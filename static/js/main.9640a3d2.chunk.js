(this.webpackJsonpexcalidraw=this.webpackJsonpexcalidraw||[]).push([[47],[,function(e,t,n){"use strict";n.d(t,"c",(function(){return r})),n.d(t,"n",(function(){return o})),n.d(t,"A",(function(){return a})),n.d(t,"o",(function(){return l})),n.d(t,"p",(function(){return c})),n.d(t,"O",(function(){return d})),n.d(t,"K",(function(){return h})),n.d(t,"e",(function(){return u})),n.d(t,"I",(function(){return m})),n.d(t,"s",(function(){return p})),n.d(t,"r",(function(){return g})),n.d(t,"d",(function(){return b})),n.d(t,"w",(function(){return f})),n.d(t,"P",(function(){return v})),n.d(t,"Y",(function(){return y})),n.d(t,"h",(function(){return x})),n.d(t,"g",(function(){return w})),n.d(t,"j",(function(){return j})),n.d(t,"m",(function(){return S})),n.d(t,"l",(function(){return E})),n.d(t,"x",(function(){return O})),n.d(t,"D",(function(){return C})),n.d(t,"t",(function(){return k})),n.d(t,"v",(function(){return I})),n.d(t,"L",(function(){return M})),n.d(t,"z",(function(){return A})),n.d(t,"N",(function(){return T})),n.d(t,"T",(function(){return L})),n.d(t,"R",(function(){return D})),n.d(t,"S",(function(){return P})),n.d(t,"X",(function(){return z})),n.d(t,"J",(function(){return N})),n.d(t,"Z",(function(){return R})),n.d(t,"y",(function(){return B})),n.d(t,"a",(function(){return H})),n.d(t,"E",(function(){return _})),n.d(t,"Q",(function(){return F})),n.d(t,"V",(function(){return U})),n.d(t,"U",(function(){return V})),n.d(t,"k",(function(){return G})),n.d(t,"H",(function(){return W})),n.d(t,"G",(function(){return K})),n.d(t,"F",(function(){return Y})),n.d(t,"C",(function(){return Z})),n.d(t,"u",(function(){return X})),n.d(t,"f",(function(){return q})),n.d(t,"i",(function(){return J})),n.d(t,"b",(function(){return Q})),n.d(t,"B",(function(){return $})),n.d(t,"M",(function(){return ee})),n.d(t,"q",(function(){return te})),n.d(t,"W",(function(){return ne}));var i=n(48),s=n.n(i);const r="Excalidraw",o=10,a=8,l=5,c=1,d=30,h=Math.PI/12,u={TEXT:"text",CROSSHAIR:"crosshair",GRABBING:"grabbing",GRAB:"grab",POINTER:"pointer",MOVE:"move",AUTO:""},m={MAIN:0,WHEEL:1,SECONDARY:2,TOUCH:-1};let p;!function(e){e.COPY="copy",e.PASTE="paste",e.CUT="cut",e.KEYDOWN="keydown",e.KEYUP="keyup",e.MOUSE_MOVE="mousemove",e.RESIZE="resize",e.UNLOAD="unload",e.FOCUS="focus",e.BLUR="blur",e.DRAG_OVER="dragover",e.DROP="drop",e.GESTURE_END="gestureend",e.BEFORE_UNLOAD="beforeunload",e.GESTURE_START="gesturestart",e.GESTURE_CHANGE="gesturechange",e.POINTER_MOVE="pointermove",e.POINTER_UP="pointerup",e.STATE_CHANGE="statechange",e.WHEEL="wheel",e.TOUCH_START="touchstart",e.TOUCH_END="touchend",e.HASHCHANGE="hashchange",e.VISIBILITY_CHANGE="visibilitychange",e.SCROLL="scroll"}(p||(p={}));const g={TEST:"test",DEVELOPMENT:"development"},b={SHAPE_ACTIONS_MENU:"App-menu__left"},f={Virgil:1,Helvetica:2,Cascadia:3},v={LIGHT:"light",DARK:"dark"},y="Segoe UI Emoji",x=20,w=f.Virgil,j="left",S="top",E="{version}",O=20,C={excalidraw:"application/vnd.excalidraw+json",excalidrawlib:"application/vnd.excalidrawlib+json",json:"application/json",svg:"image/svg+xml",png:"image/png",jpg:"image/jpeg",gif:"image/gif",binary:"application/octet-stream"},k={excalidraw:"excalidraw",excalidrawClipboard:"excalidraw/clipboard",excalidrawLibrary:"excalidrawlib"},I=window.location.origin,M={LOCAL_STORAGE_LIBRARY:"excalidraw-library"},A=500,T=300,L=500,D=1e4,P=5e3,z=3e4,N=100,R=.1,B=6e4,H=3e3,_={VIEW:"viewMode",ZEN:"zenMode",GRID:"gridMode"},F=s.a.themeFilter,U={addLibrary:"addLibrary"},V={addLibrary:"addLibrary"},G={canvasActions:{changeViewBackgroundColor:!0,clearCanvas:!0,export:{saveFileToDisk:!0},loadScene:!0,saveToActiveFile:!0,theme:!0,saveAsImage:!0}},W=730,K=1e3,Y=500,Z=2,X=[1,2,3],q=10,J=1440,Q=[C.png,C.jpg,C.svg,C.gif],$=2097152,ee="http://www.w3.org/2000/svg",te=128,ne={excalidraw:2,excalidrawLibrary:2}},,,,,,,function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"d",(function(){return r})),n.d(t,"c",(function(){return a})),n.d(t,"b",(function(){return l}));var i=n(1);const s=12,r=async e=>{const t=await window.crypto.subtle.generateKey({name:"AES-GCM",length:i.q},!0,["encrypt","decrypt"]);return"cryptoKey"===e?t:(await window.crypto.subtle.exportKey("jwk",t)).k},o=(e,t)=>window.crypto.subtle.importKey("jwk",{alg:"A128GCM",ext:!0,k:e,key_ops:["encrypt","decrypt"],kty:"oct"},{name:"AES-GCM",length:i.q},!1,[t]),a=async(e,t)=>{const n="string"===typeof e?await o(e,"encrypt"):e,i=(()=>{const e=new Uint8Array(s);return window.crypto.getRandomValues(e)})(),r="string"===typeof t?(new TextEncoder).encode(t):t instanceof Uint8Array?t:t instanceof Blob?await t.arrayBuffer():t;return{encryptedBuffer:await window.crypto.subtle.encrypt({name:"AES-GCM",iv:i},n,r),iv:i}},l=async(e,t,n)=>{const i=await o(n,"decrypt");return window.crypto.subtle.decrypt({name:"AES-GCM",iv:e},i,t)}},function(e,t,n){"use strict";(function(e){var i,s;n.d(t,"a",(function(){return r}));const r="undefined"!==typeof e&&(null===(i=Object({NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GIT_SHA:"",REACT_APP_BACKEND_V2_GET_URL:"https://json.excalidraw.com/api/v2/",REACT_APP_BACKEND_V2_POST_URL:"https://json.excalidraw.com/api/v2/post/",REACT_APP_LIBRARY_URL:"https://libraries.excalidraw.com",REACT_APP_LIBRARY_BACKEND:"https://us-central1-excalidraw-room-persistence.cloudfunctions.net/libraries",REACT_APP_SOCKET_SERVER_URL:"https://oss-collab-us1.excalidraw.com",REACT_APP_FIREBASE_CONFIG:'{"apiKey":"AIzaSyAd15pYlMci_xIp9ko6wkEsDzAAA0Dn0RU","authDomain":"excalidraw-room-persistence.firebaseapp.com","databaseURL":"https://excalidraw-room-persistence.firebaseio.com","projectId":"excalidraw-room-persistence","storageBucket":"excalidraw-room-persistence.appspot.com","messagingSenderId":"654800341332","appId":"1:654800341332:web:4a692de832b55bd57ce0c1"}',REACT_APP_GOOGLE_ANALYTICS_ID:"UA-387204-13"}))||void 0===i?void 0:i.REACT_APP_GOOGLE_ANALYTICS_ID)&&"undefined"!==typeof window&&window.gtag?(e,t,n,i)=>{window.gtag("event",t,{event_category:e,event_label:n,value:i})}:("undefined"!==typeof e&&(null===(s=Object({NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GIT_SHA:"",REACT_APP_BACKEND_V2_GET_URL:"https://json.excalidraw.com/api/v2/",REACT_APP_BACKEND_V2_POST_URL:"https://json.excalidraw.com/api/v2/post/",REACT_APP_LIBRARY_URL:"https://libraries.excalidraw.com",REACT_APP_LIBRARY_BACKEND:"https://us-central1-excalidraw-room-persistence.cloudfunctions.net/libraries",REACT_APP_SOCKET_SERVER_URL:"https://oss-collab-us1.excalidraw.com",REACT_APP_FIREBASE_CONFIG:'{"apiKey":"AIzaSyAd15pYlMci_xIp9ko6wkEsDzAAA0Dn0RU","authDomain":"excalidraw-room-persistence.firebaseapp.com","databaseURL":"https://excalidraw-room-persistence.firebaseio.com","projectId":"excalidraw-room-persistence","storageBucket":"excalidraw-room-persistence.appspot.com","messagingSenderId":"654800341332","appId":"1:654800341332:web:4a692de832b55bd57ce0c1"}',REACT_APP_GOOGLE_ANALYTICS_ID:"UA-387204-13"}))||void 0===s||s.JEST_WORKER_ID),(e,t,n,i)=>{})}).call(this,n(41))},,,,,,,,,,function(e,t,n){"use strict";n.d(t,"f",(function(){return l})),n.d(t,"a",(function(){return c})),n.d(t,"e",(function(){return d})),n.d(t,"c",(function(){return h})),n.d(t,"b",(function(){return b})),n.d(t,"d",(function(){return f}));var i=n(28),s=n(8);const r=e=>new Promise(((t,n)=>{const i="string"===typeof e?new Blob([(new TextEncoder).encode(e)]):new Blob([e instanceof Uint8Array?e:new Uint8Array(e)]),s=new FileReader;s.onload=e=>{if(!e.target||"string"!==typeof e.target.result)return n(new Error("couldn't convert to byte string"));t(e.target.result)},s.readAsBinaryString(i)})),o=e=>{const t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(let i=0,s=e.length;i<s;i++)n[i]=e.charCodeAt(i);return t},a=e=>new TextDecoder("utf-8").decode(o(e)),l=async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t?window.btoa(e):window.btoa(await r(e))},c=async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t?window.atob(e):a(window.atob(e))},d=async e=>{let t,{text:n,compress:s}=e;if(!1!==s)try{t=await r(Object(i.deflate)(n))}catch(o){console.error("encode: cannot deflate",o)}return{version:"1",encoding:"bstring",compressed:!!t,encoded:t||await r(n)}},h=async e=>{let t;if("bstring"!==e.encoding)throw new Error('decode: unknown encoding "'.concat(e.encoding,'"'));return t=e.compressed?e.encoded:await a(e.encoded),e.compressed?Object(i.inflate)(new Uint8Array(o(t)),{to:"string"}):t},u={1:8,2:16,4:32};function m(e,t,n,i){if(null!=i){if(i>Math.pow(2,u[t])-1)throw new Error("attempting to set value higher than the allocated bytes (value: ".concat(i,", bytes: ").concat(t,")"));const s="setUint".concat(u[t]);return new DataView(e.buffer)[s](n,i),e}const s="getUint".concat(u[t]);return new DataView(e.buffer)[s](n)}const p=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=new Uint8Array(4+4*t.length+t.reduce(((e,t)=>e+t.byteLength),0));let s=0;m(i,4,s,1),s+=4;for(const r of t)m(i,4,s,r.byteLength),s+=4,i.set(r,s),s+=r.byteLength;return i},g=e=>{const t=[];let n=0;const i=m(e,4,n);if(i>1)throw new Error("invalid version ".concat(i));for(n+=4;;){const i=m(e,4,n);if(n+=4,t.push(e.slice(n,n+i)),n+=i,n>=e.byteLength)break}return t},b=async(e,t)=>{const n=(new TextEncoder).encode(JSON.stringify({version:2,compression:"pako@1",encryption:"AES-GCM"})),r=(new TextEncoder).encode(JSON.stringify(t.metadata||null)),{iv:o,buffer:a}=await(async(e,t)=>{const{encryptedBuffer:n,iv:r}=await Object(s.c)(t,Object(i.deflate)(e));return{iv:r,buffer:new Uint8Array(n)}})(p(r,e),t.encryptionKey);return p(n,o,a)},f=async(e,t)=>{const[n,r,o]=g(e),a=JSON.parse((new TextDecoder).decode(n));try{const[e,n]=g(await(async(e,t,n,r)=>(t=new Uint8Array(await Object(s.b)(e,t,n)),r?Object(i.inflate)(t):t))(r,o,t.decryptionKey,!!a.compression));return{metadata:JSON.parse((new TextDecoder).decode(e)),data:n}}catch(l){throw console.error("Error during decompressing and decrypting the file.",a),l}}},,,,,,,,,,,function(e,t,n){},,,,,,,function(e){e.exports=JSON.parse('{"labels":{"paste":"Paste","pasteCharts":"Paste charts","selectAll":"Select all","multiSelect":"Add element to selection","moveCanvas":"Move canvas","cut":"Cut","copy":"Copy","copyAsPng":"Copy to clipboard as PNG","copyAsSvg":"Copy to clipboard as SVG","bringForward":"Bring forward","sendToBack":"Send to back","bringToFront":"Bring to front","sendBackward":"Send backward","delete":"Delete","copyStyles":"Copy styles","pasteStyles":"Paste styles","stroke":"Stroke","background":"Background","fill":"Fill","strokeWidth":"Stroke width","strokeStyle":"Stroke style","strokeStyle_solid":"Solid","strokeStyle_dashed":"Dashed","strokeStyle_dotted":"Dotted","sloppiness":"Sloppiness","opacity":"Opacity","textAlign":"Text align","edges":"Edges","sharp":"Sharp","round":"Round","arrowheads":"Arrowheads","arrowhead_none":"None","arrowhead_arrow":"Arrow","arrowhead_bar":"Bar","arrowhead_dot":"Dot","arrowhead_triangle":"Triangle","fontSize":"Font size","fontFamily":"Font family","onlySelected":"Only selected","withBackground":"Background","exportEmbedScene":"Embed scene","exportEmbedScene_details":"Scene data will be saved into the exported PNG/SVG file so that the scene can be restored from it.\\nWill increase exported file size.","addWatermark":"Add \\"Made with Excalidraw\\"","handDrawn":"Hand-drawn","normal":"Normal","code":"Code","small":"Small","medium":"Medium","large":"Large","veryLarge":"Very large","solid":"Solid","hachure":"Hachure","crossHatch":"Cross-hatch","thin":"Thin","bold":"Bold","left":"Left","center":"Center","right":"Right","extraBold":"Extra bold","architect":"Architect","artist":"Artist","cartoonist":"Cartoonist","fileTitle":"File name","colorPicker":"Color picker","canvasBackground":"Canvas background","drawingCanvas":"Drawing canvas","layers":"Layers","actions":"Actions","language":"Language","liveCollaboration":"Live collaboration","duplicateSelection":"Duplicate","untitled":"Untitled","name":"Name","yourName":"Your name","madeWithExcalidraw":"Made with Excalidraw","group":"Group selection","ungroup":"Ungroup selection","collaborators":"Collaborators","showGrid":"Show grid","addToLibrary":"Add to library","removeFromLibrary":"Remove from library","libraryLoadingMessage":"Loading library\u2026","libraries":"Browse libraries","loadingScene":"Loading scene\u2026","align":"Align","alignTop":"Align top","alignBottom":"Align bottom","alignLeft":"Align left","alignRight":"Align right","centerVertically":"Center vertically","centerHorizontally":"Center horizontally","distributeHorizontally":"Distribute horizontally","distributeVertically":"Distribute vertically","flipHorizontal":"Flip horizontal","flipVertical":"Flip vertical","viewMode":"View mode","toggleExportColorScheme":"Toggle export color scheme","share":"Share","showStroke":"Show stroke color picker","showBackground":"Show background color picker","toggleTheme":"Toggle theme","personalLib":"Personal Library","excalidrawLib":"Excalidraw Library"},"buttons":{"clearReset":"Reset the canvas","exportJSON":"Export to file","exportImage":"Save as image","export":"Export","exportToPng":"Export to PNG","exportToSvg":"Export to SVG","copyToClipboard":"Copy to clipboard","copyPngToClipboard":"Copy PNG to clipboard","scale":"Scale","save":"Save to current file","saveAs":"Save as","load":"Load","getShareableLink":"Get shareable link","close":"Close","selectLanguage":"Select language","scrollBackToContent":"Scroll back to content","zoomIn":"Zoom in","zoomOut":"Zoom out","resetZoom":"Reset zoom","menu":"Menu","done":"Done","edit":"Edit","undo":"Undo","redo":"Redo","resetLibrary":"Reset library","createNewRoom":"Create new room","fullScreen":"Full screen","darkMode":"Dark mode","lightMode":"Light mode","zenMode":"Zen mode","exitZenMode":"Exit zen mode","cancel":"Cancel","clear":"Clear","remove":"Remove","publishLibrary":"Publish","submit":"Submit","confirm":"Confirm"},"alerts":{"clearReset":"This will clear the whole canvas. Are you sure?","couldNotCreateShareableLink":"Couldn\'t create shareable link.","couldNotCreateShareableLinkTooBig":"Couldn\'t create shareable link: the scene is too big","couldNotLoadInvalidFile":"Couldn\'t load invalid file","importBackendFailed":"Importing from backend failed.","cannotExportEmptyCanvas":"Cannot export empty canvas.","couldNotCopyToClipboard":"Couldn\'t copy to clipboard. Try using Chrome browser.","decryptFailed":"Couldn\'t decrypt data.","uploadedSecurly":"The upload has been secured with end-to-end encryption, which means that Excalidraw server and third parties can\'t read the content.","loadSceneOverridePrompt":"Loading external drawing will replace your existing content. Do you wish to continue?","collabStopOverridePrompt":"Stopping the session will overwrite your previous, locally stored drawing. Are you sure?\\n\\n(If you want to keep your local drawing, simply close the browser tab instead.)","errorLoadingLibrary":"There was an error loading the third party library.","errorAddingToLibrary":"Couldn\'t add item to the library","errorRemovingFromLibrary":"Couldn\'t remove item from the library","confirmAddLibrary":"This will add {{numShapes}} shape(s) to your library. Are you sure?","imageDoesNotContainScene":"This image does not seem to contain any scene data. Have you enabled scene embedding during export?","cannotRestoreFromImage":"Scene couldn\'t be restored from this image file","invalidSceneUrl":"Couldn\'t import scene from the supplied URL. It\'s either malformed, or doesn\'t contain valid Excalidraw JSON data.","resetLibrary":"This will clear your library. Are you sure?","removeItemsFromsLibrary":"Delete {{count}} item(s) from library?","invalidEncryptionKey":"Encryption key must be of 22 characters. Live collaboration is disabled."},"errors":{"unsupportedFileType":"Unsupported file type.","imageInsertError":"Couldn\'t insert image. Try again later...","fileTooBig":"File is too big. Maximum allowed size is {{maxSize}}.","svgImageInsertError":"Couldn\'t insert SVG image. The SVG markup looks invalid.","invalidSVGString":"Invalid SVG."},"toolBar":{"selection":"Selection","image":"Insert image","rectangle":"Rectangle","diamond":"Diamond","ellipse":"Ellipse","arrow":"Arrow","line":"Line","freedraw":"Draw","text":"Text","library":"Library","lock":"Keep selected tool active after drawing"},"headings":{"canvasActions":"Canvas actions","selectedShapeActions":"Selected shape actions","shapes":"Shapes"},"hints":{"canvasPanning":"To move canvas, hold mouse wheel or spacebar while dragging","linearElement":"Click to start multiple points, drag for single line","freeDraw":"Click and drag, release when you\'re finished","text":"Tip: you can also add text by double-clicking anywhere with the selection tool","text_selected":"Double-click or press ENTER to edit text","text_editing":"Press Escape or CtrlOrCmd+ENTER to finish editing","linearElementMulti":"Click on last point or press Escape or Enter to finish","lockAngle":"You can constrain angle by holding SHIFT","resize":"You can constrain proportions by holding SHIFT while resizing,\\nhold ALT to resize from the center","resizeImage":"You can resize freely by holding SHIFT,\\nhold ALT to resize from the center","rotate":"You can constrain angles by holding SHIFT while rotating","lineEditor_info":"Double-click or press Enter to edit points","lineEditor_pointSelected":"Press Delete to remove point, CtrlOrCmd+D to duplicate, or drag to move","lineEditor_nothingSelected":"Select a point to move or remove, or hold Alt and click to add new points","placeImage":"Click to place the image, or click and drag to set its size manually","publishLibrary":"Publish your own library"},"canvasError":{"cannotShowPreview":"Cannot show preview","canvasTooBig":"The canvas may be too big.","canvasTooBigTip":"Tip: try moving the farthest elements a bit closer together."},"errorSplash":{"headingMain_pre":"Encountered an error. Try ","headingMain_button":"reloading the page.","clearCanvasMessage":"If reloading doesn\'t work, try ","clearCanvasMessage_button":"clearing the canvas.","clearCanvasCaveat":" This will result in loss of work ","trackedToSentry_pre":"The error with identifier ","trackedToSentry_post":" was tracked on our system.","openIssueMessage_pre":"We were very cautious not to include your scene information on the error. If your scene is not private, please consider following up on our ","openIssueMessage_button":"bug tracker.","openIssueMessage_post":" Please include information below by copying and pasting into the GitHub issue.","sceneContent":"Scene content:"},"roomDialog":{"desc_intro":"You can invite people to your current scene to collaborate with you.","desc_privacy":"Don\'t worry, the session uses end-to-end encryption, so whatever you draw will stay private. Not even our server will be able to see what you come up with.","button_startSession":"Start session","button_stopSession":"Stop session","desc_inProgressIntro":"Live-collaboration session is now in progress.","desc_shareLink":"Share this link with anyone you want to collaborate with:","desc_exitSession":"Stopping the session will disconnect you from the room, but you\'ll be able to continue working with the scene, locally. Note that this won\'t affect other people, and they\'ll still be able to collaborate on their version.","shareTitle":"Join a live collaboration session on Excalidraw"},"errorDialog":{"title":"Error"},"exportDialog":{"disk_title":"Save to disk","disk_details":"Export the scene data to a file from which you can import later.","disk_button":"Save to file","link_title":"Shareable link","link_details":"Export as a read-only link.","link_button":"Export to Link","excalidrawplus_description":"Save the scene to your Excalidraw+ workspace.","excalidrawplus_button":"Export","excalidrawplus_exportError":"Couldn\'t export to Excalidraw+ at this moment..."},"helpDialog":{"blog":"Read our blog","click":"click","curvedArrow":"Curved arrow","curvedLine":"Curved line","documentation":"Documentation","doubleClick":"double-click","drag":"drag","editor":"Editor","editSelectedShape":"Edit selected shape (text/arrow/line)","github":"Found an issue? Submit","howto":"Follow our guides","or":"or","preventBinding":"Prevent arrow binding","shapes":"Shapes","shortcuts":"Keyboard shortcuts","textFinish":"Finish editing (text editor)","textNewLine":"Add new line (text editor)","title":"Help","view":"View","zoomToFit":"Zoom to fit all elements","zoomToSelection":"Zoom to selection"},"clearCanvasDialog":{"title":"Clear canvas"},"publishDialog":{"title":"Publish library","itemName":"Item name","authorName":"Author name","githubUsername":"GitHub username","twitterUsername":"Twitter username","libraryName":"Library name","libraryDesc":"Library description","website":"Website","placeholder":{"authorName":"Your name or username","libraryName":"Name of your library","libraryDesc":"Description of your library to help people understand its usage","githubHandle":"GitHub handle (optional), so you can edit the library once submitted for review","twitterHandle":"Twitter username (optional), so we know who to credit when promoting over Twitter","website":"Link to your personal website or elsewhere (optional)"},"errors":{"required":"Required","website":"Enter a valid URL"},"noteDescription":{"pre":"Submit your library to be included in the ","link":"public library repository","post":"for other people to use in their drawings."},"noteGuidelines":{"pre":"The library needs to be manually approved first. Please read the ","link":"guidelines","post":" before submitting. You will need a GitHub account to communicate and make changes if requested, but it is not strictly required."},"noteLicense":{"pre":"By submitting, you agree the library will be published under the ","link":"MIT License, ","post":"which in short means anyone can use them without restrictions."},"noteItems":"Each library item must have its own name so it\'s filterable. The following library items will be included:","atleastOneLibItem":"Please select at least one library item to get started"},"publishSuccessDialog":{"title":"Library submitted","content":"Thank you {{authorName}}. Your library has been submitted for review. You can track the status","link":"here"},"confirmDialog":{"resetLibrary":"Reset library","removeItemsFromLib":"Remove selected items from library"},"encrypted":{"tooltip":"Your drawings are end-to-end encrypted so Excalidraw\'s servers will never see them.","link":"Blog post on end-to-end encryption in Excalidraw"},"stats":{"angle":"Angle","element":"Element","elements":"Elements","height":"Height","scene":"Scene","selected":"Selected","storage":"Storage","title":"Stats for nerds","total":"Total","version":"Version","versionCopy":"Click to copy","versionNotAvailable":"Version not available","width":"Width"},"toast":{"addedToLibrary":"Added to library","copyStyles":"Copied styles.","copyToClipboard":"Copied to clipboard.","copyToClipboardAsPng":"Copied {{exportSelection}} to clipboard as PNG\\n({{exportColorScheme}})","fileSaved":"File saved.","fileSavedToFilename":"Saved to {filename}","canvas":"canvas","selection":"selection"},"colors":{"495057":"Gray 7","ffffff":"White","f8f9fa":"Gray 0","f1f3f5":"Gray 1","fff5f5":"Red 0","fff0f6":"Pink 0","f8f0fc":"Grape 0","f3f0ff":"Violet 0","edf2ff":"Indigo 0","e7f5ff":"Blue 0","e3fafc":"Cyan 0","e6fcf5":"Teal 0","ebfbee":"Green 0","f4fce3":"Lime 0","fff9db":"Yellow 0","fff4e6":"Orange 0","transparent":"Transparent","ced4da":"Gray 4","868e96":"Gray 6","fa5252":"Red 6","e64980":"Pink 6","be4bdb":"Grape 6","7950f2":"Violet 6","4c6ef5":"Indigo 6","228be6":"Blue 6","15aabf":"Cyan 6","12b886":"Teal 6","40c057":"Green 6","82c91e":"Lime 6","fab005":"Yellow 6","fd7e14":"Orange 6","000000":"Black","343a40":"Gray 8","c92a2a":"Red 9","a61e4d":"Pink 9","862e9c":"Grape 9","5f3dc4":"Violet 9","364fc7":"Indigo 9","1864ab":"Blue 9","0b7285":"Cyan 9","087f5b":"Teal 9","2b8a3e":"Green 9","5c940d":"Lime 9","e67700":"Yellow 9","d9480f":"Orange 9"}}')},function(e){e.exports=JSON.parse('{"ar-SA":86,"bg-BG":59,"bn-BD":0,"ca-ES":78,"cs-CZ":25,"da-DK":17,"de-DE":100,"el-GR":88,"en":100,"es-ES":88,"fa-IR":66,"fi-FI":100,"fr-FR":100,"he-IL":84,"hi-IN":58,"hu-HU":52,"id-ID":100,"it-IT":100,"ja-JP":99,"kab-KAB":82,"kk-KZ":24,"ko-KR":58,"lv-LV":100,"my-MM":49,"nb-NO":100,"nl-NL":93,"nn-NO":87,"oc-FR":99,"pa-IN":84,"pl-PL":97,"pt-BR":99,"pt-PT":87,"ro-RO":100,"ru-RU":86,"si-LK":9,"sk-SK":99,"sv-SE":99,"ta-IN":98,"tr-TR":78,"uk-UA":85,"zh-CN":92,"zh-HK":29,"zh-TW":100}')},,function(e){e.exports=JSON.parse('{"name":"@excalidraw/excalidraw","version":"0.10.0","main":"main.js","types":"types/packages/excalidraw/index.d.ts","files":["dist/*","types/*"],"publishConfig":{"access":"public"},"description":"Excalidraw as a React component","repository":"https://github.com/excalidraw/excalidraw","license":"MIT","keywords":["excalidraw","excalidraw-embed","react","npm","npm excalidraw"],"browserslist":{"production":[">0.2%","not dead","not ie <= 11","not op_mini all","not safari < 12","not kaios <= 2.5","not edge < 79","not chrome < 70","not and_uc < 13","not samsung < 10"],"development":["last 1 chrome version","last 1 firefox version","last 1 safari version"]},"peerDependencies":{"react":"^17.0.2","react-dom":"^17.0.2"},"devDependencies":{"@babel/core":"7.16.0","@babel/plugin-transform-arrow-functions":"7.16.0","@babel/plugin-transform-async-to-generator":"7.16.0","@babel/plugin-transform-runtime":"7.16.4","@babel/plugin-transform-typescript":"7.16.1","@babel/preset-env":"7.16.4","@babel/preset-react":"7.16.0","@babel/preset-typescript":"7.16.0","autoprefixer":"10.4.0","babel-loader":"8.2.3","babel-plugin-transform-class-properties":"6.24.1","cross-env":"7.0.3","css-loader":"6.5.1","file-loader":"6.2.0","mini-css-extract-plugin":"2.4.5","postcss-loader":"6.2.0","sass-loader":"12.3.0","terser-webpack-plugin":"5.2.5","ts-loader":"9.2.6","typescript":"4.5.2","webpack":"5.64.3","webpack-bundle-analyzer":"4.5.0","webpack-cli":"4.9.1"},"bugs":"https://github.com/excalidraw/excalidraw/issues","homepage":"https://github.com/excalidraw/excalidraw/tree/master/src/packages/excalidraw","scripts":{"gen:types":"tsc --project ../../../tsconfig-types.json","build:umd":"cross-env NODE_ENV=production webpack --config webpack.prod.config.js && cross-env NODE_ENV=development webpack --config webpack.dev.config.js && yarn gen:types","build:umd:withAnalyzer":"cross-env NODE_ENV=production ANALYZER=true webpack --config webpack.prod.config.js","pack":"yarn build:umd && yarn pack"},"dependencies":{"dotenv":"10.0.0"}}')},,function(e,t,n){},,,,,,function(e,t,n){e.exports={themeFilter:"invert(93%) hue-rotate(180deg)"}},,,,,,,,,,function(e,t,n){var i={"./ar-SA.json":[109,4],"./bg-BG.json":[110,5],"./bn-BD.json":[111,6],"./ca-ES.json":[112,7],"./cs-CZ.json":[113,8],"./da-DK.json":[114,9],"./de-DE.json":[115,10],"./el-GR.json":[116,11],"./en.json":[37],"./es-ES.json":[117,12],"./fa-IR.json":[118,13],"./fi-FI.json":[119,14],"./fr-FR.json":[120,15],"./he-IL.json":[121,16],"./hi-IN.json":[122,17],"./hu-HU.json":[123,18],"./id-ID.json":[124,19],"./it-IT.json":[125,20],"./ja-JP.json":[126,21],"./kab-KAB.json":[127,22],"./kk-KZ.json":[128,23],"./ko-KR.json":[129,24],"./lv-LV.json":[130,25],"./my-MM.json":[131,26],"./nb-NO.json":[132,27],"./nl-NL.json":[133,28],"./nn-NO.json":[134,29],"./oc-FR.json":[135,30],"./pa-IN.json":[136,31],"./percentages.json":[38],"./pl-PL.json":[137,32],"./pt-BR.json":[138,33],"./pt-PT.json":[139,34],"./ro-RO.json":[140,35],"./ru-RU.json":[141,36],"./si-LK.json":[142,37],"./sk-SK.json":[143,38],"./sv-SE.json":[144,39],"./ta-IN.json":[145,40],"./tr-TR.json":[146,41],"./uk-UA.json":[147,42],"./zh-CN.json":[148,43],"./zh-HK.json":[149,44],"./zh-TW.json":[150,45]};function s(e){if(!n.o(i,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=i[e],s=t[0];return Promise.all(t.slice(1).map(n.e)).then((function(){return n.t(s,3)}))}s.keys=function(){return Object.keys(i)},s.id=58,e.exports=s},function(e,t,n){},,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},,function(e,t,n){},function(e,t,n){},,,,,,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var i=n(12),s=n.n(i),r=n(51),o=n(2),a=n.n(o),l=n(9),c=n(4),d=n(1),h=n(37),u=n(38);const m={code:"en",label:"English"},p=[{code:"ar-SA",label:"\u0627\u0644\u0639\u0631\u0628\u064a\u0629",rtl:!0},{code:"bg-BG",label:"\u0411\u044a\u043b\u0433\u0430\u0440\u0441\u043a\u0438"},{code:"ca-ES",label:"Catal\xe0"},{code:"de-DE",label:"Deutsch"},{code:"el-GR",label:"\u0395\u03bb\u03bb\u03b7\u03bd\u03b9\u03ba\u03ac"},{code:"es-ES",label:"Espa\xf1ol"},{code:"fa-IR",label:"\u0641\u0627\u0631\u0633\u06cc",rtl:!0},{code:"fi-FI",label:"Suomi"},{code:"fr-FR",label:"Fran\xe7ais"},{code:"he-IL",label:"\u05e2\u05d1\u05e8\u05d9\u05ea",rtl:!0},{code:"hi-IN",label:"\u0939\u093f\u0928\u094d\u0926\u0940"},{code:"hu-HU",label:"Magyar"},{code:"id-ID",label:"Bahasa Indonesia"},{code:"it-IT",label:"Italiano"},{code:"ja-JP",label:"\u65e5\u672c\u8a9e"},{code:"kab-KAB",label:"Taqbaylit"},{code:"ko-KR",label:"\ud55c\uad6d\uc5b4"},{code:"my-MM",label:"Burmese"},{code:"nb-NO",label:"Norsk bokm\xe5l"},{code:"nl-NL",label:"Nederlands"},{code:"nn-NO",label:"Norsk nynorsk"},{code:"oc-FR",label:"Occitan"},{code:"pa-IN",label:"\u0a2a\u0a70\u0a1c\u0a3e\u0a2c\u0a40"},{code:"pl-PL",label:"Polski"},{code:"pt-BR",label:"Portugu\xeas Brasileiro"},{code:"pt-PT",label:"Portugu\xeas"},{code:"ro-RO",label:"Rom\xe2n\u0103"},{code:"ru-RU",label:"\u0420\u0443\u0441\u0441\u043a\u0438\u0439"},{code:"sk-SK",label:"Sloven\u010dina"},{code:"sv-SE",label:"Svenska"},{code:"tr-TR",label:"T\xfcrk\xe7e"},{code:"uk-UA",label:"\u0423\u043a\u0440\u0430\u0457\u043d\u0441\u044c\u043a\u0430"},{code:"zh-CN",label:"\u7b80\u4f53\u4e2d\u6587"},{code:"zh-TW",label:"\u7e41\u9ad4\u4e2d\u6587"},{code:"lv-LV",label:"Latvie\u0161u"},{code:"cs-CZ",label:"\u010cesky"},{code:"kk-KZ",label:"\u049a\u0430\u0437\u0430\u049b \u0442\u0456\u043b\u0456"}].concat([m]).sort(((e,t)=>e.label>t.label?1:-1)).filter((e=>u[e.code]>=85)),g="__test__";"production"===d.r.DEVELOPMENT&&p.unshift({code:g,label:"test language"},{code:"".concat(g,".rtl"),label:"\u202atest language (rtl)\u202c",rtl:!0});let b=m,f={};const v=async e=>{b=e,document.documentElement.dir=b.rtl?"rtl":"ltr",document.documentElement.lang=b.code,f=e.code.startsWith(g)?{}:await n(58)("./".concat(b.code,".json"))},y=()=>b,x=(e,t)=>{for(let n=0;n<t.length;++n){const i=t[n];if(void 0===e[i])return;e=e[i]}if("string"===typeof e)return e},w=(e,t)=>{if(b.code.startsWith(g)){const n=t?"".concat(e,"(").concat(JSON.stringify(t).slice(1,-1),")"):e;return"\u202a[[".concat(n,"]]\u202c")}const n=e.split(".");let i=x(f,n)||x(h,n);if(void 0===i)throw new Error("Can't find translation for ".concat(e));if(t)for(const s in t)i=i.replace("{{".concat(s,"}}"),String(t[s]));return i},j=e=>[c.red[e],c.pink[e],c.grape[e],c.violet[e],c.indigo[e],c.blue[e],c.cyan[e],c.teal[e],c.green[e],c.lime[e],c.yellow[e],c.orange[e]];var S={canvasBackground:[c.white,c.gray[0],c.gray[1],...j(0)],elementBackground:["transparent",c.gray[4],c.gray[6],...j(6)],elementStroke:[c.black,c.gray[8],c.gray[7],...j(9)]};const E=/Mac|iPod|iPhone|iPad/.test(window.navigator.platform),O=/^Win/.test(window.navigator.platform),C="Equal",k="Minus",I="NumpadAdd",M="NumpadSubtract",A="Numpad0",T="BracketRight",L="BracketLeft",D="Digit1",P="Digit2",z="Quote",N="Digit0",R="Slash",B="KeyC",H="KeyD",_="KeyG",F="KeyF",U="KeyH",V="KeyV",G="KeyX",W="KeyZ",K="KeyR",Y="ArrowDown",Z="ArrowLeft",X="ArrowRight",q="ArrowUp",J="Backspace",Q="Alt",$=E?"metaKey":"ctrlKey",ee="Delete",te="Enter",ne="Escape",ie="?",se=" ",re="Tab",oe="a",ae="d",le="e",ce="g",de="l",he="o",ue="p",me="q",pe="r",ge="s",be="t",fe="v",ve="x",ye="y",xe="z",we=e=>e===Z||e===X||e===Y||e===q,je=e=>e.altKey,Se=e=>e.shiftKey,Ee=e=>e.shiftKey;let Oe=null;const Ce=()=>{if(Oe)return Oe;const e=new Date,t=e.getFullYear(),n="".concat(e.getMonth()+1).padStart(2,"0"),i="".concat(e.getDate()).padStart(2,"0"),s="".concat(e.getHours()).padStart(2,"0"),r="".concat(e.getMinutes()).padStart(2,"0");return"".concat(t,"-").concat(n,"-").concat(i,"-").concat(s).concat(r)},ke=e=>e.charAt(0).toUpperCase()+e.slice(1),Ie=e=>e instanceof HTMLElement&&"wysiwyg"===e.dataset.type||e instanceof HTMLBRElement||e instanceof HTMLTextAreaElement||e instanceof HTMLInputElement&&("text"===e.type||"number"===e.type),Me=e=>{let{fontFamily:t}=e;for(const[n,i]of Object.entries(d.w))if(i===t)return"".concat(n,", ").concat(d.Y);return d.Y},Ae=e=>{let{fontSize:t,fontFamily:n}=e;return"".concat(t,"px ").concat(Me({fontFamily:n}))},Te=(e,t)=>{const n=document.createElement("div"),i=document.body;n.style.position="absolute",n.style.whiteSpace="pre",n.style.font=t,i.appendChild(n),n.innerText=e.split("\n").map((e=>e||" ")).join("\n");const s=n.offsetWidth,r=n.offsetHeight,o=document.createElement("span");o.style.display="inline-block",o.style.overflow="hidden",o.style.width="1px",o.style.height="1px",n.appendChild(o);const a=o.offsetTop+o.offsetHeight;return document.body.removeChild(n),{width:s,height:r,baseline:a}},Le=(e,t)=>{let n=0,i=null;const s=function(){for(var s=arguments.length,r=new Array(s),o=0;o<s;o++)r[o]=arguments[o];i=r,clearTimeout(n),n=window.setTimeout((()=>{i=null,e(...r)}),t)};return s.flush=()=>{if(clearTimeout(n),i){const t=i;i=null,e(...t)}},s.cancel=()=>{i=null,clearTimeout(n)},s},De=(e,t)=>Math.abs(e-t),Pe=e=>{e&&(e.style.cursor="")},ze=(e,t)=>{e&&(e.style.cursor=t)},Ne=(e,t)=>{e&&("selection"===t?Pe(e):"image"!==t&&(e.style.cursor=d.e.CROSSHAIR))},Re=()=>{var e;return"HTML"===(null===(e=document.fullscreenElement)||void 0===e?void 0:e.nodeName)},Be=e=>(e=e.replace(/\bAlt\b/i,"Alt").replace(/\bShift\b/i,"Shift").replace(/\b(Enter|Return)\b/i,"Enter").replace(/\bDel\b/i,"Delete"),E?e.replace(/\bCtrlOrCmd\b/i,"Cmd").replace(/\bAlt\b/i,"Option"):e.replace(/\bCtrlOrCmd\b/i,"Ctrl")),He=(e,t)=>{let{clientX:n,clientY:i}=e,{zoom:s,offsetLeft:r,offsetTop:o,scrollX:a,scrollY:l}=t;const c=1/s.value;return{x:(n-s.translation.x-r)*c-a,y:(i-s.translation.y-o)*c-l}},_e=(e,t)=>{let{sceneX:n,sceneY:i}=e,{zoom:s,offsetLeft:r,offsetTop:o,scrollX:a,scrollY:l}=t;return{x:(n+a+r)*s.value+s.translation.x,y:(i+l+o)*s.value+s.translation.y}},Fe=e=>getComputedStyle(document.documentElement).getPropertyValue("--".concat(e)),Ue=new RegExp("^[^".concat("A-Za-z\xc0-\xd6\xd8-\xf6\xf8-\u02b8\u0300-\u0590\u0800-\u1fff\u2c00-\ufb1c\ufdfe-\ufe6f\ufefd-\uffff","]*[").concat("\u0591-\u07ff\ufb1d-\ufdfd\ufe70-\ufefc","]")),Ve=e=>Ue.test(e),Ge=e=>{const[t,n]=e;return{x:t,y:n}},We=e=>{if("AbortError"!==(null===e||void 0===e?void 0:e.name))throw e;console.warn(e)},Ke=e=>{const t=5===e.length&&"0"===e.substr(4,1),n=9===e.length&&"00"===e.substr(7,2);return t||n||e===S.elementBackground[0]},Ye=()=>{let e,t;const n=new Promise(((n,i)=>{e=n,t=i}));return n.resolve=e,n.reject=t,n},Ze=e=>t=>{Object(i.unstable_batchedUpdates)(e,t)},Xe=(e,t)=>{const n=[{value:1,symbol:"b"},{value:1e3,symbol:"k"},{value:1e6,symbol:"M"},{value:1e9,symbol:"G"}];let i;for(i=n.length-1;i>0&&!(e>=n[i].value);i--);return(e/n[i].value).toFixed(t).replace(/\.0+$|(\.[0-9]*[1-9])0+$/,"$1")+n[i].symbol},qe=()=>{var e;return(null===(e=document.querySelector('meta[name="version"]'))||void 0===e?void 0:e.content)||d.l},Je=e=>{e.preventDefault(),e.returnValue=""},Qe=e=>Array.from(e).map((e=>"0".concat(e.toString(16)).slice(-2))).join(""),$e=()=>Date.now(),et=e=>e.reduce(((e,t)=>(e.set("string"===typeof t?t:t.id,t),e)),new Map),tt=d.u.includes(devicePixelRatio)?devicePixelRatio:1,nt=()=>({theme:d.P.LIGHT,collaborators:new Map,currentChartType:"bar",currentItemBackgroundColor:"transparent",currentItemEndArrowhead:"arrow",currentItemFillStyle:"hachure",currentItemFontFamily:d.g,currentItemFontSize:d.h,currentItemLinearStrokeSharpness:"round",currentItemOpacity:100,currentItemRoughness:1,currentItemStartArrowhead:null,currentItemStrokeColor:c.black,currentItemStrokeSharpness:"sharp",currentItemStrokeStyle:"solid",currentItemStrokeWidth:1,currentItemTextAlign:d.j,cursorButton:"up",draggingElement:null,editingElement:null,editingGroupId:null,editingLinearElement:null,elementLocked:!1,elementType:"selection",errorMessage:null,exportBackground:!0,exportScale:tt,exportEmbedScene:!1,exportWithDarkMode:!1,fileHandle:null,gridSize:null,isBindingEnabled:!0,isLibraryOpen:!1,isLoading:!1,isResizing:!1,isRotating:!1,lastPointerDownWith:"mouse",multiElement:null,name:"".concat(w("labels.untitled"),"-").concat(Ce()),openMenu:null,openPopup:null,pasteDialog:{shown:!1,data:null},previousSelectedElementIds:{},resizingElement:null,scrolledOutside:!1,scrollX:0,scrollY:0,selectedElementIds:{},selectedGroupIds:{},selectionElement:null,shouldCacheIgnoreZoom:!1,showHelpDialog:!1,showStats:!1,startBoundElement:null,suggestedBindings:[],toastMessage:null,viewBackgroundColor:c.white,zenModeEnabled:!1,zoom:{value:1,translation:{x:0,y:0}},viewModeEnabled:!1,pendingImageElement:null}),it={theme:{browser:!0,export:!1,server:!1},collaborators:{browser:!1,export:!1,server:!1},currentChartType:{browser:!0,export:!1,server:!1},currentItemBackgroundColor:{browser:!0,export:!1,server:!1},currentItemEndArrowhead:{browser:!0,export:!1,server:!1},currentItemFillStyle:{browser:!0,export:!1,server:!1},currentItemFontFamily:{browser:!0,export:!1,server:!1},currentItemFontSize:{browser:!0,export:!1,server:!1},currentItemLinearStrokeSharpness:{browser:!0,export:!1,server:!1},currentItemOpacity:{browser:!0,export:!1,server:!1},currentItemRoughness:{browser:!0,export:!1,server:!1},currentItemStartArrowhead:{browser:!0,export:!1,server:!1},currentItemStrokeColor:{browser:!0,export:!1,server:!1},currentItemStrokeSharpness:{browser:!0,export:!1,server:!1},currentItemStrokeStyle:{browser:!0,export:!1,server:!1},currentItemStrokeWidth:{browser:!0,export:!1,server:!1},currentItemTextAlign:{browser:!0,export:!1,server:!1},cursorButton:{browser:!0,export:!1,server:!1},draggingElement:{browser:!1,export:!1,server:!1},editingElement:{browser:!1,export:!1,server:!1},editingGroupId:{browser:!0,export:!1,server:!1},editingLinearElement:{browser:!1,export:!1,server:!1},elementLocked:{browser:!0,export:!1,server:!1},elementType:{browser:!0,export:!1,server:!1},errorMessage:{browser:!1,export:!1,server:!1},exportBackground:{browser:!0,export:!1,server:!1},exportEmbedScene:{browser:!0,export:!1,server:!1},exportScale:{browser:!0,export:!1,server:!1},exportWithDarkMode:{browser:!0,export:!1,server:!1},fileHandle:{browser:!1,export:!1,server:!1},gridSize:{browser:!0,export:!0,server:!0},height:{browser:!1,export:!1,server:!1},isBindingEnabled:{browser:!1,export:!1,server:!1},isLibraryOpen:{browser:!1,export:!1,server:!1},isLoading:{browser:!1,export:!1,server:!1},isResizing:{browser:!1,export:!1,server:!1},isRotating:{browser:!1,export:!1,server:!1},lastPointerDownWith:{browser:!0,export:!1,server:!1},multiElement:{browser:!1,export:!1,server:!1},name:{browser:!0,export:!1,server:!1},offsetLeft:{browser:!1,export:!1,server:!1},offsetTop:{browser:!1,export:!1,server:!1},openMenu:{browser:!0,export:!1,server:!1},openPopup:{browser:!1,export:!1,server:!1},pasteDialog:{browser:!1,export:!1,server:!1},previousSelectedElementIds:{browser:!0,export:!1,server:!1},resizingElement:{browser:!1,export:!1,server:!1},scrolledOutside:{browser:!0,export:!1,server:!1},scrollX:{browser:!0,export:!1,server:!1},scrollY:{browser:!0,export:!1,server:!1},selectedElementIds:{browser:!0,export:!1,server:!1},selectedGroupIds:{browser:!0,export:!1,server:!1},selectionElement:{browser:!1,export:!1,server:!1},shouldCacheIgnoreZoom:{browser:!0,export:!1,server:!1},showHelpDialog:{browser:!1,export:!1,server:!1},showStats:{browser:!0,export:!1,server:!1},startBoundElement:{browser:!1,export:!1,server:!1},suggestedBindings:{browser:!1,export:!1,server:!1},toastMessage:{browser:!1,export:!1,server:!1},viewBackgroundColor:{browser:!0,export:!0,server:!0},width:{browser:!1,export:!1,server:!1},zenModeEnabled:{browser:!0,export:!1,server:!1},zoom:{browser:!0,export:!1,server:!1},viewModeEnabled:{browser:!1,export:!1,server:!1},pendingImageElement:{browser:!1,export:!1,server:!1}},st=(e,t)=>{const n={};for(const i of Object.keys(e)){const s=it[i];if(null===s||void 0===s?void 0:s[t]){const t=e[i];n[i]=t}}return n},rt=e=>st(e,"browser"),ot=e=>st(e,"export"),at=e=>st(e,"server");var lt=n(5);const ct=()=>{const[e,t]=Object(o.useState)(null);return[e,Object(o.useCallback)((e=>t(e)),[])]};var dt=n(14),ht=n(18);const ut=e=>!!e&&"image"===e.type&&!!e.fileId,mt=e=>!!e&&"image"===e.type,pt=e=>null!=e&&"text"===e.type,gt=e=>null!=e&&bt(e.type),bt=e=>"freedraw"===e,ft=e=>null!=e&&vt(e.type),vt=e=>"arrow"===e||"line"===e,yt=e=>null!=e&&xt(e.type),xt=e=>"arrow"===e,wt=e=>null!=e&&("rectangle"===e.type||"diamond"===e.type||"ellipse"===e.type||"text"===e.type),jt=(e,t,n,i,s)=>[(e-n)*Math.cos(s)-(t-i)*Math.sin(s)+n,(e-n)*Math.sin(s)+(t-i)*Math.cos(s)+i],St=(e,t,n)=>jt(e[0],e[1],t[0],t[1],n),Et=(e,t,n,i,s,r,o,a)=>{const l=Math.cos(i),c=Math.sin(i);return e.e&&e.w?t+=s+o:e.e?(t+=s*(1+l),n+=s*c,t+=o*(1-l),n+=o*-c):e.w&&(t+=s*(1-l),n+=s*-c,t+=o*(1+l),n+=o*c),e.n&&e.s?n+=r+a:e.n?(t+=r*c,n+=r*(1-l),t+=a*-c,n+=a*(1+l)):e.s&&(t+=r*-c,n+=r*(1+l),t+=a*c,n+=a*(1-l)),[t,n]},Ot=(e,t,n,i)=>{const s=n-e,r=i-t;return Math.hypot(s,r)},Ct=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(e.length>=3){const[n,i]=[e[0],e[e.length-1]];return Ot(n[0],n[1],i[0],i[1])<=d.A/t}return!1},kt=(e,t,n)=>{const i=e.length;if(i<3)return!1;const s=[Number.MAX_SAFE_INTEGER,n],r=[t,n];let o=0;for(let a=0;a<i;a++){const t=e[a],n=e[(a+1)%i];if(At(t,n,r,s)){if(0===Mt(t,r,n))return It(t,r,n);o++}}return o%2===1},It=(e,t,n)=>t[0]<=Math.max(e[0],n[0])&&t[0]>=Math.min(e[0],n[0])&&t[1]<=Math.max(e[1],n[1])&&t[1]>=Math.min(e[1],n[1]),Mt=(e,t,n)=>{const i=(t[1]-e[1])*(n[0]-t[0])-(t[0]-e[0])*(n[1]-t[1]);return 0===i?0:i>0?1:2},At=(e,t,n,i)=>{const s=Mt(e,t,n),r=Mt(e,t,i),o=Mt(n,i,e),a=Mt(n,i,t);return s!==r&&o!==a||(!(0!==s||!It(e,n,t))||(!(0!==r||!It(e,i,t))||(!(0!==o||!It(n,e,i))||!(0!==a||!It(n,t,i)))))},Tt=(e,t,n)=>n?[Math.round(e/n)*n,Math.round(t/n)*n]:[e,t],Lt=e=>{const t=e.map((e=>e[0])),n=e.map((e=>e[1]));return{width:Math.max(...t)-Math.min(...t),height:Math.max(...n)-Math.min(...n)}},Dt=(e,t,n)=>{const i=n.map((t=>t[e])),s=Math.max(...i),r=Math.min(...i),o=s-r,a=0===o?1:t/o;let l=1/0;const c=n.map((t=>t.map(((t,n)=>{if(n!==e)return t;const i=t*a;return l=Math.min(i,l),i}))));if(2===c.length)return c;const d=r-l;return c.map((t=>t.map(((t,n)=>n===e?t+d:t))))},Pt=e=>gt(e)?Bt(e):ft(e)?Ht(e):[e.x,e.y,e.x+e.width,e.y+e.height],zt=e=>{for(const t of e.sets)if("path"===t.type)return t.ops;return e.sets[0].ops},Nt=(e,t)=>{let n=[0,0];const{minX:i,minY:s,maxX:r,maxY:o}=e.reduce(((e,i)=>{let{op:s,data:r}=i;if("move"===s)n=r;else if("bcurveTo"===s){const i=[r[0],r[1]],s=[r[2],r[3]],o=[r[4],r[5]],a=n;n=o;const l=(e,t)=>Math.pow(1-e,3)*o[t]+3*e*Math.pow(1-e,2)*s[t]+3*Math.pow(e,2)*(1-e)*i[t]+a[t]*Math.pow(e,3);let c=0;for(;c<=1;){let n=l(c,0),i=l(c,1);t&&([n,i]=t(n,i)),e.minY=Math.min(e.minY,i),e.minX=Math.min(e.minX,n),e.maxX=Math.max(e.maxX,n),e.maxY=Math.max(e.maxY,i),c+=.1}}return e}),{minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0});return[i,s,r,o]},Rt=e=>{let t=1/0,n=1/0,i=-1/0,s=-1/0;for(const[r,o]of e)t=Math.min(t,r),n=Math.min(n,o),i=Math.max(i,r),s=Math.max(s,o);return[t,n,i,s]},Bt=e=>{const[t,n,i,s]=Rt(e.points);return[t+e.x,n+e.y,i+e.x,s+e.y]},Ht=e=>{let t;if(e.points.length<2||!rn(e)){const{minX:n,minY:i,maxX:s,maxY:r}=e.points.reduce(((e,t)=>{let[n,i]=t;return e.minY=Math.min(e.minY,i),e.minX=Math.min(e.minX,n),e.maxX=Math.max(e.maxX,n),e.maxY=Math.max(e.maxY,i),e}),{minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0});t=[n+e.x,i+e.y,s+e.x,r+e.y]}else{const n=rn(e),i=zt(n[0]),[s,r,o,a]=Nt(i);t=[s+e.x,r+e.y,o+e.x,a+e.y]}return t},_t=e=>{let t;const[n,i,s,r]=Pt(e),o=(n+s)/2,a=(i+r)/2;if(gt(e)){const[t,n,i,s]=Rt(e.points.map((t=>{let[n,i]=t;return jt(n,i,o-e.x,a-e.y,e.angle)})));return[t+e.x,n+e.y,i+e.x,s+e.y]}if(ft(e))t=((e,t,n)=>{if(e.points.length<2||!rn(e)){const{minX:i,minY:s,maxX:r,maxY:o}=e.points.reduce(((i,s)=>{let[r,o]=s;return[r,o]=jt(e.x+r,e.y+o,t,n,e.angle),i.minY=Math.min(i.minY,o),i.minX=Math.min(i.minX,r),i.maxX=Math.max(i.maxX,r),i.maxY=Math.max(i.maxY,o),i}),{minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0});return[i,s,r,o]}const i=rn(e),s=zt(i[0]);return Nt(s,((i,s)=>jt(e.x+i,e.y+s,t,n,e.angle)))})(e,o,a);else if("diamond"===e.type){const[l,c]=jt(o,i,o,a,e.angle),[d,h]=jt(o,r,o,a,e.angle),[u,m]=jt(n,a,o,a,e.angle),[p,g]=jt(s,a,o,a,e.angle);t=[Math.min(l,d,u,p),Math.min(c,h,m,g),Math.max(l,d,u,p),Math.max(c,h,m,g)]}else if("ellipse"===e.type){const l=(s-n)/2,c=(r-i)/2,d=Math.cos(e.angle),h=Math.sin(e.angle),u=Math.hypot(l*d,c*h),m=Math.hypot(c*d,l*h);t=[o-u,a-m,o+u,a+m]}else{const[l,c]=jt(n,i,o,a,e.angle),[d,h]=jt(n,r,o,a,e.angle),[u,m]=jt(s,r,o,a,e.angle),[p,g]=jt(s,i,o,a,e.angle);t=[Math.min(l,d,u,p),Math.min(c,h,m,g),Math.max(l,d,u,p),Math.max(c,h,m,g)]}return t},Ft=e=>{if(!e.length)return[0,0,0,0];let t=1/0,n=-1/0,i=1/0,s=-1/0;return e.forEach((e=>{const[r,o,a,l]=_t(e);t=Math.min(t,r),i=Math.min(i,o),n=Math.max(n,a),s=Math.max(s,l)})),[t,i,n,s]},Ut=(e,t,n)=>{if(!ft(e)&&!gt(e))return[e.x,e.y,e.x+t,e.y+n];const i=Dt(0,t,Dt(1,n,e.points));let s;if(gt(e))s=Rt(i);else{const t=dt.a.generator(),n="sharp"===e.strokeSharpness?t.linearPath(i,an(e)):t.curve(i,an(e)),r=zt(n);s=Nt(r)}const[r,o,a,l]=s;return[r+e.x,o+e.y,a+e.x,l+e.y]},Vt=(e,t,n)=>{const i=dt.a.generator(),s="sharp"===n?i.linearPath(t,an(e)):i.curve(t,an(e)),r=zt(s),[o,a,l,c]=Nt(r);return[o+e.x,a+e.y,l+e.x,c+e.y]},Gt=e=>{const[t,n,i,s]=Ft(e);return{minX:t,minY:n,maxX:i,maxY:s}};var Wt=n(49);const Kt="invert(100%) hue-rotate(180deg) saturate(1.25)",Yt=nt(),Zt=(e,t)=>ut(e)&&!t.imageCache.has(e.fileId),Xt=(e,t)=>{var n;return"dark"===t.theme&&ut(e)&&!Zt(e,t)&&(null===(n=t.imageCache.get(e.fileId))||void 0===n?void 0:n.mimeType)!==d.D.svg},qt=e=>[8,8+e],Jt=e=>[1.5,6+e],Qt=e=>"freedraw"===e.type?12*e.strokeWidth:20,$t=document.createElement("img");$t.src="data:".concat(d.D.svg,",").concat(encodeURIComponent('<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="image" class="svg-inline--fa fa-image fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="#888" d="M464 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h416c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48zM112 120c-30.928 0-56 25.072-56 56s25.072 56 56 56 56-25.072 56-56-25.072-56-56-56zM64 384h384V272l-87.515-87.515c-4.686-4.686-12.284-4.686-16.971 0L208 320l-55.515-55.515c-4.686-4.686-12.284-4.686-16.971 0L64 336v48z"></path></svg>'));const en=document.createElement("img");en.src="data:".concat(d.D.svg,",").concat(encodeURIComponent('<svg viewBox="0 0 668 668" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2"><path d="M464 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h416c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48ZM112 120c-30.928 0-56 25.072-56 56s25.072 56 56 56 56-25.072 56-56-25.072-56-56-56ZM64 384h384V272l-87.515-87.515c-4.686-4.686-12.284-4.686-16.971 0L208 320l-55.515-55.515c-4.686-4.686-12.284-4.686-16.971 0L64 336v48Z" style="fill:#888;fill-rule:nonzero" transform="matrix(.81709 0 0 .81709 124.825 145.825)"/><path d="M256 8C119.034 8 8 119.033 8 256c0 136.967 111.034 248 248 248s248-111.034 248-248S392.967 8 256 8Zm130.108 117.892c65.448 65.448 70 165.481 20.677 235.637L150.47 105.216c70.204-49.356 170.226-44.735 235.638 20.676ZM125.892 386.108c-65.448-65.448-70-165.481-20.677-235.637L361.53 406.784c-70.203 49.356-170.226 44.736-235.638-20.676Z" style="fill:#888;fill-rule:nonzero" transform="matrix(.30366 0 0 .30366 506.822 60.065)"/></svg>'));const tn=(e,t,n,i)=>{switch(n.globalAlpha=e.opacity/100,e.type){case"rectangle":case"diamond":case"ellipse":n.lineJoin="round",n.lineCap="round",t.draw(rn(e));break;case"arrow":case"line":n.lineJoin="round",n.lineCap="round",rn(e).forEach((e=>{t.draw(e)}));break;case"freedraw":{n.save(),n.fillStyle=e.strokeColor;const t=function(e){return pn.get(e)}(e);n.fillStyle=e.strokeColor,n.fill(t),n.restore();break}case"image":{var s;const t=ut(e)?null===(s=i.imageCache.get(e.fileId))||void 0===s?void 0:s.image:void 0;null==t||t instanceof Promise?((e,t,n)=>{t.fillStyle="#E7E7E7",t.fillRect(0,0,e.width,e.height);const i=Math.min(e.width,e.height),s=Math.min(i,Math.min(.4*i,100));t.drawImage("error"===e.status?en:$t,e.width/2-s/2,e.height/2-s/2,s,s)})(e,n,i.zoom.value):n.drawImage(t,0,0,e.width,e.height);break}default:if(!pt(e))throw new Error("Unimplemented type ".concat(e.type));{const t=Ve(e.text),i=t&&!n.canvas.isConnected;i&&document.body.appendChild(n.canvas),n.canvas.setAttribute("dir",t?"rtl":"ltr"),n.save(),n.font=Ae(e),n.fillStyle=e.strokeColor,n.textAlign=e.textAlign;const s=e.text.replace(/\r\n?/g,"\n").split("\n"),r=e.height/s.length,o=e.height-e.baseline,a="center"===e.textAlign?e.width/2:"right"===e.textAlign?e.width:0;for(let e=0;e<s.length;e++)n.fillText(s[e],a,(e+1)*r-o);n.restore(),i&&n.canvas.remove()}}n.globalAlpha=1},nn=new WeakMap,sn=new WeakMap,rn=e=>sn.get(e),on=e=>sn.delete(e),an=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n={seed:e.seed,strokeLineDash:"dashed"===e.strokeStyle?qt(e.strokeWidth):"dotted"===e.strokeStyle?Jt(e.strokeWidth):void 0,disableMultiStroke:"solid"!==e.strokeStyle,strokeWidth:"solid"!==e.strokeStyle?e.strokeWidth+.5:e.strokeWidth,fillWeight:e.strokeWidth/2,hachureGap:4*e.strokeWidth,roughness:e.roughness,stroke:e.strokeColor,preserveVertices:t,fixedDecimalPlaceDigits:0};switch(e.type){case"rectangle":case"diamond":case"ellipse":return n.fillStyle=e.fillStyle,n.fill="transparent"===e.backgroundColor?void 0:e.backgroundColor,"ellipse"===e.type&&(n.curveFitting=1),n;case"line":return Ct(e.points)&&(n.fillStyle=e.fillStyle,n.fill="transparent"===e.backgroundColor?void 0:e.backgroundColor),n;case"freedraw":case"arrow":return n;default:throw new Error("Unimplemented type ".concat(e.type))}},ln=(e,t)=>{let n=sn.get(e)||null;if(!n){switch(nn.delete(e),e.type){case"rectangle":if("round"===e.strokeSharpness){const i=e.width,s=e.height,r=.25*Math.min(i,s);n=t.path("M ".concat(r," 0 L ").concat(i-r," 0 Q ").concat(i," 0, ").concat(i," ").concat(r," L ").concat(i," ").concat(s-r," Q ").concat(i," ").concat(s,", ").concat(i-r," ").concat(s," L ").concat(r," ").concat(s," Q 0 ").concat(s,", 0 ").concat(s-r," L 0 ").concat(r," Q 0 0, ").concat(r," 0"),an(e,!0))}else n=t.rectangle(0,0,e.width,e.height,an(e));break;case"diamond":{const[i,s,r,o,a,l,c,d]=(e=>{const t=Math.floor(e.width/2)+1,n=e.width,i=Math.floor(e.height/2)+1;return[t,0,n,i,t,e.height,0,i]})(e);n=t.polygon([[i,s],[r,o],[a,l],[c,d]],an(e));break}case"ellipse":n=t.ellipse(e.width/2,e.height/2,e.width,e.height,an(e));break;case"line":case"arrow":{const i=an(e),s=e.points.length?e.points:[[0,0]];if(n="sharp"===e.strokeSharpness?i.fill?[t.polygon(s,i)]:[t.linearPath(s,i)]:[t.curve(s,i)],"arrow"===e.type){const{startArrowhead:s=null,endArrowhead:r="arrow"}=e,o=(e,n,s,r)=>{const o=((e,t,n,i)=>{const s=zt(t[0]);if(s.length<1)return null;const r="start"===n?1:s.length-1,o=s[r].data,a=[o[4],o[5]],l=[o[2],o[3]],c=[o[0],o[1]],d=s[r-1];let h=[0,0];"move"===d.op?h=d.data:"bcurveTo"===d.op&&(h=[d.data[4],d.data[5]]);const u=(e,t)=>Math.pow(1-e,3)*a[t]+3*e*Math.pow(1-e,2)*l[t]+3*Math.pow(e,2)*(1-e)*c[t]+h[t]*Math.pow(e,3),[m,p]="start"===n?h:a,[g,b]=[u(.3,0),u(.3,1)],f=Math.hypot(m-g,p-b),v=(m-g)/f,y=(p-b)/f,x={arrow:30,bar:15,dot:15,triangle:15}[i];let w=0;if("arrow"===i){const[t,n]=e.points[e.points.length-1],[i,s]=e.points.length>1?e.points[e.points.length-2]:[0,0];w=Math.hypot(t-i,n-s)}else for(let A=0;A<e.points.length;A++){const[t,n]=e.points[A-1]||[0,0],[i,s]=e.points[A];w+=Math.hypot(i-t,s-n)}const j=Math.min(x,w/2),S=m-v*j,E=p-y*j;if("dot"===i)return[m,p,Math.hypot(E-p,S-m)+e.strokeWidth];const O={arrow:20,bar:90,triangle:25}[i],[C,k]=jt(S,E,m,p,-O*Math.PI/180),[I,M]=jt(S,E,m,p,O*Math.PI/180);return[m,p,C,k,I,M]})(e,n,s,r);if(null===o)return[];if("dot"===r){const[n,s,r]=o;return[t.circle(n,s,r,{...i,fill:e.strokeColor,fillStyle:"solid",stroke:"none"})]}if("triangle"===r){const[n,s,r,a,l,c]=o;return delete i.strokeLineDash,[t.polygon([[n,s],[r,a],[l,c],[n,s]],{...i,fill:e.strokeColor,fillStyle:"solid"})]}const[a,l,c,d,h,u]=o;if("dotted"===e.strokeStyle){const t=Jt(e.strokeWidth-1);i.strokeLineDash=[t[0],t[1]-1]}else delete i.strokeLineDash;return[t.line(c,d,a,l,i),t.line(h,u,a,l,i)]};if(null!==s){const t=o(e,n,"start",s);n.push(...t)}if(null!==r){const t=o(e,n,"end",r);n.push(...t)}}break}case"freedraw":gn(e),n=[];break;case"text":case"image":n=[]}sn.set(e,n)}},cn=(e,t)=>{const n=t?t.zoom:Yt.zoom,i=nn.get(e),s=i&&i.canvasZoom!==n.value&&!(null===t||void 0===t?void 0:t.shouldCacheIgnoreZoom);if(!i||s||i.theme!==t.theme){const i=((e,t,n)=>{const i=document.createElement("canvas"),s=i.getContext("2d"),r=Qt(e);let o=0,a=0;if(ft(e)||gt(e)){let[n,l,c,d]=Pt(e);n=Math.floor(n),c=Math.ceil(c),l=Math.floor(l),d=Math.ceil(d),i.width=De(n,c)*window.devicePixelRatio*t.value+r*t.value*2,i.height=De(l,d)*window.devicePixelRatio*t.value+r*t.value*2,o=e.x>n?Math.floor(De(e.x,n))*window.devicePixelRatio*t.value:0,a=e.y>l?Math.floor(De(e.y,l))*window.devicePixelRatio*t.value:0,s.translate(o,a)}else i.width=e.width*window.devicePixelRatio*t.value+r*t.value*2,i.height=e.height*window.devicePixelRatio*t.value+r*t.value*2;s.save(),s.translate(r*t.value,r*t.value),s.scale(window.devicePixelRatio*t.value,window.devicePixelRatio*t.value);const l=dt.a.canvas(i);return Xt(e,n)&&(s.filter=Kt),tn(e,l,s,n),s.restore(),{element:e,canvas:i,theme:n.theme,canvasZoom:t.value,canvasOffsetX:o,canvasOffsetY:a}})(e,n,t);return nn.set(e,i),i}return i},dn=(e,t,n,i)=>{const s=e.element,r=Qt(s);let[o,a,l,c]=Pt(s);gt(s)&&(o=Math.floor(o),l=Math.ceil(l),a=Math.floor(a),c=Math.ceil(c));const d=((o+l)/2+i.scrollX)*window.devicePixelRatio,h=((a+c)/2+i.scrollY)*window.devicePixelRatio,u=Zt(s,i),m="scale"in e.element&&!u?e.element.scale[0]:1,p="scale"in e.element&&!u?e.element.scale[1]:1;n.save(),n.scale(1/window.devicePixelRatio*m,1/window.devicePixelRatio*p),n.translate(d*m,h*p),n.rotate(s.angle*m*p),n.drawImage(e.canvas,-(l-o)/2*window.devicePixelRatio-r*e.canvasZoom/e.canvasZoom,-(c-a)/2*window.devicePixelRatio-r*e.canvasZoom/e.canvasZoom,e.canvas.width/e.canvasZoom,e.canvas.height/e.canvasZoom),n.restore()},hn=(e,t,n,i)=>{const s=t.generator;switch(e.type){case"selection":n.save(),n.translate(e.x+i.scrollX,e.y+i.scrollY),n.fillStyle="rgba(0, 0, 255, 0.10)",n.fillRect(0,0,e.width,e.height),n.restore();break;case"freedraw":if(ln(e,s),i.isExporting){const t=cn(e,i);dn(t,0,n,i)}else{const[s,r,o,a]=Pt(e),l=(s+o)/2+i.scrollX,c=(r+a)/2+i.scrollY,d=(o-s)/2-(e.x-s),h=(a-r)/2-(e.y-r);n.save(),n.translate(l,c),n.rotate(e.angle),n.translate(-d,-h),tn(e,t,n,i),n.restore()}break;case"rectangle":case"diamond":case"ellipse":case"line":case"arrow":case"image":case"text":if(ln(e,s),i.isExporting){const[s,r,o,a]=Pt(e),l=(s+o)/2+i.scrollX,c=(r+a)/2+i.scrollY,d=(o-s)/2-(e.x-s),h=(a-r)/2-(e.y-r);n.save(),n.translate(l,c),n.rotate(e.angle),n.translate(-d,-h),Xt(e,i)&&(n.filter="none"),tn(e,t,n,i),n.restore()}else{const t=cn(e,i);dn(t,0,n,i)}break;default:throw new Error("Unimplemented type ".concat(e.type))}},un=(e,t,n)=>{if("undefined"===typeof n)return e.draw(t);const i={sets:t.sets,shape:t.shape,options:{...t.options,fixedDecimalPlaceDigits:n}};return e.draw(i)},mn=(e,t,n,i,s,r,o)=>{const[a,l,c,h]=Pt(e),u=(c-a)/2-(e.x-a),m=(h-l)/2-(e.y-l),p=180*e.angle/Math.PI,g=t.generator;switch(e.type){case"selection":throw new Error("Selection rendering is not supported for SVG");case"rectangle":case"diamond":case"ellipse":{ln(e,g);const i=un(t,rn(e),d.C),o=e.opacity/100;1!==o&&(i.setAttribute("stroke-opacity","".concat(o)),i.setAttribute("fill-opacity","".concat(o))),i.setAttribute("stroke-linecap","round"),i.setAttribute("transform","translate(".concat(s||0," ").concat(r||0,") rotate(").concat(p," ").concat(u," ").concat(m,")")),n.appendChild(i);break}case"line":case"arrow":{ln(e,g);const i=n.ownerDocument.createElementNS(d.M,"g"),o=e.opacity/100;i.setAttribute("stroke-linecap","round"),rn(e).forEach((n=>{const a=un(t,n,d.C);1!==o&&(a.setAttribute("stroke-opacity","".concat(o)),a.setAttribute("fill-opacity","".concat(o))),a.setAttribute("transform","translate(".concat(s||0," ").concat(r||0,") rotate(").concat(p," ").concat(u," ").concat(m,")")),"line"===e.type&&Ct(e.points)&&"transparent"!==e.backgroundColor&&a.setAttribute("fill-rule","evenodd"),i.appendChild(a)})),n.appendChild(i);break}case"freedraw":{gn(e);const t=e.opacity/100,i=n.ownerDocument.createElementNS(d.M,"g");1!==t&&(i.setAttribute("stroke-opacity","".concat(t)),i.setAttribute("fill-opacity","".concat(t))),i.setAttribute("transform","translate(".concat(s||0," ").concat(r||0,") rotate(").concat(p," ").concat(u," ").concat(m,")"));const o=n.ownerDocument.createElementNS(d.M,"path");i.setAttribute("stroke","none"),i.setAttribute("fill",e.strokeColor),o.setAttribute("d",bn(e)),i.appendChild(o),n.appendChild(i);break}case"image":{const t=ut(e)&&i[e.fileId];if(t){const i="image-".concat(t.id);let a=n.querySelector("#".concat(i));if(!a){a=n.ownerDocument.createElementNS(d.M,"symbol"),a.id=i;const e=n.ownerDocument.createElementNS(d.M,"image");e.setAttribute("width","100%"),e.setAttribute("height","100%"),e.setAttribute("href",t.dataURL),a.appendChild(e),n.prepend(a)}const l=n.ownerDocument.createElementNS(d.M,"use");l.setAttribute("href","#".concat(i)),o&&t.mimeType!==d.D.svg&&l.setAttribute("filter",Kt),l.setAttribute("width","".concat(Math.round(e.width))),l.setAttribute("height","".concat(Math.round(e.height))),l.setAttribute("transform","translate(".concat(s||0," ").concat(r||0,") rotate(").concat(p," ").concat(u," ").concat(m,")")),n.appendChild(l)}break}default:if(!pt(e))throw new Error("Unimplemented type ".concat(e.type));{const t=e.opacity/100,i=n.ownerDocument.createElementNS(d.M,"g");1!==t&&(i.setAttribute("stroke-opacity","".concat(t)),i.setAttribute("fill-opacity","".concat(t))),i.setAttribute("transform","translate(".concat(s||0," ").concat(r||0,") rotate(").concat(p," ").concat(u," ").concat(m,")"));const o=e.text.replace(/\r\n?/g,"\n").split("\n"),a=e.height/o.length,l=e.height-e.baseline,c="center"===e.textAlign?e.width/2:"right"===e.textAlign?e.width:0,h=Ve(e.text)?"rtl":"ltr",g="center"===e.textAlign?"middle":"right"===e.textAlign||"rtl"===h?"end":"start";for(let s=0;s<o.length;s++){const t=n.ownerDocument.createElementNS(d.M,"text");t.textContent=o[s],t.setAttribute("x","".concat(c)),t.setAttribute("y","".concat((s+1)*a-l)),t.setAttribute("font-family",Me(e)),t.setAttribute("font-size","".concat(e.fontSize,"px")),t.setAttribute("fill",e.strokeColor),t.setAttribute("text-anchor",g),t.setAttribute("style","white-space: pre;"),t.setAttribute("direction",h),i.appendChild(t)}n.appendChild(i)}}},pn=new WeakMap([]);function gn(e){const t=bn(e),n=new Path2D(t);return pn.set(e,n),n}function bn(e){const t=e.simulatePressure?e.points:e.points.length?e.points.map(((t,n)=>{let[i,s]=t;return[i,s,e.pressures[n]]})):[[0,0,.5]],n={simulatePressure:e.simulatePressure,size:4.25*e.strokeWidth,thinning:.6,smoothing:.5,streamline:.5,easing:e=>Math.sin(e*Math.PI/2),last:!!e.lastCommittedPoint};return function(e){if(!e.length)return"";const t=e.length-1;return e.reduce(((e,n,i,s)=>(i===t?e.push(n,fn(n,s[0]),"L",s[0],"Z"):e.push(n,fn(n,s[i+1])),e)),["M",e[0],"Q"]).join(" ").replace(vn,"$1")}(Object(Wt.a)(t,n))}function fn(e,t){return[(e[0]+t[0])/2,(e[1]+t[1])/2]}const vn=/(\s?[A-Z]?,?-?[0-9]*\.[0-9]{0,2})(([0-9]|e|-)*)/g;const yn=e=>"string"===typeof e;class xn{constructor(){this.callbacks=new Set,this.nonDeletedElements=[],this.elements=[],this.elementsMap=new Map}static mapElementToScene(e,t){yn(e)?this.sceneMapById.set(e,t):this.sceneMapByElement.set(e,t)}static getScene(e){return yn(e)?this.sceneMapById.get(e)||null:this.sceneMapByElement.get(e)||null}getElementsIncludingDeleted(){return this.elements}getElements(){return this.nonDeletedElements}getElement(e){return this.elementsMap.get(e)||null}getNonDeletedElement(e){const t=this.getElement(e);return t&&sr(t)?t:null}getNonDeletedElements(e){const t=[];return e.forEach((e=>{const n=this.getNonDeletedElement(e);null!=n&&t.push(n)})),t}replaceAllElements(e){this.elements=e,this.elementsMap.clear(),e.forEach((e=>{this.elementsMap.set(e.id,e),xn.mapElementToScene(e,this)})),this.nonDeletedElements=ir(this.elements),this.informMutation()}informMutation(){for(const e of Array.from(this.callbacks))e()}addCallback(e){if(this.callbacks.has(e))throw new Error;return this.callbacks.add(e),()=>{if(!this.callbacks.has(e))throw new Error;this.callbacks.delete(e)}}destroy(){xn.sceneMapById.forEach(((e,t)=>{e===this&&xn.sceneMapById.delete(t)})),this.callbacks.clear()}}xn.sceneMapByElement=new WeakMap,xn.sceneMapById=new Map;var wn=xn,jn=n(20);let Sn=new jn.a(Date.now());const En=()=>Math.floor(Sn.next()*2**31),On=()=>Object(ht.a)(),Cn=function(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=!1;const{points:s,fileId:r}=t;"undefined"!==typeof s&&(t={...Lt(s),...t});for(const a in t){const n=t[a];if("undefined"!==typeof n){if(e[a]===n&&("object"!==typeof n||null===n||"groupIds"===a||"scale"===a))continue;if("scale"===a){const t=e[a],i=n;if(t[0]===i[0]&&t[1]===i[1])continue}else if("points"===a){const t=e[a],i=n;if(t.length===i.length){let e=!1,n=t.length;for(;--n;){const s=t[n],r=i[n];if(s[0]!==r[0]||s[1]!==r[1]){e=!0;break}}if(!e)continue}}e[a]=n,i=!0}}if(!i)return e;var o;("undefined"===typeof t.height&&"undefined"===typeof t.width&&"undefined"==typeof r&&"undefined"===typeof s||on(e),e.version++,e.versionNonce=En(),e.updated=$e(),n)&&(null===(o=wn.getScene(e))||void 0===o||o.informMutation());return e},kn=(e,t)=>{let n=!1;for(const i in t){const s=t[i];if("undefined"!==typeof s){if(e[i]===s&&("object"!==typeof s||null===s))continue;n=!0}}return n?{...e,...t,updated:$e(),version:e.version+1,versionNonce:En()}:e},In=(e,t)=>(e.version=(null!==t&&void 0!==t?t:e.version)+1,e.versionNonce=En(),e.updated=$e(),e),Mn=e=>ft(e)||gt(e)?e.points.length<2:0===e.width&&0===e.height,An=(e,t,n)=>{const i=Math.abs(t),s=Math.abs(n);if("line"===e||"arrow"===e||"freedraw"===e){const e=Math.round(Math.atan(s/i)/d.K)*d.K;0===e?n=0:e===Math.PI/2?t=0:n=Math.round(i*Math.tan(e))*Math.sign(n)||n}else"selection"!==e&&(n=i*Math.sign(n));return{width:t,height:n}},Tn=e=>{const t={width:e.width,height:e.height,x:e.x,y:e.y};if(e.width<0){const n=Math.abs(e.width);t.width=n,t.x=e.x-n}if(e.height<0){const n=Math.abs(e.height);t.height=n,t.y=e.y-n}return t},Ln=(e,t,n)=>{const i=n.filter((t=>t.groupIds.includes(e)));return i.length<2?t.selectedGroupIds[e]||t.editingGroupId===e?{...t,selectedGroupIds:{...t.selectedGroupIds,[e]:!1},editingGroupId:null}:t:{...t,selectedGroupIds:{...t.selectedGroupIds,[e]:!0},selectedElementIds:{...t.selectedElementIds,...Object.fromEntries(i.map((e=>[e.id,!0])))}}},Dn=(e,t)=>null!=Pn(e,t),Pn=(e,t)=>t.groupIds.filter((t=>t!==e.editingGroupId)).find((t=>e.selectedGroupIds[t])),zn=e=>Object.entries(e.selectedGroupIds).filter((e=>{let[t,n]=e;return n})).map((e=>{let[t,n]=e;return t})),Nn=(e,t)=>{let n={...e,selectedGroupIds:{}};const i=hr(t,e);if(!i.length)return{...n,editingGroupId:null};for(const s of i){let i=s.groupIds;if(e.editingGroupId){const t=i.indexOf(e.editingGroupId);t>-1&&(i=i.slice(0,t))}if(i.length>0){const e=i[i.length-1];n=Ln(e,n,t)}}return n},Rn=(e,t)=>e.groupIds.includes(t),Bn=(e,t)=>e.filter((e=>Rn(e,t))),Hn=(e,t,n)=>{const i=[...e],s=n?i.indexOf(n):-1,r=s>-1?s:i.length;return i.splice(r,0,t),i},_n=(e,t)=>{var n,i;let{x:s,y:r,strokeColor:o,backgroundColor:a,fillStyle:l,strokeWidth:c,strokeStyle:d,roughness:h,opacity:u,width:m=0,height:p=0,angle:g=0,groupIds:b=[],strokeSharpness:f,boundElementIds:v=null,...y}=t;return{id:y.id||On(),type:e,x:s,y:r,width:m,height:p,angle:g,strokeColor:o,backgroundColor:a,fillStyle:l,strokeWidth:c,strokeStyle:d,roughness:h,opacity:u,groupIds:b,strokeSharpness:f,seed:null!==(n=y.seed)&&void 0!==n?n:En(),version:y.version||1,versionNonce:null!==(i=y.versionNonce)&&void 0!==i?i:0,isDeleted:!1,boundElementIds:v,updated:$e()}},Fn=e=>_n(e.type,e),Un=(e,t)=>({x:"center"===e.textAlign?t.width/2:"right"===e.textAlign?t.width:0,y:"middle"===e.verticalAlign?t.height/2:0}),Vn=e=>{const t=Te(e.text,Ae(e)),n=Un(e,t);return kn({..._n("text",e),text:e.text,fontSize:e.fontSize,fontFamily:e.fontFamily,textAlign:e.textAlign,verticalAlign:e.verticalAlign,x:e.x-n.x,y:e.y-n.y,width:t.width,height:t.height,baseline:t.baseline},{})},Gn=(e,t)=>{const{width:n,height:i,baseline:s}=Te(t,Ae(e)),{textAlign:r,verticalAlign:o}=e;let a,l;if("center"===r&&"middle"===o){const t=Te(e.text,Ae(e)),s=Un(e,{width:n-t.width,height:i-t.height});a=e.x-s.x,l=e.y-s.y}else{const[t,s,o,c]=Pt(e),[d,h,u,m]=Ut(e,n,i),p=(t-d)/2,g=(s-h)/2,b=(o-u)/2,f=(c-m)/2;[a,l]=Et({s:!0,e:"center"===r||"left"===r,w:"center"===r||"right"===r},e.x,e.y,e.angle,p,g,b,f)}return{width:n,height:i,x:Number.isFinite(a)?a:e.x,y:Number.isFinite(l)?l:e.y,baseline:s}},Wn=(e,t)=>{let{text:n,isDeleted:i}=t;return kn(e,{text:n,isDeleted:null!==i&&void 0!==i?i:e.isDeleted,...Gn(e,n)})},Kn=e=>({..._n(e.type,e),points:e.points||[],lastCommittedPoint:null,startBinding:null,endBinding:null,startArrowhead:e.startArrowhead,endArrowhead:e.endArrowhead}),Yn=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(null==e||"object"!==typeof e)return e;if("[object Object]"===Object.prototype.toString.call(e)){const n="function"===typeof e.constructor?Object.create(Object.getPrototypeOf(e)):{};for(const i in e)if(e.hasOwnProperty(i)){if(0===t&&("shape"===i||"canvas"===i))continue;n[i]=Yn(e[i],t+1)}return n}if(Array.isArray(e)){let n=e.length;const i=new Array(n);for(;n--;)i[n]=Yn(e[n],t+1);return i}return e},Zn=(e,t,n,i)=>{let s=Yn(n);return s.id=On(),s.updated=$e(),s.seed=En(),s.groupIds=((e,t,n)=>{const i=[...e],s=t?e.indexOf(t):-1,r=s>-1?s:e.length;for(let o=0;o<r;o++)i[o]=n(i[o]);return i})(s.groupIds,e,(e=>(t.has(e)||t.set(e,On()),t.get(e)))),i&&(s=Object.assign(s,i)),s},Xn={mouse:8,pen:16,touch:28},qn={e:!0,s:!0,n:!0,w:!0},Jn={e:!0,s:!0,n:!0,w:!0},Qn={e:!0,s:!0,n:!0,w:!0,nw:!0,se:!0},$n={e:!0,s:!0,n:!0,w:!0,ne:!0,sw:!0},ei=(e,t,n,i,s,r,o)=>{const[a,l]=jt(e+n/2,t+i/2,s,r,o);return[a-n/2,l-i/2,n,i]},ti=function(e,t,n,i){let[s,r,o,a]=e,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const c=Xn[i],d=c/n.value,h=c/n.value,u=c/n.value,m=c/n.value,p=o-s,g=a-r,b=(s+o)/2,f=(r+a)/2,v=4/n.value,y=(c-8)/(2*n.value),x={nw:l.nw?void 0:ei(s-v-u+y,r-v-m+y,d,h,b,f,t),ne:l.ne?void 0:ei(o+v-y,r-v-m+y,d,h,b,f,t),sw:l.sw?void 0:ei(s-v-u+y,a+v-y,d,h,b,f,t),se:l.se?void 0:ei(o+v-y,a+v-y,d,h,b,f,t),rotation:l.rotation?void 0:ei(s+p/2-d/2,r-v-m+y-16/n.value,d,h,b,f,t)},w=5*Xn.mouse/n.value;return Math.abs(p)>w&&(l.n||(x.n=ei(s+p/2-d/2,r-v-m+y,d,h,b,f,t)),l.s||(x.s=ei(s+p/2-d/2,a+v-y,d,h,b,f,t))),Math.abs(g)>w&&(l.w||(x.w=ei(s-v-u+y,r+g/2-h/2,d,h,b,f,t)),l.e||(x.e=ei(o+v-y,r+g/2-h/2,d,h,b,f,t))),x},ni=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"mouse",i={};if("arrow"===e.type||"line"===e.type||"freedraw"===e.type){if(2===e.points.length){const[,t]=e.points;0===t[0]||0===t[1]?i=$n:t[0]>0&&t[1]<0?i=Qn:t[0]>0&&t[1]>0?i=$n:t[0]<0&&t[1]>0?i=Qn:t[0]<0&&t[1]<0&&(i=$n)}}else"text"===e.type&&(i=Jn);return ti(Pt(e),e.angle,t,n,i)},ii=(e,t)=>[0,0,0,0,t,e,1,0],si=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=[0,0,0,0,0,0,0,0];if(t<0||t>7)throw new Error("Expected `index` betwen 0 and 7, got `".concat(t,"`"));return 0!==e&&(n[t]=e),n},ri=e=>[e[0],e[1],e[2],e[3],-e[4],-e[5],-e[6],-e[7]],oi=(e,t)=>vi(t)?[e[0]+t,e[1],e[2],e[3],e[4],e[5],e[6],e[7]]:[e[0]+t[0],e[1]+t[1],e[2]+t[2],e[3]+t[3],e[4]+t[4],e[5]+t[5],e[6]+t[6],e[7]+t[7]],ai=(e,t)=>vi(t)?[e[0]-t,e[1],e[2],e[3],e[4],e[5],e[6],e[7]]:[e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3],e[4]-t[4],e[5]-t[5],e[6]-t[6],e[7]-t[7]],li=(e,t)=>vi(t)?[e[0]*t,e[1]*t,e[2]*t,e[3]*t,e[4]*t,e[5]*t,e[6]*t,e[7]*t]:[ci(e,t),t[1]*e[0]+t[0]*e[1]-t[4]*e[2]+t[5]*e[3]+t[2]*e[4]-t[3]*e[5]-t[7]*e[6]-t[6]*e[7],t[2]*e[0]+t[0]*e[2]-t[6]*e[3]+t[3]*e[6],t[3]*e[0]+t[6]*e[2]+t[0]*e[3]-t[2]*e[6],t[4]*e[0]+t[2]*e[1]-t[1]*e[2]+t[7]*e[3]+t[0]*e[4]+t[6]*e[5]-t[5]*e[6]+t[3]*e[7],t[5]*e[0]-t[3]*e[1]+t[7]*e[2]+t[1]*e[3]-t[6]*e[4]+t[0]*e[5]+t[4]*e[6]+t[2]*e[7],t[6]*e[0]+t[3]*e[2]-t[2]*e[3]+t[0]*e[6],t[7]*e[0]+t[6]*e[1]+t[5]*e[2]+t[4]*e[3]+t[3]*e[4]+t[2]*e[5]+t[1]*e[6]+t[0]*e[7]],ci=(e,t)=>t[0]*e[0]+t[2]*e[2]+t[3]*e[3]-t[6]*e[6],di=(e,t)=>[t[0]*e[0],t[1]*e[0]+t[0]*e[1],t[2]*e[0]+t[0]*e[2],t[3]*e[0]+t[0]*e[3],t[4]*e[0]+t[2]*e[1]-t[1]*e[2]+t[0]*e[4],t[5]*e[0]-t[3]*e[1]+t[1]*e[3]+t[0]*e[5],t[6]*e[0]+t[3]*e[2]-t[2]*e[3]+t[0]*e[6],t[7]*e[0]+t[6]*e[1]+t[5]*e[2]+t[4]*e[3]+t[3]*e[4]+t[2]*e[5]+t[1]*e[6]],hi=(e,t)=>[ui(e,t),e[1]*t[7]+e[4]*t[5]-e[5]*t[4]+e[7]*t[1],e[2]*t[7]-e[4]*t[6]+e[6]*t[4]+e[7]*t[2],e[3]*t[7]+e[5]*t[6]-e[6]*t[5]+e[7]*t[3],e[4]*t[7]+e[7]*t[4],e[5]*t[7]+e[7]*t[5],e[6]*t[7]+e[7]*t[6],e[7]*t[7]],ui=(e,t)=>e[0]*t[7]+e[1]*t[6]+e[2]*t[5]+e[3]*t[4]+e[4]*t[3]+e[5]*t[2]+e[6]*t[1]+e[7]*t[0],mi=(e,t)=>[t[0]*e[0]+t[2]*e[2]+t[3]*e[3]-t[6]*e[6],t[1]*e[0]+t[0]*e[1]-t[4]*e[2]+t[5]*e[3]+t[2]*e[4]-t[3]*e[5]-t[7]*e[6]-t[6]*e[7],t[2]*e[0]+t[0]*e[2]-t[6]*e[3]+t[3]*e[6],t[3]*e[0]+t[6]*e[2]+t[0]*e[3]-t[2]*e[6],t[4]*e[0]+t[7]*e[3]+t[0]*e[4]+t[3]*e[7],t[5]*e[0]+t[7]*e[2]+t[0]*e[5]+t[2]*e[7],t[6]*e[0]+t[0]*e[6],t[7]*e[0]+t[0]*e[7]],pi=e=>Math.sqrt(Math.abs(e[0]*e[0]-e[2]*e[2]-e[3]*e[3]+e[6]*e[6])),gi=e=>Math.sqrt(Math.abs(e[7]*e[7]-e[5]*e[5]-e[4]*e[4]+e[1]*e[1])),bi=e=>{const t=pi(e);if(0===t||1===t)return e;const n=e[6]<0?-1:1;return li(e,n/t)},fi=e=>{const t=gi(e);return 0===t||1===t?e:li(e,1/t)},vi=e=>"number"===typeof e,yi=(si(1,1),si(1,2),si(1,3),si(1,4),si(1,5),si(1,6),si(1,7),(e,t,n)=>bi([0,n,e,t,0,0,0,0])),xi=(e,t)=>bi(hi(t,e)),wi=(e,t)=>mi(e,t),ji=e=>{let[t,n]=e;return[0,0,0,0,n,t,1,0]},Si=e=>[e[5],e[4]],Ei=(e,t)=>bi(di(e,t)),Oi=(e,t)=>pi(hi(e,t)),Ci=(e,t)=>ui(e,t),ki=e=>[0,0,0,0,e[4],e[5],0,0],Ii=(e,t)=>oi(li(e,Math.sin(t/2)),Math.cos(t/2)),Mi=(e,t)=>bi(li(li(e,t),ri(e)));var Ai=n(21);const Ti=(e,t,n,i)=>{const s=10/t.zoom.value;return!Li(e,t,[n,i])&&Pi(e,[n,i],s)},Li=(e,t,n)=>{const i=10/t.zoom.value,s="text"===e.type?Hi:(e=>{if("arrow"===e.type)return!1;if("freedraw"===e.type)return!0;const t="transparent"!==e.backgroundColor;return"line"===e.type?t&&Ct(e.points):t||mt(e)})(e)?_i:Fi;return Ri({element:e,point:n,threshold:i,check:s})},Di=(e,t)=>e.selectedElementIds[t.id],Pi=(e,t,n)=>{let[i,s]=t;const[r,o,a,l]=Pt(e),c=(r+a)/2,d=(o+l)/2,[h,u]=jt(i,s,c,d,-e.angle);return h>r-n&&h<a+n&&u>o-n&&u<l+n},zi=(e,t)=>{let{x:n,y:i}=t;const s=Ni(e,e.width,e.height);return Ri({element:e,point:[n,i],threshold:s,check:Ui})},Ni=(e,t,n)=>{const i=("diamond"===e.type?1/Math.sqrt(2):1)*Math.min(t,n);return Math.max(16,Math.min(.25*i,32))},Ri=e=>{switch(e.element.type){case"rectangle":case"image":case"text":case"diamond":case"ellipse":const t=Bi(e.element,e.point);return e.check(t,e.threshold);case"freedraw":return!!e.check(Vi(e.element,e.point),e.threshold)&&Yi(e.element,e.point,e.threshold);case"arrow":case"line":return Zi(e);case"selection":return console.warn("This should not happen, we need to investigate why it does."),!1}},Bi=(e,t)=>{switch(e.type){case"rectangle":case"image":case"text":return Vi(e,t);case"diamond":return Gi(e,t);case"ellipse":return Wi(e,t)}},Hi=(e,t)=>e<0,_i=(e,t)=>e<t,Fi=(e,t)=>Math.abs(e)<t,Ui=(e,t)=>0<=e&&e<t,Vi=(e,t)=>{const[,n,i,s]=Xi(e,t);return Math.max(Ci(n,yi(0,1,-s)),Ci(n,yi(1,0,-i)))},Gi=(e,t)=>{const[,n,i,s]=Xi(e,t),r=yi(s,i,-s*i);return Ci(n,r)},Wi=(e,t)=>{const[n,i]=Ki(e,t);return s=i,-Math.sign(s[1])*Ci(n,i);var s},Ki=(e,t)=>{const[,n,i,s]=Xi(e,t),[r,o]=Si(n);let a=.707,l=.707;const c=i,d=s;[0,1,2,3].forEach((e=>{const t=(c*c-d*d)*a**3/c,n=(d*d-c*c)*l**3/d,i=c*a-t,s=d*l-n,h=r-t,u=o-n,m=Math.hypot(s,i),p=Math.hypot(u,h);a=Math.min(1,Math.max(0,(h*m/p+t)/c)),l=Math.min(1,Math.max(0,(u*m/p+n)/d));const g=Math.hypot(l,a);a/=g,l/=g}));const h=ii(c*a,d*l);var u;return[n,wi(xi(n,u=h),u)]},Yi=(e,t,n)=>{let i,s;if(0===e.angle)i=t[0]-e.x,s=t[1]-e.y;else{const[n,r,o,a]=Pt(e),l=St(t,[n+(o-n)/2,r+(a-r)/2],-e.angle);i=l[0]-e.x,s=l[1]-e.y}let r,[o,a]=e.points;if(Ot(o[0],o[1],i,s)<n||Ot(a[0],a[1],i,s)<n)return!0;for(let l=0;l<e.points.length;l++){const t=[a[0]-o[0],a[1]-o[1]],c=Math.hypot(t[1],t[0]),d=[t[0]/c,t[1]/c],h=[i-o[0],s-o[1]],u=(h[0]*d[0]+h[1]*d[1])/Math.hypot(d[1],d[0]);r=[o[0]+d[0]*u,o[1]+d[1]*u];const m=Ot(r[0],r[1],o[0],o[1]),p=Ot(r[0],r[1],a[0],a[1]);if(r=p<m&&m>c?a:m<p&&p>c?o:r,Math.hypot(s-r[1],i-r[0])<n)return!0;o=a,a=e.points[l+1]}return!1},Zi=e=>{const{element:t,threshold:n}=e;if(!rn(t))return!1;const[i,s,r,o]=Xi(e.element,e.point),a=yi(0,1,-o),l=yi(1,0,-r);if(!_i(Ci(s,a),n)||!_i(Ci(s,l),n))return!1;const[c,d]=Si(i),h=rn(t);if(e.check===_i){if(h.some((e=>as(e,c,d,t.strokeSharpness))))return!0}return h.some((e=>ls(e,c,d,n)))},Xi=(e,t)=>{const n=ji(t),i=Pt(e),s=Ji(i),r=Ii(s,e.angle),o=Mi(r,n),a=(e=>[0,0,0,0,Math.abs(e[4]),Math.abs(e[5]),1,0])(ai(o,ki(s))),l=(c=e.x,[0,0,0,0,e.y,c,0,0]);var c;const d=ai(o,l),[h,u,m,p]=i;return[d,a,(m-h)/2,(p-u)/2]},qi=e=>{const t=Pt(e),n=Ji(t),i=Ii(n,e.angle),s=ri([1,0,0,0,-.5*(r=ki(n))[5],.5*r[4],0,0]);var r;return li(s,i)},Ji=e=>{let[t,n,i,s]=e;return ii((t+i)/2,(n+s)/2)},Qi=(e,t,n)=>{const i=qi(e),s=Mi(i,ji(t)),r=Mi(i,ji(n)),o=xi(s,r),a=e.height/e.width,l=e.width/2,c=e.height/2,d=o[2],h=o[3],u=o[1],m=Math.abs(h),p=Math.abs(d);switch(e.type){case"rectangle":case"image":case"text":return u/(l*(p+a*m));case"diamond":return m<p?u/(p*l):u/(m*c);case"ellipse":return u/(l*Math.sqrt(d**2+a**2*h**2))}},$i=function(e,t,n){let i,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;switch(e.type){case"rectangle":case"image":case"text":case"diamond":const n=es(e);i=n.flatMap(((e,i)=>{const r=[e,n[(i+1)%4]];return ts(t,ns(r,s))})).concat(n.flatMap((e=>ss(e,s,t))));break;case"ellipse":i=is(e,s,t)}if(i.length<2)return[];const r=i.sort(((e,t)=>Oi(e,n)-Oi(t,n)));return[r[0],r[r.length-1]]},es=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const n=t*e.width/2,i=t*e.height/2;switch(e.type){case"rectangle":case"image":case"text":return[ii(n,i),ii(n,-i),ii(-n,-i),ii(-n,i)];case"diamond":return[ii(0,i),ii(n,0),ii(0,-i),ii(-n,0)]}},ts=(e,t)=>{const[n,i]=t;return Ci(n,e)*Ci(i,e)>=0?[]:[Ei(e,xi(n,i))]},ns=(e,t)=>{const[n,i]=e,s=((e,t)=>{const n=.5*t;return[1,0,0,0,n*e[4],n*e[5],0,0]})((r=n,fi([0,0,0,0,(o=i)[4]-r[4],o[5]-r[5],0,0])),t);var r,o;return[Mi(s,n),Mi(s,i)]},is=(e,t,n)=>{const i=e.width/2+t,s=e.height/2+t,r=n[2],o=n[3],a=n[1],l=i*i*r*r+s*s*o*o,c=l-a*a;if(0===l||c<=0)return[];const d=Math.sqrt(c),h=-i*i*r*a,u=-s*s*o*a;return[ii((h+i*s*o*d)/l,(u-i*s*r*d)/l),ii((h-i*s*o*d)/l,(u+i*s*r*d)/l)]},ss=(e,t,n)=>{if(0===t)return 0===Ci(n,e)?[e]:[];const i=n[2],s=n[3],r=n[1],[o,a]=Si(e),l=i*i+s*s,c=t*t*l-(i*o+s*a+r)**2;if(0===l||c<=0)return[];const d=Math.sqrt(c),h=o*s*s-a*i*s-i*r,u=a*i*i-o*i*s-s*r;return[ii((h+s*d)/l,(u-i*d)/l),ii((h-s*d)/l,(u+i*d)/l)]},rs=(e,t,n)=>{const i=Math.abs(t),s=e.width*i/2,r=e.height*i/2,o=Math.sign(t),[a,l]=Si(n),c=0===l?1e-4:l,d=a**2*r**2+c**2*s**2,h=(-a*r**2+o*c*Math.sqrt(Math.max(0,d-s**2*r**2)))/d,u=(-h*a-1)/c,m=-(s**2)*h/(u**2*r**2+h**2*s**2);return ii(m,(-h*m-1)/u)},os=(e,t,n)=>{const i=Math.abs(t),s=Math.sign(t),r=es(e,i);let o=0,a=null;return r.forEach((e=>{const t=s*xi(n,e)[1];t>o&&(o=t,a=e)})),a},as=(e,t,n,i)=>{const s=zt(e),r=[];let o=!1;for(const a of s)"move"===a.op?(o=!o,o&&r.push([a.data[0],a.data[1]])):"bcurveTo"===a.op&&o&&(r.push([a.data[0],a.data[1]]),r.push([a.data[2],a.data[3]]),r.push([a.data[4],a.data[5]]));if(r.length>=4){if("sharp"===i)return kt(r,t,n);const e=Object(Ai.a)(r,10,5);return kt(e,t,n)}return!1},ls=(e,t,n,i)=>{const s=zt(e);let r=[0,0];return s.some(((e,s)=>{let{op:o,data:a}=e;if("move"===o)r=a;else if("bcurveTo"===o){const e=[a[0],a[1]],s=[a[2],a[3]],o=[a[4],a[5]],l=r;r=o;const c=((e,t,n,i,s,r)=>{let[o,a]=s;const l=(s,r)=>Math.pow(1-s,3)*i[r]+3*s*Math.pow(1-s,2)*n[r]+3*Math.pow(s,2)*(1-s)*t[r]+e[r]*Math.pow(s,3);let c=0;for(;c<=1;){const e=l(c,0),t=l(c,1);if(Math.sqrt(Math.pow(e-o,2)+Math.pow(t-a,2))<r)return!0;c+=.01}return!1})(l,e,s,o,[t,n],i);return c}return!1}))},cs=(e,t,n)=>t>=e[0]&&t<=e[0]+e[2]&&n>=e[1]&&n<=e[1]+e[3],ds=(e,t,n,i,s,r)=>e.reduce(((e,o)=>{if(e)return e;const a=((e,t,n,i,s,r)=>{if(!t.selectedElementIds[e.id])return!1;const{rotation:o,...a}=ni(e,s,r);if(o&&cs(o,n,i))return"rotation";const l=Object.keys(a).filter((e=>{const t=a[e];return!!t&&cs(t,n,i)}));return l.length>0&&l[0]})(o,t,n,i,s,r);return a?{element:o,transformHandleType:a}:null}),null),hs=(e,t,n,i,s)=>{let[r,o,a,l]=e;const c=ti([r,o,a,l],0,i,s,qn);return Object.keys(c).find((e=>{const i=c[e];return i&&cs(i,t,n)}))||!1},us=["ns","nesw","ew","nwse"],ms=e=>{const{element:t,transformHandleType:n}=e,i=t&&Math.sign(t.height)*Math.sign(t.width)===-1;let s=null;switch(n){case"n":case"s":s="ns";break;case"w":case"e":s="ew";break;case"nw":case"se":s=i?"nesw":"nwse";break;case"ne":case"sw":s=i?"nwse":"nesw";break;case"rotation":return"grab"}return s&&t&&(s=((e,t)=>{const n=us.indexOf(e);if(n>=0){const i=Math.round(t/(Math.PI/4));e=us[(n+i)%us.length]}return e})(s,t.angle)),s?"".concat(s,"-resize"):""};class ps{constructor(e,t){this.elementId=void 0,this.activePointIndex=void 0,this.isDragging=void 0,this.lastUncommittedPoint=void 0,this.pointerOffset=void 0,this.startBindingElement=void 0,this.endBindingElement=void 0,this.elementId=e.id,wn.mapElementToScene(this.elementId,t),ps.normalizePoints(e),this.activePointIndex=null,this.lastUncommittedPoint=null,this.isDragging=!1,this.pointerOffset={x:0,y:0},this.startBindingElement="keep",this.endBindingElement="keep"}static getElement(e){var t;const n=null===(t=wn.getScene(e))||void 0===t?void 0:t.getNonDeletedElement(e);return n||null}static handlePointDragging(e,t,n,i,s){if(!e.editingLinearElement)return!1;const{editingLinearElement:r}=e,{activePointIndex:o,elementId:a,isDragging:l}=r,c=ps.getElement(a);if(!c)return!1;if(null!=o&&o>-1){!1===l&&t({editingLinearElement:{...r,isDragging:!0}});const a=ps.createPointAt(c,n-r.pointerOffset.x,i-r.pointerOffset.y,e.gridSize);return ps.movePoint(c,o,a),yt(c)&&s(c,0===o?"start":"end"),!0}return!1}static handlePointerUp(e,t,n){const{elementId:i,activePointIndex:s,isDragging:r}=t,o=ps.getElement(i);if(!o)return t;let a={};if(r&&(0===s||s===o.points.length-1)){Ct(o.points,n.zoom.value)&&ps.movePoint(o,s,0===s?o.points[o.points.length-1]:o.points[0]);a={[0===s?"startBindingElement":"endBindingElement"]:gs(n)?Cs(Ge(ps.getPointAtIndexGlobalCoordinates(o,s)),wn.getScene(o)):null}}return{...t,...a,isDragging:!1,pointerOffset:{x:0,y:0}}}static handlePointerDown(e,t,n,i,s){const r={didAddPoint:!1,hitElement:null};if(!t.editingLinearElement)return r;const{elementId:o}=t.editingLinearElement,a=ps.getElement(o);if(!a)return r;if(e.altKey)return null==t.editingLinearElement.lastUncommittedPoint&&Cn(a,{points:[...a.points,ps.createPointAt(a,s.x,s.y,t.gridSize)]}),i.resumeRecording(),n({editingLinearElement:{...t.editingLinearElement,activePointIndex:a.points.length-1,lastUncommittedPoint:null,endBindingElement:Cs(s,wn.getScene(a))}}),r.didAddPoint=!0,r;const l=ps.getPointIndexUnderCursor(a,t.zoom,s.x,s.y);if(l>-1)r.hitElement=a;else{const{startBindingElement:e,endBindingElement:n}=t.editingLinearElement;gs(t)&&yt(a)&&bs(a,e,n)}const[c,d,h,u]=Pt(a),m=(c+h)/2,p=(d+u)/2,g=l>-1&&jt(a.x+a.points[l][0],a.y+a.points[l][1],m,p,a.angle);return n({editingLinearElement:{...t.editingLinearElement,activePointIndex:l>-1?l:null,pointerOffset:g?{x:s.x-g[0],y:s.y-g[1]}:{x:0,y:0}}}),r}static handlePointerMove(e,t,n,i,s){const{elementId:r,lastUncommittedPoint:o}=i,a=ps.getElement(r);if(!a)return i;const{points:l}=a,c=l[l.length-1];if(!e.altKey)return c===o&&ps.movePoint(a,l.length-1,"delete"),{...i,lastUncommittedPoint:null};const d=ps.createPointAt(a,t-i.pointerOffset.x,n-i.pointerOffset.y,s);return c===o?ps.movePoint(a,a.points.length-1,d):ps.movePoint(a,"new",d),{...i,lastUncommittedPoint:a.points[a.points.length-1]}}static getPointsGlobalCoordinates(e){const[t,n,i,s]=Pt(e),r=(t+i)/2,o=(n+s)/2;return e.points.map((t=>{let{x:n,y:i}=e;return[n,i]=jt(n+t[0],i+t[1],r,o,e.angle),[n,i]}))}static getPointAtIndexGlobalCoordinates(e,t){const n=t<0?e.points.length+t:t,[i,s,r,o]=Pt(e),a=(i+r)/2,l=(s+o)/2,c=e.points[n],{x:d,y:h}=e;return jt(d+c[0],h+c[1],a,l,e.angle)}static pointFromAbsoluteCoords(e,t){const[n,i,s,r]=Pt(e),o=(n+s)/2,a=(i+r)/2,[l,c]=jt(t[0],t[1],o,a,-e.angle);return[l-e.x,c-e.y]}static getPointIndexUnderCursor(e,t,n,i){const s=this.getPointsGlobalCoordinates(e);let r=s.length;for(;--r>-1;){const e=s[r];if(Ot(n,i,e[0],e[1])*t.value<this.POINT_HANDLE_SIZE/2+1)return r}return-1}static createPointAt(e,t,n,i){const s=Tt(t,n,i),[r,o,a,l]=Pt(e),c=(r+a)/2,d=(o+l)/2,[h,u]=jt(s[0],s[1],c,d,-e.angle);return[h-e.x,u-e.y]}static getNormalizedPoints(e){const{points:t}=e,n=t[0][0],i=t[0][1];return{points:t.map(((e,t)=>[e[0]-n,e[1]-i])),x:e.x+n,y:e.y+i}}static normalizePoints(e){Cn(e,ps.getNormalizedPoints(e))}static movePointByOffset(e,t,n){const[i,s]=e.points[t];ps.movePoint(e,t,[i+n.x,s+n.y])}static movePoint(e,t,n,i){const{points:s}=e;let r,o=0,a=0;if("delete"===n){if("new"===t)throw new Error("invalid args in movePoint");r=s.slice(),r.splice(t,1),0===t&&(o=r[0][0],a=r[0][1],r=r.map(((e,t)=>0===t?[0,0]:[e[0]-o,e[1]-a])))}else if("new"===t)r=[...s,n];else{const e=n[0]-s[t][0],i=n[1]-s[t][1];r=s.map(((n,s)=>s===t?0===s?(o=e,a=i,n):(o=0,a=0,[n[0]+e,n[1]+i]):o||a?[n[0]-o,n[1]-a]:n))}const l=Vt(e,r,e.strokeSharpness||"round"),c=Vt(e,s,e.strokeSharpness||"round"),d=(l[0]+l[2])/2,h=(l[1]+l[3])/2,u=(c[0]+c[2])/2,m=(c[1]+c[3])/2,p=jt(o,a,u-d,m-h,e.angle);Cn(e,{...i,points:r,x:e.x+p[0],y:e.y+p[1]})}}ps.POINT_HANDLE_SIZE=20;const gs=e=>e.isBindingEnabled,bs=(e,t,n)=>{const i=new Set,s=new Set;fs(e,t,n,"start",i,s),fs(e,n,t,"end",i,s);const r=Array.from(s).filter((e=>!i.has(e)));wn.getScene(e).getNonDeletedElements(r).forEach((t=>{var n;Cn(t,{boundElementIds:null===(n=t.boundElementIds)||void 0===n?void 0:n.filter((t=>t!==e.id))})}))},fs=(e,t,n,i,s,r)=>{if("keep"!==t)if(null!=t)null!=n&&("keep"===n?js(e,t,i):"start"!==i&&n.id===t.id)||(ws(e,t,i),s.add(t.id));else{const t=Os(e,i);null!=t&&r.add(t)}},vs=e=>{e.forEach((e=>{yt(e)?bs(e,Ps(e,"start"),Ps(e,"end")):wt(e)&&ys(e)}))},ys=e=>{Ns(e).forEach((t=>{let[n,i]=t;return bs(n,"end"===i?"keep":e,"start"===i?"keep":e)}))},xs=(e,t,n,i)=>{null!=t.startBoundElement&&ws(e,t.startBoundElement,"start");const s=Cs(i,n);null==s||js(e,s,"end")||ws(e,s,"end")},ws=(e,t,n)=>{var i;Cn(e,{["start"===n?"startBinding":"endBinding"]:{elementId:t.id,...ks(e,t,n)}}),Cn(t,{boundElementIds:Array.from(new Set([...null!==(i=t.boundElementIds)&&void 0!==i?i:[],e.id]))})},js=(e,t,n)=>{const i=e["start"===n?"endBinding":"startBinding"];return Ss(e,null===i||void 0===i?void 0:i.elementId,t)},Ss=(e,t,n)=>t===n.id&&e.points.length<3,Es=e=>{e.forEach((e=>{yt(e)&&bs(e,null,null)}))},Os=(e,t)=>{const n="start"===t?"startBinding":"endBinding",i=e[n];return null==i?null:(Cn(e,{[n]:null}),i.elementId)},Cs=(e,t)=>jr(t.getElements(),(t=>wt(t)&&zi(t,e))),ks=(e,t,n)=>{const i="start"===n?-1:1,s=-1===i?0:e.points.length-1,r=s-i,o=ps.getPointAtIndexGlobalCoordinates(e,s),a=ps.getPointAtIndexGlobalCoordinates(e,r);return{focus:Qi(t,a,o),gap:Math.max(1,Bi(t,o))}},Is=(e,t)=>{var n;const i=null!==(n=e.boundElementIds)&&void 0!==n?n:[];if(0===i.length)return;const{newSize:s,simultaneouslyUpdated:r}=null!==t&&void 0!==t?t:{},o=As(r);wn.getScene(e).getNonDeletedElements(i).forEach((t=>{const n=e;if(!Ms(t,n))return;const i=Ls(n,t.startBinding,s),r=Ls(n,t.endBinding,s);o.has(t.id)?Cn(t,{startBinding:i,endBinding:r}):(Ts(t,"start",i,e),Ts(t,"end",r,e))}))},Ms=(e,t)=>{var n,i;return(null===(n=e.startBinding)||void 0===n?void 0:n.elementId)===t.id||(null===(i=e.endBinding)||void 0===i?void 0:i.elementId)===t.id},As=e=>new Set((e||[]).map((e=>e.id))),Ts=(e,t,n,i)=>{if(null==n||n.elementId!==i.id&&e.points.length>2)return;const s=wn.getScene(e).getElement(n.elementId);if(null==s)return;const r="start"===t?-1:1,o=-1===r?0:e.points.length-1,a=o-r,l=ps.getPointAtIndexGlobalCoordinates(e,a),c=((e,t,n)=>{if(0===t){const t=Pt(e),n=Ji(t);return Si(n)}const i=qi(e),s=Mi(i,ji(n)),r=ri(i);let o;switch(e.type){case"rectangle":case"image":case"text":case"diamond":o=os(e,t,s);break;case"ellipse":o=rs(e,t,s)}return Si(Mi(r,o))})(s,n.focus,l);let d;if(0===n.gap)d=c;else{const e=function(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const s=qi(e),r=Mi(s,ji(t)),o=Mi(s,ji(n)),a=xi(r,o),l=ri(s);return $i(e,a,r,i).map((e=>Si(Mi(l,e))))}(s,l,c,n.gap);d=0===e.length?c:e[0]}ps.movePoint(e,o,ps.pointFromAbsoluteCoords(e,d),{["start"===t?"startBinding":"endBinding"]:n})},Ls=(e,t,n)=>{if(null==t||null==n)return t;const{gap:i,focus:s,elementId:r}=t,{width:o,height:a}=n,{width:l,height:c}=e;return{elementId:r,gap:Math.max(1,Math.min(Ni(e,o,a),i*(o<a?o/l:a/c))),focus:s}},Ds=e=>[Ps(e,"start"),Ps(e,"end")].filter((e=>null!=e)),Ps=(e,t)=>Cs(zs(e,t),wn.getScene(e)),zs=(e,t)=>{const n="start"===t?0:-1;return Ge(ps.getPointAtIndexGlobalCoordinates(e,n))},Ns=e=>wn.getScene(e).getElements().map((t=>{if(!yt(t))return null;const n=Rs(t,"start",e),i=Rs(t,"end",e);return n||i?[t,n&&i?"both":n?"start":"end",e]:null})).filter((e=>null!=e)),Rs=(e,t,n)=>null==e["start"===t?"startBinding":"endBinding"]&&!js(e,n,t)&&zi(n,zs(e,t)),Bs=(e,t,n,i)=>{const s=new Set,r=new Set,o="duplicatesServeAsOld"===i;t.forEach((e=>{const{boundElementIds:t}=e;if(null!=t&&t.length>0&&(t.forEach((e=>{o&&!n.has(e)&&s.add(e)})),r.add(n.get(e.id))),yt(e)){if(null!=e.startBinding){const{elementId:t}=e.startBinding;o&&!n.has(t)&&r.add(t)}if(null!=e.endBinding){const{elementId:t}=e.endBinding;o&&!n.has(t)&&r.add(t)}null==e.startBinding&&null==e.endBinding||s.add(n.get(e.id))}})),e.filter((e=>{let{id:t}=e;return s.has(t)})).forEach((e=>{const{startBinding:t,endBinding:i}=e;Cn(e,{startBinding:Hs(t,n),endBinding:Hs(i,n)})})),e.filter((e=>{let{id:t}=e;return r.has(t)})).forEach((e=>{const{boundElementIds:t}=e;null!=t&&t.length>0&&Cn(e,{boundElementIds:t.map((e=>{var t;return null!==(t=n.get(e))&&void 0!==t?t:e}))})}))},Hs=(e,t)=>{var n;if(null==e)return null;const{elementId:i,focus:s,gap:r}=e;return{focus:s,gap:r,elementId:null!==(n=t.get(i))&&void 0!==n?n:i}},_s=(e,t)=>{const n=new Set(t.map((e=>e.id))),i=new Set;t.forEach((e=>{var t;wt(e)&&(null===(t=e.boundElementIds)||void 0===t||t.forEach((e=>{n.has(e)||i.add(e)})))})),e.filter((e=>{let{id:t}=e;return i.has(t)})).forEach((e=>{const{startBinding:t,endBinding:i}=e;Cn(e,{startBinding:Fs(t,n),endBinding:Fs(i,n)})}))},Fs=(e,t)=>null==e||t.has(e.elementId)?null:e,Us=e=>e>=2*Math.PI?e-2*Math.PI:e,Vs=(e,t,n,i)=>{const[s,r,o,a]=Pt(e),l=(s+o)/2,c=(r+a)/2;let h=5*Math.PI/2+Math.atan2(n-c,t-l);i&&(h+=d.K/2,h-=h%d.K),h=Us(h),Cn(e,{angle:h})},Gs=(e,t,n,i,s)=>{const[r,o,a,l]=Pt(e),c=(r+a)/2,d=(o+l)/2,[h,u]=jt(i,s,c,d,-e.angle);let[m,p]="end"===t?[h-e.x,u-e.y]:[e.x+e.points[1][0]-h,e.y+e.points[1][1]-u];n&&([m,p]=((e,t,n,i)=>{const s=An(e,...jt(t,n,0,0,i));return jt(s.width,s.height,0,0,-i)})(e.type,m,p,e.angle));const[g,b]=Et("end"===t?{s:!0,e:!0}:{n:!0,w:!0},e.x,e.y,e.angle,0,0,(e.points[1][0]-m)/2,(e.points[1][1]-p)/2);Cn(e,{x:g,y:b,points:[[0,0],[m,p]]})},Ws=(e,t,n)=>ft(e)||gt(e)?{points:Dt(0,t,Dt(1,n,e.points))}:{},Ks=(e,t,n)=>{const i=e.fontSize*(t/e.width);if(i<1)return null;const s=Te(e.text,Ae({fontSize:i,fontFamily:e.fontFamily}));return{size:i,baseline:s.baseline+(n-s.height)}},Ys=(e,t,n,i,s)=>{const[r,o,a,l]=Pt(e),c=(r+a)/2,d=(o+l)/2,[h,u]=jt(i,s,c,d,-e.angle);let m;switch(t){case"se":m=Math.max((h-r)/(a-r),(u-o)/(l-o));break;case"nw":m=Math.max((a-h)/(a-r),(l-u)/(l-o));break;case"ne":m=Math.max((h-r)/(a-r),(l-u)/(l-o));break;case"sw":m=Math.max((a-h)/(a-r),(u-o)/(l-o))}if(m>0){const i=e.width*m,s=e.height*m,c=Ks(e,i,s);if(null===c)return;const[d,h,u,p]=Ut(e,i,s),g=(r-d)/2,b=(o-h)/2,f=(a-u)/2,v=(l-p)/2,[y,x]=Et(((e,t)=>({n:/^(n|ne|nw)$/.test(e)||t&&/^(s|se|sw)$/.test(e),s:/^(s|se|sw)$/.test(e)||t&&/^(n|ne|nw)$/.test(e),w:/^(w|nw|sw)$/.test(e)||t&&/^(e|ne|se)$/.test(e),e:/^(e|ne|se)$/.test(e)||t&&/^(w|nw|sw)$/.test(e)}))(t,n),e.x,e.y,e.angle,g,b,f,v);Cn(e,{fontSize:c.size,width:i,height:s,baseline:c.baseline,x:y,y:x})}},Zs=(e,t,n,i,s,r,o)=>{const[a,l,c,d]=Ut(e,e.width,e.height),h=[a,l],u=[c,d],m=[((p=h)[0]+(g=u)[0])/2,(p[1]+g[1])/2];var p,g;const b=St([r,o],m,-e.angle),[f,v,y,x]=Ut(n,n.width,n.height),w=y-f,j=x-v;let S=(u[0]-h[0])/w,E=(u[1]-h[1])/j;i.includes("e")&&(S=(b[0]-h[0])/w),i.includes("s")&&(E=(b[1]-h[1])/j),i.includes("w")&&(S=(u[0]-b[0])/w),i.includes("n")&&(E=(u[1]-b[1])/j);const O=e.width,C=e.height;let k=n.width*S,I=n.height*E;if(s&&(k=2*k-O,I=2*I-C),t){const e=Math.abs(k)/O,t=Math.abs(I)/C;if(1===i.length&&(I*=e,k*=t),2===i.length){const n=Math.max(e,t);k=O*n*Math.sign(k),I=C*n*Math.sign(I)}}const[M,A,T,L]=Ut(e,k,I),D=T-M,P=L-A;let z=[...h];if(["n","w","nw"].includes(i)&&(z=[u[0]-Math.abs(D),u[1]-Math.abs(P)]),"ne"===i){const e=[h[0],u[1]];z=[e[0],e[1]-Math.abs(P)]}if("sw"===i){const e=[u[0],h[1]];z=[e[0]-Math.abs(D),e[1]]}t&&(["s","n"].includes(i)&&(z[0]=m[0]-D/2),["e","w"].includes(i)&&(z[1]=m[1]-P/2)),k<0&&(i.includes("e")&&(z[0]-=Math.abs(D)),i.includes("w")&&(z[0]+=Math.abs(D))),I<0&&(i.includes("s")&&(z[1]-=Math.abs(P)),i.includes("n")&&(z[1]+=Math.abs(P))),s&&(z[0]=m[0]-Math.abs(D)/2,z[1]=m[1]-Math.abs(P)/2);const N=e.angle,R=St(z,m,N),B=[z[0]+Math.abs(D)/2,z[1]+Math.abs(P)/2],H=St(B,m,N);z=St(R,H,-N);const _=Ws(e,k,I),F=[...z];F[0]+=e.x-M,F[1]+=e.y-A;const U={width:Math.abs(k),height:Math.abs(I),x:F[0],y:F[1],..._};"scale"in n&&"scale"in e&&Cn(n,{scale:[(Math.sign(S)||e.scale[0])*e.scale[0],(Math.sign(E)||e.scale[1])*e.scale[1]]}),0!==U.width&&0!==U.height&&Number.isFinite(U.x)&&Number.isFinite(U.y)&&(Is(n,{newSize:{width:U.width,height:U.height}}),Cn(n,U))},Xs=(e,t,n,i)=>{const[s,r,o,a]=Ft(e);let l,c;switch(t){case"se":l=Math.max((n-s)/(o-s),(i-r)/(a-r)),c=(e,t,n)=>{let[i,o]=t,[a,c]=n;return{x:e.x+(i-s)*(l-1)+i-a,y:e.y+(o-r)*(l-1)+o-c}};break;case"nw":l=Math.max((o-n)/(o-s),(a-i)/(a-r)),c=(e,t,n)=>{let[,,i,s]=t,[,,r,c]=n;return{x:e.x-(o-i)*(l-1)+i-r,y:e.y-(a-s)*(l-1)+s-c}};break;case"ne":l=Math.max((n-s)/(o-s),(a-i)/(a-r)),c=(e,t,n)=>{let[i,,,r]=t,[o,,,c]=n;return{x:e.x+(i-s)*(l-1)+i-o,y:e.y-(a-r)*(l-1)+r-c}};break;case"sw":l=Math.max((o-n)/(o-s),(i-r)/(a-r)),c=(e,t,n)=>{let[,i,s]=t,[,a,c]=n;return{x:e.x-(o-s)*(l-1)+s-c,y:e.y+(i-r)*(l-1)+i-a}}}if(l>0){const t=e.reduce(((t,n)=>{if(!t)return t;const i=n.width*l,s=n.height*l;let r={};if("text"===n.type){const e=Ks(n,i,s);if(null===e)return null;r={fontSize:e.size,baseline:e.baseline}}const o=Pt(n),a=Ws(n,i,s);Is(n,{newSize:{width:i,height:s},simultaneouslyUpdated:e});const d=Ut({...n,...a},i,s),{x:h,y:u}=c(n,o,d);return[...t,{width:i,height:s,x:h,y:u,...a,...r}]}),[]);t&&e.forEach(((e,n)=>{Cn(e,t[n])}))}},qs=(e,t,n,i,s,r,o)=>{let a=5*Math.PI/2+Math.atan2(i-o,n-r);s&&(a+=d.K/2,a-=a%d.K),t.forEach(((t,n)=>{var i,s;const[l,c,d,h]=Pt(t),u=(l+d)/2,m=(c+h)/2,p=null!==(i=null===(s=e.originalElements.get(t.id))||void 0===s?void 0:s.angle)&&void 0!==i?i:t.angle,[g,b]=jt(u,m,r,o,a+p-t.angle);Cn(t,{x:t.x+(g-u),y:t.y+(b-m),angle:Us(a+p)})}))},Js=(e,t,n,i,s,r,o,a,l,c,d)=>{l&&(d?a=o/d:(({width:o,height:a}=An(t,o,r<i?-a:a)),a<0&&(a=-a)));let h=s<n?n-o:n,u=r<i?i-a:i;c&&(h=n-(o+=o)/2,u=i-(a+=a)/2),0!==o&&0!==a&&Cn(e,{x:h,y:u,width:o,height:a})},Qs=e=>e.replace(/\t/g,"        ").replace(/\r?\n|\r/g,"\n"),$s=(e,t,n,i,s)=>{const{zoom:r,offsetTop:o,offsetLeft:a}=i,l=180*n/Math.PI;let c=(e-2*a)*(r.value-1)/2;const d=(t-2*o)*(r.value-1)/2;return e>s&&1!==r.value&&(c=s/2*(r.value-1)),"translate(".concat(c,"px, ").concat(d,"px) scale(").concat(r.value,") rotate(").concat(l,"deg)")},er=e=>{const t=Te(e.text,Ae(e));Cn(e,{width:t.width,height:t.height,baseline:t.baseline})},tr=(e,t)=>Boolean(!e.viewModeEnabled&&(e.editingElement||hr(t,e).length||"selection"!==e.elementType)),nr=e=>e.reduce(((e,t)=>e+t.version),0),ir=e=>e.filter((e=>!e.isDeleted)),sr=e=>!e.isDeleted,rr=e=>ir(e).map((e=>vt(e.type)?{...e,lastCommittedPoint:null}:e)),or=e=>rr(e),ar=e=>rr(e),lr=e=>rr(e),cr=(e,t,n)=>{const[i,s]=[e.horizontal,e.vertical].map((e=>null!=e&&e.x<=t&&t<=e.x+e.width&&e.y<=n&&n<=e.y+e.height));return{isOverEither:i||s,isOverHorizontal:i,isOverVertical:s}},dr=(e,t)=>e.some((e=>t.selectedElementIds[e.id])),hr=(e,t)=>e.filter((e=>t.selectedElementIds[e.id])),ur=(e,t)=>t.editingElement?[t.editingElement]:hr(e,t),mr=e=>{let{scenePoint:t,viewportDimensions:n,zoom:i}=e;return{scrollX:n.width/2*(1/i.value)-t.x-i.translation.x*(1/i.value),scrollY:n.height/2*(1/i.value)-t.y-i.translation.y*(1/i.value)}},pr=(e,t,n)=>{if(!(e=(e=>e.filter((e=>!e.isDeleted&&!Mn(e))))(e)).length)return{scrollX:0,scrollY:0};let[i,s,r,o]=Ft(e);((e,t,n)=>{const[i,s,r,o]=n,{x:a,y:l}=_e({sceneX:i,sceneY:s},e),{x:c,y:d}=_e({sceneX:r,sceneY:o},e);return c-a>e.width||d-l>e.height})(t,0,[i,s,r,o])&&([i,s,r,o]=((e,t)=>{if(!e.length)return[0,0,0,0];let n=1/0,i=e[0];return e.forEach((e=>{const[s,r,o,a]=_t(e),l=Ot((s+o)/2,(r+a)/2,t.x,t.y);l<n&&(n=l,i=e)})),_t(i)})(e,He({clientX:t.scrollX,clientY:t.scrollY},t)));return mr({scenePoint:{x:(i+r)/2,y:(s+o)/2},viewportDimensions:{width:t.width,height:t.height},zoom:t.zoom})},gr=e=>"rectangle"===e||"ellipse"===e||"diamond"===e||"line"===e,br=e=>"image"!==e,fr=e=>"rectangle"===e||"ellipse"===e||"diamond"===e||"freedraw"===e||"arrow"===e||"line"===e,vr=e=>"rectangle"===e||"ellipse"===e||"diamond"===e||"arrow"===e||"line"===e,yr=e=>"rectangle"===e||"arrow"===e||"line"===e,xr=e=>"text"===e,wr=e=>"arrow"===e,jr=(e,t)=>{let n=null;for(let i=e.length-1;i>=0;--i){const s=e[i];if(!s.isDeleted&&t(s)){n=s;break}}return n},Sr=function(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{x:0,y:0};return{value:e,translation:{x:i.x-n.left-(i.x-n.left-t.translation.x)*(e/t.value),y:i.y-n.top-(i.y-n.top-t.translation.y)*(e/t.value)}}},Er=e=>{const t=parseFloat(e.toFixed(2));return Math.max(.1,Math.min(t,10))};n(30);class Or extends Error{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Couldn't export canvas.",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"CANVAS_ERROR";super(),this.name=t,this.message=e}}class Cr extends DOMException{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Request Aborted","AbortError")}}n(59);var kr=n(0);var Ir=e=>{let{size:t="1em",circleWidth:n=8}=e;return Object(kr.jsx)("div",{className:"Spinner",children:Object(kr.jsx)("svg",{viewBox:"0 0 100 100",style:{width:t,height:t},children:Object(kr.jsx)("circle",{cx:"50",cy:"50",r:50-n/2,strokeWidth:n,fill:"none",strokeMiterlimit:"10"})})})};const Mr=a.a.forwardRef(((e,t)=>{const{id:n}=Qd(),i=a.a.useRef(null);a.a.useImperativeHandle(t,(()=>i.current));const s="ToolIcon_size_".concat(e.size),[r,l]=Object(o.useState)(!1),c=Object(o.useRef)(!0),d=async t=>{var n;const i="onClick"in e&&(null===(n=e.onClick)||void 0===n?void 0:n.call(e,t));if(i&&"then"in i)try{l(!0),await i}catch(s){if(!(s instanceof Cr))throw s;console.warn(s)}finally{c.current&&l(!1)}};Object(o.useEffect)((()=>()=>{c.current=!1}),[]);const h=Object(o.useRef)(null);if("button"===e.type||"icon"===e.type||"submit"===e.type){const t="icon"===e.type?"button":e.type;return Object(kr.jsxs)("button",{className:Object(lt.a)("ToolIcon_type_button",s,e.className,e.visible&&!e.hidden?"ToolIcon_type_button--show":"ToolIcon_type_button--hide",{ToolIcon:!e.hidden,"ToolIcon--selected":e.selected,"ToolIcon--plain":"icon"===e.type}),"data-testid":e["data-testid"],hidden:e.hidden,title:e.title,"aria-label":e["aria-label"],type:t,onClick:d,ref:i,disabled:r||e.isLoading,children:[(e.icon||e.label)&&Object(kr.jsxs)("div",{className:"ToolIcon__icon","aria-hidden":"true",children:[e.icon||e.label,e.keyBindingLabel&&Object(kr.jsx)("span",{className:"ToolIcon__keybinding",children:e.keyBindingLabel}),e.isLoading&&Object(kr.jsx)(Ir,{})]}),e.showAriaLabel&&Object(kr.jsxs)("div",{className:"ToolIcon__label",children:[e["aria-label"]," ",r&&Object(kr.jsx)(Ir,{})]}),e.children]})}return Object(kr.jsxs)("label",{className:Object(lt.a)("ToolIcon",e.className),title:e.title,onPointerDown:e=>{h.current=e.pointerType||null},onPointerUp:()=>{requestAnimationFrame((()=>{h.current=null}))},children:[Object(kr.jsx)("input",{className:"ToolIcon_type_radio ".concat(s),type:"radio",name:e.name,"aria-label":e["aria-label"],"aria-keyshortcuts":e["aria-keyshortcuts"],"data-testid":e["data-testid"],id:"".concat(n,"-").concat(e.id),onChange:()=>{var t;null===(t=e.onChange)||void 0===t||t.call(e,{pointerType:h.current})},checked:e.checked,ref:i}),Object(kr.jsxs)("div",{className:"ToolIcon__icon",children:[e.icon,e.keyBindingLabel&&Object(kr.jsx)("span",{className:"ToolIcon__keybinding",children:e.keyBindingLabel})]})]})}));Mr.defaultProps={visible:!0,className:"",size:"medium"};const Ar=e=>e===d.P.LIGHT?c.orange[4]:c.orange[9],Tr=e=>e===d.P.LIGHT?c.black:c.gray[4],Lr=e=>e===d.P.LIGHT?c.white:"#1e1e1e",Dr=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:512;const{width:n=512,height:i=n,mirror:s,style:r}="number"===typeof t?{width:t}:t;return Object(kr.jsx)("svg",{"aria-hidden":"true",focusable:"false",role:"img",viewBox:"0 0 ".concat(n," ").concat(i),className:Object(lt.a)({"rtl-mirror":s}),style:r,children:"string"===typeof e?Object(kr.jsx)("path",{fill:"currentColor",d:e}):e})},Pr=Dr(Object(kr.jsx)("polyline",{fill:"none",stroke:"currentColor",points:"20 6 9 17 4 12"}),{width:24,height:24}),zr=Dr("M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z",{mirror:!0}),Nr=Dr("M433.941 129.941l-83.882-83.882A48 48 0 0 0 316.118 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V163.882a48 48 0 0 0-14.059-33.941zM224 416c-35.346 0-64-28.654-64-64 0-35.346 28.654-64 64-64s64 28.654 64 64c0 35.346-28.654 64-64 64zm96-304.52V212c0 6.627-5.373 12-12 12H76c-6.627 0-12-5.373-12-12V108c0-6.627 5.373-12 12-12h228.52c3.183 0 6.235 1.264 8.485 3.515l3.48 3.48A11.996 11.996 0 0 1 320 111.48z",{width:448,height:512}),Rr=Dr("M252 54L203 8a28 27 0 00-20-8H28C12 0 0 12 0 27v195c0 15 12 26 28 26h204c15 0 28-11 28-26V73a28 27 0 00-8-19zM130 213c-21 0-37-16-37-36 0-19 16-35 37-35 20 0 37 16 37 35 0 20-17 36-37 36zm56-169v56c0 4-4 6-7 6H44c-4 0-7-2-7-6V42c0-4 3-7 7-7h133l4 2 3 2a7 7 0 012 5z M296 201l87 95-188 205-78 9c-10 1-19-8-18-20l9-84zm141-14l-41-44a31 31 0 00-46 0l-38 41 87 95 38-42c13-14 13-36 0-50z",{width:448,height:512}),Br=Dr("M572.694 292.093L500.27 416.248A63.997 63.997 0 0 1 444.989 448H45.025c-18.523 0-30.064-20.093-20.731-36.093l72.424-124.155A64 64 0 0 1 152 256h399.964c18.523 0 30.064 20.093 20.73 36.093zM152 224h328v-48c0-26.51-21.49-48-48-48H272l-64-64H48C21.49 64 0 85.49 0 112v278.046l69.077-118.418C86.214 242.25 117.989 224 152 224z",{width:576,height:512,mirror:!0}),Hr=Dr("M384 112v352c0 26.51-21.49 48-48 48H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h80c0-35.29 28.71-64 64-64s64 28.71 64 64h80c26.51 0 48 21.49 48 48zM192 40c-13.255 0-24 10.745-24 24s10.745 24 24 24 24-10.745 24-24-10.745-24-24-24m96 114v-20a6 6 0 0 0-6-6H102a6 6 0 0 0-6 6v20a6 6 0 0 0 6 6h180a6 6 0 0 0 6-6z",{width:384,height:512}),_r=Dr("M32 464a48 48 0 0 0 48 48h288a48 48 0 0 0 48-48V128H32zm272-256a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zm-96 0a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zm-96 0a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zM432 32H312l-9.4-18.7A24 24 0 0 0 281.1 0H166.8a23.72 23.72 0 0 0-21.4 13.3L136 32H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16z",{width:448,height:512}),Fr=Dr("M204.3 5C104.9 24.4 24.8 104.3 5.2 203.4c-37 187 131.7 326.4 258.8 306.7 41.2-6.4 61.4-54.6 42.5-91.7-23.1-45.4 9.9-98.4 60.9-98.4h79.7c35.8 0 64.8-29.6 64.9-65.3C511.5 97.1 368.1-26.9 204.3 5zM96 320c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm32-128c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm128-64c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm128 64c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32z"),Ur=Dr("M384 121.9c0-6.3-2.5-12.4-7-16.9L279.1 7c-4.5-4.5-10.6-7-17-7H256v128h128zM571 308l-95.7-96.4c-10.1-10.1-27.4-3-27.4 11.3V288h-64v64h64v65.2c0 14.3 17.3 21.4 27.4 11.3L571 332c6.6-6.6 6.6-17.4 0-24zm-379 28v-32c0-8.8 7.2-16 16-16h176V160H248c-13.2 0-24-10.8-24-24V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V352H208c-8.8 0-16-7.2-16-16z",{width:576,height:512,mirror:!0}),Vr=Dr(Object(kr.jsxs)(kr.Fragment,{children:[Object(kr.jsx)("path",{d:"M571 308l-95.7-96.4c-10.1-10.1-27.4-3-27.4 11.3V288h-64v64h64v65.2c0 14.3 17.3 21.4 27.4 11.3L571 332c6.6-6.6 6.6-17.4 0-24zm-187 44v-64 64z"}),Object(kr.jsx)("path",{d:"M384 121.941V128H256V0h6.059c6.362 0 12.471 2.53 16.97 7.029l97.941 97.941a24.01 24.01 0 017.03 16.971zM248 160c-13.2 0-24-10.8-24-24V0H24C10.745 0 0 10.745 0 24v464c0 13.255 10.745 24 24 24h336c13.255 0 24-10.745 24-24V160H248zm-135.455 16c26.51 0 48 21.49 48 48s-21.49 48-48 48-48-21.49-48-48 21.491-48 48-48zm208 240h-256l.485-48.485L104.545 328c4.686-4.686 11.799-4.201 16.485.485L160.545 368 264.06 264.485c4.686-4.686 12.284-4.686 16.971 0L320.545 304v112z"})]}),{width:576,height:512,mirror:!0}),Gr=Dr("M216 0h80c13.3 0 24 10.7 24 24v168h87.7c17.8 0 26.7 21.5 14.1 34.1L269.7 378.3c-7.5 7.5-19.8 7.5-27.3 0L90.1 226.1c-12.6-12.6-3.7-34.1 14.1-34.1H192V24c0-13.3 10.7-24 24-24zm296 376v112c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V376c0-13.3 10.7-24 24-24h146.7l49 49c20.1 20.1 52.5 20.1 72.6 0l49-49H488c13.3 0 24 10.7 24 24zm-124 88c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20zm64 0c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20z",{width:512,height:512}),Wr=Dr("M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z",{width:448,height:512}),Kr=Dr("M416 208H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h384c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z",{width:448,height:512}),Yr=Dr("M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"),Zr=Dr("M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"),Xr=Dr("M255.545 8c-66.269.119-126.438 26.233-170.86 68.685L48.971 40.971C33.851 25.851 8 36.559 8 57.941V192c0 13.255 10.745 24 24 24h134.059c21.382 0 32.09-25.851 16.971-40.971l-41.75-41.75c30.864-28.899 70.801-44.907 113.23-45.273 92.398-.798 170.283 73.977 169.484 169.442C423.236 348.009 349.816 424 256 424c-41.127 0-79.997-14.678-110.63-41.556-4.743-4.161-11.906-3.908-16.368.553L89.34 422.659c-4.872 4.872-4.631 12.815.482 17.433C133.798 479.813 192.074 504 256 504c136.966 0 247.999-111.033 248-247.998C504.001 119.193 392.354 7.755 255.545 8z",{mirror:!0}),qr=Dr("M256.455 8c66.269.119 126.437 26.233 170.859 68.685l35.715-35.715C478.149 25.851 504 36.559 504 57.941V192c0 13.255-10.745 24-24 24H345.941c-21.382 0-32.09-25.851-16.971-40.971l41.75-41.75c-30.864-28.899-70.801-44.907-113.23-45.273-92.398-.798-170.283 73.977-169.484 169.442C88.764 348.009 162.184 424 256 424c41.127 0 79.997-14.678 110.629-41.556 4.743-4.161 11.906-3.908 16.368.553l39.662 39.662c4.872 4.872 4.631 12.815-.482 17.433C378.202 479.813 319.926 504 256 504 119.034 504 8.001 392.967 8 256.002 7.999 119.193 119.646 7.755 256.455 8z",{mirror:!0}),Jr=Dr("M504 256c0 136.997-111.043 248-248 248S8 392.997 8 256C8 119.083 119.043 8 256 8s248 111.083 248 248zM262.655 90c-54.497 0-89.255 22.957-116.549 63.758-3.536 5.286-2.353 12.415 2.715 16.258l34.699 26.31c5.205 3.947 12.621 3.008 16.665-2.122 17.864-22.658 30.113-35.797 57.303-35.797 20.429 0 45.698 13.148 45.698 32.958 0 14.976-12.363 22.667-32.534 33.976C247.128 238.528 216 254.941 216 296v4c0 6.627 5.373 12 12 12h56c6.627 0 12-5.373 12-12v-1.333c0-28.462 83.186-29.647 83.186-106.667 0-58.002-60.165-102-116.531-102zM256 338c-25.365 0-46 20.635-46 46 0 25.364 20.635 46 46 46s46-20.636 46-46c0-25.365-20.635-46-46-46z",{mirror:!0}),Qr=Dr("M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z",{width:24,height:24}),$r=Dr("M16 5l-1.42 1.42-1.59-1.59V16h-1.98V4.83L9.42 6.42 8 5l4-4 4 4zm4 5v11c0 1.1-.9 2-2 2H6c-1.11 0-2-.9-2-2V10c0-1.11.89-2 2-2h3v2H6v11h12V10h-3V8h3c1.1 0 2 .89 2 2z",{width:24,height:24}),eo=Dr(Object(kr.jsxs)(kr.Fragment,{children:[Object(kr.jsx)("path",{stroke:"currentColor",fill:"currentColor",d:"M40 5.6v6.1l-4.1.7c-8.9 1.4-16.5 6.9-20.6 15C13 32 10.9 43 12.4 43c.4 0 2.4-1.3 4.4-3 5-3.9 12.1-7 18.2-7.7l5-.6v12.8l11.2-11.3L62.5 22 51.2 10.8 40-.5v6.1zm10.2 22.6L44 34.5v-6.8l-6.9.6c-3.9.3-9.8 1.7-13.2 3.1-3.5 1.4-6.5 2.4-6.7 2.2-.9-1 3-7.5 6.4-10.8C28 18.6 34.4 16 40.1 16c3.7 0 3.9-.1 3.9-3.2V9.5l6.2 6.3 6.3 6.2-6.3 6.2z"}),Object(kr.jsx)("path",{stroke:"currentColor",fill:"currentColor",d:"M0 36v20h48v-6.2c0-6 0-6.1-2-4.3-1.1 1-2 2.9-2 4.2V52H4V34c0-17.3-.1-18-2-18s-2 .7-2 20z"})]}),{width:64,height:64}),to=(Dr(Object(kr.jsx)("path",{stroke:"currentColor",strokeWidth:"40",fill:"currentColor",d:"M148 560a318 318 0 0 0 522 110 316 316 0 0 0 0-450 316 316 0 0 0-450 0c-11 11-21 22-30 34v4h47c25 0 46 21 46 46s-21 45-46 45H90c-13 0-25-6-33-14-9-9-14-20-14-33V156c0-25 20-45 45-45s45 20 45 45v32l1 1a401 401 0 0 1 623 509l212 212a42 42 0 0 1-59 59L698 757A401 401 0 0 1 65 570a42 42 0 0 1 83-10z"}),{width:1024}),a.a.memo((e=>{let{theme:t}=e;return Dr(Object(kr.jsxs)(kr.Fragment,{children:[Object(kr.jsx)("path",{d:"M22 9.556C22 8.696 21.303 8 20.444 8H16v8H8v4.444C8 21.304 8.697 22 9.556 22h10.888c.86 0 1.556-.697 1.556-1.556V9.556z",fill:Tr(t),stroke:Tr(t),strokeWidth:"2"}),Object(kr.jsx)("path",{d:"M16 3.556C16 2.696 15.303 2 14.444 2H3.556C2.696 2 2 2.697 2 3.556v10.888C2 15.304 2.697 16 3.556 16h10.888c.86 0 1.556-.697 1.556-1.556V3.556z",fill:Ar(t),stroke:Ar(t),strokeWidth:"2"})]}),{width:24,mirror:!0})}))),no=a.a.memo((e=>{let{theme:t}=e;return Dr(Object(kr.jsxs)(kr.Fragment,{children:[Object(kr.jsx)("path",{d:"M16 3.556C16 2.696 15.303 2 14.444 2H3.556C2.696 2 2 2.697 2 3.556v10.888C2 15.304 2.697 16 3.556 16h10.888c.86 0 1.556-.697 1.556-1.556V3.556z",fill:Ar(t),stroke:Ar(t),strokeWidth:"2"}),Object(kr.jsx)("path",{d:"M22 9.556C22 8.696 21.303 8 20.444 8H9.556C8.696 8 8 8.697 8 9.556v10.888C8 21.304 8.697 22 9.556 22h10.888c.86 0 1.556-.697 1.556-1.556V9.556z",fill:Tr(t),stroke:Tr(t),strokeWidth:"2"})]}),{width:24,mirror:!0})})),io=a.a.memo((e=>{let{theme:t}=e;return Dr(Object(kr.jsxs)(kr.Fragment,{children:[Object(kr.jsx)("path",{d:"M13 21a1 1 0 001 1h7a1 1 0 001-1v-7a1 1 0 00-1-1h-3v5h-5v3zM11 3a1 1 0 00-1-1H3a1 1 0 00-1 1v7a1 1 0 001 1h3V6h5V3z",fill:Tr(t),stroke:Tr(t),strokeWidth:"2"}),Object(kr.jsx)("path",{d:"M18 7.333C18 6.597 17.403 6 16.667 6H7.333C6.597 6 6 6.597 6 7.333v9.334C6 17.403 6.597 18 7.333 18h9.334c.736 0 1.333-.597 1.333-1.333V7.333z",fill:Ar(t),stroke:Ar(t),strokeWidth:"2"})]}),{width:24,mirror:!0})})),so=a.a.memo((e=>{let{theme:t}=e;return Dr(Object(kr.jsxs)(kr.Fragment,{children:[Object(kr.jsx)("path",{d:"M18 7.333C18 6.597 17.403 6 16.667 6H7.333C6.597 6 6 6.597 6 7.333v9.334C6 17.403 6.597 18 7.333 18h9.334c.736 0 1.333-.597 1.333-1.333V7.333z",fill:Ar(t),stroke:Ar(t),strokeWidth:"2"}),Object(kr.jsx)("path",{d:"M11 3a1 1 0 00-1-1H3a1 1 0 00-1 1v7a1 1 0 001 1h8V3zM22 14a1 1 0 00-1-1h-7a1 1 0 00-1 1v7a1 1 0 001 1h8v-8z",fill:Tr(t),stroke:Tr(t),strokeWidth:"2"})]}),{width:24,mirror:!0})})),ro=a.a.memo((e=>{let{theme:t}=e;return Dr(Object(kr.jsxs)(kr.Fragment,{children:[Object(kr.jsx)("path",{d:"M 2,5 H 22",fill:Tr(t),stroke:Tr(t),strokeWidth:"2",strokeLinecap:"round"}),Object(kr.jsx)("path",{d:"M 6,7 C 5.446,7 5,7.446 5,8 v 9.999992 c 0,0.554 0.446,1 1,1 h 3.0000001 c 0.554,0 0.9999999,-0.446 0.9999999,-1 V 8 C 10,7.446 9.5540001,7 9.0000001,7 Z m 9,0 c -0.554,0 -1,0.446 -1,1 v 5.999992 c 0,0.554 0.446,1 1,1 h 3 c 0.554,0 1,-0.446 1,-1 V 8 C 19,7.446 18.554,7 18,7 Z",fill:Ar(t),stroke:Ar(t),strokeWidth:"2"})]}),{width:24,mirror:!0})})),oo=a.a.memo((e=>{let{theme:t}=e;return Dr(Object(kr.jsxs)(kr.Fragment,{children:[Object(kr.jsx)("path",{d:"M 2,19 H 22",fill:Tr(t),stroke:Tr(t),strokeWidth:"2",strokeLinecap:"round"}),Object(kr.jsx)("path",{d:"m 6,16.999992 c -0.554,0 -1,-0.446 -1,-1 V 6 C 5,5.446 5.446,5 6,5 H 9.0000001 C 9.5540001,5 10,5.446 10,6 v 9.999992 c 0,0.554 -0.4459999,1 -0.9999999,1 z m 9,0 c -0.554,0 -1,-0.446 -1,-1 V 10 c 0,-0.554 0.446,-1 1,-1 h 3 c 0.554,0 1,0.446 1,1 v 5.999992 c 0,0.554 -0.446,1 -1,1 z",fill:Ar(t),stroke:Ar(t),strokeWidth:"2"})]}),{width:24,mirror:!0})})),ao=a.a.memo((e=>{let{theme:t}=e;return Dr(Object(kr.jsxs)(kr.Fragment,{children:[Object(kr.jsx)("path",{d:"M 5,2 V 22",fill:Tr(t),stroke:Tr(t),strokeWidth:"2",strokeLinecap:"round"}),Object(kr.jsx)("path",{d:"m 7.000004,5.999996 c 0,-0.554 0.446,-1 1,-1 h 9.999992 c 0.554,0 1,0.446 1,1 v 3.0000001 c 0,0.554 -0.446,0.9999999 -1,0.9999999 H 8.000004 c -0.554,0 -1,-0.4459999 -1,-0.9999999 z m 0,9 c 0,-0.554 0.446,-1 1,-1 h 5.999992 c 0.554,0 1,0.446 1,1 v 3 c 0,0.554 -0.446,1 -1,1 H 8.000004 c -0.554,0 -1,-0.446 -1,-1 z",fill:Ar(t),stroke:Ar(t),strokeWidth:"2"})]}),{width:24})})),lo=a.a.memo((e=>{let{theme:t}=e;return Dr(Object(kr.jsxs)(kr.Fragment,{children:[Object(kr.jsx)("path",{d:"M 19,2 V 22",fill:Tr(t),stroke:Tr(t),strokeWidth:"2",strokeLinecap:"round"}),Object(kr.jsx)("path",{d:"m 16.999996,5.999996 c 0,-0.554 -0.446,-1 -1,-1 H 6.000004 c -0.554,0 -1,0.446 -1,1 v 3.0000001 c 0,0.554 0.446,0.9999999 1,0.9999999 h 9.999992 c 0.554,0 1,-0.4459999 1,-0.9999999 z m 0,9 c 0,-0.554 -0.446,-1 -1,-1 h -5.999992 c -0.554,0 -1,0.446 -1,1 v 3 c 0,0.554 0.446,1 1,1 h 5.999992 c 0.554,0 1,-0.446 1,-1 z",fill:Ar(t),stroke:Ar(t),strokeWidth:"2"})]}),{width:24})})),co=a.a.memo((e=>{let{theme:t}=e;return Dr(Object(kr.jsxs)(kr.Fragment,{children:[Object(kr.jsx)("path",{d:"M19 5V19M5 5V19",stroke:Tr(t),strokeWidth:"2",strokeLinecap:"round"}),Object(kr.jsx)("path",{d:"M15 9C15.554 9 16 9.446 16 10V14C16 14.554 15.554 15 15 15H9C8.446 15 8 14.554 8 14V10C8 9.446 8.446 9 9 9H15Z",fill:Ar(t),stroke:Ar(t),strokeWidth:"2"})]}),{width:24})})),ho=a.a.memo((e=>{let{theme:t}=e;return Dr(Object(kr.jsxs)(kr.Fragment,{children:[Object(kr.jsx)("path",{d:"M5 5L19 5M5 19H19",fill:Tr(t),stroke:Tr(t),strokeWidth:"2",strokeLinecap:"round"}),Object(kr.jsx)("path",{d:"M15 9C15.554 9 16 9.446 16 10V14C16 14.554 15.554 15 15 15H9C8.446 15 8 14.554 8 14V10C8 9.446 8.446 9 9 9H15Z",fill:Ar(t),stroke:Ar(t),strokeWidth:"2"})]}),{width:24})})),uo=a.a.memo((e=>{let{theme:t}=e;return Dr(Object(kr.jsxs)(kr.Fragment,{children:[Object(kr.jsx)("path",{d:"m 5.000004,16.999996 c 0,0.554 0.446,1 1,1 h 3 c 0.554,0 1,-0.446 1,-1 v -10 c 0,-0.554 -0.446,-1 -1,-1 h -3 c -0.554,0 -1,0.446 -1,1 z m 9,-2 c 0,0.554 0.446,1 1,1 h 3 c 0.554,0 1,-0.446 1,-1 v -6 c 0,-0.554 -0.446,-1 -1,-1 h -3 c -0.554,0 -1,0.446 -1,1 z",fill:Ar(t),stroke:Ar(t),strokeWidth:"2"}),Object(kr.jsx)("path",{d:"M 2,12 H 22",fill:Tr(t),stroke:Tr(t),strokeWidth:"2",strokeDasharray:"1, 2.8",strokeLinecap:"round"})]}),{width:24,mirror:!0})})),mo=a.a.memo((e=>{let{theme:t}=e;return Dr(Object(kr.jsxs)(kr.Fragment,{children:[Object(kr.jsx)("path",{d:"M 7 5 C 6.446 5 6 5.446 6 6 L 6 9 C 6 9.554 6.446 10 7 10 L 17 10 C 17.554 10 18 9.554 18 9 L 18 6 C 18 5.446 17.554 5 17 5 L 7 5 z M 9 14 C 8.446 14 8 14.446 8 15 L 8 18 C 8 18.554 8.446 19 9 19 L 15 19 C 15.554 19 16 18.554 16 18 L 16 15 C 16 14.446 15.554 14 15 14 L 9 14 z ",fill:Ar(t),stroke:Ar(t),strokeWidth:"2"}),Object(kr.jsx)("path",{d:"M 12,2 V 22",fill:Tr(t),stroke:Tr(t),strokeWidth:"2",strokeDasharray:"1, 2.8",strokeLinecap:"round"})]}),{width:24})})),po=Dr("M192 256c61.9 0 112-50.1 112-112S253.9 32 192 32 80 82.1 80 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C51.6 288 0 339.6 0 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zM480 256c53 0 96-43 96-96s-43-96-96-96-96 43-96 96 43 96 96 96zm48 32h-3.8c-13.9 4.8-28.6 8-44.2 8s-30.3-3.2-44.2-8H432c-20.4 0-39.2 5.9-55.7 15.4 24.4 26.3 39.7 61.2 39.7 99.8v38.4c0 2.2-.5 4.3-.6 6.4H592c26.5 0 48-21.5 48-48 0-61.9-50.1-112-112-112z",{width:640,height:512,mirror:!0}),go=Dr("M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm115.7 272l-176 101c-15.8 8.8-35.7-2.5-35.7-21V152c0-18.4 19.8-29.8 35.7-21l176 107c16.4 9.2 16.4 32.9 0 42z"),bo=Dr("M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm96 328c0 8.8-7.2 16-16 16H176c-8.8 0-16-7.2-16-16V176c0-8.8 7.2-16 16-16h160c8.8 0 16 7.2 16 16v160z"),fo=Dr("M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z",{width:352,height:512}),vo=Dr("M34.52 239.03L228.87 44.69c9.37-9.37 24.57-9.37 33.94 0l22.67 22.67c9.36 9.36 9.37 24.52.04 33.9L131.49 256l154.02 154.75c9.34 9.38 9.32 24.54-.04 33.9l-22.67 22.67c-9.37 9.37-24.57 9.37-33.94 0L34.52 272.97c-9.37-9.37-9.37-24.57 0-33.94z",{width:320,height:512,style:{marginLeft:"-0.2rem"},mirror:!0}),yo=Dr("M464 0c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48H176c-26.51 0-48-21.49-48-48V48c0-26.51 21.49-48 48-48h288M176 416c-44.112 0-80-35.888-80-80V128H48c-26.51 0-48 21.49-48 48v288c0 26.51 21.49 48 48 48h288c26.51 0 48-21.49 48-48v-48H176z",{mirror:!0}),xo=Dr("M11.553 22.894a.998.998 0 00.894 0s3.037-1.516 5.465-4.097C19.616 16.987 21 14.663 21 12V5a1 1 0 00-.649-.936l-8-3a.998.998 0 00-.702 0l-8 3A1 1 0 003 5v7c0 2.663 1.384 4.987 3.088 6.797 2.428 2.581 5.465 4.097 5.465 4.097zm-1.303-8.481l6.644-6.644a.856.856 0 111.212 1.212l-7.25 7.25a.856.856 0 01-1.212 0l-3.75-3.75a.856.856 0 111.212-1.212l3.144 3.144z",{width:24}),wo=Dr("M369.9 97.9L286 14C277 5 264.8-.1 252.1-.1H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V131.9c0-12.7-5.1-25-14.1-34zM332.1 128H256V51.9l76.1 76.1zM48 464V48h160v104c0 13.3 10.7 24 24 24h104v288H48zm32-48h224V288l-23.5-23.5c-4.7-4.7-12.3-4.7-17 0L176 352l-39.5-39.5c-4.7-4.7-12.3-4.7-17 0L80 352v64zm48-240c-26.5 0-48 21.5-48 48s21.5 48 48 48 48-21.5 48-48-21.5-48-48-48z",{width:384,height:512}),jo=a.a.memo((e=>{let{theme:t}=e;return Dr(Object(kr.jsxs)(kr.Fragment,{children:[Object(kr.jsx)("path",{d:"M25 26H111V111H25",fill:Tr(t)}),Object(kr.jsx)("path",{d:"M25 111C25 80.2068 25 49.4135 25 26M25 26C48.6174 26 72.2348 26 111 26H25ZM25 26C53.3671 26 81.7343 26 111 26H25ZM111 26C111 52.303 111 78.606 111 111V26ZM111 26C111 51.2947 111 76.5893 111 111V26ZM111 111C87.0792 111 63.1585 111 25 111H111ZM111 111C87.4646 111 63.9293 111 25 111H111ZM25 111C25 81.1514 25 51.3028 25 26V111Z",stroke:Tr(t),strokeWidth:"2"}),Object(kr.jsx)("path",{d:"M100 100H160V160H100",fill:Tr(t)}),Object(kr.jsx)("path",{d:"M100 160C100 144.106 100 128.211 100 100M100 100C117.706 100 135.412 100 160 100H100ZM100 100C114.214 100 128.428 100 160 100H100ZM160 100C160 120.184 160 140.369 160 160V100ZM160 100C160 113.219 160 126.437 160 160V100ZM160 160C145.534 160 131.068 160 100 160H160ZM160 160C143.467 160 126.934 160 100 160H160ZM100 160C100 143.661 100 127.321 100 100V160Z",stroke:Tr(t),strokeWidth:"2"}),Object(kr.jsxs)("g",{fill:Lr(t),stroke:Tr(t),strokeWidth:"6",children:[Object(kr.jsx)("rect",{x:"2.5",y:"2.5",width:"30",height:"30"}),Object(kr.jsx)("rect",{x:"2.5",y:"149.5",width:"30",height:"30"}),Object(kr.jsx)("rect",{x:"147.5",y:"149.5",width:"30",height:"30"}),Object(kr.jsx)("rect",{x:"147.5",y:"2.5",width:"30",height:"30"})]})]}),{width:182,height:182,mirror:!0})})),So=a.a.memo((e=>{let{theme:t}=e;return Dr(Object(kr.jsxs)(kr.Fragment,{children:[Object(kr.jsx)("path",{d:"M25 26H111V111H25",fill:Tr(t)}),Object(kr.jsx)("path",{d:"M25 111C25 80.2068 25 49.4135 25 26M25 26C48.6174 26 72.2348 26 111 26H25ZM25 26C53.3671 26 81.7343 26 111 26H25ZM111 26C111 52.303 111 78.606 111 111V26ZM111 26C111 51.2947 111 76.5893 111 111V26ZM111 111C87.0792 111 63.1585 111 25 111H111ZM111 111C87.4646 111 63.9293 111 25 111H111ZM25 111C25 81.1514 25 51.3028 25 26V111Z",stroke:Tr(t),strokeWidth:"2"}),Object(kr.jsx)("path",{d:"M100 100H160V160H100",fill:Tr(t)}),Object(kr.jsx)("path",{d:"M100 160C100 144.106 100 128.211 100 100M100 100C117.706 100 135.412 100 160 100H100ZM100 100C114.214 100 128.428 100 160 100H100ZM160 100C160 120.184 160 140.369 160 160V100ZM160 100C160 113.219 160 126.437 160 160V100ZM160 160C145.534 160 131.068 160 100 160H160ZM160 160C143.467 160 126.934 160 100 160H160ZM100 160C100 143.661 100 127.321 100 100V160Z",stroke:Tr(t),strokeWidth:"2"}),Object(kr.jsxs)("g",{fill:Lr(t),stroke:Tr(t),strokeWidth:"6",children:[Object(kr.jsx)("rect",{x:"2.5",y:"2.5",width:"30",height:"30"}),Object(kr.jsx)("rect",{x:"78.5",y:"149.5",width:"30",height:"30"}),Object(kr.jsx)("rect",{x:"147.5",y:"149.5",width:"30",height:"30"}),Object(kr.jsx)("rect",{x:"147.5",y:"78.5",width:"30",height:"30"}),Object(kr.jsx)("rect",{x:"105.5",y:"2.5",width:"30",height:"30"}),Object(kr.jsx)("rect",{x:"2.5",y:"102.5",width:"30",height:"30"})]})]}),{width:182,height:182,mirror:!0})})),Eo=a.a.memo((e=>{let{theme:t}=e;return Dr(Object(kr.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M20.101 16H28.0934L36 8.95989V4H33.5779L20.101 16ZM30.5704 4L17.0935 16H9.10101L22.5779 4H30.5704ZM19.5704 4L6.09349 16H4V10.7475L11.5779 4H19.5704ZM8.57036 4H4V8.06952L8.57036 4ZM36 11.6378L31.101 16H36V11.6378ZM2 2V18H38V2H2Z",fill:Tr(t)}),{width:40,height:20})})),Oo=a.a.memo((e=>{let{theme:t}=e;return Dr(Object(kr.jsxs)("g",{fill:Tr(t),fillRule:"evenodd",clipRule:"evenodd",children:[Object(kr.jsx)("path",{d:"M20.101 16H28.0934L36 8.95989V4H33.5779L20.101 16ZM30.5704 4L17.0935 16H9.10101L22.5779 4H30.5704ZM19.5704 4L6.09349 16H4V10.7475L11.5779 4H19.5704ZM8.57036 4H4V8.06952L8.57036 4ZM36 11.6378L31.101 16H36V11.6378ZM2 2V18H38V2H2Z"}),Object(kr.jsx)("path",{d:"M14.0001 18L3.00006 4.00002L4.5727 2.76438L15.5727 16.7644L14.0001 18ZM25.0001 18L14.0001 4.00002L15.5727 2.76438L26.5727 16.7644L25.0001 18ZM36.0001 18L25.0001 4.00002L26.5727 2.76438L37.5727 16.7644L36.0001 18Z"})]}),{width:40,height:20})})),Co=a.a.memo((e=>{let{theme:t}=e;return Dr(Object(kr.jsx)("path",{d:"M2 2H38V18H2V2Z",fill:Tr(t)}),{width:40,height:20})})),ko=a.a.memo((e=>{let{theme:t,strokeWidth:n}=e;return Dr(Object(kr.jsx)("path",{d:"M6 10H32",stroke:Tr(t),strokeWidth:n,strokeLinecap:"round",fill:"none"}),{width:40,height:20})})),Io=a.a.memo((e=>{let{theme:t}=e;return Dr(Object(kr.jsx)("path",{d:"M6 10H34",stroke:Tr(t),strokeWidth:2,fill:"none",strokeLinecap:"round"}),{width:40,height:20})})),Mo=a.a.memo((e=>{let{theme:t}=e;return Dr(Object(kr.jsx)("path",{d:"M6 10H34",stroke:Tr(t),strokeWidth:2.5,strokeDasharray:"10, 8",fill:"none",strokeLinecap:"round"}),{width:40,height:20})})),Ao=a.a.memo((e=>{let{theme:t}=e;return Dr(Object(kr.jsx)("path",{d:"M6 10H36",stroke:Tr(t),strokeWidth:2.5,strokeDasharray:"2, 4.5",fill:"none",strokeLinecap:"round"}),{width:40,height:20})})),To=a.a.memo((e=>{let{theme:t}=e;return Dr(Object(kr.jsx)("path",{d:"M3.00098 16.1691C6.28774 13.9744 19.6399 2.8905 22.7215 3.00082C25.8041 3.11113 19.1158 15.5488 21.4962 16.8309C23.8757 18.1131 34.4155 11.7148 37.0001 10.6919",stroke:Tr(t),strokeWidth:2,strokeLinecap:"round",fill:"none"}),{width:40,height:20,mirror:!0})})),Lo=a.a.memo((e=>{let{theme:t}=e;return Dr(Object(kr.jsx)("path",{d:"M3 17C6.68158 14.8752 16.1296 9.09849 22.0648 6.54922C28 3.99995 22.2896 13.3209 25 14C27.7104 14.6791 36.3757 9.6471 36.3757 9.6471M6.40706 15C13 11.1918 20.0468 1.51045 23.0234 3.0052C26 4.49995 20.457 12.8659 22.7285 16.4329C25 20 36.3757 13 36.3757 13",stroke:Tr(t),strokeWidth:2,strokeLinecap:"round",fill:"none"}),{width:40,height:20,mirror:!0})})),Do=a.a.memo((e=>{let{theme:t}=e;return Dr(Object(kr.jsx)("path",{d:"M3 15.6468C6.93692 13.5378 22.5544 2.81528 26.6206 3.00242C30.6877 3.18956 25.6708 15.3346 27.4009 16.7705C29.1309 18.2055 35.4001 12.4762 37 11.6177M3.97143 10.4917C6.61158 9.24563 16.3706 2.61886 19.8104 3.01724C23.2522 3.41472 22.0773 12.2013 24.6181 12.8783C27.1598 13.5536 33.3179 8.04068 35.0571 7.07244",stroke:Tr(t),strokeWidth:2,strokeLinecap:"round",fill:"none"}),{width:40,height:20,mirror:!0})})),Po=a.a.memo((e=>{let{theme:t}=e;return Dr(Object(kr.jsx)("path",{d:"M10 17L10 5L35 5",stroke:Tr(t),strokeWidth:2,strokeLinecap:"round",fill:"none"}),{width:40,height:20,mirror:!0})})),zo=a.a.memo((e=>{let{theme:t}=e;return Dr(Object(kr.jsx)("path",{d:"M10 17V15C10 8 13 5 21 5L33.5 5",stroke:Tr(t),strokeWidth:2,strokeLinecap:"round",fill:"none"}),{width:40,height:20,mirror:!0})})),No=a.a.memo((e=>{let{theme:t}=e;return Dr(Object(kr.jsx)("path",{d:"M6 10H34",stroke:Tr(t),strokeWidth:2,fill:"none"}),{width:40,height:20})})),Ro=a.a.memo((e=>{let{theme:t,flip:n=!1}=e;return Dr(Object(kr.jsxs)("g",{transform:n?"translate(40, 0) scale(-1, 1)":"",stroke:Tr(t),strokeWidth:2,fill:"none",children:[Object(kr.jsx)("path",{d:"M34 10H6M34 10L27 5M34 10L27 15"}),Object(kr.jsx)("path",{d:"M27.5 5L34.5 10L27.5 15"})]}),{width:40,height:20})})),Bo=a.a.memo((e=>{let{theme:t,flip:n=!1}=e;return Dr(Object(kr.jsxs)("g",{stroke:Tr(t),fill:Tr(t),transform:n?"translate(40, 0) scale(-1, 1)":"",children:[Object(kr.jsx)("path",{d:"M32 10L6 10",strokeWidth:2}),Object(kr.jsx)("circle",{r:"4",transform:"matrix(-1 0 0 1 30 10)"})]}),{width:40,height:20})})),Ho=a.a.memo((e=>{let{theme:t,flip:n=!1}=e;return Dr(Object(kr.jsx)("g",{transform:n?"translate(40, 0) scale(-1, 1)":"",children:Object(kr.jsx)("path",{d:"M34 10H5.99996M34 10L34 5M34 10L34 15",stroke:Tr(t),strokeWidth:2,fill:"none"})}),{width:40,height:20})})),_o=a.a.memo((e=>{let{theme:t,flip:n=!1}=e;return Dr(Object(kr.jsxs)("g",{stroke:Tr(t),fill:Tr(t),transform:n?"translate(40, 0) scale(-1, 1)":"",children:[Object(kr.jsx)("path",{d:"M32 10L6 10",strokeWidth:2}),Object(kr.jsx)("path",{d:"M27.5 5.5L34.5 10L27.5 14.5L27.5 5.5"})]}),{width:40,height:20})})),Fo=a.a.memo((e=>{let{theme:t}=e;return Dr(Object(kr.jsx)("path",{fill:Tr(t),d:"M 0 69.092 L 0 55.03 A 124.24 124.24 0 0 0 4.706 57.02 Q 6.826 57.863 8.708 58.5 A 53.466 53.466 0 0 0 12.231 59.571 Q 17.236 60.889 21.387 60.889 A 20.909 20.909 0 0 0 24.265 60.704 Q 25.719 60.502 26.903 60.077 A 8.649 8.649 0 0 0 29.028 58.985 Q 31.689 57.08 31.689 53.321 Q 31.689 51.221 30.518 49.585 A 10.126 10.126 0 0 0 29.282 48.177 Q 28.352 47.287 27.075 46.436 A 23.719 23.719 0 0 0 25.752 45.627 Q 23.774 44.492 20.176 42.735 A 254.44 254.44 0 0 0 17.822 41.602 Q 11.503 38.631 8.236 35.888 A 19.742 19.742 0 0 1 8.008 35.694 A 22.18 22.18 0 0 1 2.783 29.102 Q 0.83 25.342 0.83 20.313 A 22.471 22.471 0 0 1 1.733 13.778 A 17.283 17.283 0 0 1 7.251 5.42 A 21.486 21.486 0 0 1 15.177 1.272 Q 18.361 0.338 22.166 0.09 A 43.573 43.573 0 0 1 25 0 A 42.399 42.399 0 0 1 34.349 1.01 A 39.075 39.075 0 0 1 35.62 1.319 A 67.407 67.407 0 0 1 42.108 3.382 A 83.357 83.357 0 0 1 46.191 5.03 L 41.309 16.797 Q 35.596 14.453 31.86 13.526 A 30.762 30.762 0 0 0 25.417 12.612 A 28.337 28.337 0 0 0 24.512 12.598 A 14.846 14.846 0 0 0 22.022 12.793 Q 19.498 13.224 17.92 14.6 Q 15.625 16.602 15.625 19.824 Q 15.625 21.826 16.553 23.316 Q 17.48 24.805 19.507 26.197 A 18.343 18.343 0 0 0 20.659 26.912 Q 22.596 28.035 26.516 29.953 A 299.99 299.99 0 0 0 29.102 31.201 Q 37.91 35.412 41.841 39.642 A 16.553 16.553 0 0 1 42.822 40.796 A 17.675 17.675 0 0 1 46.301 49.233 A 23.517 23.517 0 0 1 46.533 52.588 A 21.581 21.581 0 0 1 45.471 59.515 A 17.733 17.733 0 0 1 39.575 67.823 Q 33.745 72.486 24.094 73.243 A 49.683 49.683 0 0 1 20.215 73.389 A 51.712 51.712 0 0 1 9.448 72.315 A 40.672 40.672 0 0 1 0 69.092 Z"}),{width:47,height:77})})),Uo=a.a.memo((e=>{let{theme:t}=e;return Dr(Object(kr.jsx)("path",{fill:Tr(t),d:"M 44.092 71.387 L 30.225 71.387 L 13.037 15.381 L 12.598 15.381 A 1505.093 1505.093 0 0 1 12.959 22.313 Q 13.426 31.715 13.508 36.4 A 102.991 102.991 0 0 1 13.525 38.184 L 13.525 71.387 L 0 71.387 L 0 0 L 20.605 0 L 37.5 54.59 L 37.793 54.59 L 55.713 0 L 76.318 0 L 76.318 71.387 L 62.207 71.387 L 62.207 37.598 Q 62.207 35.205 62.28 32.08 A 160.703 160.703 0 0 1 62.326 30.544 Q 62.452 26.754 62.866 17.168 A 5390.536 5390.536 0 0 1 62.939 15.479 L 62.5 15.479 L 44.092 71.387 Z"}),{width:77,height:75})})),Vo=a.a.memo((e=>{let{theme:t}=e;return Dr(Object(kr.jsx)("path",{fill:Tr(t),d:"M 44.092 71.387 L 0 71.387 L 0 0 L 15.137 0 L 15.137 58.887 L 44.092 58.887 L 44.092 71.387 Z"}),{width:45,height:75})})),Go=a.a.memo((e=>{let{theme:t}=e;return Dr(Object(kr.jsx)("path",{fill:Tr(t),d:"M 42.578 35.4 L 66.699 71.387 L 49.414 71.387 L 32.813 44.385 L 16.211 71.387 L 0 71.387 L 23.682 34.57 L 1.514 0 L 18.213 0 L 33.594 25.684 L 48.682 0 L 64.99 0 L 42.578 35.4 Z M 119.775 71.387 L 75.684 71.387 L 75.684 0 L 90.82 0 L 90.82 58.887 L 119.775 58.887 L 119.775 71.387 Z"}),{width:120,height:75})})),Wo=a.a.memo((e=>{let{theme:t}=e;return Dr(Object(kr.jsx)("path",{fill:Tr(t),d:"M290.74 93.24l128.02 128.02-277.99 277.99-114.14 12.6C11.35 513.54-1.56 500.62.14 485.34l12.7-114.22 277.9-277.88zm207.2-19.06l-60.11-60.11c-18.75-18.75-49.16-18.75-67.91 0l-56.55 56.55 128.02 128.02 56.55-56.55c18.75-18.76 18.75-49.16 0-67.91z"}),{width:448,height:512})})),Ko=a.a.memo((e=>{let{theme:t}=e;return Dr(Object(kr.jsxs)(kr.Fragment,{children:[Object(kr.jsx)("path",{fill:Tr(t),d:"M 63.818 71.68 L 54.492 71.68 L 45.898 49.561 L 17.578 49.561 L 9.082 71.68 L 0 71.68 L 27.881 0 L 35.986 0 L 63.818 71.68 Z M 20.605 41.602 L 43.213 41.602 L 35.205 19.971 L 31.787 9.277 Q 30.322 15.137 28.711 19.971 L 20.605 41.602 Z"}),Object(kr.jsx)("path",{fill:Tr(t),d:"M 68.994 71.68 L 52.686 71.68 L 47.51 54.688 L 21.484 54.688 L 16.309 71.68 L 0 71.68 L 25.195 0 L 43.701 0 L 68.994 71.68 Z M 25.293 41.992 L 43.896 41.992 A 27590.463 27590.463 0 0 1 42.2 36.532 Q 36.965 19.676 35.937 16.273 A 120.932 120.932 0 0 1 35.815 15.869 A 131.65 131.65 0 0 1 35.396 14.435 Q 34.951 12.879 34.675 11.741 A 34.866 34.866 0 0 1 34.521 11.084 A 141.762 141.762 0 0 1 33.706 14.075 Q 31.482 21.957 25.293 41.992 Z"})]}),{width:70,height:78})})),Yo=a.a.memo((e=>{let{theme:t}=e;return Dr(Object(kr.jsx)(kr.Fragment,{children:Object(kr.jsx)("path",{fill:Tr(t),d:"M278.9 511.5l-61-17.7c-6.4-1.8-10-8.5-8.2-14.9L346.2 8.7c1.8-6.4 8.5-10 14.9-8.2l61 17.7c6.4 1.8 10 8.5 8.2 14.9L293.8 503.3c-1.9 6.4-8.5 10.1-14.9 8.2zm-114-112.2l43.5-46.4c4.6-4.9 4.3-12.7-.8-17.2L117 256l90.6-79.7c5.1-4.5 5.5-12.3.8-17.2l-43.5-46.4c-4.5-4.8-12.1-5.1-17-.5L3.8 247.2c-5.1 4.7-5.1 12.8 0 17.5l144.1 135.1c4.9 4.6 12.5 4.4 17-.5zm327.2.6l144.1-135.1c5.1-4.7 5.1-12.8 0-17.5L492.1 112.1c-4.8-4.5-12.4-4.3-17 .5L431.6 159c-4.6 4.9-4.3 12.7.8 17.2L523 256l-90.6 79.7c-5.1 4.5-5.5 12.3-.8 17.2l43.5 46.4c4.5 4.9 12.1 5.1 17 .6z"})}),{width:640,height:512})})),Zo=a.a.memo((e=>{let{theme:t}=e;return Dr(Object(kr.jsx)("path",{d:"M12.83 352h262.34A12.82 12.82 0 00288 339.17v-38.34A12.82 12.82 0 00275.17 288H12.83A12.82 12.82 0 000 300.83v38.34A12.82 12.82 0 0012.83 352zm0-256h262.34A12.82 12.82 0 00288 83.17V44.83A12.82 12.82 0 00275.17 32H12.83A12.82 12.82 0 000 44.83v38.34A12.82 12.82 0 0012.83 96zM432 160H16a16 16 0 00-16 16v32a16 16 0 0016 16h416a16 16 0 0016-16v-32a16 16 0 00-16-16zm0 256H16a16 16 0 00-16 16v32a16 16 0 0016 16h416a16 16 0 0016-16v-32a16 16 0 00-16-16z",fill:Tr(t),strokeLinecap:"round"}),{width:448,height:512})})),Xo=a.a.memo((e=>{let{theme:t}=e;return Dr(Object(kr.jsx)("path",{d:"M432 160H16a16 16 0 00-16 16v32a16 16 0 0016 16h416a16 16 0 0016-16v-32a16 16 0 00-16-16zm0 256H16a16 16 0 00-16 16v32a16 16 0 0016 16h416a16 16 0 0016-16v-32a16 16 0 00-16-16zM108.1 96h231.81A12.09 12.09 0 00352 83.9V44.09A12.09 12.09 0 00339.91 32H108.1A12.09 12.09 0 0096 44.09V83.9A12.1 12.1 0 00108.1 96zm231.81 256A12.09 12.09 0 00352 339.9v-39.81A12.09 12.09 0 00339.91 288H108.1A12.09 12.09 0 0096 300.09v39.81a12.1 12.1 0 0012.1 12.1z",fill:Tr(t)}),{width:448,height:512})})),qo=a.a.memo((e=>{let{theme:t}=e;return Dr(Object(kr.jsx)("path",{d:"M16 224h416a16 16 0 0016-16v-32a16 16 0 00-16-16H16a16 16 0 00-16 16v32a16 16 0 0016 16zm416 192H16a16 16 0 00-16 16v32a16 16 0 0016 16h416a16 16 0 0016-16v-32a16 16 0 00-16-16zm3.17-384H172.83A12.82 12.82 0 00160 44.83v38.34A12.82 12.82 0 00172.83 96h262.34A12.82 12.82 0 00448 83.17V44.83A12.82 12.82 0 00435.17 32zm0 256H172.83A12.82 12.82 0 00160 300.83v38.34A12.82 12.82 0 00172.83 352h262.34A12.82 12.82 0 00448 339.17v-38.34A12.82 12.82 0 00435.17 288z",fill:Tr(t),strokeLinecap:"round"}),{width:448,height:512})})),Jo=Dr(Object(kr.jsx)("path",{d:"M537.6 226.6c4.1-10.7 6.4-22.4 6.4-34.6 0-53-43-96-96-96-19.7 0-38.1 6-53.3 16.2C367 64.2 315.3 32 256 32c-88.4 0-160 71.6-160 160 0 2.7.1 5.4.2 8.1C40.2 219.8 0 273.2 0 336c0 79.5 64.5 144 144 144h368c70.7 0 128-57.3 128-128 0-61.9-44-113.6-102.4-125.4zM393.4 288H328v112c0 8.8-7.2 16-16 16h-48c-8.8 0-16-7.2-16-16V288h-65.4c-14.3 0-21.4-17.2-11.3-27.3l105.4-105.4c6.2-6.2 16.4-6.2 22.6 0l105.4 105.4c10.1 10.1 2.9 27.3-11.3 27.3z",fill:"currentColor"}),{width:640,height:512});let Qo=[];const $o=e=>(Qo=Qo.concat(e),e),ea=(e,t)=>{if(e.editingGroupId){const n=Bn(ir(t),e.editingGroupId);if(n.length)return{...e,selectedElementIds:{[n[0].id]:!0}}}return e},ta=$o({name:"deleteSelectedElements",perform:(e,t)=>{if(t.editingLinearElement){const{elementId:n,activePointIndex:i,startBindingElement:s,endBindingElement:r}=t.editingLinearElement,o=ps.getElement(n);if(!o)return!1;if(null==i||-1===i||o.points.length<2){const n=e.filter((e=>e.id!==o.id));return{elements:n,appState:{...ea(t,n),editingLinearElement:null},commitToHistory:!1}}const a={startBindingElement:0===i?null:s,endBindingElement:i===o.points.length-1?null:r};return ps.movePoint(o,i,"delete"),{elements:e,appState:{...t,editingLinearElement:{...t.editingLinearElement,...a,activePointIndex:i>0?i-1:0}},commitToHistory:!0}}let{elements:n,appState:i}=((e,t)=>({elements:e.map((e=>t.selectedElementIds[e.id]?kn(e,{isDeleted:!0}):e)),appState:{...t,selectedElementIds:{}}}))(e,t);return _s(n,e.filter((e=>{let{id:n}=e;return t.selectedElementIds[n]}))),i=ea(i,n),{elements:n,appState:{...i,elementType:"selection",multiElement:null},commitToHistory:dr(ir(e),t)}},contextItemLabel:"labels.delete",keyTest:e=>e.key===J||e.key===ee,PanelComponent:e=>{let{elements:t,appState:n,updateData:i}=e;return Object(kr.jsx)(Mr,{type:"button",icon:_r,title:w("labels.delete"),"aria-label":w("labels.delete"),onClick:()=>i(null),visible:dr(ir(t),n)})}}),na=(e,t)=>{let n=[],i=[],s=null,r=-1;for(;++r<e.length;)t.selectedElementIds[e[r].id]?(i.length&&(n=n.concat(i),i=[]),n.push(r),s=r+1):e[r].isDeleted&&s===r?(s=r+1,i.push(r)):i=[];return n},ia=(e,t,n,i)=>{const s=t[n],r=t=>!t.isDeleted&&(!e.editingGroupId||t.groupIds.includes(e.editingGroupId)),o="left"===i?function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.length-1;n<0&&(n=e.length+n),n=Math.min(e.length-1,Math.max(n,0));let i=n+1;for(;--i>-1;)if(t(e[i],i,e))return i;return-1}(t,r,Math.max(0,n-1)):function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;n<0&&(n=e.length+n),n=Math.min(e.length,Math.max(n,0));let i=n-1;for(;++i<e.length;)if(t(e[i],i,e))return i;return-1}(t,r,n+1),a=t[o];if(!a)return-1;if(e.editingGroupId){if((null===s||void 0===s?void 0:s.groupIds.join(""))===(null===a||void 0===a?void 0:a.groupIds.join("")))return o;if(!(null===a||void 0===a?void 0:a.groupIds.includes(e.editingGroupId)))return-1}if(!a.groupIds.length)return o;const l=e.editingGroupId?a.groupIds[a.groupIds.indexOf(e.editingGroupId)-1]:a.groupIds[a.groupIds.length-1],c=Bn(t,l);return c.length?"left"===i?t.indexOf(c[0]):t.indexOf(c[c.length-1]):o},sa=(e,t)=>t.reduce(((t,n)=>{const i=e[n];return t[i.id]=i,t}),{}),ra=(e,t,n)=>{const i=na(t,e),s=sa(t,i);let r=(e=>{let t=0;return e.reduce(((n,i,s)=>(s>0&&e[s-1]!==i-1&&(t=++t),(n[t]||(n[t]=[])).push(i),n)),[])})(i);return"right"===n&&(r=r.reverse()),r.forEach(((i,s)=>{const r=i[0],o=i[i.length-1],a="left"===n?r:o,l=ia(e,t,a,n);if(-1===l||a===l)return;const c="left"===n?t.slice(0,l):t.slice(0,r),d=t.slice(r,o+1),h="left"===n?t.slice(l,r):t.slice(o+1,l+1),u="left"===n?t.slice(o+1):t.slice(l+1);t="left"===n?[...c,...d,...h,...u]:[...c,...h,...d,...u]})),t.map((e=>s[e.id]?In(e):e))},oa=(e,t,n)=>{const i=na(e,t),s=sa(e,i),r=[];let o,a;if("left"===n){if(t.editingGroupId){const n=Bn(e,t.editingGroupId);if(!n.length)return e;o=e.indexOf(n[0])}else o=0;a=i[i.length-1]}else{if(t.editingGroupId){const n=Bn(e,t.editingGroupId);if(!n.length)return e;a=e.indexOf(n[n.length-1])}else a=e.length-1;o=i[0]}for(let h=o;h<a+1;h++)i.includes(h)||r.push(e[h]);const l=Object.values(s).map((e=>In(e))),c=e.slice(0,o),d=e.slice(a+1);return"left"===n?[...c,...l,...r,...d]:[...c,...r,...l,...d]},aa=(e,t)=>ra(t,e,"left"),la=(e,t)=>ra(t,e,"right"),ca=(e,t)=>oa(e,t,"left"),da=(e,t)=>oa(e,t,"right"),ha=$o({name:"sendBackward",perform:(e,t)=>({elements:aa(e,t),appState:t,commitToHistory:!0}),contextItemLabel:"labels.sendBackward",keyPriority:40,keyTest:e=>e[$]&&!e.shiftKey&&e.code===L,PanelComponent:e=>{let{updateData:t,appState:n}=e;return Object(kr.jsx)("button",{type:"button",className:"zIndexButton",onClick:()=>t(null),title:"".concat(w("labels.sendBackward")," \u2014 ").concat(Be("CtrlOrCmd+[")),children:Object(kr.jsx)(no,{theme:n.theme})})}}),ua=$o({name:"bringForward",perform:(e,t)=>({elements:la(e,t),appState:t,commitToHistory:!0}),contextItemLabel:"labels.bringForward",keyPriority:40,keyTest:e=>e[$]&&!e.shiftKey&&e.code===T,PanelComponent:e=>{let{updateData:t,appState:n}=e;return Object(kr.jsx)("button",{type:"button",className:"zIndexButton",onClick:()=>t(null),title:"".concat(w("labels.bringForward")," \u2014 ").concat(Be("CtrlOrCmd+]")),children:Object(kr.jsx)(to,{theme:n.theme})})}}),ma=$o({name:"sendToBack",perform:(e,t)=>({elements:ca(e,t),appState:t,commitToHistory:!0}),contextItemLabel:"labels.sendToBack",keyTest:e=>E?e[$]&&e.altKey&&e.code===L:e[$]&&e.shiftKey&&e.code===L,PanelComponent:e=>{let{updateData:t,appState:n}=e;return Object(kr.jsx)("button",{type:"button",className:"zIndexButton",onClick:()=>t(null),title:"".concat(w("labels.sendToBack")," \u2014 ").concat(Be(E?"CtrlOrCmd+Alt+[":"CtrlOrCmd+Shift+[")),children:Object(kr.jsx)(so,{theme:n.theme})})}}),pa=$o({name:"bringToFront",perform:(e,t)=>({elements:da(e,t),appState:t,commitToHistory:!0}),contextItemLabel:"labels.bringToFront",keyTest:e=>E?e[$]&&e.altKey&&e.code===T:e[$]&&e.shiftKey&&e.code===T,PanelComponent:e=>{let{updateData:t,appState:n}=e;return Object(kr.jsx)("button",{type:"button",className:"zIndexButton",onClick:e=>t(null),title:"".concat(w("labels.bringToFront")," \u2014 ").concat(Be(E?"CtrlOrCmd+Alt+]":"CtrlOrCmd+Shift+]")),children:Object(kr.jsx)(io,{theme:n.theme})})}}),ga=$o({name:"selectAll",perform:(e,t)=>!t.editingLinearElement&&{appState:Nn({...t,editingGroupId:null,selectedElementIds:e.reduce(((e,t)=>(t.isDeleted||(e[t.id]=!0),e)),{})},ir(e)),commitToHistory:!0},contextItemLabel:"labels.selectAll",keyTest:e=>e[$]&&e.key===oe}),ba=$o({name:"duplicateSelection",perform:(e,t)=>{if(t.editingLinearElement){const{activePointIndex:n,elementId:i}=t.editingLinearElement,s=ps.getElement(i);if(!s||null===n)return!1;const{points:r}=s,o=r[n],a=r[n+1];return Cn(s,{points:[...r.slice(0,n+1),a?[(o[0]+a[0])/2,(o[1]+a[1])/2]:[o[0]+30,o[1]+30],...r.slice(n+1)]}),{appState:{...t,editingLinearElement:{...t.editingLinearElement,activePointIndex:n+1}},elements:e,commitToHistory:!0}}return{...fa(e,t),commitToHistory:!0}},contextItemLabel:"labels.duplicateSelection",keyTest:e=>e[$]&&e.key===ae,PanelComponent:e=>{let{elements:t,appState:n,updateData:i}=e;return Object(kr.jsx)(Mr,{type:"button",icon:yo,title:"".concat(w("labels.duplicateSelection")," \u2014 ").concat(Be("CtrlOrCmd+D")),"aria-label":w("labels.duplicateSelection"),onClick:()=>i(null),visible:dr(ir(t),n)})}}),fa=(e,t)=>{const n=new Map,i=[],s=[],r=new Map,o=e=>{const o=Zn(t.editingGroupId,n,e,{x:e.x+d.x/2,y:e.y+d.x/2});return r.set(e.id,o.id),s.push(e),i.push(o),o},a=[];let l=0;for(;l<e.length;){const n=e[l];if(t.selectedElementIds[n.id]){if(n.groupIds.length){const i=Pn(t,n);if(i){const t=Bn(e,i);a.push(...t,...t.map((e=>o(e)))),l+=t.length;continue}}a.push(n,o(n))}else a.push(n);l++}return Bs(a,s,r),{elements:a,appState:Nn({...t,selectedGroupIds:{},selectedElementIds:i.reduce(((e,t)=>(e[t.id]=!0,e)),{})},ir(a))}},va=e=>{let{options:t,value:n,onChange:i,group:s}=e;return Object(kr.jsx)("div",{className:"buttonList buttonListIcon",children:t.map((e=>Object(kr.jsxs)("label",{className:Object(lt.a)({active:n===e.value}),title:e.text,children:[Object(kr.jsx)("input",{type:"radio",name:s,onChange:()=>i(e.value),checked:n===e.value}),e.icon]},e.text)))})};n(61);const ya=e=>{let{children:t,left:n,top:s,onCloseRequest:r,fitInViewport:a=!1}=e;const l=Object(o.useRef)(null);return Object(o.useLayoutEffect)((()=>{if(a&&l.current){const e=l.current,{x:t,y:n,width:i,height:s}=e.getBoundingClientRect(),r=window.innerWidth;t+i>r&&(e.style.left="".concat(r-i,"px"));const o=window.innerHeight;n+s>o&&(e.style.top="".concat(o-s,"px"))}}),[a]),Object(o.useEffect)((()=>{if(r){const e=e=>{var t;(null===(t=l.current)||void 0===t?void 0:t.contains(e.target))||Object(i.unstable_batchedUpdates)((()=>r(e)))};return document.addEventListener("pointerdown",e,!1),()=>document.removeEventListener("pointerdown",e,!1)}}),[r]),Object(kr.jsx)("div",{className:"popover",style:{top:s,left:n},ref:l,children:t})};n(62);const xa=e=>{const t=(new Option).style;return t.color=e,!!t.color},wa=[["1","2","3","4","5"],["q","w","e","r","t"],["a","s","d","f","g"]].flat(),ja=e=>{let{colors:t,color:n,onChange:i,onClose:s,label:r,showInput:o=!0,type:l}=e;const c=a.a.useRef(),d=a.a.useRef(),h=a.a.useRef(),u=a.a.useRef();a.a.useEffect((()=>{d.current?d.current.focus():u.current?u.current.focus():h.current&&h.current.focus()}),[]);return Object(kr.jsxs)("div",{className:"color-picker color-picker-type-".concat(l),role:"dialog","aria-modal":"true","aria-label":w("labels.colorPicker"),onKeyDown:e=>{if(e.key===re){const{activeElement:i}=document;var t;if(e.shiftKey){if(i===c.current)null===(t=u.current)||void 0===t||t.focus(),e.preventDefault()}else if(i===u.current){var n;null===(n=c.current)||void 0===n||n.focus(),e.preventDefault()}}else if(we(e.key)){const{activeElement:t}=document,n=y().rtl,i=Array.prototype.indexOf.call(h.current.children,t);if(-1!==i){const t=h.current.children.length-(o?1:0),s=e.key===(n?Z:X)?(i+1)%t:e.key===(n?X:Z)?(t+i-1)%t:e.key===Y?(i+5)%t:e.key===q?(t+i-5)%t:i;h.current.children[s].focus()}e.preventDefault()}else if(wa.includes(e.key.toLowerCase())&&!Ie(e.target)){const t=wa.indexOf(e.key.toLowerCase());h.current.children[t].focus(),e.preventDefault()}else e.key!==ne&&e.key!==te||(e.preventDefault(),s());e.nativeEvent.stopImmediatePropagation(),e.stopPropagation()},children:[Object(kr.jsx)("div",{className:"color-picker-triangle color-picker-triangle-shadow"}),Object(kr.jsx)("div",{className:"color-picker-triangle"}),Object(kr.jsxs)("div",{className:"color-picker-content",ref:e=>{e&&(h.current=e)},tabIndex:0,children:[t.map(((e,t)=>{const s=e.replace("#","");return Object(kr.jsxs)("button",{className:"color-picker-swatch",onClick:t=>{t.currentTarget.focus(),i(e)},title:"".concat(w("colors.".concat(s))).concat(Ke(e)?"":" (".concat(e,")")," \u2014 ").concat(wa[t].toUpperCase()),"aria-label":w("colors.".concat(s)),"aria-keyshortcuts":wa[t],style:{color:e},ref:i=>{i&&0===t&&(c.current=i),i&&e===n&&(d.current=i)},onFocus:()=>{i(e)},children:[Ke(e)?Object(kr.jsx)("div",{className:"color-picker-transparent"}):void 0,Object(kr.jsx)("span",{className:"color-picker-keybinding",children:wa[t]})]},e)})),o&&Object(kr.jsx)(Sa,{color:n,label:r,onChange:e=>{i(e)},ref:u})]})]})},Sa=a.a.forwardRef(((e,t)=>{let{color:n,onChange:i,label:s}=e;const[r,o]=a.a.useState(n),l=a.a.useRef(null);a.a.useEffect((()=>{o(n)}),[n]),a.a.useImperativeHandle(t,(()=>l.current));const c=a.a.useCallback((e=>{const t=e.toLowerCase(),n=(e=>Ke(e)||xa(e)?e:xa("#".concat(e))?"#".concat(e):null)(t);n&&i(n),o(t)}),[i]);return Object(kr.jsxs)("label",{className:"color-input-container",children:[Object(kr.jsx)("div",{className:"color-picker-hash",children:"#"}),Object(kr.jsx)("input",{spellCheck:!1,className:"color-picker-input","aria-label":s,onChange:e=>c(e.target.value),value:(r||"").replace(/^#/,""),onBlur:()=>o(n),ref:l})]})})),Ea=e=>{let{type:t,color:n,onChange:i,label:s,isActive:r,setActive:o}=e;const l=a.a.useRef(null);return Object(kr.jsxs)("div",{children:[Object(kr.jsxs)("div",{className:"color-picker-control-container",children:[Object(kr.jsx)("button",{className:"color-picker-label-swatch","aria-label":s,style:n?{"--swatch-color":n}:void 0,onClick:()=>o(!r),ref:l}),Object(kr.jsx)(Sa,{color:n,label:s,onChange:e=>{i(e)}})]}),Object(kr.jsx)(a.a.Suspense,{fallback:"",children:r?Object(kr.jsx)(ya,{onCloseRequest:e=>e.target!==l.current&&o(!1),children:Object(kr.jsx)(ja,{colors:S[t],color:n||null,onChange:e=>{i(e)},onClose:()=>{var e;o(!1),null===(e=l.current)||void 0===e||e.focus()},label:s,showInput:!1,type:t})}):null})]})};n(63);function Oa(e){let{options:t,value:n,label:i,onChange:s,onClose:r}=e;const o=a.a.useRef(),l=a.a.useRef(),c=a.a.useRef(null);a.a.useEffect((()=>{l.current?l.current.focus():c.current&&c.current.focus()}),[]);return Object(kr.jsx)("div",{className:"picker",role:"dialog","aria-modal":"true","aria-label":i,onKeyDown:e=>{const n=t.find((t=>t.keyBinding===e.key.toLowerCase()));if(e.metaKey||e.altKey||e.ctrlKey||!n)if(e.key===re)setTimeout((()=>{l.current!==document.activeElement&&r()}),0);else if(we(e.key)){const{activeElement:n}=document,i=y().rtl,s=Array.prototype.indexOf.call(c.current.children,n);if(-1!==s){const n=t.length;let r=s;switch(e.key){case i?Z:X:case Y:r=(s+1)%n;break;case i?X:Z:case q:r=(n+s-1)%n}c.current.children[r].focus()}e.preventDefault()}else e.key!==ne&&e.key!==te||(e.preventDefault(),r());else{const i=t.indexOf(n);c.current.children[i].focus(),e.preventDefault()}e.nativeEvent.stopImmediatePropagation(),e.stopPropagation()},children:Object(kr.jsx)("div",{className:"picker-content",ref:c,children:t.map(((e,t)=>Object(kr.jsxs)("button",{className:"picker-option",onClick:t=>{t.currentTarget.focus(),s(e.value)},title:"".concat(e.text," \u2014 ").concat(e.keyBinding.toUpperCase()),"aria-label":e.text||"none","aria-keyshortcuts":e.keyBinding,ref:i=>{i&&0===t&&(o.current=i),i&&e.value===n&&(l.current=i)},onFocus:()=>{s(e.value)},children:[e.icon,Object(kr.jsx)("span",{className:"picker-keybinding",children:e.keyBinding})]},e.text)))})})}function Ca(e){var t;let{value:n,label:i,options:s,onChange:r,group:o=""}=e;const[l,c]=a.a.useState(!1),d=a.a.useRef(null),h=y().rtl;return Object(kr.jsxs)("label",{className:"picker-container",children:[Object(kr.jsx)("button",{name:o,className:l?"active":"","aria-label":i,onClick:()=>c(!l),ref:d,children:null===(t=s.find((e=>e.value===n)))||void 0===t?void 0:t.icon}),Object(kr.jsx)(a.a.Suspense,{fallback:"",children:l?Object(kr.jsxs)(kr.Fragment,{children:[Object(kr.jsx)(ya,{onCloseRequest:e=>e.target!==d.current&&c(!1),...h?{right:5.5}:{left:-5.5},children:Object(kr.jsx)(Oa,{options:s,value:n,label:i,onChange:r,onClose:()=>{var e;c(!1),null===(e=d.current)||void 0===e||e.focus()}})}),Object(kr.jsx)("div",{className:"picker-triangle"})]}):null})]})}const ka=(e,t,n)=>e.map((e=>{var i;return t.selectedElementIds[e.id]||e.id===(null===(i=t.editingElement)||void 0===i?void 0:i.id)?n(e):e})),Ia=function(e,t,n,i){var s,r;const o=t.editingElement,a=ir(e);return null!==(s=null!==(r=o&&n(o))&&void 0!==r?r:dr(a,t)?((e,t,n)=>{const i=Array.from(new Set(hr(e,t).map((e=>n(e)))));return 1===i.length?i[0]:null})(a,t,n):i)&&void 0!==s?s:null},Ma=($o({name:"changeStrokeColor",perform:(e,t,n)=>({...n.currentItemStrokeColor&&{elements:ka(e,t,(e=>br(e.type)?kn(e,{strokeColor:n.currentItemStrokeColor}):e))},appState:{...t,...n},commitToHistory:!!n.currentItemStrokeColor}),PanelComponent:e=>{let{elements:t,appState:n,updateData:i}=e;return Object(kr.jsxs)(kr.Fragment,{children:[Object(kr.jsx)("h3",{"aria-hidden":"true",children:w("labels.stroke")}),Object(kr.jsx)(Ea,{type:"elementStroke",label:w("labels.stroke"),color:Ia(t,n,(e=>e.strokeColor),n.currentItemStrokeColor),onChange:e=>i({currentItemStrokeColor:e}),isActive:"strokeColorPicker"===n.openPopup,setActive:e=>i({openPopup:e?"strokeColorPicker":null})})]})}}),$o({name:"changeBackgroundColor",perform:(e,t,n)=>({...n.currentItemBackgroundColor&&{elements:ka(e,t,(e=>kn(e,{backgroundColor:n.currentItemBackgroundColor})))},appState:{...t,...n},commitToHistory:!!n.currentItemBackgroundColor}),PanelComponent:e=>{let{elements:t,appState:n,updateData:i}=e;return Object(kr.jsxs)(kr.Fragment,{children:[Object(kr.jsx)("h3",{"aria-hidden":"true",children:w("labels.background")}),Object(kr.jsx)(Ea,{type:"elementBackground",label:w("labels.background"),color:Ia(t,n,(e=>e.backgroundColor),n.currentItemBackgroundColor),onChange:e=>i({currentItemBackgroundColor:e}),isActive:"backgroundColorPicker"===n.openPopup,setActive:e=>i({openPopup:e?"backgroundColorPicker":null})})]})}}),$o({name:"changeFillStyle",perform:(e,t,n)=>({elements:ka(e,t,(e=>kn(e,{fillStyle:n}))),appState:{...t,currentItemFillStyle:n},commitToHistory:!0}),PanelComponent:e=>{let{elements:t,appState:n,updateData:i}=e;return Object(kr.jsxs)("fieldset",{children:[Object(kr.jsx)("legend",{children:w("labels.fill")}),Object(kr.jsx)(va,{options:[{value:"hachure",text:w("labels.hachure"),icon:Object(kr.jsx)(Eo,{theme:n.theme})},{value:"cross-hatch",text:w("labels.crossHatch"),icon:Object(kr.jsx)(Oo,{theme:n.theme})},{value:"solid",text:w("labels.solid"),icon:Object(kr.jsx)(Co,{theme:n.theme})}],group:"fill",value:Ia(t,n,(e=>e.fillStyle),n.currentItemFillStyle),onChange:e=>{i(e)}})]})}}),$o({name:"changeStrokeWidth",perform:(e,t,n)=>({elements:ka(e,t,(e=>kn(e,{strokeWidth:n}))),appState:{...t,currentItemStrokeWidth:n},commitToHistory:!0}),PanelComponent:e=>{let{elements:t,appState:n,updateData:i}=e;return Object(kr.jsxs)("fieldset",{children:[Object(kr.jsx)("legend",{children:w("labels.strokeWidth")}),Object(kr.jsx)(va,{group:"stroke-width",options:[{value:1,text:w("labels.thin"),icon:Object(kr.jsx)(ko,{theme:n.theme,strokeWidth:2})},{value:2,text:w("labels.bold"),icon:Object(kr.jsx)(ko,{theme:n.theme,strokeWidth:6})},{value:4,text:w("labels.extraBold"),icon:Object(kr.jsx)(ko,{theme:n.theme,strokeWidth:10})}],value:Ia(t,n,(e=>e.strokeWidth),n.currentItemStrokeWidth),onChange:e=>i(e)})]})}}),$o({name:"changeSloppiness",perform:(e,t,n)=>({elements:ka(e,t,(e=>kn(e,{seed:En(),roughness:n}))),appState:{...t,currentItemRoughness:n},commitToHistory:!0}),PanelComponent:e=>{let{elements:t,appState:n,updateData:i}=e;return Object(kr.jsxs)("fieldset",{children:[Object(kr.jsx)("legend",{children:w("labels.sloppiness")}),Object(kr.jsx)(va,{group:"sloppiness",options:[{value:0,text:w("labels.architect"),icon:Object(kr.jsx)(To,{theme:n.theme})},{value:1,text:w("labels.artist"),icon:Object(kr.jsx)(Lo,{theme:n.theme})},{value:2,text:w("labels.cartoonist"),icon:Object(kr.jsx)(Do,{theme:n.theme})}],value:Ia(t,n,(e=>e.roughness),n.currentItemRoughness),onChange:e=>i(e)})]})}}),$o({name:"changeStrokeStyle",perform:(e,t,n)=>({elements:ka(e,t,(e=>kn(e,{strokeStyle:n}))),appState:{...t,currentItemStrokeStyle:n},commitToHistory:!0}),PanelComponent:e=>{let{elements:t,appState:n,updateData:i}=e;return Object(kr.jsxs)("fieldset",{children:[Object(kr.jsx)("legend",{children:w("labels.strokeStyle")}),Object(kr.jsx)(va,{group:"strokeStyle",options:[{value:"solid",text:w("labels.strokeStyle_solid"),icon:Object(kr.jsx)(Io,{theme:n.theme})},{value:"dashed",text:w("labels.strokeStyle_dashed"),icon:Object(kr.jsx)(Mo,{theme:n.theme})},{value:"dotted",text:w("labels.strokeStyle_dotted"),icon:Object(kr.jsx)(Ao,{theme:n.theme})}],value:Ia(t,n,(e=>e.strokeStyle),n.currentItemStrokeStyle),onChange:e=>i(e)})]})}}),$o({name:"changeOpacity",perform:(e,t,n)=>({elements:ka(e,t,(e=>kn(e,{opacity:n}))),appState:{...t,currentItemOpacity:n},commitToHistory:!0}),PanelComponent:e=>{var t;let{elements:n,appState:i,updateData:s}=e;return Object(kr.jsxs)("label",{className:"control-label",children:[w("labels.opacity"),Object(kr.jsx)("input",{type:"range",min:"0",max:"100",step:"10",onChange:e=>s(+e.target.value),onWheel:e=>{e.stopPropagation();const t=+e.target.value;e.deltaY<0&&t<100?s(t+10):e.deltaY>0&&t>0&&s(t-10)},value:null!==(t=Ia(n,i,(e=>e.opacity),i.currentItemOpacity))&&void 0!==t?t:void 0})]})}}),$o({name:"changeFontSize",perform:(e,t,n)=>({elements:ka(e,t,(e=>{if(pt(e)){const t=kn(e,{fontSize:n});return er(t),t}return e})),appState:{...t,currentItemFontSize:n},commitToHistory:!0}),PanelComponent:e=>{let{elements:t,appState:n,updateData:i}=e;return Object(kr.jsxs)("fieldset",{children:[Object(kr.jsx)("legend",{children:w("labels.fontSize")}),Object(kr.jsx)(va,{group:"font-size",options:[{value:16,text:w("labels.small"),icon:Object(kr.jsx)(Fo,{theme:n.theme})},{value:20,text:w("labels.medium"),icon:Object(kr.jsx)(Uo,{theme:n.theme})},{value:28,text:w("labels.large"),icon:Object(kr.jsx)(Vo,{theme:n.theme})},{value:36,text:w("labels.veryLarge"),icon:Object(kr.jsx)(Go,{theme:n.theme})}],value:Ia(t,n,(e=>pt(e)&&e.fontSize),n.currentItemFontSize||d.h),onChange:e=>i(e)})]})}}),$o({name:"changeFontFamily",perform:(e,t,n)=>({elements:ka(e,t,(e=>{if(pt(e)){const t=kn(e,{fontFamily:n});return er(t),t}return e})),appState:{...t,currentItemFontFamily:n},commitToHistory:!0}),PanelComponent:e=>{let{elements:t,appState:n,updateData:i}=e;const s=[{value:d.w.Virgil,text:w("labels.handDrawn"),icon:Object(kr.jsx)(Wo,{theme:n.theme})},{value:d.w.Helvetica,text:w("labels.normal"),icon:Object(kr.jsx)(Ko,{theme:n.theme})},{value:d.w.Cascadia,text:w("labels.code"),icon:Object(kr.jsx)(Yo,{theme:n.theme})}];return Object(kr.jsxs)("fieldset",{children:[Object(kr.jsx)("legend",{children:w("labels.fontFamily")}),Object(kr.jsx)(va,{group:"font-family",options:s,value:Ia(t,n,(e=>pt(e)&&e.fontFamily),n.currentItemFontFamily||d.g),onChange:e=>i(e)})]})}}),$o({name:"changeTextAlign",perform:(e,t,n)=>({elements:ka(e,t,(e=>{if(pt(e)){const t=kn(e,{textAlign:n});return er(t),t}return e})),appState:{...t,currentItemTextAlign:n},commitToHistory:!0}),PanelComponent:e=>{let{elements:t,appState:n,updateData:i}=e;return Object(kr.jsxs)("fieldset",{children:[Object(kr.jsx)("legend",{children:w("labels.textAlign")}),Object(kr.jsx)(va,{group:"text-align",options:[{value:"left",text:w("labels.left"),icon:Object(kr.jsx)(Zo,{theme:n.theme})},{value:"center",text:w("labels.center"),icon:Object(kr.jsx)(Xo,{theme:n.theme})},{value:"right",text:w("labels.right"),icon:Object(kr.jsx)(qo,{theme:n.theme})}],value:Ia(t,n,(e=>pt(e)&&e.textAlign),n.currentItemTextAlign),onChange:e=>i(e)})]})}}),$o({name:"changeSharpness",perform:(e,t,n)=>{const i=ur(ir(e),t),s=i.length?i.every((e=>!ft(e))):!vt(t.elementType),r=i.length?i.every(ft):vt(t.elementType);return{elements:ka(e,t,(e=>kn(e,{strokeSharpness:n}))),appState:{...t,currentItemStrokeSharpness:s?n:t.currentItemStrokeSharpness,currentItemLinearStrokeSharpness:r?n:t.currentItemLinearStrokeSharpness},commitToHistory:!0}},PanelComponent:e=>{let{elements:t,appState:n,updateData:i}=e;return Object(kr.jsxs)("fieldset",{children:[Object(kr.jsx)("legend",{children:w("labels.edges")}),Object(kr.jsx)(va,{group:"edges",options:[{value:"sharp",text:w("labels.sharp"),icon:Object(kr.jsx)(Po,{theme:n.theme})},{value:"round",text:w("labels.round"),icon:Object(kr.jsx)(zo,{theme:n.theme})}],value:Ia(t,n,(e=>e.strokeSharpness),yr(n.elementType)&&(vt(n.elementType)?n.currentItemLinearStrokeSharpness:n.currentItemStrokeSharpness)||null),onChange:e=>i(e)})]})}}),$o({name:"changeArrowhead",perform:(e,t,n)=>({elements:ka(e,t,(e=>{if(ft(e)){const{position:t,type:i}=n;if("start"===t){return kn(e,{startArrowhead:i})}if("end"===t){return kn(e,{endArrowhead:i})}}return e})),appState:{...t,["start"===n.position?"currentItemStartArrowhead":"currentItemEndArrowhead"]:n.type},commitToHistory:!0}),PanelComponent:e=>{let{elements:t,appState:n,updateData:i}=e;const s=y().rtl;return Object(kr.jsxs)("fieldset",{children:[Object(kr.jsx)("legend",{children:w("labels.arrowheads")}),Object(kr.jsxs)("div",{className:"iconSelectList",children:[Object(kr.jsx)(Ca,{label:"arrowhead_start",options:[{value:null,text:w("labels.arrowhead_none"),icon:Object(kr.jsx)(No,{theme:n.theme}),keyBinding:"q"},{value:"arrow",text:w("labels.arrowhead_arrow"),icon:Object(kr.jsx)(Ro,{theme:n.theme,flip:!s}),keyBinding:"w"},{value:"bar",text:w("labels.arrowhead_bar"),icon:Object(kr.jsx)(Ho,{theme:n.theme,flip:!s}),keyBinding:"e"},{value:"dot",text:w("labels.arrowhead_dot"),icon:Object(kr.jsx)(Bo,{theme:n.theme,flip:!s}),keyBinding:"r"},{value:"triangle",text:w("labels.arrowhead_triangle"),icon:Object(kr.jsx)(_o,{theme:n.theme,flip:!s}),keyBinding:"t"}],value:Ia(t,n,(e=>ft(e)&&wr(e.type)?e.startArrowhead:n.currentItemStartArrowhead),n.currentItemStartArrowhead),onChange:e=>i({position:"start",type:e})}),Object(kr.jsx)(Ca,{label:"arrowhead_end",group:"arrowheads",options:[{value:null,text:w("labels.arrowhead_none"),keyBinding:"q",icon:Object(kr.jsx)(No,{theme:n.theme})},{value:"arrow",text:w("labels.arrowhead_arrow"),keyBinding:"w",icon:Object(kr.jsx)(Ro,{theme:n.theme,flip:s})},{value:"bar",text:w("labels.arrowhead_bar"),keyBinding:"e",icon:Object(kr.jsx)(Ho,{theme:n.theme,flip:s})},{value:"dot",text:w("labels.arrowhead_dot"),keyBinding:"r",icon:Object(kr.jsx)(Bo,{theme:n.theme,flip:s})},{value:"triangle",text:w("labels.arrowhead_triangle"),icon:Object(kr.jsx)(_o,{theme:n.theme,flip:s}),keyBinding:"t"}],value:Ia(t,n,(e=>ft(e)&&wr(e.type)?e.endArrowhead:n.currentItemEndArrowhead),n.currentItemEndArrowhead),onChange:e=>i({position:"end",type:e})})]})]})}}),e=>{const t=e.title||("dark"===e.value?w("buttons.lightMode"):w("buttons.darkMode"));return Object(kr.jsx)(Mr,{type:"icon",icon:e.value===d.P.LIGHT?Aa.MOON:Aa.SUN,title:t,"aria-label":t,onClick:()=>e.onChange(e.value===d.P.DARK?d.P.LIGHT:d.P.DARK),"data-testid":"toggle-dark-mode"})}),Aa={SUN:Object(kr.jsx)("svg",{width:"512",height:"512",className:"rtl-mirror",viewBox:"0 0 512 512",children:Object(kr.jsx)("path",{fill:"currentColor",d:"M256 160c-52.9 0-96 43.1-96 96s43.1 96 96 96 96-43.1 96-96-43.1-96-96-96zm246.4 80.5l-94.7-47.3 33.5-100.4c4.5-13.6-8.4-26.5-21.9-21.9l-100.4 33.5-47.4-94.8c-6.4-12.8-24.6-12.8-31 0l-47.3 94.7L92.7 70.8c-13.6-4.5-26.5 8.4-21.9 21.9l33.5 100.4-94.7 47.4c-12.8 6.4-12.8 24.6 0 31l94.7 47.3-33.5 100.5c-4.5 13.6 8.4 26.5 21.9 21.9l100.4-33.5 47.3 94.7c6.4 12.8 24.6 12.8 31 0l47.3-94.7 100.4 33.5c13.6 4.5 26.5-8.4 21.9-21.9l-33.5-100.4 94.7-47.3c13-6.5 13-24.7.2-31.1zm-155.9 106c-49.9 49.9-131.1 49.9-181 0-49.9-49.9-49.9-131.1 0-181 49.9-49.9 131.1-49.9 181 0 49.9 49.9 49.9 131.1 0 181z"})}),MOON:Object(kr.jsx)("svg",{width:"512",height:"512",className:"rtl-mirror",viewBox:"0 0 512 512",children:Object(kr.jsx)("path",{fill:"currentColor",d:"M283.211 512c78.962 0 151.079-35.925 198.857-94.792 7.068-8.708-.639-21.43-11.562-19.35-124.203 23.654-238.262-71.576-238.262-196.954 0-72.222 38.662-138.635 101.498-174.394 9.686-5.512 7.25-20.197-3.756-22.23A258.156 258.156 0 0 0 283.211 0c-141.309 0-256 114.511-256 256 0 141.309 114.511 256 256 256z"})})};n(64);const Ta=()=>{const e=document.querySelector(".excalidraw-tooltip");if(e)return e;const t=document.createElement("div");return document.body.appendChild(t),t.classList.add("excalidraw-tooltip"),t},La=e=>{let{children:t,label:n,long:i=!1,style:s}=e;return Object(o.useEffect)((()=>()=>Ta().classList.remove("excalidraw-tooltip--visible")),[]),Object(kr.jsx)("div",{className:"excalidraw-tooltip-wrapper",onPointerEnter:e=>((e,t,n,i)=>{t.classList.add("excalidraw-tooltip--visible"),t.style.minWidth=i?"50ch":"10ch",t.style.maxWidth=i?"50ch":"15ch",t.textContent=n;const{x:s,bottom:r,top:o,width:a}=e.getBoundingClientRect(),{width:l,height:c}=t.getBoundingClientRect(),d=window.innerWidth,h=s+a/2-l/2,u=h+l>=d?h+l-d:0,m=r+5,p=m+c>=window.innerHeight?r-o+c+10:0;Object.assign(t.style,{top:"".concat(m-p,"px"),left:"".concat(h-u,"px")})})(e.currentTarget,Ta(),n,i),onPointerLeave:()=>Ta().classList.remove("excalidraw-tooltip--visible"),style:s,children:t})};n(65);var Da=e=>{const{onConfirm:t,onCancel:n,children:i,confirmText:s=w("buttons.confirm"),cancelText:r=w("buttons.cancel"),className:o="",...a}=e;return Object(kr.jsxs)(gh,{onCloseRequest:n,small:!0,...a,className:"confirm-dialog ".concat(o),children:[i,Object(kr.jsxs)("div",{className:"confirm-dialog-buttons",children:[Object(kr.jsx)(Mr,{type:"button",title:r,"aria-label":r,label:r,onClick:n,className:"confirm-dialog--cancel"}),Object(kr.jsx)(Mr,{type:"button",title:s,"aria-label":s,label:s,onClick:t,className:"confirm-dialog--confirm"})]})]})};var Pa=e=>{let{onConfirm:t}=e;const[n,i]=Object(o.useState)(!1),s=()=>{i(!n)};return Object(kr.jsxs)(kr.Fragment,{children:[Object(kr.jsx)(Mr,{type:"button",icon:_r,title:w("buttons.clearReset"),"aria-label":w("buttons.clearReset"),showAriaLabel:qd(),onClick:s,"data-testid":"clear-canvas-button"}),n&&Object(kr.jsx)(Da,{onConfirm:()=>{t(),s()},onCancel:s,title:w("clearCanvasDialog.title"),children:Object(kr.jsxs)("p",{className:"clear-canvas__content",children:[" ",w("alerts.clearReset")]})})]})};$o({name:"changeViewBackgroundColor",perform:(e,t,n)=>({appState:{...t,...n},commitToHistory:!!n.viewBackgroundColor}),PanelComponent:e=>{let{appState:t,updateData:n}=e;return Object(kr.jsx)("div",{style:{position:"relative"},children:Object(kr.jsx)(Ea,{label:w("labels.canvasBackground"),type:"canvasBackground",color:t.viewBackgroundColor,onChange:e=>n({viewBackgroundColor:e}),isActive:"canvasColorPicker"===t.openPopup,setActive:e=>n({openPopup:e?"canvasColorPicker":null}),"data-testid":"canvas-background-picker"})})}}),$o({name:"clearCanvas",perform:(e,t,n,i)=>(i.imageCache.clear(),{elements:e.map((e=>kn(e,{isDeleted:!0}))),appState:{...nt(),files:{},theme:t.theme,elementLocked:t.elementLocked,exportBackground:t.exportBackground,exportEmbedScene:t.exportEmbedScene,gridSize:t.gridSize,showStats:t.showStats,pasteDialog:t.pasteDialog},commitToHistory:!0}),PanelComponent:e=>{let{updateData:t}=e;return Object(kr.jsx)(Pa,{onConfirm:t})}}),$o({name:"zoomIn",perform:(e,t)=>{const n=Sr(Er(t.zoom.value+d.Z),t.zoom,{left:t.offsetLeft,top:t.offsetTop},{x:t.width/2,y:t.height/2});return{appState:{...t,zoom:n},commitToHistory:!1}},PanelComponent:e=>{let{updateData:t}=e;return Object(kr.jsx)(Mr,{type:"button",icon:Wr,title:"".concat(w("buttons.zoomIn")," \u2014 ").concat(Be("CtrlOrCmd++")),"aria-label":w("buttons.zoomIn"),onClick:()=>{t(null)},size:"small"})},keyTest:e=>(e.code===C||e.code===I)&&(e[$]||e.shiftKey)}),$o({name:"zoomOut",perform:(e,t)=>{const n=Sr(Er(t.zoom.value-d.Z),t.zoom,{left:t.offsetLeft,top:t.offsetTop},{x:t.width/2,y:t.height/2});return{appState:{...t,zoom:n},commitToHistory:!1}},PanelComponent:e=>{let{updateData:t}=e;return Object(kr.jsx)(Mr,{type:"button",icon:Kr,title:"".concat(w("buttons.zoomOut")," \u2014 ").concat(Be("CtrlOrCmd+-")),"aria-label":w("buttons.zoomOut"),onClick:()=>{t(null)},size:"small"})},keyTest:e=>(e.code===k||e.code===M)&&(e[$]||e.shiftKey)}),$o({name:"resetZoom",perform:(e,t)=>({appState:{...t,zoom:Sr(1,t.zoom,{left:t.offsetLeft,top:t.offsetTop},{x:t.width/2,y:t.height/2})},commitToHistory:!1}),PanelComponent:e=>{let{updateData:t,appState:n}=e;return Object(kr.jsx)(La,{label:w("buttons.resetZoom"),style:{height:"100%"},children:Object(kr.jsxs)(Mr,{type:"button",className:"reset-zoom-button",title:w("buttons.resetZoom"),"aria-label":w("buttons.resetZoom"),onClick:()=>{t(null)},size:"small",children:[(100*n.zoom.value).toFixed(0),"%"]})})},keyTest:e=>(e.code===N||e.code===A)&&(e[$]||e.shiftKey)});const za=(e,t,n)=>{const i=ir(e),s=hr(i,t),r=n&&s.length>0?Ft(s):Ft(i),o=((e,t)=>{const[n,i,s,r]=e,o=s-n,a=t.width/o,l=r-i,c=t.height/l,h=Math.min(a,c),u=Math.floor(h/d.Z)*d.Z;return Math.min(Math.max(u,d.Z),1)})(r,{width:t.width,height:t.height}),a=Sr(o,t.zoom,{left:t.offsetLeft,top:t.offsetTop}),[l,c,h,u]=r,m=(l+h)/2,p=(c+u)/2;return{appState:{...t,...mr({scenePoint:{x:m,y:p},viewportDimensions:{width:t.width,height:t.height},zoom:a}),zoom:a},commitToHistory:!1}},Na=($o({name:"zoomToSelection",perform:(e,t)=>za(e,t,!0),keyTest:e=>e.code===P&&e.shiftKey&&!e.altKey&&!e[$]}),$o({name:"zoomToFit",perform:(e,t)=>za(e,t,!1),keyTest:e=>e.code===D&&e.shiftKey&&!e.altKey&&!e[$]}),$o({name:"toggleTheme",perform:(e,t,n)=>({appState:{...t,theme:n||(t.theme===d.P.LIGHT?d.P.DARK:d.P.LIGHT)},commitToHistory:!1}),PanelComponent:e=>{let{appState:t,updateData:n}=e;return Object(kr.jsx)("div",{style:{marginInlineStart:"0.25rem"},children:Object(kr.jsx)(Ma,{value:t.theme,onChange:e=>{n(e)}})})},keyTest:e=>e.altKey&&e.shiftKey&&e.code===H}),$o({name:"finalize",perform:(e,t,n,i)=>{var s;let{canvas:r,focusContainer:o}=i;if(t.editingLinearElement){const{elementId:n,startBindingElement:i,endBindingElement:s}=t.editingLinearElement,r=ps.getElement(n);if(r)return yt(r)&&bs(r,i,s),{elements:r.points.length<2||Mn(r)?e.filter((e=>e.id!==r.id)):void 0,appState:{...t,editingLinearElement:null},commitToHistory:!0}}let a=e;t.pendingImageElement&&Cn(t.pendingImageElement,{isDeleted:!0},!1),window.document.activeElement instanceof HTMLElement&&o();const l=t.multiElement?t.multiElement:"freedraw"===(null===(s=t.editingElement)||void 0===s?void 0:s.type)?t.editingElement:null;if(l){if("freedraw"!==l.type&&"touch"!==t.lastPointerDownWith){const{points:e,lastCommittedPoint:t}=l;t&&e[e.length-1]===t||Cn(l,{points:l.points.slice(0,-1)})}Mn(l)&&(a=a.slice(0,-1));const e=Ct(l.points,t.zoom.value);if(("line"===l.type||"freedraw"===l.type)&&e){const e=l.points,t=e[0];Cn(l,{points:e.map(((n,i)=>i===e.length-1?[t[0],t[1]]:n))})}if(yt(l)&&!e&&l.points.length>1){const[e,n]=ps.getPointAtIndexGlobalCoordinates(l,-1);xs(l,t,wn.getScene(l),{x:e,y:n})}t.elementLocked||"freedraw"===t.elementType||(t.selectedElementIds[l.id]=!0)}return(t.elementLocked||"freedraw"===t.elementType)&&l||Pe(r),{elements:a,appState:{...t,elementType:(t.elementLocked||"freedraw"===t.elementType)&&l?t.elementType:"selection",draggingElement:null,multiElement:null,editingElement:null,startBoundElement:null,suggestedBindings:[],selectedElementIds:l&&!t.elementLocked&&"freedraw"!==t.elementType?{...t.selectedElementIds,[l.id]:!0}:t.selectedElementIds,pendingImageElement:null},commitToHistory:"freedraw"===t.elementType}},keyTest:(e,t)=>e.key===ne&&(null!==t.editingLinearElement||!t.draggingElement&&null===t.multiElement)||(e.key===ne||e.key===te)&&null!==t.multiElement,PanelComponent:e=>{let{appState:t,updateData:n}=e;return Object(kr.jsx)(Mr,{type:"button",icon:Yr,title:w("buttons.done"),"aria-label":w("buttons.done"),onClick:n,visible:null!=t.multiElement})}}));n(66),n(67);const Ra=e=>{const{id:t}=Qd(),[n,i]=Object(o.useState)(e.value);return Object(kr.jsxs)("div",{className:"ProjectName",children:[Object(kr.jsx)("label",{className:"ProjectName-label",htmlFor:"filename",children:"".concat(e.label).concat(e.isNameEditable?"":":")}),e.isNameEditable?Object(kr.jsx)("input",{type:"text",className:"TextInput",onBlur:t=>{(e=>{let t=e.parentElement;for(;t;){if(t.tabIndex>-1)return void t.focus();t=t.parentElement}})(t.target);const n=t.target.value;n!==e.value&&e.onChange(n)},onKeyDown:e=>{if("Enter"===e.key){if(e.preventDefault(),e.nativeEvent.isComposing||229===e.keyCode)return;e.currentTarget.blur()}},id:"".concat(t,"-filename"),value:n,onChange:e=>i(e.target.value)}):Object(kr.jsx)("span",{className:"TextInput TextInput--readonly",id:"".concat(t,"-filename"),children:e.value})]})},Ba=(e,t)=>{if(null===t||void 0===t?void 0:t.collaborators){const n=t.collaborators.get(e);if(null===n||void 0===n?void 0:n.color)return n.color}const n=e.split("").reduce(((e,t)=>e+t.charCodeAt(0)),0),i=S.elementBackground.slice(1),s=S.elementStroke.slice(1);return{background:i[n%i.length],stroke:s[n%s.length]}};let Ha;!function(e){e.ACTIVE="active",e.AWAY="away",e.IDLE="idle"}(Ha||(Ha={}));const _a=(()=>{const e=document.createElement("canvas").getContext("2d");if(!e)return!1;return e.fillStyle="#f00",e.textBaseline="top",e.font="32px Arial",e.fillText("\ud83d\ude00",0,0),0!==e.getImageData(12,12,1,1).data[0]})(),Fa=function(e,t,n,i,s,r,o,a){let l=arguments.length>8&&void 0!==arguments[8]&&arguments[8];e.save(),e.translate(r,o),e.rotate(a),l&&e.fillRect(t-r,n-o,i,s),e.strokeRect(t-r,n-o,i,s),e.restore()},Ua=(e,t,n,i)=>{e.beginPath(),e.arc(t,n,i,0,2*Math.PI),e.fill(),e.stroke()},Va=(e,t,n,i,s,r,o)=>{if(null===r)return{atLeastOneVisibleElement:!1};const{renderScrollbars:a=!0,renderSelection:l=!0,renderGrid:h=!0,isExporting:u}=o,m=r.getContext("2d");m.setTransform(1,0,0,1,0,0),m.save(),m.scale(i,i);const p=r.width/i,g=r.height/i;if(u&&"dark"===o.theme&&(m.filter=d.Q),"string"===typeof o.viewBackgroundColor){("transparent"===o.viewBackgroundColor||5===o.viewBackgroundColor.length||9===o.viewBackgroundColor.length||/(hsla|rgba)\(/.test(o.viewBackgroundColor))&&m.clearRect(0,0,p,g),m.save(),m.fillStyle=o.viewBackgroundColor,m.fillRect(0,0,p,g),m.restore()}else m.clearRect(0,0,p,g);const b=o.zoom.translation.x,f=o.zoom.translation.y;m.save(),m.translate(b,f),m.scale(o.zoom.value,o.zoom.value),h&&t.gridSize&&((e,t,n,i,s,r)=>{e.save(),e.strokeStyle="rgba(0,0,0,0.1)",e.beginPath();for(let o=n;o<n+s+2*t;o+=t)e.moveTo(o,i-t),e.lineTo(o,i+r+2*t);for(let o=i;o<i+r+2*t;o+=t)e.moveTo(n-t,o),e.lineTo(n+s+2*t,o);e.stroke(),e.restore()})(m,t.gridSize,-Math.ceil(b/o.zoom.value/t.gridSize)*t.gridSize+o.scrollX%t.gridSize,-Math.ceil(f/o.zoom.value/t.gridSize)*t.gridSize+o.scrollY%t.gridSize,p/o.zoom.value,g/o.zoom.value);const v=e.filter((e=>Xa(e,p,g,{zoom:o.zoom,offsetLeft:t.offsetLeft,offsetTop:t.offsetTop,scrollX:o.scrollX,scrollY:o.scrollY})));if(v.forEach((e=>{try{hn(e,s,m,o)}catch(t){console.error(t)}})),t.editingLinearElement){const e=ps.getElement(t.editingLinearElement.elementId);e&&((e,t,n,i)=>{e.save(),e.translate(n.scrollX,n.scrollY),e.lineWidth=1/n.zoom.value,ps.getPointsGlobalCoordinates(i).forEach(((i,s)=>{var r;e.strokeStyle="red",e.setLineDash([]),e.fillStyle=(null===(r=t.editingLinearElement)||void 0===r?void 0:r.activePointIndex)===s?"rgba(255, 127, 127, 0.9)":"rgba(255, 255, 255, 0.9)";const{POINT_HANDLE_SIZE:o}=ps;Ua(e,i[0],i[1],o/2/n.zoom.value)})),e.restore()})(m,t,o,e)}if(n)try{hn(n,s,m,o)}catch(w){console.error(w)}if(gs(t)&&t.suggestedBindings.filter((e=>null!=e)).forEach((e=>{Ka(m,o,e)})),l&&!t.multiElement&&!t.editingLinearElement){const n=e.reduce(((e,n)=>{const i=[];if(t.selectedElementIds[n.id]&&!Dn(t,n)&&i.push(c.black),o.remoteSelectedElementIds[n.id]&&i.push(...o.remoteSelectedElementIds[n.id].map((e=>{const{background:n}=Ba(e,t);return n}))),i.length){const[t,s,r,o]=Pt(n);e.push({angle:n.angle,elementX1:t,elementY1:s,elementX2:r,elementY2:o,selectionColors:i})}return e}),[]),i=t=>{const i=Bn(e,t),[s,r,o,a]=Ft(i);n.push({angle:0,elementX1:s,elementX2:o,elementY1:r,elementY2:a,selectionColors:[c.black]})};for(const e of zn(t))i(e);t.editingGroupId&&i(t.editingGroupId),n.forEach((e=>Wa(m,o,e)));const s=hr(e,t);if(m.save(),m.translate(o.scrollX,o.scrollY),1===s.length){m.fillStyle=c.white;const e=ni(s[0],o.zoom,"mouse");t.viewModeEnabled||Ga(m,o,e,s[0].angle)}else if(s.length>1&&!t.isRotating){const e=4/o.zoom.value;m.fillStyle=c.white;const[t,n,i,r]=Ft(s),a=m.getLineDash();m.setLineDash([2/o.zoom.value]);const l=m.lineWidth;m.lineWidth=1/o.zoom.value,Fa(m,t-e,n-e,i-t+2*e,r-n+2*e,(t+i)/2,(n+r)/2,0),m.lineWidth=l,m.setLineDash(a);const d=ti([t,n,i,r],0,o.zoom,"mouse",qn);Ga(m,o,d,0)}m.restore()}m.restore();for(const d in o.remotePointerViewportCoords){let{x:e,y:n}=o.remotePointerViewportCoords[d];e-=t.offsetLeft,n-=t.offsetTop;const i=9,s=14,r=e<0||e>p-i||n<0||n>g-s;e=Math.max(e,0),e=Math.min(e,p-i),n=Math.max(n,0),n=Math.min(n,g-s);const{background:a,stroke:l}=Ba(d,t);m.save(),m.strokeStyle=l,m.fillStyle=a;const h=o.remotePointerUserStates[d];(r||h===Ha.AWAY)&&(m.globalAlpha=.48),o.remotePointerButton&&"down"===o.remotePointerButton[d]&&(m.beginPath(),m.arc(e,n,15,0,2*Math.PI,!1),m.lineWidth=3,m.strokeStyle="#ffffff88",m.stroke(),m.closePath(),m.beginPath(),m.arc(e,n,15,0,2*Math.PI,!1),m.lineWidth=1,m.strokeStyle=l,m.stroke(),m.closePath()),m.beginPath(),m.moveTo(e,n),m.lineTo(e+1,n+14),m.lineTo(e+4,n+9),m.lineTo(e+9,n+10),m.lineTo(e,n),m.fill(),m.stroke();const u=o.remotePointerUsernames[d];let b="";h===Ha.AWAY?b=_a?"\u26ab\ufe0f":" (".concat(Ha.AWAY,")"):h===Ha.IDLE?b=_a?"\ud83d\udca4":" (".concat(Ha.IDLE,")"):h===Ha.ACTIVE&&(b=_a?"\ud83d\udfe2":"");const f="".concat(u?"".concat(u," "):"").concat(b);if(!r&&f){const t=e+i,r=n+s,o=4,d=4,h=m.measureText(f),u=h.actualBoundingBoxDescent+h.actualBoundingBoxAscent;m.fillStyle=l,m.fillRect(t-1,r-1,h.width+2*o+2,u+2*d+2),m.fillStyle=a,m.fillRect(t,r,h.width+2*o,u+2*d),m.fillStyle=c.white,m.fillText(f,t+o,r+d+h.actualBoundingBoxAscent)}m.restore(),m.closePath()}let x;return a&&(x=((e,t,n,i)=>{let{scrollX:s,scrollY:r,zoom:o}=i;if(0===e.length)return{horizontal:null,vertical:null};const[a,l,c,d]=Ft(e),h=t/o.value,u=n/o.value,m=t-h,p=n-u,g={top:parseInt(Fe("sat")),bottom:parseInt(Fe("sab")),left:parseInt(Fe("sal")),right:parseInt(Fe("sar"))},b=y().rtl,f=m/2-s+g.left,v=p/2-r+g.top,x=f+h-g.right,w=v+u-g.bottom,j=Math.min(a,f),S=Math.min(l,v),E=Math.max(c,x),O=Math.max(d,w);return{horizontal:f===j&&x===E?null:{x:Math.max(g.left,4)+(f-j)/(E-j)*t,y:n-6-Math.max(4,g.bottom),width:(x-f)/(E-j)*t-Math.max(8,g.left+g.right),height:6},vertical:v===S&&w===O?null:{x:b?Math.max(g.left,4):t-6-Math.max(g.right,4),y:(v-S)/(O-S)*n+Math.max(g.top,4),width:6,height:(w-v)/(O-S)*n-Math.max(8,g.top+g.bottom)}}})(e,p,g,o),m.save(),m.fillStyle="rgba(0,0,0,0.3)",m.strokeStyle="rgba(255,255,255,0.8)",[x.horizontal,x.vertical].forEach((e=>{e&&((e,t,n,i,s,r)=>{e.beginPath(),e.moveTo(t+r,n),e.lineTo(t+i-r,n),e.quadraticCurveTo(t+i,n,t+i,n+r),e.lineTo(t+i,n+s-r),e.quadraticCurveTo(t+i,n+s,t+i-r,n+s),e.lineTo(t+r,n+s),e.quadraticCurveTo(t,n+s,t,n+s-r),e.lineTo(t,n+r),e.quadraticCurveTo(t,n,t+r,n),e.closePath(),e.fill(),e.stroke()})(m,e.x,e.y,e.width,e.height,3)})),m.restore()),m.restore(),{atLeastOneVisibleElement:v.length>0,scrollBars:x}},Ga=(e,t,n,i)=>{Object.keys(n).forEach((s=>{const r=n[s];void 0!==r&&(e.save(),e.lineWidth=1/t.zoom.value,"rotation"===s?Ua(e,r[0]+r[2]/2,r[1]+r[3]/2,r[2]/2):Fa(e,r[0],r[1],r[2],r[3],r[0]+r[2]/2,r[1]+r[3]/2,i,!0),e.restore())}))},Wa=(e,t,n)=>{const{angle:i,elementX1:s,elementY1:r,elementX2:o,elementY2:a,selectionColors:l}=n,c=o-s,d=a-r,h=4/t.zoom.value,u=8/t.zoom.value,m=4/t.zoom.value;e.save(),e.translate(t.scrollX,t.scrollY),e.lineWidth=1/t.zoom.value;const p=l.length;for(let g=0;g<p;++g)e.strokeStyle=l[g],e.setLineDash([u,m+(u+m)*(p-1)]),e.lineDashOffset=(u+m)*g,Fa(e,s-h,r-h,c+2*h,d+2*h,s+c/2,r+d/2,i);e.restore()},Ka=(e,t,n)=>{const i=Array.isArray(n)?Za:Ya;e.save(),e.translate(t.scrollX,t.scrollY),i(e,n),e.restore()},Ya=(e,t)=>{const[n,i,s,r]=Pt(t),o=s-n,a=r-i,l=Ni(t,o,a);e.strokeStyle="rgba(0,0,0,.05)",e.lineWidth=l-4;const c=2+l/2;switch(t.type){case"rectangle":case"text":Fa(e,n-c,i-c,o+2*c,a+2*c,n+o/2,i+a/2,t.angle);break;case"diamond":const s=Math.hypot(o,a);((e,t,n,i,s,r)=>{e.save(),e.translate(i,s),e.rotate(r),e.beginPath(),e.moveTo(0,n/2),e.lineTo(t/2,0),e.lineTo(0,-n/2),e.lineTo(-t/2,0),e.closePath(),e.stroke(),e.restore()})(e,o+2*(c*s/a),a+2*(c*s/o),n+o/2,i+a/2,t.angle);break;case"ellipse":((e,t,n,i,s,r)=>{e.beginPath(),e.ellipse(i,s,t/2,n/2,r,0,2*Math.PI),e.stroke()})(e,o+2*c,a+2*c,n+o/2,i+a/2,t.angle)}},Za=(e,t)=>{const[n,i,s]=t,r=Ni(s,s.width,s.height);e.strokeStyle="rgba(0,0,0,0)",e.fillStyle="rgba(0,0,0,.05)";("both"===i?[0,-1]:"start"===i?[0]:[-1]).forEach((t=>{const[i,s]=ps.getPointAtIndexGlobalCoordinates(n,t);Ua(e,i,s,r)}))},Xa=(e,t,n,i)=>{const[s,r,o,a]=_t(e),l=He({clientX:i.offsetLeft,clientY:i.offsetTop},i),c=He({clientX:i.offsetLeft+t,clientY:i.offsetTop+n},i);return l.x<=o&&l.y<=a&&c.x>=s&&c.y>=r};var qa=n(33);const Ja=e=>{var t,n,i;const s=null===(t=e.extensions)||void 0===t?void 0:t.reduce(((e,t)=>(e.push(d.D[t]),e)),[]),r=null===(n=e.extensions)||void 0===n?void 0:n.reduce(((e,t)=>"jpg"===t?e.concat(".jpg",".jpeg"):e.concat(".".concat(t))),[]);return Object(qa.a)({description:e.description,extensions:r,mimeTypes:s,multiple:null!==(i=e.multiple)&&void 0!==i&&i,legacySetup:(t,n,i)=>{const s=Le(n,500),r=()=>{o(),document.addEventListener(d.s.KEYUP,s),document.addEventListener(d.s.POINTER_UP,s),s()},o=()=>{var n;if(null===(n=i.files)||void 0===n?void 0:n.length){const n=e.multiple?[...i.files]:i.files[0];t(n)}};requestAnimationFrame((()=>{window.addEventListener(d.s.FOCUS,r)}));const a=window.setInterval((()=>{o()}),500);return e=>{clearInterval(a),s.cancel(),window.removeEventListener(d.s.FOCUS,r),document.removeEventListener(d.s.KEYUP,s),document.removeEventListener(d.s.POINTER_UP,s),e&&(console.warn("Opening the file was canceled (legacy-fs)."),e(new Cr))}}})},Qa=(e,t)=>Object(qa.b)(e,{fileName:"".concat(t.name,".").concat(t.extension),description:t.description,extensions:[".".concat(t.extension)]},t.fileHandle),$a={selection:!0,text:!0,rectangle:!0,diamond:!0,ellipse:!0,line:!0,image:!0,arrow:!0,freedraw:!0},el=(e,t)=>{var n,i,s,r,o,a,l,c,d,h,u,m,p;const g={type:t.type||e.type,version:e.version||1,versionNonce:null!==(n=e.versionNonce)&&void 0!==n?n:0,isDeleted:null!==(i=e.isDeleted)&&void 0!==i&&i,id:e.id||On(),fillStyle:e.fillStyle||"hachure",strokeWidth:e.strokeWidth||1,strokeStyle:null!==(s=e.strokeStyle)&&void 0!==s?s:"solid",roughness:null!==(r=e.roughness)&&void 0!==r?r:1,opacity:null==e.opacity?100:e.opacity,angle:e.angle||0,x:null!==(o=null!==(a=t.x)&&void 0!==a?a:e.x)&&void 0!==o?o:0,y:null!==(l=null!==(c=t.y)&&void 0!==c?c:e.y)&&void 0!==l?l:0,strokeColor:e.strokeColor,backgroundColor:e.backgroundColor,width:e.width||0,height:e.height||0,seed:null!==(d=e.seed)&&void 0!==d?d:1,groupIds:null!==(h=e.groupIds)&&void 0!==h?h:[],strokeSharpness:null!==(u=e.strokeSharpness)&&void 0!==u?u:vt(e.type)?"round":"sharp",boundElementIds:null!==(m=e.boundElementIds)&&void 0!==m?m:[],updated:null!==(p=e.updated)&&void 0!==p?p:$e()};return{...g,...Tn(g),...t}},tl=e=>{var t,n;switch(e.type){case"text":let i=e.fontSize,s=e.fontFamily;if("font"in e){const[t,r]=e.font.split(" ");i=parseInt(t,10),n=r,s=Object.keys(d.w).includes(n)?d.w[n]:d.g}return el(e,{fontSize:i,fontFamily:s,text:null!==(t=e.text)&&void 0!==t?t:"",baseline:e.baseline,textAlign:e.textAlign||d.j,verticalAlign:e.verticalAlign||d.m});case"freedraw":return el(e,{points:e.points,lastCommittedPoint:null,simulatePressure:e.simulatePressure,pressures:e.pressures});case"image":return el(e,{status:e.status||"pending",fileId:e.fileId,scale:e.scale||[1,1]});case"line":case"draw":case"arrow":{const{startArrowhead:t=null,endArrowhead:n=("arrow"===e.type?"arrow":null)}=e;let i=e.x,s=e.y,r=!Array.isArray(e.points)||e.points.length<2?[[0,0],[e.width,e.height]]:e.points;return 0===r[0][0]&&0===r[0][1]||({points:r,x:i,y:s}=ps.getNormalizedPoints(e)),el(e,{type:"draw"===e.type?"line":e.type,startBinding:e.startBinding,endBinding:e.endBinding,lastCommittedPoint:null,startArrowhead:t,endArrowhead:n,points:r,x:i,y:s})}case"ellipse":case"rectangle":case"diamond":return el(e,{})}},nl=(e,t)=>{const n=t?et(t):null;return(e||[]).reduce(((e,t)=>{if("selection"!==t.type&&!Mn(t)){let i=tl(t);if(i){const s=null===n||void 0===n?void 0:n.get(t.id);s&&s.version>i.version&&(i=In(i,s.version)),e.push(i)}}return e}),[])},il=(e,t)=>{e=e||{};const n=nt(),i={};for(const[s,r]of Object.entries(n)){const n=e[s],o=t?t[s]:void 0;i[s]=void 0!==n?n:void 0!==o?o:r}return{...i,elementType:$a[i.elementType]?i.elementType:"selection",zoom:"number"===typeof e.zoom?{value:e.zoom,translation:n.zoom.translation}:e.zoom||n.zoom}},sl=(e,t,n)=>({elements:nl(null===e||void 0===e?void 0:e.elements,n),appState:il(null===e||void 0===e?void 0:e.appState,t||null),files:(null===e||void 0===e?void 0:e.files)||{}}),rl=(e,t)=>{const n=[];for(const i of e)if(Array.isArray(i))n.push({status:t,elements:i,id:On(),created:Date.now()});else{const e=i;n.push({...e,id:e.id||On(),status:e.status||t,created:e.created||Date.now()})}return n},ol=async e=>{let t;if(e.type===d.D.png)try{return await(await Promise.all([n.e(1),n.e(46)]).then(n.bind(null,222))).decodePngMetadata(e)}catch(i){throw"INVALID"===i.message?new DOMException(w("alerts.imageDoesNotContainScene"),"EncodingError"):new DOMException(w("alerts.cannotRestoreFromImage"),"EncodingError")}else if(t="text"in Blob?await e.text():await new Promise((t=>{const n=new FileReader;n.readAsText(e,"utf8"),n.onloadend=()=>{n.readyState===FileReader.DONE&&t(n.result)}})),e.type===d.D.svg)try{return await(await Promise.all([n.e(1),n.e(46)]).then(n.bind(null,222))).decodeSvgMetadata({svg:t})}catch(i){throw"INVALID"===i.message?new DOMException(w("alerts.imageDoesNotContainScene"),"EncodingError"):new DOMException(w("alerts.cannotRestoreFromImage"),"EncodingError")}return t},al=e=>{var t;return e&&(null===(t=e.name.match(/\.(json|excalidraw|png|svg)$/))||void 0===t?void 0:t[1])||null},ll=e=>{const t=al(e);return"png"===t||"svg"===t},cl=e=>{const{type:t}=e||{};return!!t&&d.b.includes(t)},dl=async(e,t,n)=>{const i=await ol(e);try{const s=JSON.parse(i);if(!vl(s))throw new Error(w("alerts.couldNotLoadInvalidFile"));return sl({elements:ar(s.elements||[]),appState:{theme:null===t||void 0===t?void 0:t.theme,fileHandle:e.handle||null,...ot(s.appState||{}),...t?pr(s.elements||[],t):{}},files:s.files},t,n)}catch(s){throw console.error(s.message),new Error(w("alerts.couldNotLoadInvalidFile"))}},hl=async e=>new Promise(((t,n)=>{try{e.toBlob((e=>{if(!e)return n(new Or(w("canvasError.canvasTooBig"),"CANVAS_POSSIBLY_TOO_BIG"));t(e)}))}catch(i){n(i)}})),ul=async e=>new Promise(((t,n)=>{const i=new FileReader;i.onload=()=>{const e=i.result;t(e)},i.onerror=e=>n(e),i.readAsDataURL(e)})),ml=async(e,t)=>{if(e.type===d.D.svg)return e;const[i,s]=await Promise.all([n.e(62).then(n.t.bind(null,229,7)).then((e=>e.default)),n.e(61).then(n.bind(null,230)).then((e=>e.default))]),r=s({pica:i({features:["js","wasm"]})});if(t.outputType){const{outputType:e}=t;r._create_blob=function(t){return this.pica.toBlob(t.out_canvas,e,.8).then((e=>(t.out_blob=e,t)))}}if(!cl(e))throw new Error(w("errors.unsupportedFileType"));return new File([await r.toBlob(e,{max:t.maxWidthOrHeight})],e.name,{type:t.outputType||e.type})},pl=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new File([(new TextEncoder).encode(e)],t,{type:d.D.svg})},gl=(e,t)=>{const n={};for(const i of e)!i.isDeleted&&"fileId"in i&&i.fileId&&t[i.fileId]&&(n[i.fileId]=t[i.fileId]);return n},bl=(e,t,n,i)=>{const s={type:d.t.excalidraw,version:d.W.excalidraw,source:d.v,elements:"local"===i?ar(e):or(e),appState:"local"===i?ot(t):at(t),files:"local"===i?gl(e,n):void 0};return JSON.stringify(s,null,2)},fl=async(e,t,n)=>{const i=bl(e,t,n,"local"),s=new Blob([i],{type:d.D.excalidraw});return{fileHandle:await Qa(s,{name:t.name,extension:"excalidraw",description:"Excalidraw file",fileHandle:ll(t.fileHandle)?null:t.fileHandle})}},vl=e=>(null===e||void 0===e?void 0:e.type)===d.t.excalidraw&&(!e.elements||Array.isArray(e.elements)&&(!e.appState||"object"===typeof e.appState)),yl=e=>new Promise(((t,n)=>{const i=new Image;i.onload=()=>{t(i)},i.onerror=e=>{n(e)},i.src=e})),xl=async e=>{let{fileIds:t,files:n,imageCache:i}=e;const s=new Map,r=new Map;return await Promise.all(t.reduce(((e,t)=>{const o=n[t];return o&&!s.has(t)?(s.set(t,!0),e.concat((async()=>{try{if(o.mimeType===d.D.binary)throw new Error("Only images can be added to ImageCache");const e=yl(o.dataURL),n={image:e,mimeType:o.mimeType};i.set(t,n);const s=await e;i.set(t,{...n,image:s})}catch(e){r.set(t,!0)}})())):e}),[])),{imageCache:i,updatedFiles:s,erroredFiles:r}},wl=e=>e.filter((e=>ut(e))),jl="\x3c!-- svg-source:excalidraw --\x3e",Sl=async function(e,t,n,i){let{exportBackground:s,exportPadding:r=d.f,viewBackgroundColor:o}=i,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:(e,n)=>{const i=document.createElement("canvas");return i.width=e*t.exportScale,i.height=n*t.exportScale,{canvas:i,scale:t.exportScale}};const[l,c,h,u]=Ol(e,r),{canvas:m,scale:p=1}=a(h,u),g=nt(),{imageCache:b}=await xl({imageCache:new Map,fileIds:wl(e).map((e=>e.fileId)),files:n});return Va(e,t,null,p,dt.a.canvas(m),m,{viewBackgroundColor:s?o:null,scrollX:-l+r,scrollY:-c+r,zoom:g.zoom,remotePointerViewportCoords:{},remoteSelectedElementIds:{},shouldCacheIgnoreZoom:!1,remotePointerUsernames:{},remotePointerUserStates:{},theme:t.exportWithDarkMode?"dark":"light",imageCache:b,renderScrollbars:!1,renderSelection:!1,renderGrid:!1,isExporting:!0}),m},El=async(e,t,i)=>{const{exportPadding:s=d.f,viewBackgroundColor:r,exportScale:o=1,exportEmbedScene:a}=t;let l="";if(a)try{l=await(await Promise.all([n.e(1),n.e(46)]).then(n.bind(null,222))).encodeSvgMetadata({text:bl(e,t,i||{},"local")})}catch(g){console.error(g)}const[c,h,u,m]=Ol(e,s),p=document.createElementNS(d.M,"svg");if(p.setAttribute("version","1.1"),p.setAttribute("xmlns",d.M),p.setAttribute("viewBox","0 0 ".concat(u," ").concat(m)),p.setAttribute("width","".concat(u*o)),p.setAttribute("height","".concat(m*o)),t.exportWithDarkMode&&p.setAttribute("filter",d.Q),p.innerHTML="\n  ".concat(jl,"\n  ").concat(l,'\n  <defs>\n    <style>\n      @font-face {\n        font-family: "Virgil";\n        src: url("https://excalidraw.com/Virgil.woff2");\n      }\n      @font-face {\n        font-family: "Cascadia";\n        src: url("https://excalidraw.com/Cascadia.woff2");\n      }\n    </style>\n  </defs>\n  '),t.exportBackground&&r){const e=p.ownerDocument.createElementNS(d.M,"rect");e.setAttribute("x","0"),e.setAttribute("y","0"),e.setAttribute("width","".concat(u)),e.setAttribute("height","".concat(m)),e.setAttribute("fill",r),p.appendChild(e)}return function(e,t,n,i){let{offsetX:s=0,offsetY:r=0,exportWithDarkMode:o=!1}=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};n&&e.forEach((e=>{if(!e.isDeleted)try{mn(e,t,n,i,e.x+s,e.y+r,o)}catch(g){console.error(g)}}))}(e,dt.a.svg(p),p,i||{},{offsetX:-c+s,offsetY:-h+s,exportWithDarkMode:t.exportWithDarkMode}),p},Ol=(e,t)=>{const[n,i,s,r]=Ft(e);return[n,i,De(n,s)+2*t,De(i,r)+t+t]},Cl=32,kl=12,Il=256,Ml="NOT_SPREADSHEET",Al="VALID_SPREADSHEET",Tl=e=>{const t=/^[$\u20ac\xa3\xa5\u20a9]?([0-9,]+(\.[0-9]+)?)$/.exec(e);return t?parseFloat(t[1].replace(/,/g,"")):null},Ll=(e,t)=>e.slice(1).every((e=>null!==Tl(e[t]))),Dl=e=>{const t=e[0].length;if(t>2)return{type:Ml,reason:"More than 2 columns"};if(1===t){if(!Ll(e,0))return{type:Ml,reason:"Value is not numeric"};const t=null===Tl(e[0][0]),n=(t?e.slice(1):e).map((e=>Tl(e[0])));return n.length<2?{type:Ml,reason:"Less than two rows"}:{type:Al,spreadsheet:{title:t?e[0][0]:null,labels:null,values:n}}}const n=Ll(e,0)?0:1;if(!Ll(e,n))return{type:Ml,reason:"Value is not numeric"};const i=(n+1)%2,s=null===Tl(e[0][n]),r=s?e.slice(1):e;return r.length<2?{type:Ml,reason:"Less than 2 rows"}:{type:Al,spreadsheet:{title:s?e[0][n]:null,labels:r.map((e=>e[i])),values:r.map((e=>Tl(e[n])))}}},Pl=S.elementBackground.slice(2,S.elementBackground.length),zl={fillStyle:"hachure",fontFamily:d.g,fontSize:d.h,opacity:100,roughness:1,strokeColor:S.elementStroke[0],strokeSharpness:"sharp",strokeStyle:"solid",strokeWidth:1,verticalAlign:"middle"},Nl=e=>({chartWidth:44*e.values.length+kl,chartHeight:280}),Rl=(e,t,n,i,s)=>{var r;return(null===(r=e.labels)||void 0===r?void 0:r.map(((e,r)=>Vn({groupIds:[i],backgroundColor:s,...zl,text:e.length>8?"".concat(e.slice(0,5),"..."):e,x:t+44*r+24,y:n+6,width:Cl,angle:5.87,fontSize:16,textAlign:"center",verticalAlign:"top"}))))||[]},Bl=(e,t,n,i,s)=>{const r=Vn({groupIds:[i],backgroundColor:s,...zl,x:t-kl,y:n-kl,text:"0",textAlign:"right"});return[r,Vn({groupIds:[i],backgroundColor:s,...zl,x:t-kl,y:n-Il-r.height/2,text:Math.max(...e.values).toLocaleString(),textAlign:"right"})]},Hl=(e,t,n,i,s)=>{const{chartWidth:r,chartHeight:o}=Nl(e);return[Kn({backgroundColor:s,groupIds:[i],...zl,type:"line",x:t,y:n,startArrowhead:null,endArrowhead:null,width:r,points:[[0,0],[r,0]]}),Kn({backgroundColor:s,groupIds:[i],...zl,type:"line",x:t,y:n,startArrowhead:null,endArrowhead:null,height:o,points:[[0,0],[0,-o]]}),Kn({backgroundColor:s,groupIds:[i],...zl,type:"line",x:t,y:n-Il-kl,startArrowhead:null,endArrowhead:null,strokeStyle:"dotted",width:r,opacity:50,points:[[0,0],[r,0]]})]},_l=(e,t,n,i,s,r)=>{const{chartWidth:o,chartHeight:a}=Nl(e),l=e.title?Vn({backgroundColor:s,groupIds:[i],...zl,text:e.title,x:t+o/2,y:n-Il-24-d.h,strokeSharpness:"sharp",strokeStyle:"solid",textAlign:"center"}):null,c=r?Fn({backgroundColor:s,groupIds:[i],...zl,type:"rectangle",x:t,y:n-a,width:o,height:a,strokeColor:S.elementStroke[0],fillStyle:"solid",opacity:6}):null;return[...c?[c]:[],...l?[l]:[],...Rl(e,t,n,i,s),...Bl(e,t,n,i,s),...Hl(e,t,n,i,s)]},Fl=(e,t,n,i)=>"line"===e?((e,t,n)=>{const i=Math.max(...e.values),s=On(),r=Pl[Math.floor(Math.random()*Pl.length)];let o=0;const a=[];for(const d of e.values){const e=44*o,t=-d/i*Il;a.push([e,t]),o++}const l=Math.max(...a.map((e=>e[0]))),c=Math.max(...a.map((e=>e[1]))),h=Math.min(...a.map((e=>e[0]))),u=Math.min(...a.map((e=>e[1]))),m=Kn({backgroundColor:r,groupIds:[s],...zl,type:"line",x:t+kl+16,y:n-kl,startArrowhead:null,endArrowhead:null,height:c-u,width:l-h,strokeWidth:2,points:a}),p=e.values.map(((e,o)=>{const a=44*o+6,l=-e/i*Il+6;return Fn({backgroundColor:r,groupIds:[s],...zl,fillStyle:"solid",strokeWidth:2,type:"ellipse",x:t+a+16,y:n+l-24,width:kl,height:kl})})),g=e.values.map(((e,o)=>{const a=44*o+6,l=e/i*Il+6+kl;return Kn({backgroundColor:r,groupIds:[s],...zl,type:"line",x:t+a+16+6,y:n-l,startArrowhead:null,endArrowhead:null,height:l,strokeStyle:"dotted",opacity:50,points:[[0,0],[0,l]]})}));return[..._l(e,t,n,s,r,"production"===d.r.DEVELOPMENT),m,...g,...p]})(t,n,i):((e,t,n)=>{const i=Math.max(...e.values),s=On(),r=Pl[Math.floor(Math.random()*Pl.length)];return[...e.values.map(((e,o)=>{const a=e/i*Il;return Fn({backgroundColor:r,groupIds:[s],...zl,type:"rectangle",x:t+44*o+kl,y:n-a-kl,width:Cl,height:a})})),..._l(e,t,n,s,r,"production"===d.r.DEVELOPMENT)]})(t,n,i);let Ul="",Vl=!1;const Gl="clipboard"in navigator&&"readText"in navigator.clipboard,Wl="clipboard"in navigator&&"writeText"in navigator.clipboard,Kl="clipboard"in navigator&&"write"in navigator.clipboard&&"ClipboardItem"in window&&"toBlob"in HTMLCanvasElement.prototype,Yl=async(e,t,n)=>{const i=hr(e,t),s={type:d.t.excalidrawClipboard,elements:i,files:i.reduce(((e,t)=>(ut(t)&&n[t.fileId]&&(e[t.fileId]=n[t.fileId]),e)),{})},r=JSON.stringify(s);Ul=r;try{Vl=!1,await Jl(r)}catch(o){Vl=!0,console.error(o)}},Zl=()=>{if(!Ul)return{};try{return JSON.parse(Ul)}catch(e){return console.error(e),{}}},Xl=e=>{const t=(e=>{let t=e.trim().split("\n").map((e=>e.trim().split("\t")));if(t.length&&2!==t[0].length&&(t=e.trim().split("\n").map((e=>e.trim().split(",")))),0===t.length)return{type:Ml,reason:"No values"};const n=t[0].length;if(!t.every((e=>e.length===n)))return{type:Ml,reason:"All rows don't have same number of columns"};const i=Dl(t);if(i.type!==Al){const e=Dl((e=>{const t=[];for(let n=0;n<e[0].length;n++){const i=[];for(let t=0;t<e.length;t++)i.push(e[t][n]);t.push(i)}return t})(t));if(e.type===Al)return e}return i})(e);return t.type===Al?{spreadsheet:t.spreadsheet}:null},ql=async e=>{const t=await(async e=>{try{var t;return(e?null===(t=e.clipboardData)||void 0===t?void 0:t.getData("text/plain").trim():Gl&&await navigator.clipboard.readText())||""}catch{return""}})(e);if(!t||t.includes(jl))return Zl();const n=Xl(t);if(n)return n;const i=Zl();try{const e=JSON.parse(t);return s=e,[d.t.excalidraw,d.t.excalidrawClipboard].includes(null===s||void 0===s?void 0:s.type)&&Array.isArray(s.elements)?{elements:e.elements,files:e.files}:i}catch{return Vl&&i.elements?i:{text:t}}var s},Jl=async e=>{let t=!1;if(Wl)try{await navigator.clipboard.writeText(e||""),t=!0}catch(n){console.error(n)}if(!t&&!Ql(e||" "))throw new Error("couldn't copy")},Ql=e=>{const t="rtl"===document.documentElement.getAttribute("dir"),n=document.createElement("textarea");n.style.border="0",n.style.padding="0",n.style.margin="0",n.style.position="absolute",n.style[t?"right":"left"]="-9999px";const i=window.pageYOffset||document.documentElement.scrollTop;n.style.top="".concat(i,"px"),n.style.fontSize="12pt",n.setAttribute("readonly",""),n.value=e,document.body.appendChild(n);let s=!1;try{n.select(),n.setSelectionRange(0,n.value.length),s=document.execCommand("copy")}catch(r){console.error(r)}return n.remove(),s},$l=async(e,t,i,s,r)=>{let{exportBackground:o,exportPadding:a=d.f,viewBackgroundColor:l,name:c,fileHandle:h=null}=r;if(0===t.length)throw new Error(w("alerts.cannotExportEmptyCanvas"));if("svg"===e||"clipboard-svg"===e){const n=await El(t,{exportBackground:o,exportWithDarkMode:i.exportWithDarkMode,viewBackgroundColor:l,exportPadding:a,exportScale:i.exportScale,exportEmbedScene:i.exportEmbedScene&&"svg"===e},s);if("svg"===e)return await Qa(new Blob([n.outerHTML],{type:d.D.svg}),{description:"Export to SVG",name:c,extension:"svg",fileHandle:h});if("clipboard-svg"===e)return void await Jl(n.outerHTML)}const u=await Sl(t,i,s,{exportBackground:o,viewBackgroundColor:l,exportPadding:a});u.style.display="none",document.body.appendChild(u);let m=await hl(u);if(u.remove(),"png"===e)return i.exportEmbedScene&&(m=await(await Promise.all([n.e(1),n.e(46)]).then(n.bind(null,222))).encodePngMetadata({blob:m,metadata:bl(t,i,s,"local")})),await Qa(m,{description:"Export to PNG",name:c,extension:"png",fileHandle:h});if("clipboard"===e)try{await(async e=>{await navigator.clipboard.write([new window.ClipboardItem({[d.D.png]:e})])})(m)}catch(p){if("CANVAS_POSSIBLY_TOO_BIG"===p.name)throw p;throw new Error(w("alerts.couldNotCopyToClipboard"))}};n(68);const ec=e=>{let{children:t,checked:n,onChange:i,className:s}=e;return Object(kr.jsxs)("div",{className:Object(lt.a)("Checkbox",s,{"is-checked":n}),onClick:e=>{i(!n,e),e.currentTarget.querySelector(".Checkbox-box").focus()},children:[Object(kr.jsx)("button",{className:"Checkbox-box",role:"checkbox","aria-checked":n,children:Pr}),Object(kr.jsx)("div",{className:"Checkbox-label",children:t})]})};n(69);var tc=e=>{let{children:t,gap:n,align:i,justifyContent:s,className:r,style:o}=e;return Object(kr.jsx)("div",{className:Object(lt.a)("Stack Stack_horizontal",r),style:{"--gap":n,alignItems:i,justifyContent:s,...o},children:t})},nc=e=>{let{children:t,gap:n,align:i,justifyContent:s,className:r}=e;return Object(kr.jsx)("div",{className:Object(lt.a)("Stack Stack_vertical",r),style:{"--gap":n,justifyItems:i,justifyContent:s},children:t})};n(70);const ic=e=>{let{fileName:t,onSave:n}=e;return Object(kr.jsxs)(tc,{className:"ActiveFile",gap:1,align:"center",children:[Object(kr.jsxs)("span",{className:"ActiveFile__fileName",children:[wo,Object(kr.jsx)("span",{children:t})]}),Object(kr.jsx)(Mr,{type:"icon",icon:Nr,title:w("buttons.save"),"aria-label":w("buttons.save"),onClick:n,"data-testid":"save-button"})]})},sc=($o({name:"changeProjectName",perform:(e,t,n)=>(Object(l.a)("change","title"),{appState:{...t,name:n},commitToHistory:!1}),PanelComponent:e=>{let{appState:t,updateData:n,appProps:i}=e;return Object(kr.jsx)(Ra,{label:w("labels.fileTitle"),value:t.name||"Unnamed",onChange:e=>n(e),isNameEditable:"undefined"===typeof i.name&&!t.viewModeEnabled})}}),$o({name:"changeExportScale",perform:(e,t,n)=>({appState:{...t,exportScale:n},commitToHistory:!1}),PanelComponent:e=>{let{elements:t,appState:n,updateData:i}=e;const s=ir(t),r=dr(s,n)?hr(s,n):s;return Object(kr.jsx)(kr.Fragment,{children:d.u.map((e=>{const[t,s]=((e,t,n)=>{const[,,i,s]=Ol(e,t).map((e=>Math.trunc(e*n)));return[i,s]})(r,d.f,e),o="".concat(w("buttons.scale")," ").concat(e,"x (").concat(t,"x").concat(s,")");return Object(kr.jsx)(Mr,{size:"small",type:"radio",icon:"".concat(e,"x"),name:"export-canvas-scale",title:o,"aria-label":o,id:"export-canvas-scale",checked:e===n.exportScale,onChange:()=>i(e)},e)}))})}}),$o({name:"changeExportBackground",perform:(e,t,n)=>({appState:{...t,exportBackground:n},commitToHistory:!1}),PanelComponent:e=>{let{appState:t,updateData:n}=e;return Object(kr.jsx)(ec,{checked:t.exportBackground,onChange:e=>n(e),children:w("labels.withBackground")})}}),$o({name:"changeExportEmbedScene",perform:(e,t,n)=>({appState:{...t,exportEmbedScene:n},commitToHistory:!1}),PanelComponent:e=>{let{appState:t,updateData:n}=e;return Object(kr.jsxs)(ec,{checked:t.exportEmbedScene,onChange:e=>n(e),children:[w("labels.exportEmbedScene"),Object(kr.jsx)(La,{label:w("labels.exportEmbedScene_details"),long:!0,children:Object(kr.jsx)("div",{className:"excalidraw-tooltip-icon",children:Jr})})]})}}),$o({name:"saveToActiveFile",perform:async(e,t,n,i)=>{const s=!!t.fileHandle;try{const{fileHandle:n}=ll(t.fileHandle)?await(async(e,t,n)=>{const{exportBackground:i,viewBackgroundColor:s,name:r,fileHandle:o}=t,a=al(o);if(!o||"png"!==(l=a)&&"svg"!==l)throw new Error("fileHandle should exist and should be of type svg or png when resaving");var l;return t={...t,exportEmbedScene:!0},await $l(a,ir(e),t,n,{exportBackground:i,viewBackgroundColor:s,name:r,fileHandle:o}),{fileHandle:o}})(e,t,i.files):await fl(e,t,i.files);return{commitToHistory:!1,appState:{...t,fileHandle:n,toastMessage:s?(null===n||void 0===n?void 0:n.name)?w("toast.fileSavedToFilename").replace("{filename}",'"'.concat(n.name,'"')):w("toast.fileSaved"):null}}}catch(r){return"AbortError"!==(null===r||void 0===r?void 0:r.name)?console.error(r):console.warn(r),{commitToHistory:!1}}},keyTest:e=>e.key===ge&&e[$]&&!e.shiftKey,PanelComponent:e=>{var t;let{updateData:n,appState:i}=e;return Object(kr.jsx)(ic,{onSave:()=>n(null),fileName:null===(t=i.fileHandle)||void 0===t?void 0:t.name})}}),$o({name:"saveFileToDisk",perform:async(e,t,n,i)=>{try{const{fileHandle:n}=await fl(e,{...t,fileHandle:null},i.files);return{commitToHistory:!1,appState:{...t,fileHandle:n}}}catch(s){return"AbortError"!==(null===s||void 0===s?void 0:s.name)?console.error(s):console.warn(s),{commitToHistory:!1}}},keyTest:e=>e.key===ge&&e.shiftKey&&e[$],PanelComponent:e=>{let{updateData:t}=e;return Object(kr.jsx)(Mr,{type:"button",icon:Rr,title:w("buttons.saveAs"),"aria-label":w("buttons.saveAs"),showAriaLabel:qd(),hidden:!qa.c,onClick:()=>t(null),"data-testid":"save-as-button"})}}));$o({name:"loadScene",perform:async(e,t,n,i)=>{try{const{elements:n,appState:i,files:s}=await(async(e,t)=>{const n=await Ja({description:"Excalidraw files"});return dl(n,e,t)})(t,e);return{elements:n,appState:i,files:s,commitToHistory:!0}}catch(s){return"AbortError"===(null===s||void 0===s?void 0:s.name)?(console.warn(s),!1):{elements:e,appState:{...t,errorMessage:s.message},files:i.files,commitToHistory:!1}}},keyTest:e=>e[$]&&e.key===he,PanelComponent:e=>{let{updateData:t,appState:n}=e;return Object(kr.jsx)(Mr,{type:"button",icon:Br,title:w("buttons.load"),"aria-label":w("buttons.load"),showAriaLabel:qd(),onClick:t,"data-testid":"load-button"})}}),$o({name:"exportWithDarkMode",perform:(e,t,n)=>({appState:{...t,exportWithDarkMode:n},commitToHistory:!1}),PanelComponent:e=>{let{appState:t,updateData:n}=e;return Object(kr.jsx)("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:"-45px",marginBottom:"10px"},children:Object(kr.jsx)(Ma,{value:t.exportWithDarkMode?d.P.DARK:d.P.LIGHT,onChange:e=>{n(e===d.P.DARK)},title:w("labels.toggleExportColorScheme")})})}});let rc="{}";const oc=$o({name:"copyStyles",perform:(e,t)=>{const n=e.find((e=>t.selectedElementIds[e.id]));return n&&(rc=JSON.stringify(n)),{appState:{...t,toastMessage:w("toast.copyStyles")},commitToHistory:!1}},contextItemLabel:"labels.copyStyles",keyTest:e=>e[$]&&e.altKey&&e.code===B}),ac=$o({name:"pasteStyles",perform:(e,t)=>{const n=JSON.parse(rc);return"text"!==(null===(i=n)||void 0===i?void 0:i.type)&&"diamond"!==(null===i||void 0===i?void 0:i.type)&&"rectangle"!==(null===i||void 0===i?void 0:i.type)&&"ellipse"!==(null===i||void 0===i?void 0:i.type)&&"arrow"!==(null===i||void 0===i?void 0:i.type)&&"freedraw"!==(null===i||void 0===i?void 0:i.type)&&"line"!==(null===i||void 0===i?void 0:i.type)?{elements:e,commitToHistory:!1}:{elements:e.map((e=>{if(t.selectedElementIds[e.id]){const t=kn(e,{backgroundColor:null===n||void 0===n?void 0:n.backgroundColor,strokeWidth:null===n||void 0===n?void 0:n.strokeWidth,strokeColor:null===n||void 0===n?void 0:n.strokeColor,strokeStyle:null===n||void 0===n?void 0:n.strokeStyle,fillStyle:null===n||void 0===n?void 0:n.fillStyle,opacity:null===n||void 0===n?void 0:n.opacity,roughness:null===n||void 0===n?void 0:n.roughness});return pt(t)&&(Cn(t,{fontSize:(null===n||void 0===n?void 0:n.fontSize)||d.h,fontFamily:(null===n||void 0===n?void 0:n.fontFamily)||d.g,textAlign:(null===n||void 0===n?void 0:n.textAlign)||d.j}),er(t)),t}return e})),commitToHistory:!0};var i},contextItemLabel:"labels.pasteStyles",keyTest:e=>e[$]&&e.altKey&&e.code===V}),lc=e=>Object(kr.jsx)("button",{className:"help-icon",onClick:e.onClick,type:"button",title:"".concat(e.title," \u2014 ?"),"aria-label":e.title,children:Jr}),cc=($o({name:"toggleCanvasMenu",perform:(e,t)=>({appState:{...t,openMenu:"canvas"===t.openMenu?null:"canvas"},commitToHistory:!1}),PanelComponent:e=>{let{appState:t,updateData:n}=e;return Object(kr.jsx)(Mr,{type:"button",icon:Zr,"aria-label":w("buttons.menu"),onClick:n,selected:"canvas"===t.openMenu})}}),$o({name:"toggleEditMenu",perform:(e,t)=>({appState:{...t,openMenu:"shape"===t.openMenu?null:"shape"},commitToHistory:!1}),PanelComponent:e=>{let{elements:t,appState:n,updateData:i}=e;return Object(kr.jsx)(Mr,{visible:tr(n,ir(t)),type:"button",icon:Fr,"aria-label":w("buttons.edit"),onClick:i,selected:"shape"===n.openMenu})}}),$o({name:"toggleFullScreen",perform:()=>(Re()||document.documentElement.requestFullscreen(),Re()&&document.exitFullscreen(),{commitToHistory:!1}),keyTest:e=>e.code===F&&!e[$]}),$o({name:"toggleShortcuts",perform:(e,t,n,i)=>{let{focusContainer:s}=i;return t.showHelpDialog&&s(),{appState:{...t,showHelpDialog:!t.showHelpDialog},commitToHistory:!1}},PanelComponent:e=>{let{updateData:t}=e;return Object(kr.jsx)(lc,{title:w("helpDialog.title"),onClick:t})},keyTest:e=>e.key===ie}),(e,t)=>{const n=hr(ir(e),t);return n.length>=2&&!(e=>{if(e.length>=2){const t=e[0].groupIds;for(const n of t)if(e.reduce(((e,t)=>e&&Rn(t,n)),!0))return!0}return!1})(n)}),dc=$o({name:"group",perform:(e,t)=>{const n=hr(ir(e),t);if(n.length<2)return{appState:t,elements:e,commitToHistory:!1};const i=zn(t);if(1===i.length){const s=i[0],r=new Set(Bn(e,s).map((e=>e.id))),o=new Set(n.map((e=>e.id)));if(new Set([...Array.from(r),...Array.from(o)]).size===r.size)return{appState:t,elements:e,commitToHistory:!1}}const s=On(),r=e.map((e=>t.selectedElementIds[e.id]?kn(e,{groupIds:Hn(e.groupIds,s,t.editingGroupId)}):e)),o=Bn(r,s),a=o[o.length-1],l=r.lastIndexOf(a),c=r.slice(l+1),d=[...r.slice(0,l).filter((e=>!Rn(e,s))),...o,...c];return{appState:Ln(s,{...t,selectedGroupIds:{}},ir(d)),elements:d,commitToHistory:!0}},contextItemLabel:"labels.group",contextItemPredicate:(e,t)=>cc(e,t),keyTest:e=>!e.shiftKey&&e[$]&&e.code===_,PanelComponent:e=>{let{elements:t,appState:n,updateData:i}=e;return Object(kr.jsx)(Mr,{hidden:!cc(t,n),type:"button",icon:Object(kr.jsx)(jo,{theme:n.theme}),onClick:()=>i(null),title:"".concat(w("labels.group")," \u2014 ").concat(Be("CtrlOrCmd+G")),"aria-label":w("labels.group"),visible:dr(ir(t),n)})}}),hc=$o({name:"ungroup",perform:(e,t)=>{if(0===zn(t).length)return{appState:t,elements:e,commitToHistory:!1};const n=e.map((e=>{const n=((e,t)=>e.filter((e=>!t[e])))(e.groupIds,t.selectedGroupIds);return n.length===e.groupIds.length?e:kn(e,{groupIds:n})}));return{appState:Nn({...t,selectedGroupIds:{}},ir(n)),elements:n,commitToHistory:!0}},keyTest:e=>e.shiftKey&&e[$]&&e.code===_,contextItemLabel:"labels.ungroup",contextItemPredicate:(e,t)=>zn(t).length>0,PanelComponent:e=>{let{elements:t,appState:n,updateData:i}=e;return Object(kr.jsx)(Mr,{type:"button",hidden:0===zn(n).length,icon:Object(kr.jsx)(So,{theme:n.theme}),onClick:()=>i(null),title:"".concat(w("labels.ungroup")," \u2014 ").concat(Be("CtrlOrCmd+Shift+G")),"aria-label":w("labels.ungroup"),visible:dr(ir(t),n)})}});n(71);const uc=e=>{let{children:t,color:n,border:i,onClick:s}=e;return Object(kr.jsx)("div",{className:"Avatar",style:{background:n,border:"1px solid ".concat(i)},onClick:s,children:t})},mc=($o({name:"goToCollaborator",perform:(e,t,n)=>{const i=n;return i?{appState:{...t,...mr({scenePoint:i,viewportDimensions:{width:t.width,height:t.height},zoom:t.zoom}),openMenu:"canvas"===t.openMenu?null:t.openMenu},commitToHistory:!1}:{appState:t,commitToHistory:!1}},PanelComponent:e=>{let{appState:t,updateData:n,data:i}=e;const s=null===i||void 0===i?void 0:i.id;if(!s)return null;const r=t.collaborators.get(s);if(!r)return null;const{background:o,stroke:a}=Ba(s,t),l=(e=>{if(!e)return"?";const t=e.trim().split(" ");if(t.length<2)return t[0].substring(0,2).toUpperCase();const n=t[0],i=t[t.length-1];return(n[0]+i[0]).toUpperCase()})(r.username);return Object(kr.jsx)(uc,{color:o,border:a,onClick:()=>n(r.pointer),children:l})}}),$o({name:"addToLibrary",perform:(e,t,n,i)=>e.some((e=>"image"===e.type))?{commitToHistory:!1,appState:{...t,errorMessage:"Support for adding images to the library coming soon!"}}:i.library.loadLibrary().then((n=>i.library.saveLibrary([{id:On(),status:"unpublished",elements:hr(ir(e),t).map(Yn),created:Date.now()},...n]))).then((()=>({commitToHistory:!1,appState:{...t,toastMessage:w("toast.addedToLibrary")}}))).catch((e=>({commitToHistory:!1,appState:{...t,errorMessage:e.message}}))),contextItemLabel:"labels.addToLibrary"})),pc=e=>{const t=new Map;return e.forEach((e=>{const n=0===e.groupIds.length?e.id:e.groupIds[e.groupIds.length-1],i=t.get(n)||[];t.set(n,[...i,e])})),Array.from(t.values())},gc=(e,t,n)=>{let{axis:i,position:s}=n;const r=Gt(e),[o,a]="x"===i?["minX","maxX"]:["minY","maxY"],l={x:0,y:0};return"start"===s?{...l,[i]:t[o]-r[o]}:"end"===s?{...l,[i]:t[a]-r[a]}:{...l,[i]:(t[o]+t[a])/2-(r[o]+r[a])/2}},bc=(e,t)=>hr(ir(e),t).length>1,fc=(e,t,n)=>{const i=((e,t)=>{const n=pc(e),i=Gt(e);return n.flatMap((e=>{const n=gc(e,i,t);return e.map((e=>kn(e,{x:e.x+n.x,y:e.y+n.y})))}))})(hr(ir(e),t),n),s=et(i);return e.map((e=>s.get(e.id)||e))},vc=($o({name:"alignTop",perform:(e,t)=>({appState:t,elements:fc(e,t,{position:"start",axis:"y"}),commitToHistory:!0}),keyTest:e=>e[$]&&e.shiftKey&&e.key===q,PanelComponent:e=>{let{elements:t,appState:n,updateData:i}=e;return Object(kr.jsx)(Mr,{hidden:!bc(t,n),type:"button",icon:Object(kr.jsx)(ro,{theme:n.theme}),onClick:()=>i(null),title:"".concat(w("labels.alignTop")," \u2014 ").concat(Be("CtrlOrCmd+Shift+Up")),"aria-label":w("labels.alignTop"),visible:dr(ir(t),n)})}}),$o({name:"alignBottom",perform:(e,t)=>({appState:t,elements:fc(e,t,{position:"end",axis:"y"}),commitToHistory:!0}),keyTest:e=>e[$]&&e.shiftKey&&e.key===Y,PanelComponent:e=>{let{elements:t,appState:n,updateData:i}=e;return Object(kr.jsx)(Mr,{hidden:!bc(t,n),type:"button",icon:Object(kr.jsx)(oo,{theme:n.theme}),onClick:()=>i(null),title:"".concat(w("labels.alignBottom")," \u2014 ").concat(Be("CtrlOrCmd+Shift+Down")),"aria-label":w("labels.alignBottom"),visible:dr(ir(t),n)})}}),$o({name:"alignLeft",perform:(e,t)=>({appState:t,elements:fc(e,t,{position:"start",axis:"x"}),commitToHistory:!0}),keyTest:e=>e[$]&&e.shiftKey&&e.key===Z,PanelComponent:e=>{let{elements:t,appState:n,updateData:i}=e;return Object(kr.jsx)(Mr,{hidden:!bc(t,n),type:"button",icon:Object(kr.jsx)(ao,{theme:n.theme}),onClick:()=>i(null),title:"".concat(w("labels.alignLeft")," \u2014 ").concat(Be("CtrlOrCmd+Shift+Left")),"aria-label":w("labels.alignLeft"),visible:dr(ir(t),n)})}}),$o({name:"alignRight",perform:(e,t)=>({appState:t,elements:fc(e,t,{position:"end",axis:"x"}),commitToHistory:!0}),keyTest:e=>e[$]&&e.shiftKey&&e.key===X,PanelComponent:e=>{let{elements:t,appState:n,updateData:i}=e;return Object(kr.jsx)(Mr,{hidden:!bc(t,n),type:"button",icon:Object(kr.jsx)(lo,{theme:n.theme}),onClick:()=>i(null),title:"".concat(w("labels.alignRight")," \u2014 ").concat(Be("CtrlOrCmd+Shift+Right")),"aria-label":w("labels.alignRight"),visible:dr(ir(t),n)})}}),$o({name:"alignVerticallyCentered",perform:(e,t)=>({appState:t,elements:fc(e,t,{position:"center",axis:"y"}),commitToHistory:!0}),PanelComponent:e=>{let{elements:t,appState:n,updateData:i}=e;return Object(kr.jsx)(Mr,{hidden:!bc(t,n),type:"button",icon:Object(kr.jsx)(uo,{theme:n.theme}),onClick:()=>i(null),title:w("labels.centerVertically"),"aria-label":w("labels.centerVertically"),visible:dr(ir(t),n)})}}),$o({name:"alignHorizontallyCentered",perform:(e,t)=>({appState:t,elements:fc(e,t,{position:"center",axis:"x"}),commitToHistory:!0}),PanelComponent:e=>{let{elements:t,appState:n,updateData:i}=e;return Object(kr.jsx)(Mr,{hidden:!bc(t,n),type:"button",icon:Object(kr.jsx)(mo,{theme:n.theme}),onClick:()=>i(null),title:w("labels.centerHorizontally"),"aria-label":w("labels.centerHorizontally"),visible:dr(ir(t),n)})}}),e=>{const t=new Map;return e.forEach((e=>{const n=0===e.groupIds.length?e.id:e.groupIds[e.groupIds.length-1],i=t.get(n)||[];t.set(n,[...i,e])})),Array.from(t.values())}),yc=e=>{const[t,n,i,s]=Ft(e);return{minX:t,minY:n,maxX:i,maxY:s,width:i-t,height:s-n,midX:(t+i)/2,midY:(n+s)/2}},xc=(e,t)=>hr(ir(e),t).length>1,wc=(e,t,n)=>{const i=((e,t)=>{const[n,i,s,r]="x"===t.axis?["minX","midX","maxX","width"]:["minY","midY","maxY","height"],o=yc(e),a=vc(e).map((e=>[e,yc(e)])).sort(((e,t)=>e[1][i]-t[1][i]));let l=0;for(const h of a)l+=h[1][r];const c=(o[r]-l)/(a.length-1);if(c<0){const e=a.findIndex((e=>e[1][n]===o[n])),r=a.findIndex((e=>e[1][s]===o[s])),l=(a[r][1][i]-a[e][1][i])/(a.length-1);let c=a[e][1][i];return a.flatMap(((n,s)=>{let[o,a]=n;const d={x:0,y:0};return s!==e&&s!==r&&(c+=l,d[t.axis]=c-a[i]),o.map((e=>kn(e,{x:e.x+d.x,y:e.y+d.y})))}))}let d=o[n];return a.flatMap((e=>{let[i,s]=e;const o={x:0,y:0};return o[t.axis]=d-s[n],d+=c,d+=s[r],i.map((e=>kn(e,{x:e.x+o.x,y:e.y+o.y})))}))})(hr(ir(e),t),n),s=et(i);return e.map((e=>s.get(e.id)||e))},jc=($o({name:"distributeHorizontally",perform:(e,t)=>({appState:t,elements:wc(e,t,{space:"between",axis:"x"}),commitToHistory:!0}),keyTest:e=>e.altKey&&e.code===U,PanelComponent:e=>{let{elements:t,appState:n,updateData:i}=e;return Object(kr.jsx)(Mr,{hidden:!xc(t,n),type:"button",icon:Object(kr.jsx)(co,{theme:n.theme}),onClick:()=>i(null),title:"".concat(w("labels.distributeHorizontally")," \u2014 ").concat(Be("Alt+H")),"aria-label":w("labels.distributeHorizontally"),visible:dr(ir(t),n)})}}),$o({name:"distributeVertically",perform:(e,t)=>({appState:t,elements:wc(e,t,{space:"between",axis:"y"}),commitToHistory:!0}),keyTest:e=>e.altKey&&e.code===V,PanelComponent:e=>{let{elements:t,appState:n,updateData:i}=e;return Object(kr.jsx)(Mr,{hidden:!xc(t,n),type:"button",icon:Object(kr.jsx)(ho,{theme:n.theme}),onClick:()=>i(null),title:"".concat(w("labels.distributeVertically")," \u2014 ").concat(Be("Alt+V")),"aria-label":w("labels.distributeVertically"),visible:dr(ir(t),n)})}}),$o({name:"flipHorizontal",perform:(e,t)=>({elements:Ec(e,t,"horizontal"),appState:t,commitToHistory:!0}),keyTest:e=>e.shiftKey&&"KeyH"===e.code,contextItemLabel:"labels.flipHorizontal",contextItemPredicate:(e,t)=>((e,t)=>{const n=hr(ir(e),t);return 1===n.length&&"text"!==n[0].type})(e,t)})),Sc=$o({name:"flipVertical",perform:(e,t)=>({elements:Ec(e,t,"vertical"),appState:t,commitToHistory:!0}),keyTest:e=>e.shiftKey&&"KeyV"===e.code,contextItemLabel:"labels.flipVertical",contextItemPredicate:(e,t)=>((e,t)=>1===hr(ir(e),t).length)(e,t)}),Ec=(e,t,n)=>{const i=hr(ir(e),t);if(i.length>1)return e;const s=Oc(i,t,n),r=et(s);return e.map((e=>r.get(e.id)||e))},Oc=(e,t,n)=>(e.forEach((e=>{Cc(e,t),"vertical"===n&&kc(e,Math.PI)})),e),Cc=(e,t)=>{const n=e.x,i=e.y,s=e.width,r=e.height,o=Us(e.angle);let a=0;(ft(e)||gt(e))&&(a=2*e.points.reduce(((e,t)=>Math.max(e,t[0])),0)-e.width),Cn(e,{angle:Us(0)});const l=ni(e,t.zoom);let c=!0,d=0,h=l.nw;if(!h&&(c=!1,h=l.ne,!h))return void Cn(e,{angle:o});if(ft(e)){for(let t=1;t<e.points.length;t++)ps.movePoint(e,t,[-e.points[t][0],e.points[t][1]]);ps.normalizePoints(e)}else d=c?e.x+2*s:e.x-2*s,Zs(e,!0,e,c?"nw":"ne",!1,d,h[1]),Cn(e,{width:s,height:r});let u=Us(2*Math.PI-o);u<0&&(u=Us(u+2*Math.PI)),Cn(e,{angle:u}),Cn(e,{x:n+a,y:i}),Is(e)},kc=(e,t)=>{const n=e.x,i=e.y;let s=Us(e.angle+t);s<0&&(s=Us(2*Math.PI+s)),Cn(e,{angle:s}),Cn(e,{x:n,y:i})},Ic=$o({name:"copy",perform:(e,t,n,i)=>(Yl(ir(e),t,i.files),{commitToHistory:!1}),contextItemLabel:"labels.copy",keyTest:void 0}),Mc=$o({name:"cut",perform:(e,t,n,i)=>(Ic.perform(e,t,n,i),ta.perform(e,t,n,i)),contextItemLabel:"labels.cut",keyTest:e=>e[$]&&e.code===G}),Ac=$o({name:"copyAsSvg",perform:async(e,t,n,i)=>{if(!i.canvas)return{commitToHistory:!1};const s=hr(ir(e),t);try{return await $l("clipboard-svg",s.length?s:ir(e),t,i.files,t),{commitToHistory:!1}}catch(r){return console.error(r),{appState:{...t,errorMessage:r.message},commitToHistory:!1}}},contextItemLabel:"labels.copyAsSvg"}),Tc=$o({name:"copyAsPng",perform:async(e,t,n,i)=>{if(!i.canvas)return{commitToHistory:!1};const s=hr(ir(e),t);try{return await $l("clipboard",s.length?s:ir(e),t,i.files,t),{appState:{...t,toastMessage:w("toast.copyToClipboardAsPng",{exportSelection:s.length?w("toast.selection"):w("toast.canvas"),exportColorScheme:t.exportWithDarkMode?w("buttons.darkMode"):w("buttons.lightMode")})},commitToHistory:!1}}catch(r){return console.error(r),{appState:{...t,errorMessage:r.message},commitToHistory:!1}}},contextItemLabel:"labels.copyAsPng",keyTest:e=>e.code===B&&e.altKey&&e.shiftKey}),Lc=$o({name:"gridMode",perform(e,t){return Object(l.a)("view","mode","grid"),{appState:{...t,gridSize:this.checked(t)?null:d.x},commitToHistory:!1}},checked:e=>null!==e.gridSize,contextItemLabel:"labels.showGrid",keyTest:e=>e[$]&&e.code===z}),Dc=$o({name:"zenMode",perform(e,t){return Object(l.a)("view","mode","zen"),{appState:{...t,zenModeEnabled:!this.checked(t)},commitToHistory:!1}},checked:e=>e.zenModeEnabled,contextItemLabel:"buttons.zenMode",keyTest:e=>!e[$]&&e.altKey&&e.code===W}),Pc=$o({name:"stats",perform(e,t){return{appState:{...t,showStats:!this.checked(t)},commitToHistory:!1}},checked:e=>e.showStats,contextItemLabel:"stats.title",keyTest:e=>!e[$]&&e.altKey&&e.code===R}),zc=(e,t,n)=>{const i=!1;if(!t.multiElement&&!t.resizingElement&&!t.editingElement&&!t.draggingElement){const s=n();if(null===s)return{commitToHistory:i};const r=et(e),o=s.elements,a=et(o),l=e.filter((e=>!a.has(e.id))),c=o.map((e=>kn(r.get(e.id)||e,e))).concat(l.map((e=>kn(e,{isDeleted:!0}))));return _s(c,l),{elements:c,appState:{...t,...s.appState},commitToHistory:i,syncHistory:!0}}return{commitToHistory:i}};class Nc{constructor(e,t,n,i){this.actions={},this.updater=void 0,this.getAppState=void 0,this.getElementsIncludingDeleted=void 0,this.app=void 0,this.renderAction=(e,t)=>{const n=this.app.props.UIOptions.canvasActions;if(this.actions[e]&&"PanelComponent"in this.actions[e]&&(!(e in n)||n[e])){const n=this.actions[e],i=n.PanelComponent,s=e=>{this.updater(n.perform(this.getElementsIncludingDeleted(),this.getAppState(),e,this.app))};return Object(kr.jsx)(i,{elements:this.getElementsIncludingDeleted(),appState:this.getAppState(),updateData:s,appProps:this.app.props,data:t})}return null},this.updater=t=>{if(!t||!("then"in t))return e(t);t.then((t=>e(t)))},this.getAppState=t,this.getElementsIncludingDeleted=n,this.app=i}registerAction(e){this.actions[e.name]=e}registerAll(e){e.forEach((e=>this.registerAction(e)))}handleKeyDown(e){const t=this.app.props.UIOptions.canvasActions,n=Object.values(this.actions).sort(((e,t)=>(t.keyPriority||0)-(e.keyPriority||0))).filter((n=>(!(n.name in t)||t[n.name])&&n.keyTest&&n.keyTest(e,this.getAppState(),this.getElementsIncludingDeleted())));if(0===n.length)return!1;const{viewModeEnabled:i}=this.getAppState();return!(i&&!Object.values(d.E).includes(n[0].name))&&(e.preventDefault(),this.updater(n[0].perform(this.getElementsIncludingDeleted(),this.getAppState(),null,this.app)),!0)}executeAction(e){this.updater(e.perform(this.getElementsIncludingDeleted(),this.getAppState(),null,this.app))}}var Rc=class{constructor(e){this.libraryCache=null,this.app=void 0,this.resetLibrary=async()=>{var e,t;await(null===(e=(t=this.app.props).onLibraryChange)||void 0===e?void 0:e.call(t,[])),this.libraryCache=[]},this.restoreLibraryItem=e=>{const t=ir(nl(e.elements,null));return t.length?{...e,elements:t}:null},this.loadLibrary=()=>new Promise((async e=>{if(this.libraryCache)return e(JSON.parse(JSON.stringify(this.libraryCache)));try{const t=this.app.libraryItemsFromStorage;if(!t)return e([]);const n=t.reduce(((e,t)=>(this.restoreLibraryItem(t)&&e.push(t),e)),[]);this.libraryCache=JSON.parse(JSON.stringify(n)),e(n)}catch(t){console.error(t),e([])}})),this.saveLibrary=async e=>{const t=this.libraryCache;try{var n,i;const t=JSON.stringify(e);this.libraryCache=JSON.parse(t),await(null===(n=(i=this.app.props).onLibraryChange)||void 0===n?void 0:n.call(i,e))}catch(s){throw this.libraryCache=t,s}},this.app=e}async importLibrary(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"unpublished";const n=await(async e=>{const t=await ol(e),n=JSON.parse(t);if(n.type!==d.t.excalidrawLibrary)throw new Error(w("alerts.couldNotLoadInvalidFile"));return n})(e);if(!n||!n.libraryItems&&!n.library)return;const i=(e,t)=>!e.find((e=>e.elements.length===t.elements.length&&e.elements.every(((e,n)=>e.id===t.elements[n].id&&e.versionNonce===t.elements[n].versionNonce)))),s=await this.loadLibrary(),r=n.libraryItems||n.library||[],o=rl(r,t),a=[];for(const l of o){const e=this.restoreLibraryItem(l);e&&i(s,e)&&a.push(e)}await this.saveLibrary([...a,...s])}};const Bc=e=>{const t=Array.from(e.values());return{x:_c(t,(e=>e.x))/t.length,y:_c(t,(e=>e.y))/t.length}},Hc=e=>{let[t,n]=e;return Math.hypot(t.x-n.x,t.y-n.y)},_c=(e,t)=>e.reduce(((e,n)=>e+t(n)),0),Fc=e=>({selectedElementIds:e.selectedElementIds,selectedGroupIds:e.selectedGroupIds,viewBackgroundColor:e.viewBackgroundColor,editingLinearElement:e.editingLinearElement,editingGroupId:e.editingGroupId,name:e.name});var Uc=class{constructor(){this.elementCache=new Map,this.recording=!0,this.stateHistory=[],this.redoStack=[],this.lastEntry=null,this.generateEntry=(e,t)=>this.dehydrateHistoryEntry({appState:Fc(e),elements:t.reduce(((t,n)=>{if(ft(n)&&e.multiElement&&e.multiElement.id===n.id){if(e.multiElement&&e.multiElement.id===n.id&&n.points.length<2)return t;t.push({...n,points:n.lastCommittedPoint!==n.points[n.points.length-1]?n.points.slice(0,-1):n.points})}else t.push(n);return t}),[])})}hydrateHistoryEntry(e){let{appState:t,elements:n}=e;return{appState:JSON.parse(t),elements:n.map((e=>{var t;const n=null===(t=this.elementCache.get(e.id))||void 0===t?void 0:t.get(e.versionNonce);if(!n)throw new Error("Element not found: ".concat(e.id,":").concat(e.versionNonce));return n}))}}dehydrateHistoryEntry(e){let{appState:t,elements:n}=e;return{appState:JSON.stringify(t),elements:n.map((e=>{this.elementCache.has(e.id)||this.elementCache.set(e.id,new Map);const t=this.elementCache.get(e.id);return t.has(e.versionNonce)||t.set(e.versionNonce,Yn(e)),{id:e.id,versionNonce:e.versionNonce}}))}}getSnapshotForTest(){return{recording:this.recording,stateHistory:this.stateHistory.map((e=>this.hydrateHistoryEntry(e))),redoStack:this.redoStack.map((e=>this.hydrateHistoryEntry(e)))}}clear(){this.stateHistory.length=0,this.redoStack.length=0,this.lastEntry=null,this.elementCache.clear()}shouldCreateEntry(e){const{lastEntry:t}=this;if(!t)return!0;if(e.elements.length!==t.elements.length)return!0;for(let r=e.elements.length-1;r>-1;r--){const n=e.elements[r],i=t.elements[r];if(!n||!i||n.id!==i.id||n.versionNonce!==i.versionNonce)return!0}let n;for(n in e.appState){var i,s;if("editingLinearElement"===n)if((null===(i=e.appState[n])||void 0===i?void 0:i.elementId)===(null===(s=t.appState[n])||void 0===s?void 0:s.elementId))continue;if("selectedElementIds"!==n&&"selectedGroupIds"!==n&&e.appState[n]!==t.appState[n])return!0}return!1}pushEntry(e,t){const n=this.generateEntry(e,t),i=this.hydrateHistoryEntry(n);if(i){if(!this.shouldCreateEntry(i))return;this.stateHistory.push(n),this.lastEntry=i,this.clearRedoStack()}}clearRedoStack(){this.redoStack.splice(0,this.redoStack.length)}redoOnce(){if(0===this.redoStack.length)return null;const e=this.redoStack.pop();return void 0!==e?(this.stateHistory.push(e),this.hydrateHistoryEntry(e)):null}undoOnce(){if(1===this.stateHistory.length)return null;const e=this.stateHistory.pop(),t=this.stateHistory[this.stateHistory.length-1];return void 0!==e?(this.redoStack.push(e),this.hydrateHistoryEntry(t)):null}setCurrentState(e,t){this.lastEntry=this.hydrateHistoryEntry(this.generateEntry(e,t))}resumeRecording(){this.recording=!0}record(e,t){this.recording&&(this.pushEntry(e,t),this.recording=!1)}};const Vc=[{icon:Object(kr.jsx)("svg",{viewBox:"0 0 320 512",className:"",children:Object(kr.jsx)("path",{d:"M302.189 329.126H196.105l55.831 135.993c3.889 9.428-.555 19.999-9.444 23.999l-49.165 21.427c-9.165 4-19.443-.571-23.332-9.714l-53.053-129.136-86.664 89.138C18.729 472.71 0 463.554 0 447.977V18.299C0 1.899 19.921-6.096 30.277 5.443l284.412 292.542c11.472 11.179 3.007 31.141-12.5 31.141z"})}),value:"selection",key:fe},{icon:Object(kr.jsx)("svg",{viewBox:"0 0 448 512",children:Object(kr.jsx)("path",{d:"M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48z"})}),value:"rectangle",key:pe},{icon:Object(kr.jsx)("svg",{viewBox:"0 0 223.646 223.646",children:Object(kr.jsx)("path",{d:"M111.823 0L16.622 111.823 111.823 223.646 207.025 111.823z"})}),value:"diamond",key:ae},{icon:Object(kr.jsx)("svg",{viewBox:"0 0 512 512",children:Object(kr.jsx)("path",{d:"M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8z"})}),value:"ellipse",key:le},{icon:Object(kr.jsx)("svg",{viewBox:"0 0 448 512",className:"rtl-mirror",children:Object(kr.jsx)("path",{d:"M313.941 216H12c-6.627 0-12 5.373-12 12v56c0 6.627 5.373 12 12 12h301.941v46.059c0 21.382 25.851 32.09 40.971 16.971l86.059-86.059c9.373-9.373 9.373-24.569 0-33.941l-86.059-86.059c-15.119-15.119-40.971-4.411-40.971 16.971V216z"})}),value:"arrow",key:oe},{icon:Object(kr.jsx)("svg",{viewBox:"0 0 6 6",children:Object(kr.jsx)("line",{x1:"0",y1:"3",x2:"6",y2:"3",stroke:"currentColor",strokeLinecap:"round"})}),value:"line",key:[ue,de]},{icon:Object(kr.jsx)("svg",{viewBox:"0 0 512 512",children:Object(kr.jsx)("path",{fill:"currentColor",d:"M290.74 93.24l128.02 128.02-277.99 277.99-114.14 12.6C11.35 513.54-1.56 500.62.14 485.34l12.7-114.22 277.9-277.88zm207.2-19.06l-60.11-60.11c-18.75-18.75-49.16-18.75-67.91 0l-56.55 56.55 128.02 128.02 56.55-56.55c18.75-18.76 18.75-49.16 0-67.91z"})}),value:"freedraw",key:ve},{icon:Object(kr.jsx)("svg",{viewBox:"0 0 448 512",children:Object(kr.jsx)("path",{d:"M432 416h-23.41L277.88 53.69A32 32 0 0 0 247.58 32h-47.16a32 32 0 0 0-30.3 21.69L39.41 416H16a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h128a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16h-19.58l23.3-64h152.56l23.3 64H304a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h128a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM176.85 272L224 142.51 271.15 272z"})}),value:"text",key:be},{icon:Object(kr.jsx)("svg",{viewBox:"0 0 512 512",children:Object(kr.jsx)("path",{fill:"currentColor",d:"M464 64H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V112c0-26.51-21.49-48-48-48zm-6 336H54a6 6 0 0 1-6-6V118a6 6 0 0 1 6-6h404a6 6 0 0 1 6 6v276a6 6 0 0 1-6 6zM128 152c-22.091 0-40 17.909-40 40s17.909 40 40 40 40-17.909 40-40-17.909-40-40-40zM96 352h320v-80l-87.515-87.515c-4.686-4.686-12.284-4.686-16.971 0L192 304l-39.515-39.515c-4.686-4.686-12.284-4.686-16.971 0L96 304v48z"})}),value:"image",key:null}];n(72);const Gc={cut:[Be("CtrlOrCmd+X")],copy:[Be("CtrlOrCmd+C")],paste:[Be("CtrlOrCmd+V")],copyStyles:[Be("CtrlOrCmd+Alt+C")],pasteStyles:[Be("CtrlOrCmd+Alt+V")],selectAll:[Be("CtrlOrCmd+A")],deleteSelectedElements:[Be("Del")],duplicateSelection:[Be("CtrlOrCmd+D"),Be("Alt+".concat(w("helpDialog.drag")))],sendBackward:[Be("CtrlOrCmd+[")],bringForward:[Be("CtrlOrCmd+]")],sendToBack:[Be(E?"CtrlOrCmd+Alt+[":"CtrlOrCmd+Shift+[")],bringToFront:[Be(E?"CtrlOrCmd+Alt+]":"CtrlOrCmd+Shift+]")],copyAsPng:[Be("Shift+Alt+C")],copyAsSvg:[],group:[Be("CtrlOrCmd+G")],ungroup:[Be("CtrlOrCmd+Shift+G")],gridMode:[Be("CtrlOrCmd+'")],zenMode:[Be("Alt+Z")],stats:[Be("Alt+/")],addToLibrary:[],flipHorizontal:[Be("Shift+H")],flipVertical:[Be("Shift+V")],viewMode:[Be("Alt+R")]},Wc=e=>{const t=Gc[e];return t&&t.length>0?t[0]:""},Kc=e=>{let{options:t,onCloseRequest:n,top:i,left:s,actionManager:r,appState:o}=e;return Object(kr.jsx)(ya,{onCloseRequest:n,top:i,left:s,fitInViewport:!0,children:Object(kr.jsx)("ul",{className:"context-menu",onContextMenu:e=>e.preventDefault(),children:t.map(((e,t)=>{var i;if("separator"===e)return Object(kr.jsx)("hr",{className:"context-menu-option-separator"},t);const s=e.name,a=e.contextItemLabel?w(e.contextItemLabel):"";return Object(kr.jsx)("li",{"data-testid":s,onClick:n,children:Object(kr.jsxs)("button",{className:Object(lt.a)("context-menu-option",{dangerous:"deleteSelectedElements"===s,checkmark:null===(i=e.checked)||void 0===i?void 0:i.call(e,o)}),onClick:()=>r.executeAction(e),children:[Object(kr.jsx)("div",{className:"context-menu-option__label",children:a}),Object(kr.jsx)("kbd",{className:"context-menu-option__shortcut",children:s?Wc(s):""})]})},t)}))})})},Yc=new WeakMap;var Zc={push(e){const t=Array.of();e.options.forEach((e=>{e&&t.push(e)})),t.length&&Object(i.render)(Object(kr.jsx)(Kc,{top:e.top,left:e.left,options:t,onCloseRequest:()=>(e=>{const t=Yc.get(e);t&&(Object(i.unmountComponentAtNode)(t),t.remove(),Yc.delete(e))})(e.container),actionManager:e.actionManager,appState:e.appState}),(e=>{let t=Yc.get(e);return t||(t=document.createElement("div"),e.querySelector(".excalidraw-contextMenuContainer").appendChild(t),Yc.set(e,t),t)})(e.container))}};const Xc=e=>{var t;let{appState:n,elements:i,renderAction:s,elementType:r}=e;const o=ur(ir(i),n),a=Boolean(n.editingElement),l=qd(),c="rtl"===document.documentElement.getAttribute("dir"),d=gr(r)||o.some((e=>gr(e.type)&&!Ke(e.backgroundColor))),h=gr(r)||o.some((e=>gr(e.type)));let u=(null===(t=o[0])||void 0===t?void 0:t.type)||null;for(const m of o)if(m.type!==u){u=null;break}return Object(kr.jsxs)("div",{className:"panelColumn",children:[(br(r)&&"image"!==r&&"image"!==u||o.some((e=>br(e.type))))&&s("changeStrokeColor"),h&&s("changeBackgroundColor"),d&&s("changeFillStyle"),(fr(r)||o.some((e=>fr(e.type))))&&s("changeStrokeWidth"),("freedraw"===r||o.some((e=>"freedraw"===e.type)))&&s("changeStrokeShape"),(vr(r)||o.some((e=>vr(e.type))))&&Object(kr.jsxs)(kr.Fragment,{children:[s("changeStrokeStyle"),s("changeSloppiness")]}),(yr(r)||o.some((e=>yr(e.type))))&&Object(kr.jsx)(kr.Fragment,{children:s("changeSharpness")}),(xr(r)||o.some((e=>xr(e.type))))&&Object(kr.jsxs)(kr.Fragment,{children:[s("changeFontSize"),s("changeFontFamily"),s("changeTextAlign")]}),(wr(r)||o.some((e=>wr(e.type))))&&Object(kr.jsx)(kr.Fragment,{children:s("changeArrowhead")}),s("changeOpacity"),Object(kr.jsxs)("fieldset",{children:[Object(kr.jsx)("legend",{children:w("labels.layers")}),Object(kr.jsxs)("div",{className:"buttonList",children:[s("sendToBack"),s("sendBackward"),s("bringToFront"),s("bringForward")]})]}),o.length>1&&Object(kr.jsxs)("fieldset",{children:[Object(kr.jsx)("legend",{children:w("labels.align")}),Object(kr.jsxs)("div",{className:"buttonList",children:[c?Object(kr.jsxs)(kr.Fragment,{children:[s("alignRight"),s("alignHorizontallyCentered"),s("alignLeft")]}):Object(kr.jsxs)(kr.Fragment,{children:[s("alignLeft"),s("alignHorizontallyCentered"),s("alignRight")]}),o.length>2&&s("distributeHorizontally"),Object(kr.jsxs)("div",{className:"iconRow",children:[s("alignTop"),s("alignVerticallyCentered"),s("alignBottom"),o.length>2&&s("distributeVertically")]})]})]}),!l&&!a&&o.length>0&&Object(kr.jsxs)("fieldset",{children:[Object(kr.jsx)("legend",{children:w("labels.actions")}),Object(kr.jsxs)("div",{className:"buttonList",children:[s("duplicateSelection"),s("deleteSelectedElements"),s("group"),s("ungroup")]})]})]})},qc=e=>{let{canvas:t,elementType:n,setAppState:i,onImageAction:s}=e;return Object(kr.jsx)(kr.Fragment,{children:Vc.map(((e,r)=>{let{value:o,icon:a,key:l}=e;const c=w("toolBar.".concat(o)),d=l&&("string"===typeof l?l:l[0]),h=d?"".concat(ke(d)," ").concat(w("helpDialog.or")," ").concat(r+1):"".concat(r+1);return Object(kr.jsx)(Mr,{className:"Shape",type:"radio",icon:a,checked:n===o,name:"editor-current-shape",title:"".concat(ke(c)," \u2014 ").concat(h),keyBindingLabel:"".concat(r+1),"aria-label":ke(c),"aria-keyshortcuts":h,"data-testid":o,onChange:e=>{let{pointerType:n}=e;i({elementType:o,multiElement:null,selectedElementIds:{}}),Ne(t,o),"image"===o&&s({pointerType:n})}},o)}))})},Jc=e=>{let{renderAction:t,zoom:n}=e;return Object(kr.jsx)(nc,{gap:1,children:Object(kr.jsxs)(tc,{gap:1,align:"center",children:[t("zoomOut"),t("zoomIn"),t("resetZoom")]})})},Qc=e=>{let{appState:t,setAppState:n,actionManager:i,showThemeBtn:s}=e;return Object(kr.jsxs)("div",{style:{display:"flex"},children:[i.renderAction("changeViewBackgroundColor"),s&&i.renderAction("toggleTheme")]})};n(73);var $c=e=>{let{isCollaborating:t,collaboratorCount:n,onClick:i}=e;return Object(kr.jsx)(kr.Fragment,{children:Object(kr.jsx)(Mr,{className:Object(lt.a)("CollabButton",{"is-collaborating":t}),onClick:i,icon:po,type:"button",title:w("labels.liveCollaboration"),"aria-label":w("labels.liveCollaboration"),showAriaLabel:qd(),children:n>0&&Object(kr.jsx)("div",{className:"CollabButton-collaborators",children:n})})})};n(42);const ed="filter"in document.createElement("canvas").getContext("2d"),td=()=>Object(kr.jsxs)("div",{children:[Object(kr.jsx)("h3",{children:w("canvasError.cannotShowPreview")}),Object(kr.jsx)("p",{children:Object(kr.jsx)("span",{children:w("canvasError.canvasTooBig")})}),Object(kr.jsxs)("em",{children:["(",w("canvasError.canvasTooBigTip"),")"]})]}),nd=(e,t)=>{Object(i.unmountComponentAtNode)(t),t.innerHTML="",e instanceof HTMLCanvasElement?t.appendChild(e):Object(i.render)(Object(kr.jsx)(td,{}),t)},id=e=>{let{children:t,title:n,onClick:i,color:s,shade:r=6}=e;return Object(kr.jsx)("button",{className:"ExportDialog-imageExportButton",style:{"--button-color":c[s][r],"--button-color-darker":c[s][r+1],"--button-color-darkest":c[s][r+2]},title:n,"aria-label":n,onClick:i,children:t})},sd=e=>{let{elements:t,appState:n,files:i,exportPadding:s=d.f,actionManager:r,onExportToPng:a,onExportToSvg:l,onExportToClipboard:c}=e;const h=dr(t,n),[u,m]=Object(o.useState)(h),p=Object(o.useRef)(null),{exportBackground:g,viewBackgroundColor:b}=n,f=u?hr(t,n):t;return Object(o.useEffect)((()=>{m(h)}),[h]),Object(o.useEffect)((()=>{const e=p.current;e&&Sl(f,n,i,{exportBackground:g,viewBackgroundColor:b,exportPadding:s}).then((t=>hl(t).then((()=>{nd(t,e)})))).catch((t=>{console.error(t),nd(new Or,e)}))}),[n,i,f,g,s,b]),Object(kr.jsxs)("div",{className:"ExportDialog",children:[Object(kr.jsx)("div",{className:"ExportDialog__preview",ref:p}),ed&&r.renderAction("exportWithDarkMode"),Object(kr.jsx)("div",{style:{display:"grid",gridTemplateColumns:"1fr"},children:Object(kr.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(190px, 1fr))",overflow:"hidden"},children:[r.renderAction("changeExportBackground"),h&&Object(kr.jsx)(ec,{checked:u,onChange:e=>m(e),children:w("labels.onlySelected")}),r.renderAction("changeExportEmbedScene")]})}),Object(kr.jsxs)("div",{style:{display:"flex",alignItems:"center",marginTop:".6em"},children:[Object(kr.jsx)(tc,{gap:2,children:r.renderAction("changeExportScale")}),Object(kr.jsx)("p",{style:{marginLeft:"1em",userSelect:"none"},children:"Scale"})]}),Object(kr.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",margin:".6em 0"},children:!qa.c&&r.renderAction("changeProjectName")}),Object(kr.jsxs)(tc,{gap:2,justifyContent:"center",style:{margin:"2em 0"},children:[Object(kr.jsx)(id,{color:"indigo",title:w("buttons.exportToPng"),"aria-label":w("buttons.exportToPng"),onClick:()=>a(f),children:"PNG"}),Object(kr.jsx)(id,{color:"red",title:w("buttons.exportToSvg"),"aria-label":w("buttons.exportToSvg"),onClick:()=>l(f),children:"SVG"}),Kl&&Object(kr.jsx)(id,{title:w("buttons.copyPngToClipboard"),onClick:()=>c(f),color:"gray",shade:7,children:Hr})]})]})},rd=e=>{let{elements:t,appState:n,files:i,exportPadding:s=d.f,actionManager:r,onExportToPng:l,onExportToSvg:c,onExportToClipboard:h}=e;const[u,m]=Object(o.useState)(!1),p=a.a.useCallback((()=>{m(!1)}),[]);return Object(kr.jsxs)(kr.Fragment,{children:[Object(kr.jsx)(Mr,{onClick:()=>{m(!0)},"data-testid":"image-export-button",icon:Vr,type:"button","aria-label":w("buttons.exportImage"),showAriaLabel:qd(),title:w("buttons.exportImage")}),u&&Object(kr.jsx)(gh,{onCloseRequest:p,title:w("buttons.exportImage"),children:Object(kr.jsx)(sd,{elements:t,appState:n,files:i,exportPadding:s,actionManager:r,onExportToPng:l,onExportToSvg:c,onExportToClipboard:h,onCloseRequest:p})})]})};n(74);const od=e=>{let{children:t,side:n,className:i}=e;return Object(kr.jsx)("div",{className:Object(lt.a)("FixedSideContainer","FixedSideContainer_side_".concat(n),i),children:t})};n(75);const ad=e=>{let{appState:t,elements:n,isMobile:i}=e,s=(e=>{let{appState:t,elements:n,isMobile:i}=e;const{elementType:s,isResizing:r,isRotating:o,lastPointerDownWith:a}=t,l=null!==t.multiElement;if("arrow"===s||"line"===s)return w(l?"hints.linearElementMulti":"hints.linearElement");if("freedraw"===s)return w("hints.freeDraw");if("text"===s)return w("hints.text");if("image"===t.elementType&&t.pendingImageElement)return w("hints.placeImage");const c=hr(n,t);if(r&&"mouse"===a&&1===c.length){const e=c[0];return ft(e)&&2===e.points.length?w("hints.lockAngle"):mt(e)?w("hints.resizeImage"):w("hints.resize")}return o&&"mouse"===a?w("hints.rotate"):1===c.length&&ft(c[0])?t.editingLinearElement?t.editingLinearElement.activePointIndex?w("hints.lineEditor_pointSelected"):w("hints.lineEditor_nothingSelected"):w("hints.lineEditor_info"):1===c.length&&pt(c[0])?w("hints.text_selected"):t.editingElement&&pt(t.editingElement)?w("hints.text_editing"):"selection"!==s||c.length||i?null:w("hints.canvasPanning")})({appState:t,elements:n,isMobile:i});return s?(s=Be(s),Object(kr.jsx)("div",{className:"HintViewer",children:Object(kr.jsx)("span",{children:s})})):null};n(76);const ld=a.a.forwardRef(((e,t)=>{let{children:n,padding:i,className:s,style:r}=e;return Object(kr.jsx)("div",{className:Object(lt.a)("Island",s),style:{"--padding":i,...r},ref:t,children:n})}));n(77);const cd=()=>Object(kr.jsx)("div",{className:"LoadingMessage",children:Object(kr.jsx)("span",{children:w("labels.loadingScene")})}),dd={CHECKED:Object(kr.jsx)("svg",{width:"1792",height:"1792",viewBox:"0 0 1792 1792",xmlns:"http://www.w3.org/2000/svg",children:Object(kr.jsx)("path",{d:"M640 768h512v-192q0-106-75-181t-181-75-181 75-75 181v192zm832 96v576q0 40-28 68t-68 28h-960q-40 0-68-28t-28-68v-576q0-40 28-68t68-28h32v-192q0-184 132-316t316-132 316 132 132 316v192h32q40 0 68 28t28 68z"})}),UNCHECKED:Object(kr.jsx)("svg",{width:"1792",height:"1792",viewBox:"0 0 1792 1792",xmlns:"http://www.w3.org/2000/svg",className:"unlocked-icon rtl-mirror",children:Object(kr.jsx)("path",{d:"M1728 576v256q0 26-19 45t-45 19h-64q-26 0-45-19t-19-45v-256q0-106-75-181t-181-75-181 75-75 181v192h96q40 0 68 28t28 68v576q0 40-28 68t-68 28h-960q-40 0-68-28t-28-68v-576q0-40 28-68t68-28h672v-192q0-185 131.5-316.5t316.5-131.5 316.5 131.5 131.5 316.5z"})})},hd=e=>Object(kr.jsxs)("label",{className:Object(lt.a)("ToolIcon ToolIcon__lock ToolIcon_type_floating zen-mode-visibility","ToolIcon_size_".concat("medium"),{"zen-mode-visibility--hidden":e.zenModeEnabled}),title:"".concat(e.title," \u2014 Q"),children:[Object(kr.jsx)("input",{className:"ToolIcon_type_checkbox",type:"checkbox",name:e.name,onChange:e.onChange,checked:e.checked,"aria-label":e.title}),Object(kr.jsx)("div",{className:"ToolIcon__icon",children:e.checked?dd.CHECKED:dd.UNCHECKED})]}),ud=e=>{let{heading:t,children:n,...i}=e;const{id:s}=Qd(),r=Object(kr.jsx)("h2",{className:"visually-hidden",id:"".concat(s,"-").concat(t,"-title"),children:w("headings.".concat(t))});return Object(kr.jsx)("section",{...i,"aria-labelledby":"".concat(s,"-").concat(t,"-title"),children:"function"===typeof n?n(r):Object(kr.jsxs)(kr.Fragment,{children:[r,n]})})};n(78);const md=e=>{let{children:t,className:n,mobile:i}=e;return Object(kr.jsx)("div",{className:Object(lt.a)("UserList",n,{UserList_mobile:i}),children:t})},pd=Object(kr.jsx)("svg",{viewBox:"0 0 576 512",children:Object(kr.jsx)("path",{fill:"currentColor",d:"M542.22 32.05c-54.8 3.11-163.72 14.43-230.96 55.59-4.64 2.84-7.27 7.89-7.27 13.17v363.87c0 11.55 12.63 18.85 23.28 13.49 69.18-34.82 169.23-44.32 218.7-46.92 16.89-.89 30.02-14.43 30.02-30.66V62.75c.01-17.71-15.35-31.74-33.77-30.7zM264.73 87.64C197.5 46.48 88.58 35.17 33.78 32.05 15.36 31.01 0 45.04 0 62.75V400.6c0 16.24 13.13 29.78 30.02 30.66 49.49 2.6 149.59 12.11 218.77 46.95 10.62 5.35 23.21-1.94 23.21-13.46V100.63c0-5.29-2.62-10.14-7.27-12.99z"})}),gd=e=>{let{appState:t,setAppState:n}=e;return Object(kr.jsxs)("label",{className:Object(lt.a)("ToolIcon ToolIcon_type_floating ToolIcon__library zen-mode-visibility","ToolIcon_size_medium",{"zen-mode-visibility--hidden":t.zenModeEnabled}),title:"".concat(ke(w("toolBar.library"))," \u2014 0"),style:{marginInlineStart:"var(--space-factor)"},children:[Object(kr.jsx)("input",{className:"ToolIcon_type_checkbox",type:"checkbox",name:"editor-library",onChange:e=>{n({isLibraryOpen:e.target.checked})},checked:t.isLibraryOpen,"aria-label":ke(w("toolBar.library")),"aria-keyshortcuts":"0"}),Object(kr.jsx)("div",{className:"ToolIcon__icon",children:pd})]})},bd=e=>{let{appState:t,elements:n,libraryMenu:i,actionManager:s,renderJSONExportDialog:r,renderImageExportDialog:o,setAppState:l,onCollabButtonClick:c,onLockToggle:d,canvas:h,isCollaborating:u,renderCustomFooter:m,viewModeEnabled:p,showThemeBtn:g,onImageAction:b,renderTopRightUI:f}=e;return Object(kr.jsxs)(kr.Fragment,{children:[!p&&Object(kr.jsxs)(od,{side:"top",className:"App-top-bar",children:[Object(kr.jsx)(ud,{heading:"shapes",children:e=>Object(kr.jsxs)(nc,{gap:4,align:"center",children:[Object(kr.jsxs)(tc,{gap:1,children:[Object(kr.jsxs)(ld,{padding:1,children:[e,Object(kr.jsx)(tc,{gap:1,children:Object(kr.jsx)(qc,{canvas:h,elementType:t.elementType,setAppState:l,onImageAction:e=>{let{pointerType:t}=e;b({insertOnCanvasDirectly:"mouse"!==t})}})})]}),f&&f(!0,t),Object(kr.jsx)(hd,{checked:t.elementLocked,onChange:d,title:w("toolBar.lock")}),Object(kr.jsx)(gd,{appState:t,setAppState:l})]}),i]})}),Object(kr.jsx)(ad,{appState:t,elements:n,isMobile:!0})]}),Object(kr.jsx)("div",{className:"App-bottom-bar",style:{marginBottom:14,marginLeft:14,marginRight:14},children:Object(kr.jsxs)(ld,{padding:0,children:["canvas"===t.openMenu?Object(kr.jsx)(ud,{className:"App-mobile-menu",heading:"canvasActions",children:Object(kr.jsx)("div",{className:"panelColumn",children:Object(kr.jsxs)(nc,{gap:4,children:[p?Object(kr.jsxs)(kr.Fragment,{children:[r(),o()]}):Object(kr.jsxs)(kr.Fragment,{children:[s.renderAction("clearCanvas"),s.renderAction("loadScene"),r(),o(),c&&Object(kr.jsx)($c,{isCollaborating:u,collaboratorCount:t.collaborators.size,onClick:c}),Object(kr.jsx)(Qc,{actionManager:s,appState:t,setAppState:l,showThemeBtn:g})]}),null===m||void 0===m?void 0:m(!0,t),t.collaborators.size>0&&Object(kr.jsxs)("fieldset",{children:[Object(kr.jsx)("legend",{children:w("labels.collaborators")}),Object(kr.jsx)(md,{mobile:!0,children:Array.from(t.collaborators).filter((e=>{let[t,n]=e;return 0!==Object.keys(n).length})).map((e=>{let[t,n]=e;return Object(kr.jsx)(a.a.Fragment,{children:s.renderAction("goToCollaborator",{id:t})},t)}))})]})]})})}):"shape"===t.openMenu&&!p&&tr(t,n)?Object(kr.jsx)(ud,{className:"App-mobile-menu",heading:"selectedShapeActions",children:Object(kr.jsx)(Xc,{appState:t,elements:n,renderAction:s.renderAction,elementType:t.elementType})}):null,Object(kr.jsxs)("footer",{className:"App-toolbar",children:[p?Object(kr.jsx)("div",{className:"App-toolbar-content",children:s.renderAction("toggleCanvasMenu")}):Object(kr.jsxs)("div",{className:"App-toolbar-content",children:[s.renderAction("toggleCanvasMenu"),s.renderAction("toggleEditMenu"),s.renderAction("undo"),s.renderAction("redo"),s.renderAction(t.multiElement?"finalize":"duplicateSelection"),s.renderAction("deleteSelectedElements")]}),t.scrolledOutside&&!t.openMenu&&Object(kr.jsx)("button",{className:"scroll-back-to-content",onClick:()=>{l({...pr(n,t)})},children:w("buttons.scrollBackToContent")})]})]})})]})};n(79);const fd=e=>{const t=Object(o.useRef)(null),[n,i]=Object(o.useState)(null);return Object(o.useLayoutEffect)((()=>{if(!e.spreadsheet)return;const n=Fl(e.chartType,e.spreadsheet,0,0);let s;i(n);const r=t.current;return(async()=>{s=await El(n,{exportBackground:!1,viewBackgroundColor:c.white},null),r.appendChild(s),e.selected&&r.parentNode.focus()})(),()=>{r.removeChild(s)}}),[e.spreadsheet,e.chartType,e.selected]),Object(kr.jsx)("button",{className:"ChartPreview",onClick:()=>{n&&e.onClick(e.chartType,n)},children:Object(kr.jsx)("div",{ref:t})})},vd=e=>{let{setAppState:t,appState:n,onClose:i,onInsertChart:s}=e;const r=a.a.useCallback((()=>{i&&i()}),[i]),o=(e,n)=>{s(n),Object(l.a)("magic","chart",e),t({currentChartType:e,pasteDialog:{shown:!1,data:null}})};return Object(kr.jsx)(gh,{small:!0,onCloseRequest:r,title:w("labels.pasteCharts"),className:"PasteChartDialog",autofocus:!1,children:Object(kr.jsxs)("div",{className:"container",children:[Object(kr.jsx)(fd,{chartType:"bar",spreadsheet:n.pasteDialog.data,selected:"bar"===n.currentChartType,onClick:o}),Object(kr.jsx)(fd,{chartType:"line",spreadsheet:n.pasteDialog.data,selected:"line"===n.currentChartType,onClick:o})]})})};n(80);const yd=()=>Object(kr.jsxs)("div",{className:"HelpDialog--header",children:[Object(kr.jsx)("a",{className:"HelpDialog--btn",href:"https://github.com/excalidraw/excalidraw#documentation",target:"_blank",rel:"noopener noreferrer",children:w("helpDialog.documentation")}),Object(kr.jsx)("a",{className:"HelpDialog--btn",href:"https://blog.excalidraw.com",target:"_blank",rel:"noopener noreferrer",children:w("helpDialog.blog")}),Object(kr.jsx)("a",{className:"HelpDialog--btn",href:"https://github.com/excalidraw/excalidraw/issues",target:"_blank",rel:"noopener noreferrer",children:w("helpDialog.github")})]}),xd=e=>Object(kr.jsxs)(kr.Fragment,{children:[Object(kr.jsx)("h3",{children:e.title}),e.children]}),wd=e=>Object(kr.jsx)("div",{style:{display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:"space-between"},children:e.children}),jd=e=>Object(kr.jsx)("div",{style:{width:"49%"},children:e.children}),Sd=e=>Object(kr.jsxs)("div",{className:"HelpDialog--island",children:[Object(kr.jsx)("h3",{className:"HelpDialog--island-title",children:e.caption}),e.children]}),Ed=e=>Object(kr.jsx)("div",{className:"HelpDialog--shortcut",children:Object(kr.jsxs)("div",{style:{display:"flex",margin:"0",padding:"4px 8px",alignItems:"center"},children:[Object(kr.jsx)("div",{style:{lineHeight:1.4},children:e.label}),Object(kr.jsx)("div",{style:{display:"flex",flex:"0 0 auto",justifyContent:"flex-end",marginInlineStart:"auto",minWidth:"30%"},children:e.shortcuts.map(((t,n)=>Object(kr.jsxs)(a.a.Fragment,{children:[Object(kr.jsx)(Od,{children:t}),e.isOr&&n!==e.shortcuts.length-1&&w("helpDialog.or")]},n)))})]})});Ed.defaultProps={isOr:!0};const Od=e=>Object(kr.jsx)("kbd",{className:"HelpDialog--key",...e}),Cd=e=>{let{onClose:t}=e;const n=a.a.useCallback((()=>{t&&t()}),[t]);return Object(kr.jsx)(kr.Fragment,{children:Object(kr.jsxs)(gh,{onCloseRequest:n,title:w("helpDialog.title"),className:"HelpDialog",children:[Object(kr.jsx)(yd,{}),Object(kr.jsx)(xd,{title:w("helpDialog.shortcuts"),children:Object(kr.jsxs)(wd,{children:[Object(kr.jsxs)(jd,{children:[Object(kr.jsxs)(Sd,{caption:w("helpDialog.shapes"),children:[Object(kr.jsx)(Ed,{label:w("toolBar.selection"),shortcuts:["V","1"]}),Object(kr.jsx)(Ed,{label:w("toolBar.rectangle"),shortcuts:["R","2"]}),Object(kr.jsx)(Ed,{label:w("toolBar.diamond"),shortcuts:["D","3"]}),Object(kr.jsx)(Ed,{label:w("toolBar.ellipse"),shortcuts:["E","4"]}),Object(kr.jsx)(Ed,{label:w("toolBar.arrow"),shortcuts:["A","5"]}),Object(kr.jsx)(Ed,{label:w("toolBar.line"),shortcuts:["P","6"]}),Object(kr.jsx)(Ed,{label:w("toolBar.freedraw"),shortcuts:["Shift+P","7"]}),Object(kr.jsx)(Ed,{label:w("toolBar.text"),shortcuts:["T","8"]}),Object(kr.jsx)(Ed,{label:w("toolBar.image"),shortcuts:["9"]}),Object(kr.jsx)(Ed,{label:w("toolBar.library"),shortcuts:["0"]}),Object(kr.jsx)(Ed,{label:w("helpDialog.editSelectedShape"),shortcuts:[Be("Enter"),w("helpDialog.doubleClick")]}),Object(kr.jsx)(Ed,{label:w("helpDialog.textNewLine"),shortcuts:[Be("Enter"),Be("Shift+Enter")]}),Object(kr.jsx)(Ed,{label:w("helpDialog.textFinish"),shortcuts:[Be("Esc"),Be("CtrlOrCmd+Enter")]}),Object(kr.jsx)(Ed,{label:w("helpDialog.curvedArrow"),shortcuts:["A",w("helpDialog.click"),w("helpDialog.click"),w("helpDialog.click")],isOr:!1}),Object(kr.jsx)(Ed,{label:w("helpDialog.curvedLine"),shortcuts:["L",w("helpDialog.click"),w("helpDialog.click"),w("helpDialog.click")],isOr:!1}),Object(kr.jsx)(Ed,{label:w("toolBar.lock"),shortcuts:["Q"]}),Object(kr.jsx)(Ed,{label:w("helpDialog.preventBinding"),shortcuts:[Be("CtrlOrCmd")]})]}),Object(kr.jsxs)(Sd,{caption:w("helpDialog.view"),children:[Object(kr.jsx)(Ed,{label:w("buttons.zoomIn"),shortcuts:[Be("CtrlOrCmd++")]}),Object(kr.jsx)(Ed,{label:w("buttons.zoomOut"),shortcuts:[Be("CtrlOrCmd+-")]}),Object(kr.jsx)(Ed,{label:w("buttons.resetZoom"),shortcuts:[Be("CtrlOrCmd+0")]}),Object(kr.jsx)(Ed,{label:w("helpDialog.zoomToFit"),shortcuts:["Shift+1"]}),Object(kr.jsx)(Ed,{label:w("helpDialog.zoomToSelection"),shortcuts:["Shift+2"]}),Object(kr.jsx)(Ed,{label:w("buttons.fullScreen"),shortcuts:["F"]}),Object(kr.jsx)(Ed,{label:w("buttons.zenMode"),shortcuts:[Be("Alt+Z")]}),Object(kr.jsx)(Ed,{label:w("labels.showGrid"),shortcuts:[Be("CtrlOrCmd+'")]}),Object(kr.jsx)(Ed,{label:w("labels.viewMode"),shortcuts:[Be("Alt+R")]}),Object(kr.jsx)(Ed,{label:w("labels.toggleTheme"),shortcuts:[Be("Alt+Shift+D")]}),Object(kr.jsx)(Ed,{label:w("stats.title"),shortcuts:[Be("Alt+/")]})]})]}),Object(kr.jsx)(jd,{children:Object(kr.jsxs)(Sd,{caption:w("helpDialog.editor"),children:[Object(kr.jsx)(Ed,{label:w("labels.selectAll"),shortcuts:[Be("CtrlOrCmd+A")]}),Object(kr.jsx)(Ed,{label:w("labels.multiSelect"),shortcuts:[Be("Shift+".concat(w("helpDialog.click")))]}),Object(kr.jsx)(Ed,{label:w("labels.moveCanvas"),shortcuts:[Be("Space+".concat(w("helpDialog.drag"))),Be("Wheel+".concat(w("helpDialog.drag")))],isOr:!0}),Object(kr.jsx)(Ed,{label:w("labels.cut"),shortcuts:[Be("CtrlOrCmd+X")]}),Object(kr.jsx)(Ed,{label:w("labels.copy"),shortcuts:[Be("CtrlOrCmd+C")]}),Object(kr.jsx)(Ed,{label:w("labels.paste"),shortcuts:[Be("CtrlOrCmd+V")]}),Object(kr.jsx)(Ed,{label:w("labels.copyAsPng"),shortcuts:[Be("Shift+Alt+C")]}),Object(kr.jsx)(Ed,{label:w("labels.copyStyles"),shortcuts:[Be("CtrlOrCmd+Alt+C")]}),Object(kr.jsx)(Ed,{label:w("labels.pasteStyles"),shortcuts:[Be("CtrlOrCmd+Alt+V")]}),Object(kr.jsx)(Ed,{label:w("labels.delete"),shortcuts:[Be("Del")]}),Object(kr.jsx)(Ed,{label:w("labels.sendToBack"),shortcuts:[Be(E?"CtrlOrCmd+Alt+[":"CtrlOrCmd+Shift+[")]}),Object(kr.jsx)(Ed,{label:w("labels.bringToFront"),shortcuts:[Be(E?"CtrlOrCmd+Alt+]":"CtrlOrCmd+Shift+]")]}),Object(kr.jsx)(Ed,{label:w("labels.sendBackward"),shortcuts:[Be("CtrlOrCmd+[")]}),Object(kr.jsx)(Ed,{label:w("labels.bringForward"),shortcuts:[Be("CtrlOrCmd+]")]}),Object(kr.jsx)(Ed,{label:w("labels.alignTop"),shortcuts:[Be("CtrlOrCmd+Shift+Up")]}),Object(kr.jsx)(Ed,{label:w("labels.alignBottom"),shortcuts:[Be("CtrlOrCmd+Shift+Down")]}),Object(kr.jsx)(Ed,{label:w("labels.alignLeft"),shortcuts:[Be("CtrlOrCmd+Shift+Left")]}),Object(kr.jsx)(Ed,{label:w("labels.alignRight"),shortcuts:[Be("CtrlOrCmd+Shift+Right")]}),Object(kr.jsx)(Ed,{label:w("labels.duplicateSelection"),shortcuts:[Be("CtrlOrCmd+D"),Be("Alt+".concat(w("helpDialog.drag")))]}),Object(kr.jsx)(Ed,{label:w("buttons.undo"),shortcuts:[Be("CtrlOrCmd+Z")]}),Object(kr.jsx)(Ed,{label:w("buttons.redo"),shortcuts:O?[Be("CtrlOrCmd+Y"),Be("CtrlOrCmd+Shift+Z")]:[Be("CtrlOrCmd+Shift+Z")]}),Object(kr.jsx)(Ed,{label:w("labels.group"),shortcuts:[Be("CtrlOrCmd+G")]}),Object(kr.jsx)(Ed,{label:w("labels.ungroup"),shortcuts:[Be("CtrlOrCmd+Shift+G")]}),Object(kr.jsx)(Ed,{label:w("labels.flipHorizontal"),shortcuts:[Be("Shift+H")]}),Object(kr.jsx)(Ed,{label:w("labels.flipVertical"),shortcuts:[Be("Shift+V")]}),Object(kr.jsx)(Ed,{label:w("labels.showStroke"),shortcuts:[Be("S")]}),Object(kr.jsx)(Ed,{label:w("labels.showBackground"),shortcuts:[Be("G")]})]})})]})})]})})};n(81);const kd=e=>{let{children:t,color:n}=e;return Object(kr.jsx)("div",{className:"Card",style:{"--card-color":c[n][7],"--card-color-darker":c[n][8],"--card-color-darkest":c[n][9]},children:t})},Id=e=>{let{elements:t,appState:n,files:i,actionManager:s,exportOpts:r,canvas:o}=e;const{onExportToBackend:a}=r;return Object(kr.jsx)("div",{className:"ExportDialog ExportDialog--json",children:Object(kr.jsxs)("div",{className:"ExportDialog-cards",children:[r.saveFileToDisk&&Object(kr.jsxs)(kd,{color:"lime",children:[Object(kr.jsx)("div",{className:"Card-icon",children:Gr}),Object(kr.jsx)("h2",{children:w("exportDialog.disk_title")}),Object(kr.jsxs)("div",{className:"Card-details",children:[w("exportDialog.disk_details"),!qa.c&&s.renderAction("changeProjectName")]}),Object(kr.jsx)(Mr,{className:"Card-button",type:"button",title:w("exportDialog.disk_button"),"aria-label":w("exportDialog.disk_button"),showAriaLabel:!0,onClick:()=>{s.executeAction(sc)}})]}),a&&Object(kr.jsxs)(kd,{color:"pink",children:[Object(kr.jsx)("div",{className:"Card-icon",children:zr}),Object(kr.jsx)("h2",{children:w("exportDialog.link_title")}),Object(kr.jsx)("div",{className:"Card-details",children:w("exportDialog.link_details")}),Object(kr.jsx)(Mr,{className:"Card-button",type:"button",title:w("exportDialog.link_button"),"aria-label":w("exportDialog.link_button"),showAriaLabel:!0,onClick:()=>a(t,n,i,o)})]}),r.renderCustomUI&&r.renderCustomUI(t,n,i,o)]})})},Md=e=>{let{elements:t,appState:n,files:i,actionManager:s,exportOpts:r,canvas:l}=e;const[c,d]=Object(o.useState)(!1),h=a.a.useCallback((()=>{d(!1)}),[]);return Object(kr.jsxs)(kr.Fragment,{children:[Object(kr.jsx)(Mr,{onClick:()=>{d(!0)},"data-testid":"json-export-button",icon:Ur,type:"button","aria-label":w("buttons.export"),showAriaLabel:qd(),title:w("buttons.export")}),c&&Object(kr.jsx)(gh,{onCloseRequest:h,title:w("buttons.export"),children:Object(kr.jsx)(Id,{elements:t,appState:n,files:i,actionManager:s,onCloseRequest:h,exportOpts:r,canvas:l})})]})},Ad=e=>{let{elements:t,appState:n,files:i,maxWidthOrHeight:s,getDimensions:r}=e;const{elements:o,appState:a}=sl({elements:t,appState:n},null,null),{exportBackground:l,viewBackgroundColor:c}=a;return Sl(ir(o),{...a,offsetTop:0,offsetLeft:0,width:0,height:0},i||{},{exportBackground:l,viewBackgroundColor:c},((e,t)=>{var n;const i=document.createElement("canvas");if(s){"function"===typeof r&&console.warn("`getDimensions()` is ignored when `maxWidthOrHeight` is supplied.");const n=Math.max(e,t),o=s/n;return i.width=e*o,i.height=t*o,{canvas:i,scale:o}}const o=(null===r||void 0===r?void 0:r(e,t))||{width:e,height:t};return i.width=o.width,i.height=o.height,{canvas:i,scale:null!==(n=o.scale)&&void 0!==n?n:1}}))};n(82),n(83);var Td=e=>{let{libItem:t,appState:n,index:i,onChange:s,onRemove:r}=e;const a=Object(o.useRef)(null),l=Object(o.useRef)(null);return Object(o.useEffect)((()=>{const e=a.current;e&&(async()=>{const i=await(async e=>{let{elements:t,appState:n=nt(),files:i={},exportPadding:s}=e;const{elements:r,appState:o}=sl({elements:t,appState:n},null,null);return El(ir(r),{...o,exportPadding:s},i)})({elements:t.elements,appState:{...n,viewBackgroundColor:c.white,exportBackground:!0},files:null});e.innerHTML=i.outerHTML})()}),[t.elements,n]),Object(kr.jsxs)("div",{className:"single-library-item",children:[Object(kr.jsx)("div",{ref:a,className:"single-library-item__svg"}),Object(kr.jsx)(Mr,{"aria-label":w("buttons.remove"),type:"button",icon:fo,className:"single-library-item--remove",onClick:r.bind(null,t.id),title:w("buttons.remove")}),Object(kr.jsxs)("div",{style:{display:"flex",margin:"0.8rem 0.3rem",width:"100%",fontSize:"14px",fontWeight:500,flexDirection:"column"},children:[Object(kr.jsxs)("label",{style:{display:"flex",justifyContent:"space-between",flexDirection:"column"},children:[Object(kr.jsxs)("div",{style:{padding:"0.5em 0"},children:[Object(kr.jsx)("span",{style:{fontWeight:500,color:c.gray[6]},children:w("publishDialog.itemName")}),Object(kr.jsx)("span",{"aria-hidden":"true",className:"required",children:"*"})]}),Object(kr.jsx)("input",{type:"text",ref:l,style:{width:"80%",padding:"0.2rem"},defaultValue:t.name,placeholder:"Item name",onChange:e=>{s(e.target.value,i)}})]}),Object(kr.jsx)("span",{className:"error",children:t.error})]})]})};const Ld="publish-library-data",Dd=async e=>{const t=128,n=Math.round(8),i=Math.max(Math.round(2),2),s=((e,t)=>{if(!e.length||t<1)return[];let n=0,i=0;const s=Array(Math.ceil(e.length/t));for(;n<e.length;)s[i++]=e.slice(n,n+=t);return s})(e,6),r=document.createElement("canvas");r.width=s[0].length*t+(s[0].length+1)*(2*n)-2*n,r.height=s.length*t+(s.length+1)*(2*n)-2*n;const o=r.getContext("2d");o.fillStyle=c.white,o.fillRect(0,0,r.width,r.height);for(const[a,l]of e.entries()){const e=await Ad({elements:l.elements,files:null,maxWidthOrHeight:t}),{width:s,height:r}=e,d=Math.floor(a/6)*(t+2*n),h=a%6*(t+2*n);o.drawImage(e,h+(t-s)/2+n,d+(t-r)/2+n),o.lineWidth=i,o.strokeStyle=c.gray[4],o.strokeRect(h+n/2,d+n/2,t+n,t+n)}return await ml(new File([await hl(r)],"preview",{type:d.D.png}),{outputType:d.D.jpg,maxWidthOrHeight:5e3})};var Pd=e=>{let{onClose:t,libraryItems:n,appState:i,onSuccess:s,onError:r,updateItemsInStorage:a,onRemove:l}=e;const[c,h]=Object(o.useState)({authorName:"",githubHandle:"",name:"",description:"",twitterHandle:"",website:""}),[u,m]=Object(o.useState)(!1);Object(o.useEffect)((()=>{const e=(()=>{try{const e=localStorage.getItem(Ld);if(e)return JSON.parse(e)}catch(e){console.error(e)}return null})();e&&h(e)}),[]);const[p,g]=Object(o.useState)(n.slice());Object(o.useEffect)((()=>{g(n.slice())}),[n]);const b=e=>{h({...c,[e.target.name]:e.target.value})},f=Object(o.useCallback)((()=>{a(p),(e=>{try{localStorage.setItem(Ld,JSON.stringify(e))}catch(t){console.error(t)}})(c),t()}),[p,t,a,c]),v=!!n.length;return Object(kr.jsx)(gh,{onCloseRequest:f,title:w("publishDialog.title"),className:"publish-library",children:v?Object(kr.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),m(!0);const t=[];let n=!1;if(p.forEach((e=>{let i="";e.name||(i=w("publishDialog.errors.required"),n=!0),t.push({...e,error:i})})),n)return g(t),void m(!1);const i=await Dd(p),o={type:d.t.excalidrawLibrary,version:d.W.excalidrawLibrary,source:d.v,libraryItems:p},a=JSON.stringify(o,null,2),l=new Blob([a],{type:"application/json"}),h=new FormData;h.append("excalidrawLib",l),h.append("previewImage",i),h.append("previewImageType",i.type),h.append("title",c.name),h.append("authorName",c.authorName),h.append("githubHandle",c.githubHandle),h.append("name",c.name),h.append("description",c.description),h.append("twitterHandle",c.twitterHandle),h.append("website",c.website),fetch("".concat("https://us-central1-excalidraw-room-persistence.cloudfunctions.net/libraries","/submit"),{method:"post",body:h}).then((e=>e.ok?e.json().then((e=>{let{url:t}=e;localStorage.removeItem(Ld),s({url:t,authorName:c.authorName,items:p})})):e.json().catch((()=>{throw new Error(e.statusText||"something went wrong")})).then((t=>{throw new Error(t.message||e.statusText||"something went wrong")}))),(e=>{console.error(e),r(e),m(!1)})).catch((e=>{console.error(e),r(e),m(!1)}))},children:[Object(kr.jsxs)("div",{className:"publish-library-note",children:[w("publishDialog.noteDescription.pre"),Object(kr.jsx)("a",{href:"https://libraries.excalidraw.com",target:"_blank",rel:"noopener noreferrer",children:w("publishDialog.noteDescription.link")})," ",w("publishDialog.noteDescription.post")]}),Object(kr.jsxs)("span",{className:"publish-library-note",children:[w("publishDialog.noteGuidelines.pre"),Object(kr.jsx)("a",{href:"https://github.com/excalidraw/excalidraw-libraries#guidelines",target:"_blank",rel:"noopener noreferrer",children:w("publishDialog.noteGuidelines.link")}),w("publishDialog.noteGuidelines.post")]}),Object(kr.jsx)("div",{className:"publish-library-note",children:w("publishDialog.noteItems")}),(()=>{const e=[];return p.forEach(((t,n)=>{e.push(Object(kr.jsx)("div",{className:"single-library-item-wrapper",children:Object(kr.jsx)(Td,{libItem:t,appState:i,index:n,onChange:(e,t)=>{const n=p.slice();n[t].name=e,g(n)},onRemove:l})},n))})),Object(kr.jsx)("div",{className:"selected-library-items",children:e})})(),Object(kr.jsxs)("div",{className:"publish-library__fields",children:[Object(kr.jsxs)("label",{children:[Object(kr.jsxs)("div",{children:[Object(kr.jsx)("span",{children:w("publishDialog.libraryName")}),Object(kr.jsx)("span",{"aria-hidden":"true",className:"required",children:"*"})]}),Object(kr.jsx)("input",{type:"text",name:"name",required:!0,value:c.name,onChange:b,placeholder:w("publishDialog.placeholder.libraryName")})]}),Object(kr.jsxs)("label",{style:{alignItems:"flex-start"},children:[Object(kr.jsxs)("div",{children:[Object(kr.jsx)("span",{children:w("publishDialog.libraryDesc")}),Object(kr.jsx)("span",{"aria-hidden":"true",className:"required",children:"*"})]}),Object(kr.jsx)("textarea",{name:"description",rows:4,required:!0,value:c.description,onChange:b,placeholder:w("publishDialog.placeholder.libraryDesc")})]}),Object(kr.jsxs)("label",{children:[Object(kr.jsxs)("div",{children:[Object(kr.jsx)("span",{children:w("publishDialog.authorName")}),Object(kr.jsx)("span",{"aria-hidden":"true",className:"required",children:"*"})]}),Object(kr.jsx)("input",{type:"text",name:"authorName",required:!0,value:c.authorName,onChange:b,placeholder:w("publishDialog.placeholder.authorName")})]}),Object(kr.jsxs)("label",{children:[Object(kr.jsx)("span",{children:w("publishDialog.githubUsername")}),Object(kr.jsx)("input",{type:"text",name:"githubHandle",value:c.githubHandle,onChange:b,placeholder:w("publishDialog.placeholder.githubHandle")})]}),Object(kr.jsxs)("label",{children:[Object(kr.jsx)("span",{children:w("publishDialog.twitterUsername")}),Object(kr.jsx)("input",{type:"text",name:"twitterHandle",value:c.twitterHandle,onChange:b,placeholder:w("publishDialog.placeholder.twitterHandle")})]}),Object(kr.jsxs)("label",{children:[Object(kr.jsx)("span",{children:w("publishDialog.website")}),Object(kr.jsx)("input",{type:"text",name:"website",pattern:"https?://.+",title:w("publishDialog.errors.website"),value:c.website,onChange:b,placeholder:w("publishDialog.placeholder.website")})]}),Object(kr.jsxs)("span",{className:"publish-library-note",children:[w("publishDialog.noteLicense.pre"),Object(kr.jsx)("a",{href:"https://github.com/excalidraw/excalidraw-libraries/blob/main/LICENSE",target:"_blank",rel:"noopener noreferrer",children:w("publishDialog.noteLicense.link")}),w("publishDialog.noteLicense.post")]})]}),Object(kr.jsxs)("div",{className:"publish-library__buttons",children:[Object(kr.jsx)(Mr,{type:"button",title:w("buttons.cancel"),"aria-label":w("buttons.cancel"),label:w("buttons.cancel"),onClick:f,"data-testid":"cancel-clear-canvas-button",className:"publish-library__buttons--cancel"}),Object(kr.jsx)(Mr,{type:"submit",title:w("buttons.submit"),"aria-label":w("buttons.submit"),label:w("buttons.submit"),className:"publish-library__buttons--confirm",isLoading:u})]})]}):Object(kr.jsx)("p",{style:{padding:"1em",textAlign:"center",fontWeight:500},children:w("publishDialog.atleastOneLibItem")})})},zd=(n(84),n(31));n(86);const Nd=Object(kr.jsx)("svg",{viewBox:"0 0 1792 1792",children:Object(kr.jsx)("path",{d:"M1600 736v192c0 26.667-9.33 49.333-28 68-18.67 18.67-41.33 28-68 28h-416v416c0 26.67-9.33 49.33-28 68s-41.33 28-68 28H800c-26.667 0-49.333-9.33-68-28s-28-41.33-28-68v-416H288c-26.667 0-49.333-9.33-68-28-18.667-18.667-28-41.333-28-68V736c0-26.667 9.333-49.333 28-68s41.333-28 68-28h416V224c0-26.667 9.333-49.333 28-68s41.333-28 68-28h192c26.67 0 49.33 9.333 68 28s28 41.333 28 68v416h416c26.67 0 49.33 9.333 68 28s28 41.333 28 68Z",style:{stroke:"#fff",strokeWidth:140},transform:"translate(0 64)"})}),Rd=e=>{let{id:t,elements:n,files:i,isPending:s,onClick:r,selected:a,onToggle:l}=e;const h=Object(o.useRef)(null);Object(o.useEffect)((()=>{const e=h.current;if(e)return(async()=>{if(!n)return;const t=await El(n,{exportBackground:!1,viewBackgroundColor:c.white},i);e.innerHTML=t.outerHTML})(),()=>{e.innerHTML=""}}),[n,i]);const[u,m]=Object(o.useState)(!1),p=qd(),g=s&&Object(kr.jsx)("div",{className:"library-unit__adder",children:Nd});return Object(kr.jsxs)("div",{className:Object(lt.a)("library-unit",{"library-unit__active":n,"library-unit--hover":n&&u,"library-unit--selected":a}),onMouseEnter:()=>m(!0),onMouseLeave:()=>m(!1),children:[Object(kr.jsx)("div",{className:Object(lt.a)("library-unit__dragger",{"library-unit__pulse":!!s}),ref:h,draggable:!!n,onClick:n||s?e=>{t&&e.shiftKey?l(t,e):r()}:void 0,onDragStart:e=>{m(!1),e.dataTransfer.setData(d.D.excalidrawlib,JSON.stringify(n))}}),g,t&&n&&(u||p||a)&&Object(kr.jsx)(ec,{checked:a,onChange:(e,n)=>l(t,n),className:"library-unit__checkbox"})]})};n(87);var Bd=e=>{let{libraryItems:t,onRemoveFromLibrary:n,onAddToLibrary:i,onInsertShape:s,pendingElements:r,theme:a,setAppState:l,libraryReturnUrl:c,library:h,files:u,id:m,selectedItems:p,onToggle:g,onPublish:b,resetLibrary:f}=e;const v=Object(o.useCallback)((()=>{const e=p.length?w("alerts.removeItemsFromsLibrary",{count:p.length}):w("alerts.resetLibrary"),t=p.length?w("confirmDialog.removeItemsFromLib"):w("confirmDialog.resetLibrary");return Object(kr.jsx)(Da,{onConfirm:()=>{p.length?n():f(),x(!1)},onCancel:()=>{x(!1)},title:t,children:Object(kr.jsx)("p",{children:e})})}),[p,n,f]),[y,x]=Object(o.useState)(!1),j=qd(),S=j?4:6,E=c||window.location.origin+window.location.pathname,O=p.some((e=>{var n;return"published"===(null===(n=t.find((t=>t.id===e)))||void 0===n?void 0:n.status)})),C=e=>{var t,n,i,s,r;return Object(kr.jsx)(nc,{children:Object(kr.jsx)(Rd,{elements:null===(t=e.item)||void 0===t?void 0:t.elements,files:u,isPending:!(null===(n=e.item)||void 0===n?void 0:n.id)&&!!(null===(i=e.item)||void 0===i?void 0:i.elements),onClick:e.onClick||(()=>{}),id:(null===(s=e.item)||void 0===s?void 0:s.id)||null,selected:!!(null===(r=e.item)||void 0===r?void 0:r.id)&&p.includes(e.item.id),onToggle:(e,t)=>{g(e,t)}})},e.key)},k=e=>{const t=e.map((e=>e.id?C({item:e,onClick:()=>s(e.elements),key:e.id}):C({key:"__pending__item__",item:e,onClick:()=>i(r)})));let n=Object(zd.chunk)(t,S);return n.length||(n=[[]]),n.map(((e,t,n)=>(t===n.length-1&&(e=e.concat(new Array(S-e.length).fill(null).map(((e,t)=>C({key:"empty_".concat(t),item:null}))))),Object(kr.jsx)(tc,{align:"center",gap:1,children:e},t))))},I=t.filter((e=>"published"===e.status)),M=[...r.length?[{id:null,elements:r}]:[],...t.filter((e=>"published"!==e.status))];return Object(kr.jsxs)("div",{className:"library-menu-items-container",children:[y&&v(),Object(kr.jsxs)("div",{className:"layer-ui__library-header",children:[(()=>{const e=!!p.length,n=e?t.filter((e=>p.includes(e.id))):t,i=w(e?"buttons.remove":"buttons.resetLibrary");return Object(kr.jsxs)("div",{className:"library-actions",children:[(!e||!j)&&Object(kr.jsx)(Mr,{type:"button",title:w("buttons.load"),"aria-label":w("buttons.load"),icon:Br,onClick:()=>{(async e=>{const t=await Ja({description:"Excalidraw library files"});await e.importLibrary(t)})(h).then((()=>{l({isLibraryOpen:!1}),l({isLibraryOpen:!0})})).catch(We).catch((e=>{l({errorMessage:e.message})}))},className:"library-actions--load"},"import"),!!n.length&&Object(kr.jsxs)(kr.Fragment,{children:[Object(kr.jsx)(Mr,{type:"button",title:w("buttons.export"),"aria-label":w("buttons.export"),icon:Gr,onClick:async()=>{(async e=>{const t={type:d.t.excalidrawLibrary,version:d.W.excalidrawLibrary,source:d.v,libraryItems:e},n=JSON.stringify(t,null,2);await Qa(new Blob([n],{type:d.D.excalidrawlib}),{name:"library",extension:"excalidrawlib",description:"Excalidraw library file"})})(e?n:await h.loadLibrary()).catch(We).catch((e=>{l({errorMessage:e.message})}))},className:"library-actions--export",children:p.length>0&&Object(kr.jsx)("span",{className:"library-actions-counter",children:p.length})},"export"),Object(kr.jsx)(Mr,{type:"button",title:i,"aria-label":i,icon:_r,onClick:()=>x(!0),className:"library-actions--remove",children:p.length>0&&Object(kr.jsx)("span",{className:"library-actions-counter",children:p.length})},"reset")]}),e&&!O&&Object(kr.jsx)(La,{label:w("hints.publishLibrary"),children:Object(kr.jsxs)(Mr,{type:"button","aria-label":w("buttons.publishLibrary"),label:w("buttons.publishLibrary"),icon:Jo,className:"library-actions--publish",onClick:b,children:[!j&&Object(kr.jsx)("label",{children:w("buttons.publishLibrary")}),p.length>0&&Object(kr.jsx)("span",{className:"library-actions-counter",children:p.length})]})})]})})(),Object(kr.jsx)("a",{href:"".concat("https://libraries.excalidraw.com","?target=").concat(window.name||"_blank","&referrer=").concat(E,"&useHash=true&token=").concat(m,"&theme=").concat(a,"&version=").concat(d.W.excalidrawLibrary),target:"_excalidraw_libraries",children:w("labels.libraries")})]},"library-header"),Object(kr.jsxs)(nc,{className:"library-menu-items-container__items",align:"start",gap:1,children:[Object(kr.jsxs)(kr.Fragment,{children:[Object(kr.jsx)("div",{className:"separator",children:w("labels.personalLib")}),k(M)]}),Object(kr.jsxs)(kr.Fragment,{children:[Object(kr.jsxs)("div",{className:"separator",children:[w("labels.excalidrawLib")," "]}),k(I)]})]})]})};const Hd=(e,t)=>e.filter((e=>t.includes(e.id))),_d=e=>{let{onClose:t,onInsertShape:n,pendingElements:i,onAddToLibrary:s,theme:r,setAppState:a,files:l,libraryReturnUrl:c,focusContainer:h,library:u,id:m,appState:p}=e;const g=Object(o.useRef)(null);((e,t)=>{Object(o.useEffect)((()=>{const n=n=>{e.current&&(n.target instanceof Element&&(e.current.contains(n.target)||!document.body.contains(n.target))||t(n))};return document.addEventListener("pointerdown",n,!1),()=>{document.removeEventListener("pointerdown",n)}}),[e,t])})(g,(e=>{e.target.closest(".ToolIcon__library")||t()})),Object(o.useEffect)((()=>{const e=e=>{e.key===ne&&t()};return document.addEventListener(d.s.KEYDOWN,e),()=>{document.removeEventListener(d.s.KEYDOWN,e)}}),[t]);const[b,f]=Object(o.useState)([]),[v,y]=Object(o.useState)("preloading"),[x,j]=Object(o.useState)([]),[S,E]=Object(o.useState)(!1),[O,C]=Object(o.useState)(null),k=Object(o.useRef)(null);Object(o.useEffect)((()=>(Promise.race([new Promise((e=>{k.current=window.setTimeout((()=>{e("loading")}),100)})),u.loadLibrary().then((e=>{f(e),y("ready")}))]).then((e=>{"loading"===e&&y("loading")})),()=>{clearTimeout(k.current)})),[u]);const I=Object(o.useCallback)((async()=>{const e=await u.loadLibrary(),t=e.filter((e=>!x.includes(e.id)));u.saveLibrary(t).catch((t=>{f(e),a({errorMessage:w("alerts.errorRemovingFromLibrary")})})),j([]),f(t)}),[u,a,x,j]),M=Object(o.useCallback)((()=>{u.resetLibrary(),f([]),h()}),[u,h]),A=Object(o.useCallback)((async e=>{if(e.some((e=>"image"===e.type)))return a({errorMessage:"Support for adding images to the library coming soon!"});const t=await u.loadLibrary(),n=[{status:"unpublished",elements:e,id:On(),created:Date.now()},...t];s(),u.saveLibrary(n).catch((e=>{f(t),a({errorMessage:w("alerts.errorAddingToLibrary")})})),f(n)}),[s,u,a]),T=Object(o.useCallback)((()=>Object(kr.jsxs)(gh,{onCloseRequest:()=>C(null),title:w("publishSuccessDialog.title"),className:"publish-library-success",small:!0,children:[Object(kr.jsxs)("p",{children:[w("publishSuccessDialog.content",{authorName:O.authorName})," ",Object(kr.jsx)("a",{href:null===O||void 0===O?void 0:O.url,target:"_blank",rel:"noopener noreferrer",children:w("publishSuccessDialog.link")})]}),Object(kr.jsx)(Mr,{type:"button",title:w("buttons.close"),"aria-label":w("buttons.close"),label:w("buttons.close"),onClick:()=>C(null),"data-testid":"publish-library-success-close",className:"publish-library-success-close"})]})),[C,O]),L=Object(o.useCallback)((e=>{E(!1),C({url:e.url,authorName:e.authorName});const t=b.slice();t.forEach((e=>{x.includes(e.id)&&(e.status="published")})),u.saveLibrary(t),f(t)}),[E,C,b,x,u]),[D,P]=Object(o.useState)(null);return"preloading"===v?null:Object(kr.jsxs)(ld,{padding:1,ref:g,className:"layer-ui__library",children:[S&&Object(kr.jsx)(Pd,{onClose:()=>E(!1),libraryItems:Hd(b,x),appState:p,onSuccess:L,onError:e=>window.alert(e),updateItemsInStorage:()=>u.saveLibrary(b),onRemove:e=>j(x.filter((t=>t!==e)))}),O&&T(),"loading"===v?Object(kr.jsx)("div",{className:"layer-ui__library-message",children:w("labels.libraryLoadingMessage")}):Object(kr.jsx)(Bd,{libraryItems:b,onRemoveFromLibrary:I,onAddToLibrary:A,onInsertShape:n,pendingElements:i,setAppState:a,libraryReturnUrl:c,library:u,theme:r,files:l,id:m,selectedItems:x,onToggle:(e,t)=>{if(!x.includes(e)){if(t.shiftKey&&D){const t=b.findIndex((e=>e.id===D)),n=b.findIndex((t=>t.id===e));if(-1===t||-1===n)return void j([...x,e]);const i=et(x),s=b.reduce(((e,s,r)=>((r>=t&&r<=n||i.has(s.id))&&e.push(s.id),e)),[]);j(s)}else j([...x,e]);P(e)}else P(null),j(x.filter((t=>t!==e)))},onPublish:()=>E(!0),resetLibrary:M})]})},Fd=e=>{let{actionManager:t,appState:n,files:i,setAppState:s,canvas:r,elements:a,onCollabButtonClick:l,onLockToggle:c,onInsertElements:h,zenModeEnabled:u,showExitZenModeBtn:m,showThemeBtn:p,toggleZenMode:g,isCollaborating:b,renderTopRightUI:f,renderCustomFooter:v,viewModeEnabled:y,libraryReturnUrl:x,UIOptions:j,focusContainer:S,library:E,id:O,onImageAction:C}=e;const k=qd(),I=()=>j.canvasActions.export?Object(kr.jsx)(Md,{elements:a,appState:n,files:i,actionManager:t,exportOpts:j.canvasActions.export,canvas:r}):null,M=()=>{if(!j.canvasActions.saveAsImage)return null;const e=e=>async t=>{const r=await $l(e,t,n,i,{exportBackground:n.exportBackground,name:n.name,viewBackgroundColor:n.viewBackgroundColor}).catch(We).catch((e=>{console.error(e),s({errorMessage:e.message})}));n.exportEmbedScene&&r&&ll(r)&&s({fileHandle:r})};return Object(kr.jsx)(rd,{elements:a,appState:n,files:i,actionManager:t,onExportToPng:e("png"),onExportToSvg:e("svg"),onExportToClipboard:e("clipboard")})},A=()=>Object(kr.jsx)("div",{style:{width:".625em"}}),T=Object(o.useCallback)((()=>{!!document.querySelector(".Dialog")||s({isLibraryOpen:!1})}),[s]),L=Object(o.useCallback)((()=>{s({selectedElementIds:{},selectedGroupIds:{}})}),[s]),D=n.isLibraryOpen?Object(kr.jsx)(_d,{pendingElements:hr(a,n),onClose:T,onInsertShape:h,onAddToLibrary:L,setAppState:s,libraryReturnUrl:x,focusContainer:S,library:E,theme:n.theme,files:i,id:O,appState:n}):null,P=Object(kr.jsxs)(kr.Fragment,{children:[n.isLoading&&Object(kr.jsx)(cd,{}),n.errorMessage&&Object(kr.jsx)(bh,{message:n.errorMessage,onClose:()=>s({errorMessage:null})}),n.showHelpDialog&&Object(kr.jsx)(Cd,{onClose:()=>{s({showHelpDialog:!1})}}),n.pasteDialog.shown&&Object(kr.jsx)(vd,{setAppState:s,appState:n,onInsertChart:h,onClose:()=>s({pasteDialog:{shown:!1,data:null}})})]});return k?Object(kr.jsxs)(kr.Fragment,{children:[P,Object(kr.jsx)(bd,{appState:n,elements:a,actionManager:t,libraryMenu:D,renderJSONExportDialog:I,renderImageExportDialog:M,setAppState:s,onCollabButtonClick:l,onLockToggle:c,canvas:r,isCollaborating:b,renderCustomFooter:v,viewModeEnabled:y,showThemeBtn:p,onImageAction:C,renderTopRightUI:f})]}):Object(kr.jsxs)("div",{className:Object(lt.a)("layer-ui__wrapper",{"disable-pointerEvents":n.draggingElement||n.resizingElement||n.editingElement&&!pt(n.editingElement)}),children:[P,(()=>{const e=tr(n,a);return Object(kr.jsx)(od,{side:"top",children:Object(kr.jsxs)("div",{className:"App-menu App-menu_top",children:[Object(kr.jsxs)(nc,{gap:4,className:Object(lt.a)({"disable-pointerEvents":u}),children:[y?Object(kr.jsx)(ud,{heading:"canvasActions",className:Object(lt.a)("zen-mode-transition",{"transition-left":u}),children:Object(kr.jsx)(ld,{padding:2,style:{zIndex:1},children:Object(kr.jsx)(nc,{gap:4,children:Object(kr.jsxs)(tc,{gap:1,justifyContent:"space-between",children:[I(),M()]})})})}):Object(kr.jsx)(ud,{heading:"canvasActions",className:Object(lt.a)("zen-mode-transition",{"transition-left":u}),children:Object(kr.jsx)(ld,{padding:2,style:{zIndex:1},children:Object(kr.jsxs)(nc,{gap:4,children:[Object(kr.jsxs)(tc,{gap:1,justifyContent:"space-between",children:[t.renderAction("clearCanvas"),Object(kr.jsx)(A,{}),t.renderAction("loadScene"),I(),M(),Object(kr.jsx)(A,{}),l&&Object(kr.jsx)($c,{isCollaborating:b,collaboratorCount:n.collaborators.size,onClick:l})]}),Object(kr.jsx)(Qc,{actionManager:t,appState:n,setAppState:s,showThemeBtn:p}),n.fileHandle&&Object(kr.jsx)(kr.Fragment,{children:t.renderAction("saveToActiveFile")})]})})}),e&&Object(kr.jsx)(ud,{heading:"selectedShapeActions",className:Object(lt.a)("zen-mode-transition",{"transition-left":u}),children:Object(kr.jsx)(ld,{className:d.d.SHAPE_ACTIONS_MENU,padding:2,style:{maxHeight:"".concat(n.height-(n.fileHandle?248:200),"px")},children:Object(kr.jsx)(Xc,{appState:n,elements:a,renderAction:t.renderAction,elementType:n.elementType})})})]}),!y&&Object(kr.jsx)(ud,{heading:"shapes",children:e=>Object(kr.jsxs)(nc,{gap:4,align:"start",children:[Object(kr.jsxs)(tc,{gap:1,children:[Object(kr.jsx)(hd,{zenModeEnabled:u,checked:n.elementLocked,onChange:c,title:w("toolBar.lock")}),Object(kr.jsxs)(ld,{padding:1,className:Object(lt.a)({"zen-mode":u}),children:[Object(kr.jsx)(ad,{appState:n,elements:a,isMobile:k}),e,Object(kr.jsx)(tc,{gap:1,children:Object(kr.jsx)(qc,{canvas:r,elementType:n.elementType,setAppState:s,onImageAction:e=>{let{pointerType:t}=e;C({insertOnCanvasDirectly:"mouse"!==t})}})})]}),Object(kr.jsx)(gd,{appState:n,setAppState:s})]}),D]})}),Object(kr.jsxs)("div",{className:Object(lt.a)("layer-ui__wrapper__top-right zen-mode-transition",{"transition-right":u}),children:[Object(kr.jsx)(md,{children:n.collaborators.size>0&&Array.from(n.collaborators).filter((e=>{let[t,n]=e;return 0!==Object.keys(n).length})).map((e=>{let[n,i]=e;return Object(kr.jsx)(La,{label:i.username||"Unknown user",children:t.renderAction("goToCollaborator",{id:n})},n)}))}),null===f||void 0===f?void 0:f(k,n)]})]})})})(),Object(kr.jsxs)("footer",{role:"contentinfo",className:"layer-ui__wrapper__footer App-menu App-menu_bottom",children:[Object(kr.jsx)("div",{className:Object(lt.a)("layer-ui__wrapper__footer-left zen-mode-transition",{"layer-ui__wrapper__footer-left--transition-left":u}),children:Object(kr.jsx)(nc,{gap:2,children:Object(kr.jsxs)(ud,{heading:"canvasActions",children:[Object(kr.jsx)(ld,{padding:1,children:Object(kr.jsx)(Jc,{renderAction:t.renderAction,zoom:n.zoom})}),!y&&Object(kr.jsxs)("div",{className:Object(lt.a)("undo-redo-buttons zen-mode-transition",{"layer-ui__wrapper__footer-left--transition-bottom":u}),children:[t.renderAction("undo",{size:"small"}),t.renderAction("redo",{size:"small"})]})]})})}),Object(kr.jsx)("div",{className:Object(lt.a)("layer-ui__wrapper__footer-center zen-mode-transition",{"layer-ui__wrapper__footer-left--transition-bottom":u}),children:null===v||void 0===v?void 0:v(!1,n)}),Object(kr.jsx)("div",{className:Object(lt.a)("layer-ui__wrapper__footer-right zen-mode-transition",{"transition-right disable-pointerEvents":u}),children:t.renderAction("toggleShortcuts")}),Object(kr.jsx)("button",{className:Object(lt.a)("disable-zen-mode",{"disable-zen-mode--visible":m}),onClick:g,children:w("buttons.exitZenMode")})]}),n.scrolledOutside&&Object(kr.jsx)("button",{className:"scroll-back-to-content",onClick:()=>{s({...pr(a,n)})},children:w("buttons.scrollBackToContent")})]})},Ud=(e,t)=>{const n=e=>{const{suggestedBindings:t,startBoundElement:n,...i}=e;return i},i=n(e.appState),s=n(t.appState),r=Object.keys(i);return e.renderCustomFooter===t.renderCustomFooter&&e.langCode===t.langCode&&e.elements===t.elements&&e.files===t.files&&r.every((e=>i[e]===s[e]))};var Vd=a.a.memo(Fd,Ud);n(88);const Gd=e=>{var t;const n=qd(),i=Ft(e.elements),s=ur(e.elements,e.appState),r=Ft(s);return n&&e.appState.openMenu?null:Object(kr.jsx)("div",{className:"Stats",children:Object(kr.jsxs)(ld,{padding:2,children:[Object(kr.jsx)("div",{className:"close",onClick:e.onClose,children:fo}),Object(kr.jsx)("h3",{children:w("stats.title")}),Object(kr.jsx)("table",{children:Object(kr.jsxs)("tbody",{children:[Object(kr.jsx)("tr",{children:Object(kr.jsx)("th",{colSpan:2,children:w("stats.scene")})}),Object(kr.jsxs)("tr",{children:[Object(kr.jsx)("td",{children:w("stats.elements")}),Object(kr.jsx)("td",{children:e.elements.length})]}),Object(kr.jsxs)("tr",{children:[Object(kr.jsx)("td",{children:w("stats.width")}),Object(kr.jsx)("td",{children:Math.round(i[2])-Math.round(i[0])})]}),Object(kr.jsxs)("tr",{children:[Object(kr.jsx)("td",{children:w("stats.height")}),Object(kr.jsx)("td",{children:Math.round(i[3])-Math.round(i[1])})]}),1===s.length&&Object(kr.jsx)("tr",{children:Object(kr.jsx)("th",{colSpan:2,children:w("stats.element")})}),s.length>1&&Object(kr.jsxs)(kr.Fragment,{children:[Object(kr.jsx)("tr",{children:Object(kr.jsx)("th",{colSpan:2,children:w("stats.selected")})}),Object(kr.jsxs)("tr",{children:[Object(kr.jsx)("td",{children:w("stats.elements")}),Object(kr.jsx)("td",{children:s.length})]})]}),s.length>0&&Object(kr.jsxs)(kr.Fragment,{children:[Object(kr.jsxs)("tr",{children:[Object(kr.jsx)("td",{children:"x"}),Object(kr.jsx)("td",{children:Math.round(r[0])})]}),Object(kr.jsxs)("tr",{children:[Object(kr.jsx)("td",{children:"y"}),Object(kr.jsx)("td",{children:Math.round(r[1])})]}),Object(kr.jsxs)("tr",{children:[Object(kr.jsx)("td",{children:w("stats.width")}),Object(kr.jsx)("td",{children:Math.round(r[2]-r[0])})]}),Object(kr.jsxs)("tr",{children:[Object(kr.jsx)("td",{children:w("stats.height")}),Object(kr.jsx)("td",{children:Math.round(r[3]-r[1])})]})]}),1===s.length&&Object(kr.jsxs)("tr",{children:[Object(kr.jsx)("td",{children:w("stats.angle")}),Object(kr.jsx)("td",{children:"".concat(Math.round(180*s[0].angle/Math.PI),"\xb0")})]}),null===(t=e.renderCustomStats)||void 0===t?void 0:t.call(e,e.elements,e.appState)]})})]})})};n(89);const Wd=e=>{let{message:t,clearToast:n}=e;const i=Object(o.useRef)(0),s=Object(o.useCallback)((()=>i.current=window.setTimeout((()=>n()),d.S)),[n]);return Object(o.useEffect)((()=>(s(),()=>clearTimeout(i.current))),[s,t]),Object(kr.jsx)("div",{className:"Toast",onMouseEnter:()=>clearTimeout(null===i||void 0===i?void 0:i.current),onMouseLeave:s,children:Object(kr.jsx)("p",{className:"Toast__message",children:t})})},Kd=$o({name:"viewMode",perform(e,t){return Object(l.a)("view","mode","view"),{appState:{...t,viewModeEnabled:!this.checked(t)},commitToHistory:!1}},checked:e=>e.viewModeEnabled,contextItemLabel:"labels.viewMode",keyTest:e=>!e[$]&&e.altKey&&e.code===K});var Yd=n(24),Zd=n.n(Yd);const Xd=a.a.createContext(!1),qd=()=>Object(o.useContext)(Xd),Jd=a.a.createContext({container:null,id:null}),Qd=()=>Object(o.useContext)(Jd);let $d=!1,eh=0,th=0,nh=0,ih=!1,sh=!1,rh=!1,oh={horizontal:null,vertical:null},ah=0,lh=!1,ch=null;const dh={pointers:new Map,lastCenter:null,initialDistance:null,initialScale:null};class hh extends a.a.Component{constructor(e){var t;super(e),t=this,this.canvas=null,this.rc=null,this.unmounted=!1,this.actionManager=void 0,this.isMobile=!1,this.detachIsMobileMqHandler=void 0,this.excalidrawContainerRef=a.a.createRef(),this.scene=void 0,this.resizeObserver=void 0,this.nearestScrollableContainer=void 0,this.library=void 0,this.libraryItemsFromStorage=void 0,this.id=void 0,this.history=void 0,this.excalidrawContainerValue=void 0,this.files={},this.imageCache=new Map,this.focusContainer=()=>{var e;this.props.autoFocus&&(null===(e=this.excalidrawContainerRef.current)||void 0===e||e.focus())},this.getSceneElementsIncludingDeleted=()=>this.scene.getElementsIncludingDeleted(),this.getSceneElements=()=>this.scene.getElements(),this.syncActionResult=Ze((e=>{if(this.unmounted||!1===e)return;let t=null;if(e.elements&&(e.elements.forEach((e=>{var n;(null===(n=this.state.editingElement)||void 0===n?void 0:n.id)===e.id&&this.state.editingElement!==e&&sr(e)&&(t=e)})),this.scene.replaceAllElements(e.elements),e.commitToHistory&&this.history.resumeRecording()),e.files&&(this.files=e.replaceFiles?e.files:{...this.files,...e.files},this.addNewImagesToImageCache()),e.appState||t){var n,i,s,r,o,a;e.commitToHistory&&this.history.resumeRecording();let l=(null===e||void 0===e||null===(n=e.appState)||void 0===n?void 0:n.viewModeEnabled)||!1,c=(null===e||void 0===e||null===(i=e.appState)||void 0===i?void 0:i.zenModeEnabled)||!1,h=(null===e||void 0===e||null===(s=e.appState)||void 0===s?void 0:s.gridSize)||null,u=(null===e||void 0===e||null===(r=e.appState)||void 0===r?void 0:r.theme)||d.P.LIGHT,m=null!==(o=null===e||void 0===e||null===(a=e.appState)||void 0===a?void 0:a.name)&&void 0!==o?o:this.state.name;"undefined"!==typeof this.props.viewModeEnabled&&(l=this.props.viewModeEnabled),"undefined"!==typeof this.props.zenModeEnabled&&(c=this.props.zenModeEnabled),"undefined"!==typeof this.props.gridModeEnabled&&(h=this.props.gridModeEnabled?d.x:null),"undefined"!==typeof this.props.theme&&(u=this.props.theme),"undefined"!==typeof this.props.name&&(m=this.props.name),this.setState((n=>{var i;return Object.assign(e.appState||{},{editingElement:t||(null===(i=e.appState)||void 0===i?void 0:i.editingElement)||null,viewModeEnabled:l,zenModeEnabled:c,gridSize:h,theme:u,name:m})}),(()=>{e.syncHistory&&this.history.setCurrentState(this.state,this.scene.getElementsIncludingDeleted())}))}})),this.onBlur=Ze((()=>{ih=!1,this.setState({isBindingEnabled:!0})})),this.onUnload=()=>{this.onBlur()},this.disableEvent=e=>{e.preventDefault()},this.onFontLoaded=()=>{this.scene.getElementsIncludingDeleted().forEach((e=>{pt(e)&&on(e)})),this.onSceneUpdated()},this.importLibraryFromUrl=async(e,t)=>{if(window.location.hash.includes(d.U.addLibrary)){const e=new URLSearchParams(window.location.hash.slice(1));e.delete(d.U.addLibrary),window.history.replaceState({},d.c,"#".concat(e.toString()))}else if(window.location.search.includes(d.V.addLibrary)){const e=new URLSearchParams(window.location.search);e.delete(d.V.addLibrary),window.history.replaceState({},d.c,"?".concat(e.toString()))}try{const n=await fetch(decodeURIComponent(e)),i=await n.blob(),s=JSON.parse(await i.text());if(!(e=>"object"===typeof e&&e&&e.type===d.t.excalidrawLibrary&&(1===e.version||2===e.version))(s))throw new Error;(t===this.id||window.confirm(w("alerts.confirmAddLibrary",{numShapes:(s.libraryItems||s.library||[]).length})))&&(await this.library.importLibrary(i,"published"),this.state.isLibraryOpen&&this.setState({isLibraryOpen:!1}),this.setState({isLibraryOpen:!0}))}catch(n){window.alert(w("alerts.errorLoadingLibrary")),console.error(n)}finally{this.focusContainer()}},this.resetHistory=()=>{this.history.clear()},this.resetScene=Ze((e=>{this.scene.replaceAllElements([]),this.setState((t=>({...nt(),isLoading:!(null===e||void 0===e?void 0:e.resetLoadingState)&&t.isLoading,theme:this.state.theme}))),this.resetHistory()})),this.initializeScene=async()=>{var e;"launchQueue"in window&&"LaunchParams"in window&&window.launchQueue.setConsumer((async e=>{if(!e.files.length)return;const t=e.files[0],n=await t.getFile();n.handle=t,dl(n,this.state,this.scene.getElementsIncludingDeleted()).then((e=>{this.syncActionResult({...e,appState:{...e.appState||this.state,isLoading:!1},commitToHistory:!0})})).catch((e=>{this.setState({isLoading:!1,errorMessage:e.message})}))})),this.state.isLoading||this.setState({isLoading:!0});let t=null;try{var n;t=await this.props.initialData||null,(null===(n=t)||void 0===n?void 0:n.libraryItems)&&(this.libraryItemsFromStorage=rl(t.libraryItems,"unpublished"))}catch(r){console.error(r),t={appState:{errorMessage:r.message||"Encountered an error during importing or restoring scene data"}}}const i=sl(t,null,null);i.appState={...i.appState,elementType:"image"===i.appState.elementType?"selection":i.appState.elementType,isLoading:!1},(null===(e=t)||void 0===e?void 0:e.scrollToContent)&&(i.appState={...i.appState,...pr(i.elements,{...i.appState,width:this.state.width,height:this.state.height,offsetTop:this.state.offsetTop,offsetLeft:this.state.offsetLeft})}),this.resetHistory(),this.syncActionResult({...i,commitToHistory:!0});const s=new URLSearchParams(window.location.hash.slice(1)).get(d.U.addLibrary)||new URLSearchParams(window.location.search).get(d.V.addLibrary);s&&await this.importLibraryFromUrl(s)},this.onResize=Ze((()=>{this.scene.getElementsIncludingDeleted().forEach((e=>on(e))),this.setState({})})),this.onScroll=Le((()=>{const{offsetTop:e,offsetLeft:t}=this.getCanvasOffsets();this.setState((n=>n.offsetLeft===t&&n.offsetTop===e?null:{offsetTop:e,offsetLeft:t}))}),d.J),this.onCut=Ze((e=>{var t;(null===(t=this.excalidrawContainerRef.current)||void 0===t?void 0:t.contains(document.activeElement))&&!Ie(e.target)&&(this.cutAll(),e.preventDefault())})),this.onCopy=Ze((e=>{var t;(null===(t=this.excalidrawContainerRef.current)||void 0===t?void 0:t.contains(document.activeElement))&&!Ie(e.target)&&(this.copyAll(),e.preventDefault())})),this.cutAll=()=>{this.copyAll(),this.actionManager.executeAction(ta)},this.copyAll=()=>{Yl(this.scene.getElements(),this.state,this.files)},this.onTapStart=e=>{if(!$d)return $d=!0,clearTimeout(eh),void(eh=window.setTimeout(hh.resetTapTwice,d.N));if($d&&1===e.touches.length){const[t]=e.touches;this.handleCanvasDoubleClick({clientX:t.clientX,clientY:t.clientY}),$d=!1,clearTimeout(eh)}e.preventDefault(),2===e.touches.length&&this.setState({selectedElementIds:{}})},this.onTapEnd=e=>{e.touches.length>0&&this.setState({previousSelectedElementIds:{},selectedElementIds:this.state.previousSelectedElementIds})},this.pasteFromClipboard=Ze((async e=>{var t,n;const i=document.activeElement;if(!(null===(t=this.excalidrawContainerRef.current)||void 0===t?void 0:t.contains(i)))return;const s=document.elementFromPoint(th,nh);if(e&&(!(s instanceof HTMLCanvasElement)||Ie(i)))return;let r=null===e||void 0===e||null===(n=e.clipboardData)||void 0===n?void 0:n.files[0];const o=await ql(e);if(!r&&o.text){const e=o.text.trim();e.startsWith("<svg")&&e.endsWith("</svg>")&&(r=pl(e))}if(cl(r)){const{x:e,y:t}=He({clientX:th,clientY:nh},this.state),n=this.createImageElement({sceneX:e,sceneY:t});return this.insertImageElement(n,r),this.initializeImageDimensions(n),void this.setState({selectedElementIds:{[n.id]:!0}})}if(this.props.onPaste)try{if(!1===await this.props.onPaste(o,e))return}catch(a){console.error(a)}o.errorMessage?this.setState({errorMessage:o.errorMessage}):o.spreadsheet?this.setState({pasteDialog:{data:o.spreadsheet,shown:!0}}):o.elements?this.addElementsFromPasteOrLibrary({elements:o.elements,files:o.files||null,position:"cursor"}):o.text&&this.addTextFromPaste(o.text),this.selectShapeTool("selection"),null===e||void 0===e||e.preventDefault()})),this.addElementsFromPasteOrLibrary=e=>{const t=nl(e.elements,null),[n,i,s,r]=Ft(t),o=De(n,s)/2,a=De(i,r)/2,l="object"===typeof e.position?e.position.clientX:"cursor"===e.position?th:this.state.width/2+this.state.offsetLeft,c="object"===typeof e.position?e.position.clientY:"cursor"===e.position?nh:this.state.height/2+this.state.offsetTop,{x:d,y:h}=He({clientX:l,clientY:c},this.state),u=d-o,m=h-a,p=new Map,[g,b]=Tt(u,m,this.state.gridSize),f=new Map,v=t.map((e=>{const t=Zn(this.state.editingGroupId,p,e,{x:e.x+g-n,y:e.y+b-i});return f.set(e.id,t.id),t})),y=[...this.scene.getElementsIncludingDeleted(),...v];Bs(y,t,f),e.files&&(this.files={...this.files,...e.files}),this.scene.replaceAllElements(y),this.history.resumeRecording(),this.setState(Nn({...this.state,isLibraryOpen:!1,selectedElementIds:v.reduce(((e,t)=>(e[t.id]=!0,e)),{}),selectedGroupIds:{}},this.scene.getElements()),(()=>{e.files&&this.addNewImagesToImageCache()})),this.selectShapeTool("selection")},this.setAppState=e=>{this.setState(e)},this.removePointer=e=>{"touch"===e.pointerType&&ah&&(clearTimeout(ah),ah=0,lh=!1),dh.pointers.delete(e.pointerId)},this.toggleLock=()=>{this.setState((e=>({elementLocked:!e.elementLocked,elementType:e.elementLocked?"selection":e.elementType})))},this.toggleZenMode=()=>{this.actionManager.executeAction(Dc)},this.toggleStats=()=>{this.state.showStats||Object(l.a)("dialog","stats"),this.actionManager.executeAction(Pc)},this.scrollToContent=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.scene.getElements();t.setState({...pr(Array.isArray(e)?e:[e],t.state,t.canvas)})},this.clearToast=()=>{this.setState({toastMessage:null})},this.setToastMessage=e=>{this.setState({toastMessage:e})},this.restoreFileFromShare=async()=>{try{const e=await caches.open("web-share-target"),t=await e.match("shared-file");if(t){const n=await t.blob();this.loadFileToCanvas(n),await e.delete("shared-file"),window.history.replaceState(null,d.c,window.location.pathname)}}catch(e){this.setState({errorMessage:e.message})}},this.addFiles=Ze((e=>{const t=e.reduce(((e,t)=>(e.set(t.id,t),e)),new Map);this.files={...this.files,...Object.fromEntries(t)},this.scene.getElements().forEach((e=>{ut(e)&&t.has(e.fileId)&&(this.imageCache.delete(e.fileId),on(e),In(e))})),this.scene.informMutation(),this.addNewImagesToImageCache()})),this.updateScene=Ze((e=>{e.commitToHistory&&this.history.resumeRecording(),e.appState&&this.setState(e.appState),e.elements&&this.scene.replaceAllElements(e.elements),e.collaborators&&this.setState({collaborators:e.collaborators})})),this.onSceneUpdated=()=>{this.setState({})},this.updateCurrentCursorPosition=Ze((e=>{th=e.clientX,nh=e.clientY})),this.onKeyDown=Ze((e=>{var t;if(("Proxy"in window&&(!e.shiftKey&&/^[A-Z]$/.test(e.key)||e.shiftKey&&/^[a-z]$/.test(e.key))&&(e=new Proxy(e,{get(t,n){const i=t[n];return"function"===typeof i?i.bind(t):"key"===n?e.shiftKey?t.key.toUpperCase():t.key.toLowerCase():i}})),!(Ie(e.target)&&e.key!==ne||we(e.key)&&(t=e.target,t instanceof HTMLElement&&"wysiwyg"===t.dataset.type||t instanceof HTMLBRElement||t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement||t instanceof HTMLSelectElement)))&&(e.key===ie&&this.setState({showHelpDialog:!0}),!this.actionManager.handleKeyDown(e)&&!this.state.viewModeEnabled)){if(e[$]&&this.state.isBindingEnabled&&this.setState({isBindingEnabled:!1}),e.code===N&&this.setState({isLibraryOpen:!this.state.isLibraryOpen}),we(e.key)){const t=this.state.gridSize&&(e.shiftKey?d.p:this.state.gridSize)||(e.shiftKey?d.o:d.p),n=this.scene.getElements().filter((e=>this.state.selectedElementIds[e.id]));let i=0,s=0;e.key===Z?i=-t:e.key===X?i=t:e.key===q?s=-t:e.key===Y&&(s=t),n.forEach((e=>{Cn(e,{x:e.x+i,y:e.y+s}),Is(e,{simultaneouslyUpdated:n})})),this.maybeSuggestBindingForAll(n),e.preventDefault()}else if(e.key===te){const t=hr(this.scene.getElements(),this.state);if(1===t.length&&ft(t[0]))this.state.editingLinearElement&&this.state.editingLinearElement.elementId===t[0].id||(this.history.resumeRecording(),this.setState({editingLinearElement:new ps(t[0],this.scene)}));else if(1===t.length&&!ft(t[0])){const n=t[0];return this.startTextEditing({sceneX:n.x+n.width/2,sceneY:n.y+n.height/2}),void e.preventDefault()}}else if(!e.ctrlKey&&!e.altKey&&!e.metaKey&&null===this.state.draggingElement){const t=(e=>{const t=Vc.find(((t,n)=>e===(n+1).toString()||t.key&&("string"===typeof t.key?t.key===e:t.key.includes(e))));return(null===t||void 0===t?void 0:t.value)||null})(e.key);t?this.selectShapeTool(t):e.key===me&&this.toggleLock()}if(e.key===se&&0===dh.pointers.size&&(ih=!0,ze(this.canvas,d.e.GRABBING)),e.key===ce||e.key===ge){const t=hr(this.scene.getElements(),this.state);if("selection"===this.state.elementType&&!t.length)return;e.key===ce&&(gr(this.state.elementType)||t.some((e=>gr(e.type))))&&this.setState({openPopup:"backgroundColorPicker"}),e.key===ge&&this.setState({openPopup:"strokeColorPicker"})}}})),this.onKeyUp=Ze((e=>{if(e.key===se&&(this.state.viewModeEnabled?ze(this.canvas,d.e.GRAB):"selection"===this.state.elementType?Pe(this.canvas):(Ne(this.canvas,this.state.elementType),this.setState({selectedElementIds:{},selectedGroupIds:{},editingGroupId:null})),ih=!1),e[$]||this.state.isBindingEnabled||this.setState({isBindingEnabled:!0}),we(e.key)){const e=hr(this.scene.getElements(),this.state);gs(this.state)?vs(e):Es(e),this.setState({suggestedBindings:[]})}})),this.onGestureStart=Ze((e=>{e.preventDefault(),this.setState({selectedElementIds:{}}),dh.initialScale=this.state.zoom.value})),this.onGestureChange=Ze((e=>{if(e.preventDefault(),2===dh.pointers.size)return;const t=dh.initialScale;t&&this.setState((n=>{let{zoom:i,offsetLeft:s,offsetTop:r}=n;return{zoom:Sr(Er(t*e.scale),i,{left:s,top:r},{x:th,y:nh})}}))})),this.onGestureEnd=Ze((e=>{e.preventDefault(),this.setState({previousSelectedElementIds:{},selectedElementIds:this.state.previousSelectedElementIds}),dh.initialScale=null})),this.startTextEditing=e=>{let{sceneX:t,sceneY:n,insertAtParentCenter:i=!0}=e;const s=this.getTextElementAtPosition(t,n),r=i&&this.getTextWysiwygSnappedToCenterPosition(t,n,this.state,this.canvas,window.devicePixelRatio),o=s||Vn({x:r?r.elementCenterX:t,y:r?r.elementCenterY:n,strokeColor:this.state.currentItemStrokeColor,backgroundColor:this.state.currentItemBackgroundColor,fillStyle:this.state.currentItemFillStyle,strokeWidth:this.state.currentItemStrokeWidth,strokeStyle:this.state.currentItemStrokeStyle,roughness:this.state.currentItemRoughness,opacity:this.state.currentItemOpacity,strokeSharpness:this.state.currentItemStrokeSharpness,text:"",fontSize:this.state.currentItemFontSize,fontFamily:this.state.currentItemFontFamily,textAlign:r?"center":this.state.currentItemTextAlign,verticalAlign:r?"middle":d.m});this.setState({editingElement:o}),s?r&&"center"===o.textAlign||Cn(o,{verticalAlign:d.m}):(this.scene.replaceAllElements([...this.scene.getElementsIncludingDeleted(),o]),r||Cn(o,{y:o.y-o.baseline/2})),this.setState({editingElement:o}),this.handleTextWysiwyg(o,{isExistingElement:!!s})},this.handleCanvasDoubleClick=e=>{if(this.state.multiElement)return;if("selection"!==this.state.elementType)return;const t=hr(this.scene.getElements(),this.state);if(1===t.length&&ft(t[0]))return void(this.state.editingLinearElement&&this.state.editingLinearElement.elementId===t[0].id||(this.history.resumeRecording(),this.setState({editingLinearElement:new ps(t[0],this.scene)})));Pe(this.canvas);const{x:n,y:i}=He(e,this.state);if(zn(this.state).length>0){const e=this.getElementAtPosition(n,i),t=e&&((e,t)=>e.groupIds.find((e=>t[e])))(e,this.state.selectedGroupIds);if(t)return void this.setState((n=>Nn({...n,editingGroupId:t,selectedElementIds:{[e.id]:!0},selectedGroupIds:{}},this.scene.getElements())))}Pe(this.canvas),e[$]||this.state.viewModeEnabled||this.startTextEditing({sceneX:n,sceneY:i,insertAtParentCenter:!e.altKey})},this.handleCanvasPointerMove=e=>{this.savePointer(e.clientX,e.clientY,this.state.cursorButton),dh.pointers.has(e.pointerId)&&dh.pointers.set(e.pointerId,{x:e.clientX,y:e.clientY});const t=dh.initialScale;if(2===dh.pointers.size&&dh.lastCenter&&t&&dh.initialDistance){const e=Bc(dh.pointers),n=e.x-dh.lastCenter.x,i=e.y-dh.lastCenter.y;dh.lastCenter=e;const s=Hc(Array.from(dh.pointers.values()))/dh.initialDistance;this.setState((r=>{let{zoom:o,scrollX:a,scrollY:l,offsetLeft:c,offsetTop:d}=r;return{scrollX:a+n/o.value,scrollY:l+i/o.value,zoom:Sr(Er(t*s),o,{left:c,top:d},e),shouldCacheIgnoreZoom:!0}})),this.resetShouldCacheIgnoreZoomDebounced()}else dh.lastCenter=dh.initialDistance=dh.initialScale=null;if(ih||sh||rh)return;const n=cr(oh,e.clientX-this.state.offsetLeft,e.clientY-this.state.offsetTop).isOverEither;this.state.draggingElement||this.state.multiElement||(n?Pe(this.canvas):Ne(this.canvas,this.state.elementType));const i=He(e,this.state),{x:s,y:r}=i;if(this.state.editingLinearElement&&!this.state.editingLinearElement.isDragging){const t=ps.handlePointerMove(e,s,r,this.state.editingLinearElement,this.state.gridSize);t!==this.state.editingLinearElement&&this.setState({editingLinearElement:t}),null!=t.lastUncommittedPoint?this.maybeSuggestBindingAtCursor(i):this.setState({suggestedBindings:[]})}if(xt(this.state.elementType)){const{draggingElement:e}=this.state;yt(e)?this.maybeSuggestBindingForLinearElementAtCursor(e,"end",i,this.state.startBoundElement):this.maybeSuggestBindingAtCursor(i)}if(this.state.multiElement){const{multiElement:e}=this.state,{x:t,y:n}=e,{points:i,lastCommittedPoint:o}=e,a=i[i.length-1];return Ne(this.canvas,this.state.elementType),void(a===o?Ot(s-t,r-n,a[0],a[1])>=d.A?Cn(e,{points:[...i,[s-t,r-n]]}):ze(this.canvas,d.e.POINTER):i.length>2&&o&&Ot(s-t,r-n,o[0],o[1])<d.A?(ze(this.canvas,d.e.POINTER),Cn(e,{points:i.slice(0,-1)})):(Ct(i,this.state.zoom.value)&&ze(this.canvas,d.e.POINTER),Cn(e,{points:[...i.slice(0,-1),[s-t,r-n]]})))}if(Boolean(e.buttons)||"selection"!==this.state.elementType&&"text"!==this.state.elementType)return;const o=this.scene.getElements(),a=hr(o,this.state);if(1!==a.length||n||this.state.editingLinearElement){if(a.length>1&&!n){const t=hs(Ft(a),s,r,this.state.zoom,e.pointerType);if(t)return void ze(this.canvas,ms({transformHandleType:t}))}}else{const t=ds(o,this.state,s,r,this.state.zoom,e.pointerType);if(t&&t.transformHandleType)return void ze(this.canvas,ms(t))}const l=this.getElementAtPosition(i.x,i.y);"text"===this.state.elementType?ze(this.canvas,pt(l)?d.e.TEXT:d.e.CROSSHAIR):this.state.viewModeEnabled?ze(this.canvas,d.e.GRAB):n||e[$]||!l&&!this.isHittingCommonBoundingBoxOfSelectedElements(i,a)?ze(this.canvas,d.e.AUTO):ze(this.canvas,d.e.MOVE)},this.handleTouchMove=e=>{lh=!0},this.handleCanvasPointerDown=e=>{const t=document.getSelection();if((null===t||void 0===t?void 0:t.anchorNode)&&t.removeAllRanges(),this.maybeOpenContextMenuAfterPointerDownOnTouchDevices(e),this.maybeCleanupAfterMissingPointerUp(e),sh)return;if(this.setState({lastPointerDownWith:e.pointerType,cursorButton:"down"}),this.savePointer(e.clientX,e.clientY,"down"),this.handleCanvasPanUsingWheelOrSpaceDrag(e))return;if(e.button!==d.I.MAIN&&e.button!==d.I.TOUCH)return;if(this.updateGestureOnPointerDown(e),dh.pointers.size>1)return;const n=this.initialPointerDownState(e);if(this.handleDraggingScrollBar(e,n))return;if(this.clearSelectionIfNotUsingSelection(),this.updateBindingEnabledOnPointerMove(e),this.handleSelectionOnPointerDown(e,n))return;if("text"===this.state.elementType)return void this.handleTextOnPointerDown(e,n);if("arrow"===this.state.elementType||"line"===this.state.elementType)this.handleLinearElementOnPointerDown(e,this.state.elementType,n);else if("image"===this.state.elementType){if(ze(this.canvas,d.e.CROSSHAIR),!this.state.pendingImageElement)return;this.setState({draggingElement:this.state.pendingImageElement,editingElement:this.state.pendingImageElement,pendingImageElement:null,multiElement:null});const{x:t,y:n}=He(e,this.state);Cn(this.state.pendingImageElement,{x:t,y:n})}else"freedraw"===this.state.elementType?this.handleFreeDrawElementOnPointerDown(e,this.state.elementType,n):this.createGenericElementOnPointerDown(this.state.elementType,n);const i=this.onPointerMoveFromPointerDownHandler(n),s=this.onPointerUpFromPointerDownHandler(n),r=this.onKeyDownFromPointerDownHandler(n),o=this.onKeyUpFromPointerDownHandler(n);ch=s,this.state.viewModeEnabled||(window.addEventListener(d.s.POINTER_MOVE,i),window.addEventListener(d.s.POINTER_UP,s),window.addEventListener(d.s.KEYDOWN,r),window.addEventListener(d.s.KEYUP,o),n.eventListeners.onMove=i,n.eventListeners.onUp=s,n.eventListeners.onKeyUp=o,n.eventListeners.onKeyDown=r)},this.maybeOpenContextMenuAfterPointerDownOnTouchDevices=e=>{"touch"===e.pointerType&&(lh=!1,ah?lh=!0:ah=window.setTimeout((()=>{ah=0,lh||this.handleCanvasContextMenu(e)}),d.T))},this.handleCanvasPanUsingWheelOrSpaceDrag=e=>{if(0!==dh.pointers.size||!(e.button===d.I.WHEEL||e.button===d.I.MAIN&&ih||this.state.viewModeEnabled))return!1;sh=!0;let t=!1;const n=/Linux/.test(window.navigator.platform);ze(this.canvas,d.e.GRABBING);let{clientX:i,clientY:s}=e;const r=Ze((e=>{const r=i-e.clientX,o=s-e.clientY;if(i=e.clientX,s=e.clientY,n&&!t&&(Math.abs(r)>1||Math.abs(o)>1)){t=!0;const e=t=>{document.body.removeEventListener(d.s.PASTE,e),t.stopPropagation()},n=()=>{setTimeout((()=>{document.body.removeEventListener(d.s.PASTE,e),window.removeEventListener(d.s.POINTER_UP,n)}),100)};document.body.addEventListener(d.s.PASTE,e),window.addEventListener(d.s.POINTER_UP,n)}this.setState({scrollX:this.state.scrollX-r/this.state.zoom.value,scrollY:this.state.scrollY-o/this.state.zoom.value})})),o=Ze(ch=()=>{ch=null,sh=!1,ih||(this.state.viewModeEnabled?ze(this.canvas,d.e.GRAB):Ne(this.canvas,this.state.elementType)),this.setState({cursorButton:"up"}),this.savePointer(e.clientX,e.clientY,"up"),window.removeEventListener(d.s.POINTER_MOVE,r),window.removeEventListener(d.s.POINTER_UP,o),window.removeEventListener(d.s.BLUR,o)});return window.addEventListener(d.s.BLUR,o),window.addEventListener(d.s.POINTER_MOVE,r,{passive:!0}),window.addEventListener(d.s.POINTER_UP,o),!0},this.clearSelectionIfNotUsingSelection=()=>{"selection"!==this.state.elementType&&this.setState({selectedElementIds:{},selectedGroupIds:{},editingGroupId:null})},this.handleSelectionOnPointerDown=(e,t)=>{if("selection"===this.state.elementType){const i=this.scene.getElements(),s=hr(i,this.state);if(1!==s.length||this.state.editingLinearElement)s.length>1&&(t.resize.handleType=hs(Ft(s),t.origin.x,t.origin.y,this.state.zoom,e.pointerType));else{const n=ds(i,this.state,t.origin.x,t.origin.y,this.state.zoom,e.pointerType);null!=n&&(this.setState({resizingElement:n.element}),t.resize.handleType=n.transformHandleType)}if(t.resize.handleType)ze(this.canvas,ms({transformHandleType:t.resize.handleType})),t.resize.isResizing=!0,t.resize.offset=Ge(((e,t,n,i)=>{const[s,r,o,a]=1===t.length?Pt(t[0]):Ft(t),l=(s+o)/2,c=(r+a)/2,d=1===t.length?t[0].angle:0;switch([n,i]=jt(n,i,l,c,-d),e){case"n":return jt(n-(s+o)/2,i-r,0,0,d);case"s":return jt(n-(s+o)/2,i-a,0,0,d);case"w":return jt(n-s,i-(r+a)/2,0,0,d);case"e":return jt(n-o,i-(r+a)/2,0,0,d);case"nw":return jt(n-s,i-r,0,0,d);case"ne":return jt(n-o,i-r,0,0,d);case"sw":return jt(n-s,i-a,0,0,d);case"se":return jt(n-o,i-a,0,0,d);default:return[0,0]}})(t.resize.handleType,s,t.origin.x,t.origin.y)),1===s.length&&ft(s[0])&&2===s[0].points.length&&(t.resize.arrowDirection=((e,t)=>{const[,[n,i]]=t.points;return"nw"===e&&(n<0||i<0)||"ne"===e&&n>=0||"sw"===e&&n<=0||"se"===e&&(n>0||i>0)?"end":"origin"})(t.resize.handleType,s[0]));else{var n;if(this.state.editingLinearElement){const n=ps.handlePointerDown(e,this.state,(e=>this.setState(e)),this.history,t.origin);if(n.hitElement&&(t.hit.element=n.hitElement),n.didAddPoint)return!0}t.hit.element=null!==(n=t.hit.element)&&void 0!==n?n:this.getElementAtPosition(t.origin.x,t.origin.y),t.hit.allHitElements=this.getElementsAtPosition(t.origin.x,t.origin.y);const i=t.hit.element,s=t.hit.allHitElements.some((e=>this.isASelectedElement(e)));if(null!==i&&s||e.shiftKey||t.hit.hasHitCommonBoundingBoxOfSelectedElements||this.clearSelection(i),null!=i){if(e[$])return this.state.selectedElementIds[i.id]||(t.hit.wasAddedToSelection=!0),this.setState((e=>{return{...(t=e,n=i,{...t,editingGroupId:n.groupIds.length?n.groupIds[0]:null,selectedGroupIds:{},selectedElementIds:{[n.id]:!0}}),previousSelectedElementIds:this.state.selectedElementIds};var t,n})),!1;this.state.selectedElementIds[i.id]||(this.state.editingGroupId&&!Rn(i,this.state.editingGroupId)&&this.setState({selectedElementIds:{},selectedGroupIds:{},editingGroupId:null}),s||t.hit.hasHitCommonBoundingBoxOfSelectedElements||(this.setState((e=>Nn({...e,selectedElementIds:{...e.selectedElementIds,[i.id]:!0}},this.scene.getElements()))),t.hit.wasAddedToSelection=!0))}this.setState({previousSelectedElementIds:this.state.selectedElementIds})}}return!1},this.handleTextOnPointerDown=(e,t)=>{var n;"text"!==(null===(n=this.state.editingElement)||void 0===n?void 0:n.type)&&(this.startTextEditing({sceneX:t.origin.x,sceneY:t.origin.y,insertAtParentCenter:!e.altKey}),Pe(this.canvas),this.state.elementLocked||this.setState({elementType:"selection"}))},this.handleFreeDrawElementOnPointerDown=(e,t,n)=>{const[i,s]=Tt(n.origin.x,n.origin.y,null),r=(o={type:t,x:i,y:s,strokeColor:this.state.currentItemStrokeColor,backgroundColor:this.state.currentItemBackgroundColor,fillStyle:this.state.currentItemFillStyle,strokeWidth:this.state.currentItemStrokeWidth,strokeStyle:this.state.currentItemStrokeStyle,roughness:this.state.currentItemRoughness,opacity:this.state.currentItemOpacity,strokeSharpness:this.state.currentItemLinearStrokeSharpness,simulatePressure:.5===e.pressure},{..._n(o.type,o),points:o.points||[],pressures:[],simulatePressure:o.simulatePressure,lastCommittedPoint:null});var o;this.setState((e=>({selectedElementIds:{...e.selectedElementIds,[r.id]:!1}})));const a=r.simulatePressure?r.pressures:[...r.pressures,e.pressure];Cn(r,{points:[[0,0]],pressures:a});const l=Cs(n.origin,this.scene);this.scene.replaceAllElements([...this.scene.getElementsIncludingDeleted(),r]),this.setState({draggingElement:r,editingElement:r,startBoundElement:l,suggestedBindings:[]})},this.createImageElement=e=>{let{sceneX:t,sceneY:n}=e;const[i,s]=Tt(t,n,this.state.gridSize);var r;return r={type:"image",x:i,y:s,strokeColor:this.state.currentItemStrokeColor,backgroundColor:this.state.currentItemBackgroundColor,fillStyle:this.state.currentItemFillStyle,strokeWidth:this.state.currentItemStrokeWidth,strokeStyle:this.state.currentItemStrokeStyle,roughness:this.state.currentItemRoughness,opacity:this.state.currentItemOpacity,strokeSharpness:this.state.currentItemLinearStrokeSharpness},{..._n("image",r),strokeColor:"transparent",status:"pending",fileId:null,scale:[1,1]}},this.handleLinearElementOnPointerDown=(e,t,n)=>{if(this.state.multiElement){const{multiElement:e}=this.state;if("line"===e.type&&Ct(e.points,this.state.zoom.value))return Cn(e,{lastCommittedPoint:e.points[e.points.length-1]}),void this.actionManager.executeAction(Na);const{x:t,y:i,lastCommittedPoint:s}=e;if(e.points.length>1&&s&&Ot(n.origin.x-t,n.origin.y-i,s[0],s[1])<d.A)return void this.actionManager.executeAction(Na);this.setState((t=>({selectedElementIds:{...t.selectedElementIds,[e.id]:!0}}))),Cn(e,{lastCommittedPoint:e.points[e.points.length-1]}),ze(this.canvas,d.e.POINTER)}else{const[e,i]=Tt(n.origin.x,n.origin.y,this.state.gridSize),{currentItemStartArrowhead:s,currentItemEndArrowhead:r}=this.state,[o,a]="arrow"===t?[s,r]:[null,null],l=Kn({type:t,x:e,y:i,strokeColor:this.state.currentItemStrokeColor,backgroundColor:this.state.currentItemBackgroundColor,fillStyle:this.state.currentItemFillStyle,strokeWidth:this.state.currentItemStrokeWidth,strokeStyle:this.state.currentItemStrokeStyle,roughness:this.state.currentItemRoughness,opacity:this.state.currentItemOpacity,strokeSharpness:this.state.currentItemLinearStrokeSharpness,startArrowhead:o,endArrowhead:a});this.setState((e=>({selectedElementIds:{...e.selectedElementIds,[l.id]:!1}}))),Cn(l,{points:[...l.points,[0,0]]});const c=Cs(n.origin,this.scene);this.scene.replaceAllElements([...this.scene.getElementsIncludingDeleted(),l]),this.setState({draggingElement:l,editingElement:l,startBoundElement:c,suggestedBindings:[]})}},this.createGenericElementOnPointerDown=(e,t)=>{const[n,i]=Tt(t.origin.x,t.origin.y,this.state.gridSize),s=Fn({type:e,x:n,y:i,strokeColor:this.state.currentItemStrokeColor,backgroundColor:this.state.currentItemBackgroundColor,fillStyle:this.state.currentItemFillStyle,strokeWidth:this.state.currentItemStrokeWidth,strokeStyle:this.state.currentItemStrokeStyle,roughness:this.state.currentItemRoughness,opacity:this.state.currentItemOpacity,strokeSharpness:this.state.currentItemStrokeSharpness});"selection"===s.type?this.setState({selectionElement:s,draggingElement:s}):(this.scene.replaceAllElements([...this.scene.getElementsIncludingDeleted(),s]),this.setState({multiElement:null,draggingElement:s,editingElement:s}))},this.initializeImage=async e=>{var t,n,i;let{imageFile:s,imageElement:r,showCursorImagePreview:o=!1}=e;if(!cl(s))throw new Error(w("errors.unsupportedFileType"));const a=s.type;if(ze(this.canvas,"wait"),a===d.D.svg)try{s=pl(await(async e=>{const t=(new DOMParser).parseFromString(e,d.D.svg),n=t.querySelector("svg");if(t.querySelector("parsererror")||"svg"!==(null===(i=n)||void 0===i?void 0:i.nodeName.toLowerCase()))throw new Error(w("errors.invalidSVGString"));return n.hasAttribute("xmlns")||n.setAttribute("xmlns",d.M),n.outerHTML;var i})(await s.text()),s.name)}catch(p){throw console.warn(p),new Error(w("errors.svgImageInsertError"))}const l=await((null===(t=(n=this.props).generateIdForFile)||void 0===t?void 0:t.call(n,s))||(async e=>{try{const t=await window.crypto.subtle.digest("SHA-1",await e.arrayBuffer());return Qe(new Uint8Array(t))}catch(p){return console.error(p),Object(ht.a)(40)}})(s));if(!l)throw console.warn("Couldn't generate file id or the supplied `generateIdForFile` didn't resolve to one."),new Error(w("errors.imageInsertError"));const c=this.files[l];if(!(null===c||void 0===c?void 0:c.dataURL)){try{s=await ml(s,{maxWidthOrHeight:d.i})}catch(p){console.error("error trying to resing image file on insertion",p)}if(s.size>d.B)throw new Error(w("errors.fileTooBig",{maxSize:"".concat(Math.trunc(d.B/1024/1024),"MB")}))}if(o){var h;const e=null===(h=this.files[l])||void 0===h?void 0:h.dataURL,t=e&&function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const n=e.indexOf(","),i=atob(e.slice(n+1)),s=e.slice(0,n).split(":")[1].split(";")[0],r=new ArrayBuffer(i.length),o=new Uint8Array(r);for(let a=0;a<i.length;a++)o[a]=i.charCodeAt(a);return new File([r],t,{type:s})}(e);this.setImagePreviewCursor(t||s)}const u=(null===(i=this.files[l])||void 0===i?void 0:i.dataURL)||await ul(s),m=Cn(r,{fileId:l},!1);return new Promise((async(e,t)=>{try{var n,i;this.files={...this.files,[l]:{mimeType:a,id:l,dataURL:u,created:Date.now()}};const t=this.imageCache.get(l);t||(this.addNewImagesToImageCache(),await this.updateImageCache([m])),(null===t||void 0===t?void 0:t.image)instanceof Promise&&await t.image,(null===(n=this.state.pendingImageElement)||void 0===n?void 0:n.id)!==m.id&&(null===(i=this.state.draggingElement)||void 0===i?void 0:i.id)!==m.id&&this.initializeImageDimensions(m,!0),e(m)}catch(p){console.error(p),t(new Error(w("errors.imageInsertError")))}finally{o||Pe(this.canvas)}}))},this.insertImageElement=async(e,t,n)=>{this.scene.replaceAllElements([...this.scene.getElementsIncludingDeleted(),e]);try{await this.initializeImage({imageFile:t,imageElement:e,showCursorImagePreview:n})}catch(i){Cn(e,{isDeleted:!0}),this.actionManager.executeAction(Na),this.setState({errorMessage:i.message||w("errors.imageInsertError")})}},this.setImagePreviewCursor=async e=>{const t=await ml(e,{maxWidthOrHeight:96});let n=await ul(t);if(e.type===d.D.svg){const e=await yl(n);let t=Math.min(e.height,96),i=t*(e.width/e.height);i>96&&(i=96,t=i*(e.height/e.width));const s=document.createElement("canvas");s.height=t,s.width=i;s.getContext("2d").drawImage(e,0,0,i,t),n=s.toDataURL(d.D.svg)}this.state.pendingImageElement&&ze(this.canvas,"url(".concat(n,") 4 4, auto"))},this.onImageAction=async function(){let{insertOnCanvasDirectly:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{insertOnCanvasDirectly:!1};try{const n=t.state.width/2+t.state.offsetLeft,i=t.state.height/2+t.state.offsetTop,{x:s,y:r}=He({clientX:n,clientY:i},t.state),o=await Ja({description:"Image",extensions:["jpg","png","svg","gif"]}),a=t.createImageElement({sceneX:s,sceneY:r});e?(t.insertImageElement(a,o),t.initializeImageDimensions(a),t.setState({selectedElementIds:{[a.id]:!0}},(()=>{t.actionManager.executeAction(Na)}))):t.setState({pendingImageElement:a},(()=>{t.insertImageElement(a,o,!0)}))}catch(n){"AbortError"!==n.name?console.error(n):console.warn(n),t.setState({pendingImageElement:null,editingElement:null,elementType:"selection"},(()=>{t.actionManager.executeAction(Na)}))}},this.initializeImageDimensions=function(e){var n;let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const s=ut(e)&&(null===(n=t.imageCache.get(e.fileId))||void 0===n?void 0:n.image);if(!s||s instanceof Promise){if(e.width<d.n/t.state.zoom.value&&e.height<d.n/t.state.zoom.value){const n=100/t.state.zoom.value;Cn(e,{x:e.x-n/2,y:e.y-n/2,width:n,height:n})}}else if(i||e.width<d.n/t.state.zoom.value&&e.height<d.n/t.state.zoom.value){const n=Math.max(t.state.height-120,160),i=Math.min(n,Math.floor(.5*t.state.height)/t.state.zoom.value),r=Math.min(s.naturalHeight,i),o=r*(s.naturalWidth/s.naturalHeight),a=e.x+e.width/2-o/2,l=e.y+e.height/2-r/2;Cn(e,{x:a,y:l,width:o,height:r})}},this.updateImageCache=async function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.files;const{updatedFiles:i,erroredFiles:s}=await xl({imageCache:t.imageCache,fileIds:e.map((e=>e.fileId)),files:n});if(i.size||s.size)for(const t of e)i.has(t.fileId)&&on(t);return s.size&&t.scene.replaceAllElements(t.scene.getElementsIncludingDeleted().map((e=>ut(e)&&s.has(e.fileId)?kn(e,{status:"error"}):e))),{updatedFiles:i,erroredFiles:s}},this.addNewImagesToImageCache=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:wl(t.scene.getElements()),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.files;const i=e.filter((e=>!e.isDeleted&&!t.imageCache.has(e.fileId)));if(i.length){const{updatedFiles:e}=await t.updateImageCache(i,n);e.size&&t.scene.informMutation()}},this.scheduleImageRefresh=Zd()((()=>{this.addNewImagesToImageCache()}),d.z),this.updateBindingEnabledOnPointerMove=e=>{const t=(e=>!e[$])(e);this.state.isBindingEnabled!==t&&this.setState({isBindingEnabled:t})},this.maybeSuggestBindingAtCursor=e=>{const t=Cs(e,this.scene);this.setState({suggestedBindings:null!=t?[t]:[]})},this.maybeSuggestBindingForLinearElementAtCursor=(e,t,n,i)=>{const s=Cs(n,this.scene);this.setState({suggestedBindings:null==s||Ss(e,null===i||void 0===i?void 0:i.id,s)?[]:[s]})},this.handleCanvasRef=e=>{var t,n,i;null!==e?(this.canvas=e,this.rc=dt.a.canvas(this.canvas),this.canvas.addEventListener(d.s.WHEEL,this.handleWheel,{passive:!1}),this.canvas.addEventListener(d.s.TOUCH_START,this.onTapStart),this.canvas.addEventListener(d.s.TOUCH_END,this.onTapEnd)):(null===(t=this.canvas)||void 0===t||t.removeEventListener(d.s.WHEEL,this.handleWheel),null===(n=this.canvas)||void 0===n||n.removeEventListener(d.s.TOUCH_START,this.onTapStart),null===(i=this.canvas)||void 0===i||i.removeEventListener(d.s.TOUCH_END,this.onTapEnd))},this.handleAppOnDrop=async e=>{var t,n;try{const t=e.dataTransfer.files[0];if(cl(t)){if((null===t||void 0===t?void 0:t.type)===d.D.png||(null===t||void 0===t?void 0:t.type)===d.D.svg)try{if(qa.c)try{const n=e.dataTransfer.items[0];t.handle=await n.getAsFileSystemHandle()}catch(r){console.warn(r.name,r.message)}const n=await dl(t,this.state,this.scene.getElementsIncludingDeleted());return void this.syncActionResult({...n,appState:{...n.appState||this.state,isLoading:!1},replaceFiles:!0,commitToHistory:!0})}catch(r){if("EncodingError"!==r.name)throw r}const{x:n,y:i}=He(e,this.state),s=this.createImageElement({sceneX:n,sceneY:i});return this.insertImageElement(s,t),this.initializeImageDimensions(s),void this.setState({selectedElementIds:{[s.id]:!0}})}}catch(r){return this.setState({isLoading:!1,errorMessage:r.message})}const i=e.dataTransfer.getData(d.D.excalidrawlib);if(""!==i)return void this.addElementsFromPasteOrLibrary({elements:JSON.parse(i),position:e,files:null});const s=null===(t=e.dataTransfer)||void 0===t?void 0:t.files[0];if((null===s||void 0===s?void 0:s.type)===d.D.excalidrawlib||(null===s||void 0===s||null===(n=s.name)||void 0===n?void 0:n.endsWith(".excalidrawlib")))this.library.importLibrary(s).then((()=>{this.setState({isLibraryOpen:!1}),this.setState({isLibraryOpen:!0})})).catch((e=>this.setState({isLoading:!1,errorMessage:e.message})));else{if(this.setState({isLoading:!0}),qa.c)try{const t=e.dataTransfer.items[0];s.handle=await t.getAsFileSystemHandle()}catch(r){console.warn(r.name,r.message)}await this.loadFileToCanvas(s)}},this.loadFileToCanvas=e=>{dl(e,this.state,this.scene.getElementsIncludingDeleted()).then((e=>{this.syncActionResult({...e,appState:{...e.appState||this.state,isLoading:!1},replaceFiles:!0,commitToHistory:!0})})).catch((e=>{this.setState({isLoading:!1,errorMessage:e.message})}))},this.handleCanvasContextMenu=e=>{e.preventDefault();const{x:t,y:n}=He(e,this.state),i=this.getElementAtPosition(t,n,{preferSelected:!0}),s=i?"element":"canvas",r=this.excalidrawContainerRef.current,{top:o,left:a}=r.getBoundingClientRect(),l=e.clientX-a,c=e.clientY-o;i&&!this.state.selectedElementIds[i.id]?this.setState({selectedElementIds:{[i.id]:!0}},(()=>{this._openContextMenu({top:c,left:l},s)})):this._openContextMenu({top:c,left:l},s)},this.maybeDragNewGenericElement=(e,t)=>{const n=this.state.draggingElement,i=e.lastCoords;if(n)if("selection"===n.type)Js(n,this.state.elementType,e.origin.x,e.origin.y,i.x,i.y,De(e.origin.x,i.x),De(e.origin.y,i.y),Se(t),je(t));else{var s;const[r,o]=Tt(i.x,i.y,this.state.gridSize),a=ut(n)&&(null===(s=this.imageCache.get(n.fileId))||void 0===s?void 0:s.image),l=!a||a instanceof Promise?null:a.width/a.height;Js(n,this.state.elementType,e.originInGrid.x,e.originInGrid.y,r,o,De(e.originInGrid.x,r),De(e.originInGrid.y,o),mt(n)?!Se(t):Se(t),je(t),l),this.maybeSuggestBindingForAll([n])}},this.maybeHandleResize=(e,t)=>{const n=hr(this.scene.getElements(),this.state),i=e.resize.handleType;this.setState({isResizing:i&&"rotation"!==i,isRotating:"rotation"===i});const s=e.lastCoords,[r,o]=Tt(s.x-e.resize.offset.x,s.y-e.resize.offset.y,this.state.gridSize);return!!((e,t,n,i,s,r,o,a,l,c,d)=>{if(1===n.length){const[c]=n;return"rotation"===t?(Vs(c,a,l,s),Is(c)):!ft(c)||2!==c.points.length||"nw"!==t&&"ne"!==t&&"sw"!==t&&"se"!==t?!pt(c)||"nw"!==t&&"ne"!==t&&"sw"!==t&&"se"!==t?t&&Zs(e.originalElements.get(c.id),o,c,t,r,a,l):(Ys(c,t,r,a,l),Is(c)):Gs(c,i,s,a,l),!0}if(n.length>1){if("rotation"===t)return qs(e,n,a,l,s,c,d),!0;if("nw"===t||"ne"===t||"sw"===t||"se"===t)return Xs(n,t,a,l),!0}return!1})(e,i,n,e.resize.arrowDirection,Ee(t),je(t),1===n.length&&mt(n[0])?!Se(t):Se(t),r,o,e.resize.center.x,e.resize.center.y)&&(this.maybeSuggestBindingForAll(n),!0)},this._openContextMenu=(e,t)=>{let{left:n,top:i}=e;const s=dc.contextItemPredicate(this.actionManager.getElementsIncludingDeleted(),this.actionManager.getAppState()),r=hc.contextItemPredicate(this.actionManager.getElementsIncludingDeleted(),this.actionManager.getAppState()),o=jc.contextItemPredicate(this.actionManager.getElementsIncludingDeleted(),this.actionManager.getAppState()),a=Sc.contextItemPredicate(this.actionManager.getElementsIncludingDeleted(),this.actionManager.getAppState()),l="separator",c=this.scene.getElements(),d=[];if(Kl&&c.length>0&&d.push(Tc),Wl&&c.length>0&&d.push(Ac),"canvas"===t){const e=[...d,"undefined"===typeof this.props.gridModeEnabled&&Lc,"undefined"===typeof this.props.zenModeEnabled&&Dc,"undefined"===typeof this.props.viewModeEnabled&&Kd,Pc];this.state.viewModeEnabled?Zc.push({options:e,top:i,left:n,actionManager:this.actionManager,appState:this.state,container:this.excalidrawContainerRef.current}):Zc.push({options:[this.isMobile&&navigator.clipboard&&{name:"paste",perform:(e,t)=>(this.pasteFromClipboard(null),{commitToHistory:!1}),contextItemLabel:"labels.paste"},this.isMobile&&navigator.clipboard&&l,Kl&&c.length>0&&Tc,Wl&&c.length>0&&Ac,(Kl&&c.length>0||Wl&&c.length>0)&&l,ga,l,"undefined"===typeof this.props.gridModeEnabled&&Lc,"undefined"===typeof this.props.zenModeEnabled&&Dc,"undefined"===typeof this.props.viewModeEnabled&&Kd,Pc],top:i,left:n,actionManager:this.actionManager,appState:this.state,container:this.excalidrawContainerRef.current})}else"element"===t&&(this.state.viewModeEnabled?Zc.push({options:[navigator.clipboard&&Ic,...d],top:i,left:n,actionManager:this.actionManager,appState:this.state,container:this.excalidrawContainerRef.current}):Zc.push({options:[this.isMobile&&Mc,this.isMobile&&navigator.clipboard&&Ic,this.isMobile&&navigator.clipboard&&{name:"paste",perform:(e,t)=>(this.pasteFromClipboard(null),{commitToHistory:!1}),contextItemLabel:"labels.paste"},this.isMobile&&l,...d,l,oc,ac,l,s&&dc,r&&hc,(s||r)&&l,mc,l,ha,ua,ma,pa,l,o&&jc,a&&Sc,(o||a)&&l,ba,ta],top:i,left:n,actionManager:this.actionManager,appState:this.state,container:this.excalidrawContainerRef.current}))},this.handleWheel=Ze((e=>{if(e.preventDefault(),sh)return;const{deltaX:t,deltaY:n}=e,{selectedElementIds:i,previousSelectedElementIds:s}=this.state;if(e.metaKey||e.ctrlKey){const e=Math.sign(n),t=10;let r=Math.abs(n);r>t&&(r=t),r*=e,0!==Object.keys(s).length&&setTimeout((()=>{this.setState({selectedElementIds:s,previousSelectedElementIds:{}})}),1e3);let o=this.state.zoom.value-r/100;return o+=Math.log10(Math.max(1,this.state.zoom.value))*-e,o=Math.round(o*d.Z*100)/(100*d.Z),this.setState((e=>{let{zoom:t,offsetLeft:n,offsetTop:r}=e;return{zoom:Sr(Er(o),t,{left:n,top:r},{x:th,y:nh}),selectedElementIds:{},previousSelectedElementIds:0!==Object.keys(i).length?i:s,shouldCacheIgnoreZoom:!0}})),void this.resetShouldCacheIgnoreZoomDebounced()}e.shiftKey?this.setState((e=>{let{zoom:i,scrollX:s}=e;return{scrollX:s-(n||t)/i.value}})):this.setState((e=>{let{zoom:i,scrollX:s,scrollY:r}=e;return{scrollX:s-t/i.value,scrollY:r-n/i.value}}))})),this.savePointer=(e,t,n)=>{var i,s;if(!e||!t)return;const r=He({clientX:e,clientY:t},this.state);isNaN(r.x)||isNaN(r.y),null===(i=(s=this.props).onPointerUpdate)||void 0===i||i.call(s,{pointer:r,button:n,pointersMap:dh.pointers})},this.resetShouldCacheIgnoreZoomDebounced=Le((()=>{this.unmounted||this.setState({shouldCacheIgnoreZoom:!1})}),300),this.updateDOMRect=e=>{var t;if(null===(t=this.excalidrawContainerRef)||void 0===t?void 0:t.current){const t=this.excalidrawContainerRef.current,{width:n,height:i,left:s,top:r}=t.getBoundingClientRect(),{width:o,height:a,offsetTop:l,offsetLeft:c}=this.state;if(n===o&&i===a&&s===c&&r===l)return void(e&&e());this.setState({width:n,height:i,offsetLeft:s,offsetTop:r},(()=>{e&&e()}))}},this.refresh=()=>{this.setState({...this.getCanvasOffsets()})};const n=nt(),{excalidrawRef:i,viewModeEnabled:s=!1,zenModeEnabled:r=!1,gridModeEnabled:o=!1,theme:c=n.theme,name:h=n.name}=e;if(this.state={...n,theme:c,isLoading:!0,...this.getCanvasOffsets(),viewModeEnabled:s,zenModeEnabled:r,gridSize:o?d.x:null,name:h,width:window.innerWidth,height:window.innerHeight},this.id=Object(ht.a)(),i){var u;const e="current"in i&&(null===(u=i.current)||void 0===u?void 0:u.readyPromise)||Ye(),t={ready:!0,readyPromise:e,updateScene:this.updateScene,addFiles:this.addFiles,resetScene:this.resetScene,getSceneElementsIncludingDeleted:this.getSceneElementsIncludingDeleted,history:{clear:this.resetHistory},scrollToContent:this.scrollToContent,getSceneElements:this.getSceneElements,getAppState:()=>this.state,getFiles:()=>this.files,refresh:this.refresh,importLibrary:this.importLibraryFromUrl,setToastMessage:this.setToastMessage,id:this.id};"function"===typeof i?i(t):i.current=t,e.resolve(t)}var m;this.excalidrawContainerValue={container:this.excalidrawContainerRef.current,id:this.id},this.scene=new wn,this.library=new Rc(this),this.history=new Uc,this.actionManager=new Nc(this.syncActionResult,(()=>this.state),(()=>this.scene.getElementsIncludingDeleted()),this),this.actionManager.registerAll(Qo),this.actionManager.registerAction((m=this.history,{name:"undo",perform:(e,t)=>zc(e,t,(()=>m.undoOnce())),keyTest:e=>e[$]&&e.key.toLowerCase()===xe&&!e.shiftKey,PanelComponent:e=>{let{updateData:t,data:n}=e;return Object(kr.jsx)(Mr,{type:"button",icon:Xr,"aria-label":w("buttons.undo"),onClick:t,size:(null===n||void 0===n?void 0:n.size)||"medium"})},commitToHistory:()=>!1})),this.actionManager.registerAction((e=>({name:"redo",perform:(t,n)=>zc(t,n,(()=>e.redoOnce())),keyTest:e=>e[$]&&e.shiftKey&&e.key.toLowerCase()===xe||O&&e.ctrlKey&&!e.shiftKey&&e.key===ye,PanelComponent:e=>{let{updateData:t,data:n}=e;return Object(kr.jsx)(Mr,{type:"button",icon:qr,"aria-label":w("buttons.redo"),onClick:t,size:(null===n||void 0===n?void 0:n.size)||"medium"})},commitToHistory:()=>!1}))(this.history))}renderCanvas(){const e=window.devicePixelRatio,{width:t,height:n,viewModeEnabled:i}=this.state,s=t*e,r=n*e;return i?Object(kr.jsx)("canvas",{className:"excalidraw__canvas",style:{width:t,height:n,cursor:d.e.GRAB},width:s,height:r,ref:this.handleCanvasRef,onContextMenu:this.handleCanvasContextMenu,onPointerMove:this.handleCanvasPointerMove,onPointerUp:this.removePointer,onPointerCancel:this.removePointer,onTouchMove:this.handleTouchMove,onPointerDown:this.handleCanvasPointerDown,children:w("labels.drawingCanvas")}):Object(kr.jsx)("canvas",{className:"excalidraw__canvas",style:{width:t,height:n},width:s,height:r,ref:this.handleCanvasRef,onContextMenu:this.handleCanvasContextMenu,onPointerDown:this.handleCanvasPointerDown,onDoubleClick:this.handleCanvasDoubleClick,onPointerMove:this.handleCanvasPointerMove,onPointerUp:this.removePointer,onPointerCancel:this.removePointer,onTouchMove:this.handleTouchMove,children:w("labels.drawingCanvas")})}render(){var e,t;const{zenModeEnabled:n,viewModeEnabled:i}=this.state,{onCollabButtonClick:s,renderTopRightUI:r,renderFooter:o,renderCustomStats:a}=this.props;return Object(kr.jsx)("div",{className:Object(lt.a)("excalidraw excalidraw-container",{"excalidraw--view-mode":i,"excalidraw--mobile":this.isMobile}),ref:this.excalidrawContainerRef,onDrop:this.handleAppOnDrop,tabIndex:0,onKeyDown:this.props.handleKeyboardGlobally?void 0:this.onKeyDown,children:Object(kr.jsx)(Jd.Provider,{value:this.excalidrawContainerValue,children:Object(kr.jsxs)(Xd.Provider,{value:this.isMobile,children:[Object(kr.jsx)(Vd,{canvas:this.canvas,appState:this.state,files:this.files,setAppState:this.setAppState,actionManager:this.actionManager,elements:this.scene.getElements(),onCollabButtonClick:s,onLockToggle:this.toggleLock,onInsertElements:e=>this.addElementsFromPasteOrLibrary({elements:e,position:"center",files:null}),zenModeEnabled:n,toggleZenMode:this.toggleZenMode,langCode:y().code,isCollaborating:this.props.isCollaborating||!1,renderTopRightUI:r,renderCustomFooter:o,viewModeEnabled:i,showExitZenModeBtn:"undefined"===typeof(null===(e=this.props)||void 0===e?void 0:e.zenModeEnabled)&&n,showThemeBtn:"undefined"===typeof(null===(t=this.props)||void 0===t?void 0:t.theme)&&this.props.UIOptions.canvasActions.theme,libraryReturnUrl:this.props.libraryReturnUrl,UIOptions:this.props.UIOptions,focusContainer:this.focusContainer,library:this.library,id:this.id,onImageAction:this.onImageAction}),Object(kr.jsx)("div",{className:"excalidraw-textEditorContainer"}),Object(kr.jsx)("div",{className:"excalidraw-contextMenuContainer"}),this.state.showStats&&Object(kr.jsx)(Gd,{appState:this.state,setAppState:this.setAppState,elements:this.scene.getElements(),onClose:this.toggleStats,renderCustomStats:a}),null!==this.state.toastMessage&&Object(kr.jsx)(Wd,{message:this.state.toastMessage,clearToast:this.clearToast}),Object(kr.jsx)("main",{children:this.renderCanvas()})]})})})}async componentDidMount(){var e,t,n=this;if(this.excalidrawContainerValue.container=this.excalidrawContainerRef.current,"production"===d.r.TEST||"production"===d.r.DEVELOPMENT){this.setState.bind(this);Object.defineProperties(window.h,{state:{configurable:!0,get:()=>this.state},setState:{configurable:!0,value:function(){return n.setState(...arguments)}},app:{configurable:!0,value:this},history:{configurable:!0,value:this.history}})}if(this.scene.addCallback(this.onSceneUpdated),this.addEventListeners(),this.excalidrawContainerRef.current&&this.focusContainer(),"ResizeObserver"in window&&(null===(e=this.excalidrawContainerRef)||void 0===e?void 0:e.current))this.resizeObserver=new ResizeObserver((()=>{const{width:e,height:t}=this.excalidrawContainerRef.current.getBoundingClientRect();this.isMobile=e<d.H||t<d.F&&e<d.G,this.updateDOMRect()})),null===(t=this.resizeObserver)||void 0===t||t.observe(this.excalidrawContainerRef.current);else if(window.matchMedia){const e=window.matchMedia("(max-width: ".concat(d.H,"px), (max-height: ").concat(d.F,"px) and (max-width: ").concat(d.G,"px)")),t=()=>this.isMobile=e.matches;e.addListener(t),this.detachIsMobileMqHandler=()=>e.removeListener(t)}new URLSearchParams(window.location.search.slice(1)).has("web-share-target")?this.restoreFileFromShare():this.updateDOMRect(this.initializeScene)}componentWillUnmount(){var e;this.files={},this.imageCache.clear(),null===(e=this.resizeObserver)||void 0===e||e.disconnect(),this.unmounted=!0,this.removeEventListeners(),this.scene.destroy(),clearTimeout(ah),ah=0}removeEventListeners(){var e,t;document.removeEventListener(d.s.POINTER_UP,this.removePointer),document.removeEventListener(d.s.COPY,this.onCopy),document.removeEventListener(d.s.PASTE,this.pasteFromClipboard),document.removeEventListener(d.s.CUT,this.onCut),null===(e=this.nearestScrollableContainer)||void 0===e||e.removeEventListener(d.s.SCROLL,this.onScroll),document.removeEventListener(d.s.KEYDOWN,this.onKeyDown,!1),document.removeEventListener(d.s.MOUSE_MOVE,this.updateCurrentCursorPosition,!1),document.removeEventListener(d.s.KEYUP,this.onKeyUp),window.removeEventListener(d.s.RESIZE,this.onResize,!1),window.removeEventListener(d.s.UNLOAD,this.onUnload,!1),window.removeEventListener(d.s.BLUR,this.onBlur,!1),window.removeEventListener(d.s.DRAG_OVER,this.disableEvent,!1),window.removeEventListener(d.s.DROP,this.disableEvent,!1),document.removeEventListener(d.s.GESTURE_START,this.onGestureStart,!1),document.removeEventListener(d.s.GESTURE_CHANGE,this.onGestureChange,!1),document.removeEventListener(d.s.GESTURE_END,this.onGestureEnd,!1),null===(t=this.detachIsMobileMqHandler)||void 0===t||t.call(this)}addEventListeners(){var e,t;this.removeEventListeners(),document.addEventListener(d.s.POINTER_UP,this.removePointer),document.addEventListener(d.s.COPY,this.onCopy),this.props.handleKeyboardGlobally&&document.addEventListener(d.s.KEYDOWN,this.onKeyDown,!1),document.addEventListener(d.s.KEYUP,this.onKeyUp,{passive:!0}),document.addEventListener(d.s.MOUSE_MOVE,this.updateCurrentCursorPosition),null===(e=document.fonts)||void 0===e||null===(t=e.addEventListener)||void 0===t||t.call(e,"loadingdone",this.onFontLoaded),document.addEventListener(d.s.GESTURE_START,this.onGestureStart,!1),document.addEventListener(d.s.GESTURE_CHANGE,this.onGestureChange,!1),document.addEventListener(d.s.GESTURE_END,this.onGestureEnd,!1),this.state.viewModeEnabled||(document.addEventListener(d.s.PASTE,this.pasteFromClipboard),document.addEventListener(d.s.CUT,this.onCut),this.props.detectScroll&&(this.nearestScrollableContainer=(e=>{let t=e.parentElement;for(;t;){if(t===document.body)return document;const{overflowY:e}=window.getComputedStyle(t);if(t.scrollHeight>t.clientHeight&&("auto"===e||"scroll"===e))return t;t=t.parentElement}return document})(this.excalidrawContainerRef.current),this.nearestScrollableContainer.addEventListener(d.s.SCROLL,this.onScroll)),window.addEventListener(d.s.RESIZE,this.onResize,!1),window.addEventListener(d.s.UNLOAD,this.onUnload,!1),window.addEventListener(d.s.BLUR,this.onBlur,!1),window.addEventListener(d.s.DRAG_OVER,this.disableEvent,!1),window.addEventListener(d.s.DROP,this.disableEvent,!1))}componentDidUpdate(e,t){var n,i;e.langCode!==this.props.langCode&&this.updateLanguage(),e.viewModeEnabled!==this.props.viewModeEnabled&&this.setState({viewModeEnabled:!!this.props.viewModeEnabled}),t.viewModeEnabled!==this.state.viewModeEnabled&&(this.addEventListeners(),this.deselectElements()),e.zenModeEnabled!==this.props.zenModeEnabled&&this.setState({zenModeEnabled:!!this.props.zenModeEnabled}),e.theme!==this.props.theme&&this.props.theme&&this.setState({theme:this.props.theme}),e.gridModeEnabled!==this.props.gridModeEnabled&&this.setState({gridSize:this.props.gridModeEnabled?d.x:null}),this.props.name&&e.name!==this.props.name&&this.setState({name:this.props.name}),null===(n=this.excalidrawContainerRef.current)||void 0===n||n.classList.toggle("theme--dark","dark"===this.state.theme),this.state.editingLinearElement&&!this.state.selectedElementIds[this.state.editingLinearElement.elementId]&&setTimeout((()=>{this.actionManager.executeAction(Na)}));const{multiElement:s}=t;t.elementType!==this.state.elementType&&null!=s&&gs(this.state)&&yt(s)&&xs(s,this.state,this.scene,Ge(ps.getPointAtIndexGlobalCoordinates(s,-1)));const r={},o={},a={},l={},c={};this.state.collaborators.forEach(((e,t)=>{if(e.selectedElementIds)for(const n of Object.keys(e.selectedElementIds))n in a||(a[n]=[]),a[n].push(t);e.pointer&&(e.username&&(l[t]=e.username),e.userState&&(c[t]=e.userState),o[t]=_e({sceneX:e.pointer.x,sceneY:e.pointer.y},this.state),r[t]=e.button)}));const h=this.scene.getElements().filter((e=>(!mt(e)||!this.state.pendingImageElement||e.id!==this.state.pendingImageElement.id)&&(!this.state.editingElement||"text"!==this.state.editingElement.type||e.id!==this.state.editingElement.id))),{atLeastOneVisibleElement:u,scrollBars:m}=Va(h,this.state,this.state.selectionElement,window.devicePixelRatio,this.rc,this.canvas,{scrollX:this.state.scrollX,scrollY:this.state.scrollY,viewBackgroundColor:this.state.viewBackgroundColor,zoom:this.state.zoom,remotePointerViewportCoords:o,remotePointerButton:r,remoteSelectedElementIds:a,remotePointerUsernames:l,remotePointerUserStates:c,shouldCacheIgnoreZoom:this.state.shouldCacheIgnoreZoom,theme:this.state.theme,imageCache:this.imageCache,isExporting:!1,renderScrollbars:!this.isMobile});m&&(oh=m);const p="text"!==(null===(i=this.state.editingElement)||void 0===i?void 0:i.type)&&(!u&&h.length>0);var g,b;(this.state.scrolledOutside!==p&&this.setState({scrolledOutside:p}),this.history.record(this.state,this.scene.getElementsIncludingDeleted()),this.scheduleImageRefresh(),this.state.isLoading)||(null===(g=(b=this.props).onChange)||void 0===g||g.call(b,this.scene.getElementsIncludingDeleted(),this.state,this.files))}static resetTapTwice(){$d=!1}addTextFromPaste(e){const{x:t,y:n}=He({clientX:th,clientY:nh},this.state),i=Vn({x:t,y:n,strokeColor:this.state.currentItemStrokeColor,backgroundColor:this.state.currentItemBackgroundColor,fillStyle:this.state.currentItemFillStyle,strokeWidth:this.state.currentItemStrokeWidth,strokeStyle:this.state.currentItemStrokeStyle,roughness:this.state.currentItemRoughness,opacity:this.state.currentItemOpacity,strokeSharpness:this.state.currentItemStrokeSharpness,text:e,fontSize:this.state.currentItemFontSize,fontFamily:this.state.currentItemFontFamily,textAlign:this.state.currentItemTextAlign,verticalAlign:d.m});this.scene.replaceAllElements([...this.scene.getElementsIncludingDeleted(),i]),this.setState({selectedElementIds:{[i.id]:!0}}),this.history.resumeRecording()}selectShapeTool(e){var t;ih||Ne(this.canvas,e),(t=document.activeElement)instanceof HTMLElement&&t.className.includes("ToolIcon")&&this.focusContainer(),vt(e)||this.setState({suggestedBindings:[]}),"image"===e&&this.onImageAction(),"selection"!==e?this.setState({elementType:e,selectedElementIds:{},selectedGroupIds:{},editingGroupId:null}):this.setState({elementType:e})}handleTextWysiwyg(e,t){var n=this;let{isExistingElement:i=!1}=t;const s=function(t){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];n.scene.replaceAllElements([...n.scene.getElementsIncludingDeleted().map((n=>n.id===e.id&&pt(n)?Wn(n,{text:t,isDeleted:i}):n))])};(e=>{let{id:t,appState:n,onChange:i,onSubmit:s,getViewportCoords:r,element:o,canvas:a,excalidrawContainer:l}=e;const c=()=>{var e;const i=null===(e=wn.getScene(o))||void 0===e?void 0:e.getElement(t);if(i&&pt(i)){const[e,t]=r(i.x,i.y),{textAlign:s,angle:o}=i;h.value=i.text;const a=i.text.replace(/\r\n?/g,"\n").split("\n"),c=i.height/a.length,d=(n.offsetLeft+n.width-e-8)/n.zoom.value-Number(getComputedStyle(null===l||void 0===l?void 0:l.parentNode).marginRight.slice(0,-2));Object.assign(h.style,{font:Ae(i),lineHeight:"".concat(c,"px"),width:"".concat(i.width,"px"),height:"".concat(i.height,"px"),left:"".concat(e,"px"),top:"".concat(t,"px"),transform:$s(i.width,i.height,o,n,d),textAlign:s,color:i.strokeColor,opacity:i.opacity/100,filter:"var(--theme-filter)",maxWidth:"".concat(d,"px")})}},h=document.createElement("textarea");h.dir="auto",h.tabIndex=0,h.dataset.type="wysiwyg",h.wrap="off",h.classList.add("excalidraw-wysiwyg"),Object.assign(h.style,{position:"absolute",display:"inline-block",minHeight:"1em",backfaceVisibility:"hidden",margin:0,padding:0,border:0,outline:0,resize:"none",background:"transparent",overflow:"hidden",whiteSpace:"pre",zIndex:"var(--zIndex-wysiwyg)"}),c(),i&&(h.oninput=()=>{i(Qs(h.value))}),h.onkeydown=e=>{if(e.stopPropagation(),e.key===ne)e.preventDefault(),v=!0,y();else if(e.key===te&&e[$]){if(e.preventDefault(),e.isComposing||229===e.keyCode)return;v=!0,y()}else(e.key===re||e[$]&&(e.code===L||e.code===T))&&(e.preventDefault(),e.shiftKey||e.code===L?g():p(),h.dispatchEvent(new Event("input")))};const u=" ".repeat(4),m=new RegExp("^ {1,".concat(4,"}")),p=()=>{const{selectionStart:e,selectionEnd:t}=h,n=b();let i=h.value;n.forEach((e=>{const t=i.slice(0,e),n=i.slice(e);i="".concat(t).concat(u).concat(n)})),h.value=i,h.selectionStart=e+4,h.selectionEnd=t+4*n.length},g=()=>{const{selectionStart:e,selectionEnd:t}=h,n=b(),i=[];let s=h.value;n.forEach((e=>{const t=s.slice(e,e+4).match(m);if(t){const n=s.slice(0,e),r=s.slice(e+t[0].length);s="".concat(n).concat(r),i.push(e)}})),h.value=s,i.length&&(e>i[i.length-1]?h.selectionStart=Math.max(e-4,i[i.length-1]):h.selectionStart=e,h.selectionEnd=Math.max(h.selectionStart,t-4*i.length))},b=()=>{let{selectionStart:e,selectionEnd:t,value:n}=h;const i=n.slice(0,e).match(/[^\n]*$/)[0].length;return e-=i,n.slice(e,t).split("\n").reduce(((t,n,i,s)=>t.concat(i?t[i-1]+s[i-1].length+1:e)),[]).reverse()},f=e=>{e.preventDefault(),e.stopPropagation()};let v=!1;const y=()=>{x(),s({text:Qs(h.value),viaKeyboard:v})},x=()=>{E||(E=!0,h.onblur=null,h.oninput=null,h.onkeydown=null,O&&O.disconnect(),window.removeEventListener("resize",c),window.removeEventListener("wheel",f,!0),window.removeEventListener("pointerdown",j),window.removeEventListener("pointerup",w),window.removeEventListener("blur",y),S(),h.remove())},w=()=>{window.removeEventListener("pointerup",w),setTimeout((()=>{h.onblur=y,h.focus()}))},j=e=>{(e.target instanceof HTMLElement||e.target instanceof SVGElement)&&e.target.closest(".".concat(d.d.SHAPE_ACTIONS_MENU))&&!Ie(e.target)&&(h.onblur=null,window.addEventListener("pointerup",w),window.addEventListener("blur",y))},S=wn.getScene(o).addCallback((()=>{c(),h.focus()}));let E=!1;h.select(),w();let O=null;a&&"ResizeObserver"in window?(O=new window.ResizeObserver((()=>{c()})),O.observe(a)):window.addEventListener("resize",c),window.addEventListener("pointerdown",j),window.addEventListener("wheel",f,{passive:!1,capture:!0}),null===l||void 0===l||l.querySelector(".excalidraw-textEditorContainer").appendChild(h)})({id:e.id,appState:this.state,canvas:this.canvas,getViewportCoords:(e,t)=>{const{x:n,y:i}=_e({sceneX:e,sceneY:t},this.state);return[n-this.state.offsetLeft,i-this.state.offsetTop]},onChange:Ze((t=>{s(t),sr(e)&&Is(e)})),onSubmit:Ze((t=>{let{text:n,viaKeyboard:r}=t;const o=!n.trim();s(n,o),!o&&r&&this.setState((t=>({selectedElementIds:{...t.selectedElementIds,[e.id]:!0}}))),o&&_s(this.scene.getElements(),[e]),o&&!i||this.history.resumeRecording(),this.setState({draggingElement:null,editingElement:null}),this.state.elementLocked&&Ne(this.canvas,this.state.elementType),this.focusContainer()})),element:e,excalidrawContainer:this.excalidrawContainerRef.current}),this.deselectElements(),s(e.text)}deselectElements(){this.setState({selectedElementIds:{},selectedGroupIds:{},editingGroupId:null})}getTextElementAtPosition(e,t){const n=this.getElementAtPosition(e,t);return n&&pt(n)&&!n.isDeleted?n:null}getElementAtPosition(e,t,n){const i=this.getElementsAtPosition(e,t);if(i.length>1){if(null===n||void 0===n?void 0:n.preferSelected)for(let e=i.length-1;e>-1;e--)if(this.state.selectedElementIds[i[e].id])return i[e];const s=i[i.length-1];return Ti(s,this.state,e,t)?i[i.length-2]:s}return 1===i.length?i[0]:null}getElementsAtPosition(e,t){return n=this.scene.getElements(),i=n=>((e,t,n,i)=>{const s=10/t.zoom.value,r=[n,i];return Di(t,e)?Pi(e,r,s):Li(e,t,r)})(n,this.state,e,t),n.filter((e=>!e.isDeleted&&i(e)));var n,i}maybeCleanupAfterMissingPointerUp(e){null!==ch&&ch(e)}updateGestureOnPointerDown(e){dh.pointers.set(e.pointerId,{x:e.clientX,y:e.clientY}),2===dh.pointers.size&&(dh.lastCenter=Bc(dh.pointers),dh.initialScale=this.state.zoom.value,dh.initialDistance=Hc(Array.from(dh.pointers.values())))}initialPointerDownState(e){const t=He(e,this.state),n=hr(this.scene.getElements(),this.state),[i,s,r,o]=Ft(n);return{origin:t,withCmdOrCtrl:e[$],originInGrid:Ge(Tt(t.x,t.y,this.state.gridSize)),scrollbars:cr(oh,e.clientX-this.state.offsetLeft,e.clientY-this.state.offsetTop),lastCoords:{...t},originalElements:this.scene.getElements().reduce(((e,t)=>(e.set(t.id,Yn(t)),e)),new Map),resize:{handleType:!1,isResizing:!1,offset:{x:0,y:0},arrowDirection:"origin",center:{x:(r+i)/2,y:(o+s)/2}},hit:{element:null,allHitElements:[],wasAddedToSelection:!1,hasBeenDuplicated:!1,hasHitCommonBoundingBoxOfSelectedElements:this.isHittingCommonBoundingBoxOfSelectedElements(t,n)},drag:{hasOccurred:!1,offset:null},eventListeners:{onMove:null,onUp:null,onKeyUp:null,onKeyDown:null}}}handleDraggingScrollBar(e,t){if(!t.scrollbars.isOverEither||this.state.multiElement)return!1;rh=!0,t.lastCoords.x=e.clientX,t.lastCoords.y=e.clientY;const n=Ze((e=>{e.target instanceof HTMLElement&&this.handlePointerMoveOverScrollbars(e,t)})),i=Ze((()=>{rh=!1,Ne(this.canvas,this.state.elementType),ch=null,this.setState({cursorButton:"up"}),this.savePointer(e.clientX,e.clientY,"up"),window.removeEventListener(d.s.POINTER_MOVE,n),window.removeEventListener(d.s.POINTER_UP,i)}));return ch=i,window.addEventListener(d.s.POINTER_MOVE,n),window.addEventListener(d.s.POINTER_UP,i),!0}isASelectedElement(e){return null!=e&&this.state.selectedElementIds[e.id]}isHittingCommonBoundingBoxOfSelectedElements(e,t){if(t.length<2)return!1;const n=10/this.state.zoom.value,[i,s,r,o]=Ft(t);return e.x>i-n&&e.x<r+n&&e.y>s-n&&e.y<o+n}onKeyDownFromPointerDownHandler(e){return Ze((t=>{this.maybeHandleResize(e,t)||this.maybeDragNewGenericElement(e,t)}))}onKeyUpFromPointerDownHandler(e){return Ze((t=>{t.key===Q&&t.preventDefault(),this.maybeHandleResize(e,t)||this.maybeDragNewGenericElement(e,t)}))}onPointerMoveFromPointerDownHandler(e){return Ze((t=>{null===e.drag.offset&&(e.drag.offset=Ge(((e,t,n)=>{const[i,s]=Ft(e);return[t-i,n-s]})(hr(this.scene.getElements(),this.state),e.origin.x,e.origin.y)));if(!(t.target instanceof HTMLElement))return;if(this.handlePointerMoveOverScrollbars(t,e))return;const n=He(t,this.state),[i,s]=Tt(n.x,n.y,this.state.gridSize);if(!e.drag.hasOccurred&&("arrow"===this.state.elementType||"line"===this.state.elementType)&&Ot(n.x,n.y,e.origin.x,e.origin.y)<d.n)return;if(e.resize.isResizing&&(e.lastCoords.x=n.x,e.lastCoords.y=n.y,this.maybeHandleResize(e,t)))return!0;if(this.state.editingLinearElement){if(ps.handlePointDragging(this.state,(e=>this.setState(e)),n.x,n.y,((e,t)=>{this.maybeSuggestBindingForLinearElementAtCursor(e,t,n)})))return e.lastCoords.x=n.x,void(e.lastCoords.y=n.y)}if(e.hit.allHitElements.some((e=>this.isASelectedElement(e)))||e.hit.hasHitCommonBoundingBoxOfSelectedElements){e.drag.hasOccurred=!0;const i=hr(this.scene.getElements(),this.state);if(i.length>0&&!e.withCmdOrCtrl){const[s,r]=Tt(n.x-e.drag.offset.x,n.y-e.drag.offset.y,this.state.gridSize),[o,a]=[Math.abs(n.x-e.origin.x),Math.abs(n.y-e.origin.y)],l=t.shiftKey;if(function(e,t,n,i,s){let r=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;const[l,c]=Ft(t),d={x:n-l,y:i-c};t.forEach((n=>{let i,s;if(r){const t=r&&o<a,l=r&&o>a,c=e.originalElements.get(n.id);i=t&&c?c.x:n.x+d.x,s=l&&c?c.y:n.y+d.y}else i=n.x+d.x,s=n.y+d.y;Cn(n,{x:i,y:s}),Is(n,{simultaneouslyUpdated:t})}))}(e,i,s,r,this.scene,l,o,a),this.maybeSuggestBindingForAll(i),t.altKey&&!e.hit.hasBeenDuplicated){e.hit.hasBeenDuplicated=!0;const t=[],n=[],i=new Map,o=new Map,a=e.hit.element;for(const c of this.scene.getElementsIncludingDeleted())if(this.state.selectedElementIds[c.id]||c.id===(null===a||void 0===a?void 0:a.id)&&e.hit.wasAddedToSelection){const a=Zn(this.state.editingGroupId,i,c),[l,d]=Tt(e.origin.x-e.drag.offset.x,e.origin.y-e.drag.offset.y,this.state.gridSize);Cn(a,{x:a.x+(l-s),y:a.y+(d-r)}),t.push(a),n.push(c),o.set(c.id,a.id)}else t.push(c);const l=[...t,...n];Bs(l,n,o,"duplicatesServeAsOld"),this.scene.replaceAllElements(l)}return}}const r=this.state.draggingElement;if(r){if("freedraw"===r.type){const e=r.points,i=n.x-r.x,s=n.y-r.y,o=r.simulatePressure?r.pressures:[...r.pressures,t.pressure];Cn(r,{points:[...e,[i,s]],pressures:o})}else if(ft(r)){e.drag.hasOccurred=!0;const o=r.points;let a=i-r.x,l=s-r.y;Ee(t)&&2===o.length&&({width:a,height:l}=An(this.state.elementType,a,l)),1===o.length?Cn(r,{points:[...o,[a,l]]}):o.length>1&&Cn(r,{points:[...o.slice(0,-1),[a,l]]}),yt(r)&&this.maybeSuggestBindingForLinearElementAtCursor(r,"end",n,this.state.startBoundElement)}else e.lastCoords.x=n.x,e.lastCoords.y=n.y,this.maybeDragNewGenericElement(e,t);if("selection"===this.state.elementType){const n=this.scene.getElements();!t.shiftKey&&dr(n,this.state)&&(e.withCmdOrCtrl&&e.hit.element?this.setState((t=>Nn({...t,selectedElementIds:{[e.hit.element.id]:!0}},this.scene.getElements()))):this.setState({selectedElementIds:{},selectedGroupIds:{},editingGroupId:null}));const i=((e,t)=>{const[n,i,s,r]=Pt(t);return e.filter((e=>{const[t,o,a,l]=_t(e);return"selection"!==e.type&&n<=t&&i<=o&&s>=a&&r>=l}))})(n,r);this.setState((t=>Nn({...t,selectedElementIds:{...t.selectedElementIds,...i.reduce(((e,t)=>(e[t.id]=!0,e)),{}),...e.hit.element?{[e.hit.element.id]:!i.length}:null}},this.scene.getElements())))}}}))}handlePointerMoveOverScrollbars(e,t){if(t.scrollbars.isOverHorizontal){const n=e.clientX,i=n-t.lastCoords.x;return this.setState({scrollX:this.state.scrollX-i/this.state.zoom.value}),t.lastCoords.x=n,!0}if(t.scrollbars.isOverVertical){const n=e.clientY,i=n-t.lastCoords.y;return this.setState({scrollY:this.state.scrollY-i/this.state.zoom.value}),t.lastCoords.y=n,!0}return!1}onPointerUpFromPointerDownHandler(e){return Ze((t=>{const{draggingElement:n,resizingElement:i,multiElement:s,elementType:r,elementLocked:o,isResizing:a,isRotating:l}=this.state;if(this.setState({isResizing:!1,isRotating:!1,resizingElement:null,selectionElement:null,cursorButton:"up",editingElement:s||pt(this.state.editingElement)?this.state.editingElement:null}),this.savePointer(t.clientX,t.clientY,"up"),this.state.editingLinearElement){const e=ps.handlePointerUp(t,this.state.editingLinearElement,this.state);e!==this.state.editingLinearElement&&this.setState({editingLinearElement:e,suggestedBindings:[]})}if(ch=null,window.removeEventListener(d.s.POINTER_MOVE,e.eventListeners.onMove),window.removeEventListener(d.s.POINTER_UP,e.eventListeners.onUp),window.removeEventListener(d.s.KEYDOWN,e.eventListeners.onKeyDown),window.removeEventListener(d.s.KEYUP,e.eventListeners.onKeyUp),this.state.pendingImageElement&&this.setState({pendingImageElement:null}),"freedraw"===(null===n||void 0===n?void 0:n.type)){const e=He(t,this.state),i=n.points;let s=e.x-n.x,r=e.y-n.y;s===i[0][0]&&r===i[0][1]&&(r+=1e-4,s+=1e-4);const o=n.simulatePressure?[]:[...n.pressures,t.pressure];return Cn(n,{points:[...i,[s,r]],pressures:o,lastCommittedPoint:[s,r]}),void this.actionManager.executeAction(Na)}if(mt(n)){const e=n;try{this.initializeImageDimensions(e),this.setState({selectedElementIds:{[e.id]:!0}},(()=>{this.actionManager.executeAction(Na)}))}catch(h){console.error(h),this.scene.replaceAllElements(this.scene.getElementsIncludingDeleted().filter((t=>t.id!==e.id))),this.actionManager.executeAction(Na)}return}if(ft(n)){n.points.length>1&&this.history.resumeRecording();const i=He(t,this.state);return void(e.drag.hasOccurred||!n||s?e.drag.hasOccurred&&!s&&(gs(this.state)&&yt(n)&&xs(n,this.state,this.scene,i),this.setState({suggestedBindings:[],startBoundElement:null}),o?this.setState((e=>({draggingElement:null,selectedElementIds:{...e.selectedElementIds,[this.state.draggingElement.id]:!0}}))):(Pe(this.canvas),this.setState((e=>({draggingElement:null,elementType:"selection",selectedElementIds:{...e.selectedElementIds,[this.state.draggingElement.id]:!0}}))))):(Cn(n,{points:[...n.points,[i.x-n.x,i.y-n.y]]}),this.setState({multiElement:n,editingElement:this.state.draggingElement})))}if("selection"!==r&&n&&Mn(n))return this.scene.replaceAllElements(this.scene.getElementsIncludingDeleted().slice(0,-1)),void this.setState({draggingElement:null});n&&Cn(n,Tn(n)),i&&this.history.resumeRecording(),i&&Mn(i)&&this.scene.replaceAllElements(this.scene.getElementsIncludingDeleted().filter((e=>e.id!==i.id)));const c=e.hit.element;if(c&&!e.drag.hasOccurred&&!e.hit.wasAddedToSelection)if(t.shiftKey)if(this.state.selectedElementIds[c.id])if(Dn(this.state,c)){const e=c.groupIds.flatMap((e=>Bn(this.scene.getElements(),e))).map((e=>({[e.id]:!1}))).reduce(((e,t)=>({...e,...t})),{});this.setState((t=>({selectedGroupIds:{...t.selectedElementIds,...c.groupIds.map((e=>({[e]:!1}))).reduce(((e,t)=>({...e,...t})),{})},selectedElementIds:{...t.selectedElementIds,...e}})))}else this.setState((e=>Nn({...e,selectedElementIds:{...e.selectedElementIds,[c.id]:!1}},this.scene.getElements())));else this.setState((e=>({selectedElementIds:{...e.selectedElementIds,[c.id]:!0}})));else this.setState((e=>({...Nn({...e,selectedElementIds:{[c.id]:!0}},this.scene.getElements())})));this.state.editingLinearElement||e.drag.hasOccurred||this.state.isResizing||!(c&&Ti(c,this.state,e.origin.x,e.origin.y)||!c&&e.hit.hasHitCommonBoundingBoxOfSelectedElements)?(!o&&"freedraw"!==r&&n&&this.setState((e=>({selectedElementIds:{...e.selectedElementIds,[n.id]:!0}}))),("selection"!==r||dr(this.scene.getElements(),this.state))&&this.history.resumeRecording(),(e.drag.hasOccurred||a||l)&&(gs(this.state)?vs:Es)(hr(this.scene.getElements(),this.state)),o||"freedraw"===r?this.setState({draggingElement:null,suggestedBindings:[]}):(Pe(this.canvas),this.setState({draggingElement:null,suggestedBindings:[],elementType:"selection"}))):this.setState({selectedElementIds:{},selectedGroupIds:{},editingGroupId:null})}))}maybeSuggestBindingForAll(e){const t=(e=>{const t=new Set(e.map((e=>{let{id:t}=e;return t})));return e.flatMap((e=>yt(e)?Ds(e).filter((e=>!t.has(e.id))):wt(e)?Ns(e).filter((e=>!t.has(e[0].id))):[]))})(e);this.setState({suggestedBindings:t})}clearSelection(e){this.setState((t=>({selectedElementIds:{},selectedGroupIds:{},editingGroupId:t.editingGroupId&&null!=e&&Rn(e,t.editingGroupId)?t.editingGroupId:null}))),this.setState({selectedElementIds:{},previousSelectedElementIds:this.state.selectedElementIds})}getTextWysiwygSnappedToCenterPosition(e,t,n,i,s){const r=((e,t,n)=>{let i=null;for(let s=e.length-1;s>=0;--s){if(e[s].isDeleted)continue;const[r,o,a,l]=Pt(e[s]);if(r<t&&t<a&&o<n&&n<l){i=e[s];break}}return i})(this.scene.getElementsIncludingDeleted().filter((e=>!pt(e))),e,t);if(r){const i=r.x+r.width/2,s=r.y+r.height/2;if(Math.hypot(e-i,t-s)<d.O){const{x:e,y:t}=_e({sceneX:i,sceneY:s},n);return{viewportX:e,viewportY:t,elementCenterX:i,elementCenterY:s}}}}getCanvasOffsets(){var e;if(null===(e=this.excalidrawContainerRef)||void 0===e?void 0:e.current){const e=this.excalidrawContainerRef.current,{left:t,top:n}=e.getBoundingClientRect();return{offsetLeft:t,offsetTop:n}}return{offsetLeft:0,offsetTop:0}}async updateLanguage(){const e=p.find((e=>e.code===this.props.langCode))||m;await v(e),this.setAppState({})}}hh.defaultProps={UIOptions:d.k},"production"!==d.r.TEST&&"production"!==d.r.DEVELOPMENT||(window.h=window.h||{},Object.defineProperties(window.h,{elements:{configurable:!0,get(){return this.app.scene.getElementsIncludingDeleted()},set(e){return this.app.scene.replaceAllElements(e)}}}));var uh=hh;n(90),n(91);const mh=e=>{const{theme:t=d.P.LIGHT,closeOnClickOutside:n=!0}=e,s=ph(t);if(!s)return null;return Object(i.createPortal)(Object(kr.jsxs)("div",{className:Object(lt.a)("Modal",e.className),role:"dialog","aria-modal":"true",onKeyDown:t=>{t.key===ne&&(t.nativeEvent.stopImmediatePropagation(),t.stopPropagation(),e.onCloseRequest())},"aria-labelledby":e.labelledBy,children:[Object(kr.jsx)("div",{className:"Modal__background",onClick:n?e.onCloseRequest:void 0}),Object(kr.jsx)("div",{className:"Modal__content",style:{"--max-width":"".concat(e.maxWidth,"px")},tabIndex:0,children:e.children})]}),s)},ph=e=>{const[t,n]=Object(o.useState)(null),i=qd(),s=Object(o.useRef)(i);s.current=i;const{container:r}=Qd();return Object(o.useLayoutEffect)((()=>{t&&t.classList.toggle("excalidraw--mobile",i)}),[t,i]),Object(o.useLayoutEffect)((()=>{const t=!!(null===r||void 0===r?void 0:r.classList.contains("theme--dark"))||"dark"===e,i=document.createElement("div");return i.classList.add("excalidraw","excalidraw-modal-container"),i.classList.toggle("excalidraw--mobile",s.current),t&&(i.classList.add("theme--dark"),i.classList.add("theme--dark-background-none")),document.body.appendChild(i),n(i),()=>{document.body.removeChild(i)}}),[r,e]),t},gh=e=>{const[t,n]=ct(),[i]=Object(o.useState)(document.activeElement),{id:s}=Qd();Object(o.useEffect)((()=>{if(!t)return;const n=r(t);n.length>0&&!1!==e.autofocus&&(n[1]||n[0]).focus();const i=e=>{if(e.key===re){const n=r(t),{activeElement:i}=document,s=n.findIndex((e=>e===i));0===s&&e.shiftKey?(n[n.length-1].focus(),e.preventDefault()):s!==n.length-1||e.shiftKey||(n[0].focus(),e.preventDefault())}};return t.addEventListener("keydown",i),()=>t.removeEventListener("keydown",i)}),[t,e.autofocus]);const r=e=>{const t=e.querySelectorAll("button, a, input, select, textarea, div[tabindex]");return t?Array.from(t):[]},a=()=>{i.focus(),e.onCloseRequest()};return Object(kr.jsx)(mh,{className:Object(lt.a)("Dialog",e.className),labelledBy:"dialog-title",maxWidth:e.small?550:800,onCloseRequest:a,theme:e.theme,closeOnClickOutside:e.closeOnClickOutside,children:Object(kr.jsxs)(ld,{ref:n,children:[Object(kr.jsxs)("h2",{id:"".concat(s,"-dialog-title"),className:"Dialog__title",children:[Object(kr.jsx)("span",{className:"Dialog__titleContent",children:e.title}),Object(kr.jsx)("button",{className:"Modal__close",onClick:a,"aria-label":w("buttons.close"),children:qd()?vo:fo})]}),Object(kr.jsx)("div",{className:"Dialog__content",children:e.children})]})})},bh=e=>{let{message:t,onClose:n}=e;const[i,s]=Object(o.useState)(!!t),{container:r}=Qd(),l=a.a.useCallback((()=>{s(!1),n&&n(),null===r||void 0===r||r.focus()}),[n,r]);return Object(kr.jsx)(kr.Fragment,{children:i&&Object(kr.jsx)(gh,{small:!0,onCloseRequest:l,title:w("errorDialog.title"),children:Object(kr.jsx)("div",{style:{whiteSpace:"pre-wrap"},children:t})})})};var fh=n(11);class vh extends a.a.Component{constructor(){super(...arguments),this.state={hasError:!1,sentryEventId:"",localStorage:""}}render(){return this.state.hasError?this.errorSplash():this.props.children}componentDidCatch(e,t){const n={};for(const[i,s]of Object.entries({...localStorage}))try{n[i]=JSON.parse(s)}catch(e){n[i]=s}fh.b((i=>{i.setExtras(t);const s=fh.a(e);this.setState((e=>({hasError:!0,sentryEventId:s,localStorage:JSON.stringify(n)})))}))}selectTextArea(e){e.target!==document.activeElement&&(e.preventDefault(),e.target.select())}async createGithubIssue(){let e="";try{const t=(await n.e(2).then(n.bind(null,231))).default;e=encodeURIComponent(t(this.state.sentryEventId))}catch(t){console.error(t)}window.open("https://github.com/excalidraw/excalidraw/issues/new?body=".concat(e))}errorSplash(){return Object(kr.jsx)("div",{className:"ErrorSplash excalidraw",children:Object(kr.jsxs)("div",{className:"ErrorSplash-messageContainer",children:[Object(kr.jsxs)("div",{className:"ErrorSplash-paragraph bigger align-center",children:[w("errorSplash.headingMain_pre"),Object(kr.jsx)("button",{onClick:()=>window.location.reload(),children:w("errorSplash.headingMain_button")})]}),Object(kr.jsxs)("div",{className:"ErrorSplash-paragraph align-center",children:[w("errorSplash.clearCanvasMessage"),Object(kr.jsx)("button",{onClick:()=>{try{localStorage.clear(),window.location.reload()}catch(e){console.error(e)}},children:w("errorSplash.clearCanvasMessage_button")}),Object(kr.jsx)("br",{}),Object(kr.jsxs)("div",{className:"smaller",children:[Object(kr.jsx)("span",{role:"img","aria-label":"warning",children:"\u26a0\ufe0f"}),w("errorSplash.clearCanvasCaveat"),Object(kr.jsx)("span",{role:"img","aria-hidden":"true",children:"\u26a0\ufe0f"})]})]}),Object(kr.jsxs)("div",{children:[Object(kr.jsxs)("div",{className:"ErrorSplash-paragraph",children:[w("errorSplash.trackedToSentry_pre"),this.state.sentryEventId,w("errorSplash.trackedToSentry_post")]}),Object(kr.jsxs)("div",{className:"ErrorSplash-paragraph",children:[w("errorSplash.openIssueMessage_pre"),Object(kr.jsx)("button",{onClick:()=>this.createGithubIssue(),children:w("errorSplash.openIssueMessage_button")}),w("errorSplash.openIssueMessage_post")]}),Object(kr.jsx)("div",{className:"ErrorSplash-paragraph",children:Object(kr.jsxs)("div",{className:"ErrorSplash-details",children:[Object(kr.jsx)("label",{children:w("errorSplash.sceneContent")}),Object(kr.jsx)("textarea",{rows:5,onPointerDown:this.selectTextArea,readOnly:!0,value:this.state.localStorage})]})})]})]})})}}var yh=n(40);"production"!==d.r.TEST&&(n.p=window.EXCALIDRAW_ASSET_PATH||"https://unpkg.com/".concat(yh.name,"@").concat(yh.version,"/dist/"));const xh=e=>{const[t,n]=Object(o.useState)(!0);return Object(o.useEffect)((()=>{const t=p.find((t=>t.code===e.langCode))||m;(async()=>{await v(t)})(),n(!1)}),[e.langCode]),t?Object(kr.jsx)(cd,{}):e.children};n(93),n(94);const wh=e=>{var t;const{onChange:n,initialData:i,excalidrawRef:s,onCollabButtonClick:r,isCollaborating:a,onPointerUpdate:l,renderTopRightUI:c,renderFooter:h,langCode:u=m.code,viewModeEnabled:p,zenModeEnabled:g,gridModeEnabled:b,libraryReturnUrl:f,theme:v,name:y,renderCustomStats:x,onPaste:w,detectScroll:j=!0,handleKeyboardGlobally:S=!1,onLibraryChange:E,autoFocus:O=!1,generateIdForFile:C}=e,k=null===(t=e.UIOptions)||void 0===t?void 0:t.canvasActions,I={canvasActions:{...d.k.canvasActions,...k}};var M,A;(null===k||void 0===k?void 0:k.export)&&(I.canvasActions.export.saveFileToDisk=null!==(M=null===(A=k.export)||void 0===A?void 0:A.saveFileToDisk)&&void 0!==M?M:d.k.canvasActions.export.saveFileToDisk);return Object(o.useEffect)((()=>{const e=e=>{"number"===typeof e.scale&&1!==e.scale&&e.preventDefault()};return document.addEventListener("touchmove",e,{passive:!1}),()=>{document.removeEventListener("touchmove",e)}}),[]),Object(kr.jsx)(xh,{langCode:u,children:Object(kr.jsx)(uh,{onChange:n,initialData:i,excalidrawRef:s,onCollabButtonClick:r,isCollaborating:a,onPointerUpdate:l,renderTopRightUI:c,renderFooter:h,langCode:u,viewModeEnabled:p,zenModeEnabled:g,gridModeEnabled:b,libraryReturnUrl:f,theme:v,name:y,renderCustomStats:x,UIOptions:I,onPaste:w,detectScroll:j,handleKeyboardGlobally:S,onLibraryChange:E,autoFocus:O,generateIdForFile:C})})},jh=(e,t)=>{const{initialData:n,UIOptions:i={},...s}=e,{initialData:r,UIOptions:o={},...a}=t,l=Object.keys(i),c=Object.keys(o);if(l.length!==c.length)return!1;const d=l.every((e=>{if("canvasActions"===e){Object.keys(i.canvasActions).every((e=>{var t,n,s,r;return"export"===e&&(null===i||void 0===i||null===(t=i.canvasActions)||void 0===t?void 0:t.export)&&(null===o||void 0===o||null===(n=o.canvasActions)||void 0===n?void 0:n.export)?i.canvasActions.export.saveFileToDisk===o.canvasActions.export.saveFileToDisk:(null===i||void 0===i||null===(s=i.canvasActions)||void 0===s?void 0:s[e])===(null===o||void 0===o||null===(r=o.canvasActions)||void 0===r?void 0:r[e])}))}return!0})),h=Object.keys(e),u=Object.keys(t);return d&&h.length===u.length&&h.every((e=>s[e]===a[e]))},Sh=Object(o.forwardRef)(((e,t)=>Object(kr.jsx)(wh,{...e,excalidrawRef:t})));var Eh=a.a.memo(Sh,jh);const Oh=3145728,Ch="server-volatile-broadcast",kh="server-broadcast";let Ih;!function(e){e.INIT="SCENE_INIT",e.UPDATE="SCENE_UPDATE"}(Ih||(Ih={}));const Mh="/files/shareLinks",Ah="/files/rooms";var Th=n(19),Lh=n(8);class Dh{constructor(e){let{getFiles:t,saveFiles:n}=e;this.fetchingFiles=new Map,this.savingFiles=new Map,this.savedFiles=new Map,this.erroredFiles=new Map,this._getFiles=void 0,this._saveFiles=void 0,this.isFileHandled=e=>this.savedFiles.has(e)||this.fetchingFiles.has(e)||this.savingFiles.has(e)||this.erroredFiles.has(e),this.isFileSaved=e=>this.savedFiles.has(e),this.saveFiles=async e=>{let{elements:t,files:n}=e;const i=new Map;for(const s of t)ut(s)&&n[s.fileId]&&!this.isFileHandled(s.fileId)&&(i.set(s.fileId,n[s.fileId]),this.savingFiles.set(s.fileId,!0));try{const{savedFiles:e,erroredFiles:t}=await this._saveFiles({addedFiles:i});for(const[n]of e)this.savedFiles.set(n,!0);return{savedFiles:e,erroredFiles:t}}finally{for(const[e]of i)this.savingFiles.delete(e)}},this.getFiles=async e=>{if(!e.length)return{loadedFiles:[],erroredFiles:new Map};for(const t of e)this.fetchingFiles.set(t,!0);try{const{loadedFiles:t,erroredFiles:n}=await this._getFiles(e);for(const e of t)this.savedFiles.set(e.id,!0);for(const[e]of n)this.erroredFiles.set(e,!0);return{loadedFiles:t,erroredFiles:n}}finally{for(const t of e)this.fetchingFiles.delete(t)}},this.shouldPreventUnload=e=>e.some((e=>ut(e)&&!e.isDeleted&&this.savingFiles.has(e.fileId))),this.shouldUpdateImageElementStatus=e=>ut(e)&&this.isFileSaved(e.fileId)&&"pending"===e.status,this._getFiles=t,this._saveFiles=n}reset(){this.fetchingFiles.clear(),this.savingFiles.clear(),this.savedFiles.clear(),this.erroredFiles.clear()}}const Ph=async e=>{let{files:t,maxBytes:n,encryptionKey:i}=e;const s=[];for(const[r,o]of t){const e=(new TextEncoder).encode(o.dataURL),t=await Object(Th.b)(e,{encryptionKey:i,metadata:{id:r,mimeType:o.mimeType,created:Date.now()}});if(e.byteLength>n)throw new Error(w("errors.fileTooBig",{maxSize:"".concat(Math.trunc(n/1024/1024),"MB")}));s.push({id:r,buffer:t})}return s},zh=e=>{e.erroredFiles.size&&e.excalidrawAPI.updateScene({elements:e.excalidrawAPI.getSceneElementsIncludingDeleted().map((t=>ut(t)&&e.erroredFiles.has(t.fileId)?kn(t,{status:"error"}):t))})},Nh=JSON.parse('{"apiKey":"AIzaSyAd15pYlMci_xIp9ko6wkEsDzAAA0Dn0RU","authDomain":"excalidraw-room-persistence.firebaseapp.com","databaseURL":"https://excalidraw-room-persistence.firebaseio.com","projectId":"excalidraw-room-persistence","storageBucket":"excalidraw-room-persistence.appspot.com","messagingSenderId":"654800341332","appId":"1:654800341332:web:4a692de832b55bd57ce0c1"}');let Rh=null,Bh=null,Hh=null,_h=!1;const Fh=async()=>(Rh||(Rh=(async()=>{const e=(await Promise.all([n.e(0),n.e(3)]).then(n.bind(null,233))).default;if(!_h){try{e.initializeApp(Nh)}catch(t){if("app/duplicate-app"!==t.code)throw t;console.warn(t.name,t.code)}_h=!0}return e})()),Rh),Uh=async()=>{const e=await Fh();return Bh||(Bh=Promise.all([n.e(0),n.e(53)]).then(n.bind(null,236))),!0!==Bh&&(await Bh,Bh=!0),e},Vh=async()=>{const e=await Fh();return Hh||(Hh=Promise.all([n.e(0),n.e(60)]).then(n.bind(null,235))),!0!==Hh&&(await Hh,Hh=!0),e},Gh=new WeakMap,Wh=(e,t)=>{if(e.socket&&e.roomId&&e.roomKey){const n=nr(t);return Gh.get(e.socket)===n}return!0},Kh=async e=>{let{prefix:t,files:n}=e;const i=await Vh(),s=new Map,r=new Map;return await Promise.all(n.map((async e=>{let{id:n,buffer:o}=e;try{await i.storage().ref("".concat(t,"/").concat(n)).put(new Blob([o],{type:d.D.binary}),{cacheControl:"public, max-age=".concat(31536e3)}),r.set(n,!0)}catch(a){s.set(n,!0)}}))),{savedFiles:r,erroredFiles:s}},Yh=async(e,t)=>{const{roomId:n,roomKey:i,socket:s}=e;if(!n||!i||!s||Wh(e,t))return!0;const r=await Uh(),o=nr(t),{ciphertext:a,iv:l}=await(async(e,t)=>{const n=JSON.stringify(t),i=(new TextEncoder).encode(n),{encryptedBuffer:s,iv:r}=await Object(Lh.c)(e,i);return{ciphertext:s,iv:r}})(i,t),c={sceneVersion:o,ciphertext:r.firestore.Blob.fromUint8Array(new Uint8Array(a)),iv:r.firestore.Blob.fromUint8Array(l)},d=r.firestore(),h=d.collection("scenes").doc(n),u=await d.runTransaction((async e=>{const t=await e.get(h);if(!t.exists)return e.set(h,c),!0;return!(t.data().sceneVersion>=c.sceneVersion)&&(e.update(h,c),!0)}));return u&&Gh.set(s,o),u},Zh=async(e,t,n)=>{const i=(await Uh()).firestore().collection("scenes").doc(e),s=await i.get();if(!s.exists)return null;const r=s.data(),o=r.ciphertext.toUint8Array(),a=r.iv.toUint8Array(),l=await(async(e,t,n)=>{const i=await Object(Lh.b)(t,n,e),s=new TextDecoder("utf-8").decode(new Uint8Array(i));return JSON.parse(s)})(t,a,o);return n&&Gh.set(n,nr(l)),nl(l,null)},Xh=async(e,t,n)=>{const i=[],s=new Map;return await Promise.all([...new Set(n)].map((async n=>{try{const r="https://firebasestorage.googleapis.com/v0/b/".concat(Nh.storageBucket,"/o/").concat(encodeURIComponent(e.replace(/^\//,"")),"%2F").concat(n),o=await fetch("".concat(r,"?alt=media"));if(o.status<400){const e=await o.arrayBuffer(),{data:s,metadata:r}=await Object(Th.d)(new Uint8Array(e),{decryptionKey:t}),a=(new TextDecoder).decode(s);i.push({mimeType:r.mimeType||d.D.binary,id:n,dataURL:a,created:(null===r||void 0===r?void 0:r.created)||Date.now()})}else s.set(n,!0)}catch(r){s.set(n,!0),console.error(r)}}))),{loadedFiles:i,erroredFiles:s}},qh=async()=>{const e=await(async()=>{const e=new Uint8Array(10);return window.crypto.getRandomValues(e),Qe(e)})(),t=await Object(Lh.d)();if(!t)throw new Error("Couldn't generate room key");return{roomId:e,roomKey:t}},Jh=async(e,t)=>{try{const i=await fetch("".concat("https://json.excalidraw.com/api/v2/").concat(e));if(!i.ok)return window.alert(w("alerts.importBackendFailed")),{};const s=await i.arrayBuffer();try{const{data:e}=await Object(Th.d)(new Uint8Array(s),{decryptionKey:t}),n=JSON.parse((new TextDecoder).decode(e));return{elements:n.elements||null,appState:n.appState||null}}catch(n){return console.warn("error when decoding shareLink data using the new format:",n),(async e=>{let t,{buffer:i,decryptionKey:s}=e;try{const e=i.slice(0,Lh.a),n=i.slice(Lh.a,i.byteLength);t=await Object(Lh.b)(new Uint8Array(e),n,s)}catch(n){const r=new Uint8Array(Lh.a);t=await Object(Lh.b)(r,i,s)}const r=new window.TextDecoder("utf-8").decode(new Uint8Array(t)),o=JSON.parse(r);return{elements:o.elements||null,appState:o.appState||null}})({buffer:s,decryptionKey:t})}}catch(n){return window.alert(w("alerts.importBackendFailed")),console.error(n),{}}},Qh=async(e,t,n)=>{let i;return i=null!=e&&null!=t?sl(await Jh(e,t),null===n||void 0===n?void 0:n.appState,null===n||void 0===n?void 0:n.elements):sl(n||null,null,null),{elements:i.elements,appState:i.appState,files:i.files,commitToHistory:!1}},$h="excalidraw",eu="excalidraw-state",tu="excalidraw-collab",nu="collabLinkForceLoadFlag",iu=()=>{try{const e=localStorage.getItem(tu);if(e)return JSON.parse(e).username}catch(e){console.error(e)}return null},su=()=>{try{const e=localStorage.getItem($h);return(null===e||void 0===e?void 0:e.length)||0}catch(e){return console.error(e),0}},ru=()=>{try{const e=localStorage.getItem(eu),t=localStorage.getItem(tu),n=localStorage.getItem(d.L.LOCAL_STORAGE_LIBRARY),i=(null===e||void 0===e?void 0:e.length)||0,s=(null===t||void 0===t?void 0:t.length)||0;return i+s+((null===n||void 0===n?void 0:n.length)||0)+su()}catch(e){return console.error(e),0}};var ou=class{constructor(e){this.collab=void 0,this.socket=null,this.socketInitialized=!1,this.roomId=null,this.roomKey=null,this.broadcastedElementVersions=new Map,this.queueFileUpload=Object(zd.throttle)((async()=>{try{await this.collab.fileManager.saveFiles({elements:this.collab.excalidrawAPI.getSceneElementsIncludingDeleted(),files:this.collab.excalidrawAPI.getFiles()})}catch(e){"AbortError"!==e.name&&this.collab.excalidrawAPI.updateScene({appState:{errorMessage:e.message}})}this.collab.excalidrawAPI.updateScene({elements:this.collab.excalidrawAPI.getSceneElementsIncludingDeleted().map((e=>this.collab.fileManager.shouldUpdateImageElementStatus(e)?kn(e,{status:"saved"}):e))})}),300),this.broadcastScene=async(e,t,n)=>{if(e===Ih.INIT&&!n)throw new Error("syncAll must be true when sending SCENE.INIT");const i=t.reduce(((e,t,i,s)=>{var r;(n||!this.broadcastedElementVersions.has(t.id)||t.version>this.broadcastedElementVersions.get(t.id))&&this.collab.isSyncableElement(t)&&e.push({...t,parent:0===i?"^":null===(r=s[i-1])||void 0===r?void 0:r.id});return e}),[]),s={type:e,payload:{elements:i}};for(const o of i)this.broadcastedElementVersions.set(o.id,o.version);const r=this._broadcastSocketData(s);this.queueFileUpload(),n&&this.collab.isCollaborating?await Promise.all([r,this.collab.saveCollabRoomToFirebase(i)]):await r},this.broadcastIdleChange=e=>{var t;if(null===(t=this.socket)||void 0===t?void 0:t.id){const t={type:"IDLE_STATUS",payload:{socketId:this.socket.id,userState:e,username:this.collab.state.username}};return this._broadcastSocketData(t,!0)}},this.broadcastMouseLocation=e=>{var t;if(null===(t=this.socket)||void 0===t?void 0:t.id){const t={type:"MOUSE_LOCATION",payload:{socketId:this.socket.id,pointer:e.pointer,button:e.button||"up",selectedElementIds:this.collab.excalidrawAPI.getAppState().selectedElementIds,username:this.collab.state.username}};return this._broadcastSocketData(t,!0)}},this.collab=e}open(e,t,n){this.socket=e,this.roomId=t,this.roomKey=n,this.socket.on("init-room",(()=>{this.socket&&(this.socket.emit("join-room",this.roomId),Object(l.a)("share","room joined"))})),this.socket.on("new-user",(async e=>{this.broadcastScene(Ih.INIT,this.collab.getSceneElementsIncludingDeleted(),!0)})),this.socket.on("room-user-change",(e=>{this.collab.setCollaborators(e)}))}close(){this.socket&&(this.queueFileUpload.flush(),this.socket.close(),this.socket=null,this.roomId=null,this.roomKey=null,this.socketInitialized=!1,this.broadcastedElementVersions=new Map)}isOpen(){return!!(this.socketInitialized&&this.socket&&this.roomId&&this.roomKey)}async _broadcastSocketData(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.isOpen()){var n;const i=JSON.stringify(e),s=(new TextEncoder).encode(i),{encryptedBuffer:r,iv:o}=await Object(Lh.c)(this.roomKey,s);null===(n=this.socket)||void 0===n||n.emit(t?Ch:kh,this.roomId,r,o)}}};n(103);const au=()=>{const e=window.navigator,t=/Apple/.test(e.vendor),n=-1!==e.appVersion.indexOf("Win");return t?$r:n?eo:Qr};var lu=e=>{let{handleClose:t,activeRoomLink:n,username:i,onUsernameChange:s,onRoomCreate:r,onRoomDestroy:a,setErrorMessage:l,theme:c}=e;const d=Object(o.useRef)(null),h=async()=>{try{await Jl(n)}catch(e){l(e.message)}d.current&&d.current.select()},u=async()=>{try{await navigator.share({title:w("roomDialog.shareTitle"),text:w("roomDialog.shareTitle"),url:n})}catch(e){}},m=e=>{e.target!==document.activeElement&&(e.preventDefault(),e.target.select())};return Object(kr.jsx)(gh,{small:!0,onCloseRequest:t,title:w("labels.liveCollaboration"),theme:c,children:Object(kr.jsxs)("div",{className:"RoomDialog-modal",children:[!n&&Object(kr.jsxs)(kr.Fragment,{children:[Object(kr.jsx)("p",{children:w("roomDialog.desc_intro")}),Object(kr.jsx)("p",{children:"\ud83d\udd12 ".concat(w("roomDialog.desc_privacy"))}),Object(kr.jsx)("div",{className:"RoomDialog-sessionStartButtonContainer",children:Object(kr.jsx)(Mr,{className:"RoomDialog-startSession",type:"button",icon:go,title:w("roomDialog.button_startSession"),"aria-label":w("roomDialog.button_startSession"),showAriaLabel:!0,onClick:r})})]}),n&&Object(kr.jsxs)(kr.Fragment,{children:[Object(kr.jsx)("p",{children:w("roomDialog.desc_inProgressIntro")}),Object(kr.jsx)("p",{children:w("roomDialog.desc_shareLink")}),Object(kr.jsxs)("div",{className:"RoomDialog-linkContainer",children:[Object(kr.jsxs)(tc,{gap:2,children:["share"in navigator?Object(kr.jsx)(Mr,{type:"button",icon:au(),title:w("labels.share"),"aria-label":w("labels.share"),onClick:u}):null,Object(kr.jsx)(Mr,{type:"button",icon:Hr,title:w("labels.copy"),"aria-label":w("labels.copy"),onClick:h})]}),Object(kr.jsx)("input",{type:"text",value:n,readOnly:!0,className:"RoomDialog-link",ref:d,onPointerDown:m})]}),Object(kr.jsxs)("div",{className:"RoomDialog-usernameContainer",children:[Object(kr.jsx)("label",{className:"RoomDialog-usernameLabel",htmlFor:"username",children:w("labels.yourName")}),Object(kr.jsx)("input",{type:"text",id:"username",value:i||"",className:"RoomDialog-username TextInput",onChange:e=>s(e.target.value),onKeyPress:e=>"Enter"===e.key&&t()})]}),Object(kr.jsxs)("p",{children:[Object(kr.jsx)("span",{role:"img","aria-hidden":"true",className:"RoomDialog-emoji",children:"\ud83d\udd12"})," ",w("roomDialog.desc_privacy")]}),Object(kr.jsx)("p",{children:w("roomDialog.desc_exitSession")}),Object(kr.jsx)("div",{className:"RoomDialog-sessionStartButtonContainer",children:Object(kr.jsx)(Mr,{className:"RoomDialog-stopSession",type:"button",icon:bo,title:w("roomDialog.button_stopSession"),"aria-label":w("roomDialog.button_stopSession"),showAriaLabel:!0,onClick:a})})]})]})})};const cu=(e,t,n)=>{var i,s,r;return!(!t||!(t.id===(null===(i=e.editingElement)||void 0===i?void 0:i.id)||t.id===(null===(s=e.resizingElement)||void 0===s?void 0:s.id)||t.id===(null===(r=e.draggingElement)||void 0===r?void 0:r.id)||t.version>n.version||t.version===n.version&&t.versionNonce<n.versionNonce))},{Context:du,Consumer:hu,Provider:uu}=(e=>{const t=a.a.createContext(e);class n extends a.a.Component{constructor(n){super(n),this.state={value:e},t._updateProviderValue=e=>this.setState({value:e})}render(){return Object(kr.jsx)(t.Provider,{value:this.state.value,children:this.props.children})}}class i extends a.a.Component{componentDidMount(){var e;null===(e=t._updateProviderValue)||void 0===e||e.call(t,this.props.value)}componentDidUpdate(){var e;null===(e=t._updateProviderValue)||void 0===e||e.call(t,this.props.value)}render(){return Object(kr.jsx)(t.Consumer,{children:()=>this.props.children})}}return{Context:t,Consumer:n,Provider:i}})({api:null});class mu extends o.PureComponent{constructor(e){var t;super(e),t=this,this.portal=void 0,this.fileManager=void 0,this.excalidrawAPI=void 0,this.isCollaborating=!1,this.activeIntervalId=void 0,this.idleTimeoutId=void 0,this.socketInitializationTimer=void 0,this.lastBroadcastedOrReceivedSceneVersion=-1,this.collaborators=new Map,this.onUnload=()=>{this.destroySocketClient({isUnload:!0})},this.beforeUnload=Ze((e=>{const t=this.getSyncableElements(this.getSceneElementsIncludingDeleted());if(!this.isCollaborating||!this.fileManager.shouldPreventUnload(t)&&Wh(this.portal,t)||(this.saveCollabRoomToFirebase(t),Je(e)),this.isCollaborating||this.portal.roomId)try{var n;null===(n=localStorage)||void 0===n||n.setItem(nu,JSON.stringify({timestamp:Date.now(),room:this.portal.roomId}))}catch{}})),this.saveCollabRoomToFirebase=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.getSyncableElements(t.excalidrawAPI.getSceneElementsIncludingDeleted());try{await Yh(t.portal,e)}catch(n){console.error(n)}},this.openPortal=async()=>(Object(l.a)("share","room creation"),this.initializeSocketClient(null)),this.closePortal=()=>{if(this.queueBroadcastAllElements.cancel(),this.loadImageFiles.cancel(),this.saveCollabRoomToFirebase(),window.confirm(w("alerts.collabStopOverridePrompt"))){var e,t;window.history.pushState({},d.c,window.location.origin),this.destroySocketClient(),Object(l.a)("share","room closed"),null===(e=(t=this.props).onRoomClose)||void 0===e||e.call(t);const n=this.excalidrawAPI.getSceneElementsIncludingDeleted().map((e=>mt(e)&&"saved"===e.status?kn(e,{status:"pending"}):e));this.excalidrawAPI.updateScene({elements:n,commitToHistory:!1})}},this.destroySocketClient=e=>{(null===e||void 0===e?void 0:e.isUnload)||(this.collaborators=new Map,this.excalidrawAPI.updateScene({collaborators:this.collaborators}),this.setState({activeRoomLink:""}),this.isCollaborating=!1),this.lastBroadcastedOrReceivedSceneVersion=-1,this.portal.close(),this.fileManager.reset()},this.fetchImageFilesFromFirebase=async e=>{const t=e.elements.filter((e=>ut(e)&&!this.fileManager.isFileHandled(e.fileId)&&!e.isDeleted&&"saved"===e.status)).map((e=>e.fileId));return await this.fileManager.getFiles(t)},this.decryptPayload=async(e,t,n)=>{try{const i=await Object(Lh.b)(e,t,n),s=new TextDecoder("utf-8").decode(new Uint8Array(i));return JSON.parse(s)}catch(i){return window.alert(w("alerts.decryptFailed")),console.error(i),{type:"INVALID_RESPONSE"}}},this.initializeSocketClient=async e=>{if(this.portal.socket)return null;let t,i;var s;e?({roomId:t,roomKey:i}=e):(({roomId:t,roomKey:i}=await qh()),window.history.pushState({},d.c,(s={roomId:t,roomKey:i},"".concat(window.location.origin).concat(window.location.pathname,"#room=").concat(s.roomId,",").concat(s.roomKey))));const r=Ye();this.isCollaborating=!0;const{default:o}=await Promise.all([n.e(1),n.e(52),n.e(50)]).then(n.t.bind(null,232,7));if(this.portal.open(o("https://oss-collab-us1.excalidraw.com"),t,i),e){this.excalidrawAPI.resetScene();try{const e=await Zh(t,i,this.portal.socket);e&&r.resolve({elements:e,scrollToContent:!0})}catch(a){console.error(a)}}else{const e=this.excalidrawAPI.getSceneElements().map((e=>mt(e)&&"saved"===e.status?kn(e,{status:"pending"}):e));this.excalidrawAPI.history.clear(),this.excalidrawAPI.updateScene({elements:e,commitToHistory:!0}),this.broadcastElements(e);const t=this.getSyncableElements(e);this.saveCollabRoomToFirebase(t)}return this.socketInitializationTimer=window.setTimeout((()=>{this.initializeSocket(),r.resolve(null)}),5e3),this.portal.socket.on("client-broadcast",(async(e,t)=>{if(!this.portal.roomKey)return;const n=await this.decryptPayload(t,e,this.portal.roomKey);switch(n.type){case"INVALID_RESPONSE":return;case Ih.INIT:if(!this.portal.socketInitialized){this.initializeSocket();const e=n.payload.elements,t=this.reconcileElements(e);this.handleRemoteSceneUpdate(t,{init:!0}),r.resolve({elements:t,scrollToContent:!0})}break;case Ih.UPDATE:this.handleRemoteSceneUpdate(this.reconcileElements(n.payload.elements));break;case"MOUSE_LOCATION":{const{pointer:e,button:t,username:i,selectedElementIds:s}=n.payload,r=n.payload.socketId||n.payload.socketID,o=new Map(this.collaborators),a=o.get(r)||{};a.pointer=e,a.button=t,a.selectedElementIds=s,a.username=i,o.set(r,a),this.excalidrawAPI.updateScene({collaborators:o});break}case"IDLE_STATUS":{const{userState:e,socketId:t,username:i}=n.payload,s=new Map(this.collaborators),r=s.get(t)||{};r.userState=e,r.username=i,this.excalidrawAPI.updateScene({collaborators:s});break}}})),this.portal.socket.on("first-in-room",(()=>{this.portal.socket&&this.portal.socket.off("first-in-room"),this.initializeSocket(),r.resolve(null)})),this.initializeIdleDetector(),this.setState({activeRoomLink:window.location.href}),r},this.initializeSocket=()=>{this.portal.socketInitialized=!0,clearTimeout(this.socketInitializationTimer)},this.reconcileElements=e=>{const t=((e,t,n)=>{const i=e.reduce(((e,t,n)=>(e[t.id]=[t,n],e)),{}),s=e.slice(),r=new WeakMap;let o=0,a=0,l=-1;for(const d of t){var c;l++;const e=i[d.id];if(cu(n,null===e||void 0===e?void 0:e[0],d)){d.parent&&delete d.parent;continue}e&&r.set(e[0],!0);const h=d.parent||(null===(c=t[l-1])||void 0===c?void 0:c.id)||null;if(null!=h)if(delete d.parent,"^"===h)a++,0===o?(s.unshift(d),i[d.id]=[d,o-a]):(s.splice(o+1,0,d),i[d.id]=[d,o+1-a],o++);else{let e=i[h]?i[h][1]:null;null!=e&&(e+=a),null!=e&&e>=o?(s.splice(e+1,0,d),a++,i[d.id]=[d,e+1-a],o=e+1):null!=e?(s.splice(o+1,0,d),a++,i[d.id]=[d,o+1-a],o++):(s.push(d),i[d.id]=[d,s.length-1-a])}else e?(s[e[1]]=d,i[d.id]=[d,e[1]]):(s.push(d),i[d.id]=[d,s.length-1-a])}return s.filter((e=>!r.has(e)))})(this.getSceneElementsIncludingDeleted(),e,this.excalidrawAPI.getAppState());return this.setLastBroadcastedOrReceivedSceneVersion(nr(t)),t},this.loadImageFiles=Zd()((async()=>{const{loadedFiles:e,erroredFiles:t}=await this.fetchImageFilesFromFirebase({elements:this.excalidrawAPI.getSceneElementsIncludingDeleted()});this.excalidrawAPI.addFiles(e),zh({excalidrawAPI:this.excalidrawAPI,erroredFiles:t,elements:this.excalidrawAPI.getSceneElementsIncludingDeleted()})}),500),this.handleRemoteSceneUpdate=function(e){let{init:n=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.excalidrawAPI.updateScene({elements:e,commitToHistory:!!n}),t.excalidrawAPI.history.clear(),t.loadImageFiles()},this.onPointerMove=()=>{this.idleTimeoutId&&(window.clearTimeout(this.idleTimeoutId),this.idleTimeoutId=null),this.idleTimeoutId=window.setTimeout(this.reportIdle,d.y),this.activeIntervalId||(this.activeIntervalId=window.setInterval(this.reportActive,d.a))},this.onVisibilityChange=()=>{document.hidden?(this.idleTimeoutId&&(window.clearTimeout(this.idleTimeoutId),this.idleTimeoutId=null),this.activeIntervalId&&(window.clearInterval(this.activeIntervalId),this.activeIntervalId=null),this.onIdleStateChange(Ha.AWAY)):(this.idleTimeoutId=window.setTimeout(this.reportIdle,d.y),this.activeIntervalId=window.setInterval(this.reportActive,d.a),this.onIdleStateChange(Ha.ACTIVE))},this.reportIdle=()=>{this.onIdleStateChange(Ha.IDLE),this.activeIntervalId&&(window.clearInterval(this.activeIntervalId),this.activeIntervalId=null)},this.reportActive=()=>{this.onIdleStateChange(Ha.ACTIVE)},this.initializeIdleDetector=()=>{document.addEventListener(d.s.POINTER_MOVE,this.onPointerMove),document.addEventListener(d.s.VISIBILITY_CHANGE,this.onVisibilityChange)},this.setLastBroadcastedOrReceivedSceneVersion=e=>{this.lastBroadcastedOrReceivedSceneVersion=e},this.getLastBroadcastedOrReceivedSceneVersion=()=>this.lastBroadcastedOrReceivedSceneVersion,this.getSceneElementsIncludingDeleted=()=>this.excalidrawAPI.getSceneElementsIncludingDeleted(),this.onPointerUpdate=e=>{e.pointersMap.size<2&&this.portal.socket&&this.portal.broadcastMouseLocation(e)},this.onIdleStateChange=e=>{this.setState({userState:e}),this.portal.broadcastIdleChange(e)},this.broadcastElements=e=>{nr(e)>this.getLastBroadcastedOrReceivedSceneVersion()&&(this.portal.broadcastScene(Ih.UPDATE,e,!1),this.lastBroadcastedOrReceivedSceneVersion=nr(e),this.queueBroadcastAllElements())},this.queueBroadcastAllElements=Zd()((()=>{this.portal.broadcastScene(Ih.UPDATE,this.excalidrawAPI.getSceneElementsIncludingDeleted(),!0);const e=this.getLastBroadcastedOrReceivedSceneVersion(),t=Math.max(e,nr(this.getSceneElementsIncludingDeleted()));this.setLastBroadcastedOrReceivedSceneVersion(t)}),2e4),this.handleClose=()=>{this.setState({modalIsShown:!1})},this.onUsernameChange=e=>{this.setState({username:e}),(e=>{try{localStorage.setItem(tu,JSON.stringify({username:e}))}catch(t){console.error(t)}})(e)},this.onCollabButtonClick=()=>{this.setState({modalIsShown:!0})},this.isSyncableElement=e=>e.isDeleted||!Mn(e),this.getSyncableElements=e=>e.filter((e=>this.isSyncableElement(e))),this.contextValue=null,this.getContextValue=()=>(this.contextValue||(this.contextValue={}),this.contextValue.isCollaborating=()=>this.isCollaborating,this.contextValue.username=this.state.username,this.contextValue.onPointerUpdate=this.onPointerUpdate,this.contextValue.initializeSocketClient=this.initializeSocketClient,this.contextValue.onCollabButtonClick=this.onCollabButtonClick,this.contextValue.broadcastElements=this.broadcastElements,this.contextValue.fetchImageFilesFromFirebase=this.fetchImageFilesFromFirebase,this.contextValue),this.state={modalIsShown:!1,errorMessage:"",username:iu()||"",userState:Ha.ACTIVE,activeRoomLink:""},this.portal=new ou(this),this.fileManager=new Dh({getFiles:async e=>{const{roomId:t,roomKey:n}=this.portal;if(!t||!n)throw new Cr;return Xh("files/rooms/".concat(t),n,e)},saveFiles:async e=>{let{addedFiles:t}=e;const{roomId:n,roomKey:i}=this.portal;if(!n||!i)throw new Cr;return Kh({prefix:"".concat(Ah,"/").concat(n),files:await Ph({files:t,encryptionKey:i,maxBytes:Oh})})}}),this.excalidrawAPI=e.excalidrawAPI,this.activeIntervalId=null,this.idleTimeoutId=null}componentDidMount(){window.addEventListener(d.s.BEFORE_UNLOAD,this.beforeUnload),window.addEventListener(d.s.UNLOAD,this.onUnload),"production"!==d.r.TEST&&"production"!==d.r.DEVELOPMENT||(window.collab=window.collab||{},Object.defineProperties(window,{collab:{configurable:!0,value:this}}))}componentWillUnmount(){window.removeEventListener(d.s.BEFORE_UNLOAD,this.beforeUnload),window.removeEventListener(d.s.UNLOAD,this.onUnload),window.removeEventListener(d.s.POINTER_MOVE,this.onPointerMove),window.removeEventListener(d.s.VISIBILITY_CHANGE,this.onVisibilityChange),this.activeIntervalId&&(window.clearInterval(this.activeIntervalId),this.activeIntervalId=null),this.idleTimeoutId&&(window.clearTimeout(this.idleTimeoutId),this.idleTimeoutId=null)}setCollaborators(e){this.setState((t=>{const n=new Map;for(const i of e)this.collaborators.has(i)?n.set(i,this.collaborators.get(i)):n.set(i,{});this.collaborators=n,this.excalidrawAPI.updateScene({collaborators:n})}))}render(){const{modalIsShown:e,username:t,errorMessage:n,activeRoomLink:i}=this.state;return Object(kr.jsxs)(kr.Fragment,{children:[e&&Object(kr.jsx)(lu,{handleClose:this.handleClose,activeRoomLink:i,username:t,onUsernameChange:this.onUsernameChange,onRoomCreate:this.openPortal,onRoomDestroy:this.closePortal,setErrorMessage:e=>{this.setState({errorMessage:e})},theme:this.excalidrawAPI.getAppState().theme}),n&&Object(kr.jsx)(bh,{message:n,onClose:()=>this.setState({errorMessage:""})}),Object(kr.jsx)(uu,{value:{api:this.getContextValue()}})]})}}"production"!==d.r.TEST&&"production"!==d.r.DEVELOPMENT||(window.collab=window.collab||{});var pu=mu;const gu=e=>{let{onChange:t,languages:n=p,currentLangCode:i=y().code}=e;return Object(kr.jsx)(a.a.Fragment,{children:Object(kr.jsxs)("select",{className:"dropdown-select dropdown-select__language",onChange:e=>{let{target:n}=e;return t(n.value)},value:i,"aria-label":w("buttons.selectLanguage"),children:[Object(kr.jsx)("option",{value:m.code,children:m.label},m.code),n.map((e=>Object(kr.jsx)("option",{value:e.code,children:e.label},e.code)))]})})},bu=Le((e=>{e({scene:su(),total:ru()})}),500);var fu=e=>{const[t,n]=Object(o.useState)({scene:0,total:0});Object(o.useEffect)((()=>{bu((e=>{n(e)}))})),Object(o.useEffect)((()=>()=>bu.cancel()),[]);const i=qe();let s,r;return i!==d.l?(r=i.slice(0,16).replace("T"," "),s=i.slice(21)):r=w("stats.versionNotAvailable"),Object(kr.jsxs)(kr.Fragment,{children:[Object(kr.jsx)("tr",{children:Object(kr.jsx)("th",{colSpan:2,children:w("stats.storage")})}),Object(kr.jsxs)("tr",{children:[Object(kr.jsx)("td",{children:w("stats.scene")}),Object(kr.jsx)("td",{children:Xe(t.scene,1)})]}),Object(kr.jsxs)("tr",{children:[Object(kr.jsx)("td",{children:w("stats.total")}),Object(kr.jsx)("td",{children:Xe(t.total,1)})]}),Object(kr.jsx)("tr",{children:Object(kr.jsx)("th",{colSpan:2,children:w("stats.version")})}),Object(kr.jsx)("tr",{children:Object(kr.jsxs)("td",{colSpan:2,style:{textAlign:"center",cursor:"pointer"},onClick:async()=>{try{await Jl(qe()),e.setToastMessage(w("toast.copyToClipboard"))}catch{}},title:w("stats.versionCopy"),children:[r,Object(kr.jsx)("br",{}),s]})})]})};n(104);const vu=Dr(Object(kr.jsxs)(kr.Fragment,{children:[Object(kr.jsx)("path",{d:"M72.652 63.598c-1.368.91-1.191 2.833-.953 4.572.702 5.104.47 5.323 1.073 7.016.649 1.826.433 2.553-.08 3.292-.406.588-1.207 1.371-1.906 1.516-.98.204-2.967.01-3.922-.246-.643-.174-1.292-.94-1.598-1.53-.389-.751-1.256-1.951-.694-3.593.56-1.64 1.325-5.374 1.363-6.108.098-1.904.02-3.934-1.085-5.014-1.104-1.082-3.941-1.055-5.739-1.038-1.723.017-3.583 1.207-5.045 1.141-1.343-.061-2.939-.686-3.728-1.536-.79-.852-1.082-2.469-1.007-3.57.074-1.1.726-2.398 1.454-3.033.727-.635 1.91-.867 2.909-.777 1.472.13 4.1 1.342 5.928 1.564 1.67.203 4.016.501 5.04-.227 1.021-.73 1.048-2.717 1.094-4.145.07-2.063-1.021-6.528-.683-8.23.22-1.098 1.709-1.696 2.717-1.979 1.007-.282 2.521-.125 3.328.285.788.398 1.499 1.29 1.516 2.173.031 1.68-1.209 5.66-1.322 7.905-.058 1.133-.61 3.124.482 3.764 1.264.74 2.95 1.778 7.1.673 1.765-.47 3.157-.689 4.62-.622 1.342.06 2.939.685 3.728 1.536.787.85 1.08 2.468 1.006 3.568-.074 1.101-.726 2.4-1.454 3.035-.727.634-1.908.866-2.908.777-1.473-.13-3.164-.68-4.88-1.248-2.526-.835-5.176-.708-6.354.079z",fill:"currentColor"}),Object(kr.jsx)("path",{d:"M51.396 25.807c0 .237-.285.474-.617.474-.284 0-1.09 1.328-1.708 2.941-1.897 4.934-20.873 42.46-20.92 41.273 0-.616-.285-1.043-.76-1.043-.664 0-.759.38-.474 2.23.284 2.134.095 2.609-6.642 15.702-3.795 7.448-7.875 15.228-9.06 17.316-1.234 2.182-2.183 4.554-2.278 5.55-.142 1.708.047 1.945 4.175 5.503 2.372 2.088 5.408 4.697 6.736 5.883 5.978 5.456 8.777 7.638 9.536 7.496 1.138-.19 18.739-18.644 18.786-19.688 0-.475-.854-7.685-1.898-16.035-1.802-14.232-3.51-30.884-3.32-32.497.142-.996-.57-6.024-1.092-8.207-.426-1.708-.237-2.42 3.179-10.2 1.992-4.601 4.602-10.247 5.74-12.524 1.091-2.277 2.04-4.27 2.04-4.412 0-.142-.332-.237-.711-.237-.38 0-.712.19-.712.475zM40.485 61.245c.522 3.32 1.565 11.29 2.324 17.695 1.47 11.765 3.179 24.811 3.653 28.132.285 1.66.095 1.992-2.989 5.408-5.36 6.025-11.053 11.955-12.998 13.473l-1.803 1.423-9.25-8.634c-8.54-7.875-9.252-8.681-8.73-9.63.285-.522 2.704-4.934 5.361-9.773 2.657-4.839 6.167-11.29 7.78-14.327 1.66-3.084 3.179-5.74 3.463-5.882.332-.19.427 4.601.332 14.8-.19 15.23-.142 15.277 1.376 14.945.19 0 .332-7.686.332-17.031V74.86l4.981-9.963c2.752-5.503 5.03-9.915 5.124-9.867.095.047.57 2.846 1.044 6.215zM20.228 3.842c-3.51 2.799-8.919 7.543-13.189 11.623l-3.368 3.178.617 4.175c.332 2.277.949 6.736 1.328 9.867.427 3.132.854 6.073.996 6.5.19.57 0 .854-.521.854-.902 0-.95-.237 1.518 7.59.901 2.989 1.755 5.74 1.85 6.025.095.332.474.474.901.332.427-.19.664-.57.522-.901-.142-.38.095-.76.474-.902.522-.19.475-.569-.332-1.945-1.28-2.134-4.554-20.352-4.744-26.234-.142-4.175-.142-4.222 1.613-6.594 1.708-2.325 5.646-5.835 11.718-10.295 1.708-1.28 3.416-2.704 3.89-3.178.712-.854 1.044-.617 7.021 5.74 3.463 3.653 7.306 7.4 8.54 8.35l2.277 1.707-1.756 3.7c-.948 1.993-4.791 9.678-8.586 16.984-7.923 15.37-6.31 13.9-15.513 14.043l-5.978.047-1.992 2.277c-2.088 2.42-2.372 3.32-1.376 4.839.38.522.664 1.376.664 1.898 0 .854.332.996 2.23 1.09 1.186.048 2.277.19 2.42.333.142.142.331 3.083.474 6.547l.19 6.262-3.179 6.831c-5.266 11.386-7.353 16.604-7.353 18.312 0 .901.19 1.66.38 1.66.474 0 .474-.047 19.782-40.324 8.966-18.691 17.458-36.292 18.881-39.185 1.423-2.894 2.704-5.55 2.799-5.93.095-.427-3.178-3.7-8.397-8.303-4.696-4.174-8.824-7.97-9.203-8.396-1.091-1.329-2.704-.902-5.598 1.423zm-2.372 62.147c-.38.996-1.376 3.083-2.183 4.649-1.328 2.656-1.47 2.751-1.802 1.66-.19-.664-.332-2.61-.38-4.364-.047-3.464-.142-3.416 3.843-3.653l1.28-.048-.758 1.756zm3.985-7.59c-2.183 4.221-2.277 4.269-8.255 4.553-5.266.285-5.36.238-5.36-.759 0-.569-.19-1.328-.428-1.708-.284-.426-.094-1.186.57-2.23l1.043-1.612h4.744c2.61-.048 5.598-.237 6.642-.427 1.044-.19 1.945-.285 2.04-.237.095.047-.38 1.138-.996 2.42zm-.19-43.266c-.854.616-1.091 1.233-1.091 2.799 0 1.85.142 2.134 1.423 2.656 1.28.522 1.613.475 3.084-.522 1.945-1.328 1.992-1.66.569-3.795-1.234-1.85-2.467-2.182-3.985-1.138z",fill:"currentColor"}),Object(kr.jsx)("path",{d:"M50.141 24.917c.352-.615 1.06-1.085 1.967-1.085.804 0 1.477.34 1.734.597.342.342.477.74.477 1.14 0 .089-.006.305-.119.612-.168.461-1.056 2.337-2.08 4.471-1.131 2.264-3.724 7.875-5.708 12.457-1.671 3.806-2.558 5.881-2.97 7.216-.301.975-.279 1.406-.123 2.032.558 2.33 1.27 7.704 1.122 8.73-.187 1.596 1.537 18.06 3.32 32.136 1.056 8.446 1.91 15.74 1.91 16.22l-.002.07c-.009.184-.087.607-.447 1.14-.506.747-1.932 2.414-3.805 4.476-4.242 4.672-10.806 11.46-13.673 14.059-.682.617-1.199 1.023-1.472 1.182a1.872 1.872 0 01-.612.236c-.41.077-1.225-.015-2.35-.737-1.495-.959-4.19-3.217-8.46-7.114-1.327-1.184-4.36-3.79-6.718-5.865-1.712-1.476-2.767-2.405-3.411-3.096-.677-.727-.994-1.291-1.16-1.839-.165-.544-.18-1.09-.117-1.847.104-1.1 1.103-3.737 2.466-6.15 1.182-2.08 5.247-9.833 9.031-17.26 3.34-6.491 5.06-9.853 5.906-11.859.677-1.603.696-2.113.587-2.93-.18-1.168-.195-1.884-.111-2.308.1-.511.321-.851.58-1.1.346-.331.813-.55 1.488-.55.199 0 .391.024.574.07 4.068-7.268 18.093-35.143 19.705-39.334.585-1.53 1.353-2.823 1.794-3.288.228-.24.462-.39.677-.482zM38.72 59.573a448.835 448.835 0 00-3.06 5.995l-4.823 9.646v16.63c0 8.501-.124 15.643-.287 16.987-.142 1.166-1.002 1.462-1.384 1.526l.16-.017c-.671.147-1.214.135-1.647-.047-.495-.209-1.058-.629-1.33-1.813-.332-1.439-.336-5.202-.22-14.563.04-4.272.047-7.59.016-9.984-.33.582-.666 1.188-.986 1.783-1.615 3.04-5.13 9.5-7.79 14.345-2.383 4.34-4.576 8.338-5.207 9.493.131.186.356.489.61.77 1.165 1.287 3.451 3.428 7.667 7.316l8.316 7.76.798-.63c1.917-1.495 7.517-7.35 12.808-13.295.898-.995 1.544-1.72 2-2.29.37-.464.594-.76.675-1.06.067-.247.004-.478-.051-.8l-.007-.041c-.475-3.324-2.184-16.382-3.657-28.168-.757-6.384-1.797-14.328-2.317-17.639l-.004-.023c-.089-.635-.185-1.272-.28-1.881zM19.289 2.67c1.673-1.343 3-2.096 4.04-2.364 1.537-.394 2.687.004 3.621 1.119.396.44 4.46 4.165 9.071 8.264 4.274 3.769 7.265 6.676 8.244 7.909.69.868.68 1.598.625 1.844-.002.013-.006.026-.009.038-.1.398-1.416 3.195-2.908 6.228-1.423 2.893-9.912 20.488-18.875 39.173C7.581 97.252 4.465 103.75 3.6 105.058c-.497.751-.885.854-1.111.924a1.729 1.729 0 01-.526.076c-.42 0-.964-.148-1.368-.767-.223-.342-.511-1.288-.511-2.394 0-.606.19-1.592.67-3.03.955-2.866 3.1-7.864 6.821-15.911l3.03-6.513-.178-5.89a153.908 153.908 0 00-.33-5.346c-.352-.041-.773-.081-1.14-.096-.98-.049-1.616-.131-2.03-.261-.645-.204-1.016-.535-1.267-.928-.221-.348-.358-.79-.358-1.4 0-.282-.173-.735-.377-1.016l-.04-.059c-.621-.945-.859-1.757-.79-2.608.085-1.023.72-2.222 2.283-4.034l1.607-1.836c-.218-.687-.996-3.199-1.807-5.89-1.558-4.942-2.122-6.841-2.152-7.56-.034-.83.282-1.245.57-1.51a1.53 1.53 0 01.406-.265c-.217-1.235-.55-3.498-.875-5.878a488.89 488.89 0 00-1.323-9.829l-.617-4.175a1.5 1.5 0 01.455-1.31l3.361-3.172c4.301-4.11 9.749-8.888 13.287-11.709zm-3.879 71.31c-.31.283-.612.394-.858.441a1.547 1.547 0 01-1.04-.132l.103 3.418v.018l1.795-3.746zm12.426 1.473a23.55 23.55 0 01-.225.553 43.912 43.912 0 01-.763 1.686c.328-.11.65-.094.966.015l.022.008v-2.262zm1.524-3.996l-.032.037a1.575 1.575 0 01-.862.5c.042.411.057.798 0 1.25l.894-1.787zM16.286 65.87c-.566.056-1.034.117-1.267.149-.014.118-.03.275-.035.408-.012.4-.001.889.007 1.466.006.237.014.477.024.716.49-.997.97-2.02 1.271-2.739zm4.486-3.076a4.31 4.31 0 01-.88.654c.136.22.21.469.22.721l.281-.585.38-.79zm-.299-5.017c-1.381.168-3.98.324-6.29.365h-3.956l-.594.92c-.19.298-.36.7-.429.874.215.444.399 1.073.478 1.666h.014c.771.012 1.964-.048 3.819-.148 2.63-.125 3.979-.11 4.898-.616.326-.18.561-.453.817-.83.374-.551.75-1.276 1.243-2.23zm4.52-3.77a6.345 6.345 0 01-1.098.892c.156.141.3.333.383.595l.714-1.487zm15.241-3.122c-.47.934-.941 1.866-1.41 2.789.6-.264 1.192-.034 1.288.014.079.04.308.15.517.425a27.335 27.335 0 00-.224-1.044c-.185-.74-.289-1.336-.17-2.184zM24.148 5.38c-.758.673-2.198 1.856-3.649 2.944-5.896 4.33-9.738 7.717-11.4 9.978-.594.803-.97 1.279-1.177 1.801-.316.802-.217 1.685-.143 3.852.132 4.065 1.762 14.092 3.157 20.466.555 2.535 1.023 4.46 1.383 5.059.528.9.771 1.5.842 1.889.088.484.016.86-.118 1.167a1.86 1.86 0 01-.27.446l2.687-.021c1.825-.028 3.22.008 4.349-.038.897-.038 1.587-.111 2.187-.396.71-.336 1.26-.968 1.948-2.018 1.313-2.003 2.904-5.314 5.721-10.782 3.785-7.286 7.618-14.95 8.563-16.935l1.23-2.593-1.311-.984c-1.258-.967-5.182-4.782-8.717-8.51-2.604-2.769-4.52-4.608-5.282-5.325zm-11.86 47.181l-.001-.003-.026-.064.027.067zm-1.503-1.764l.059-.024a1.07 1.07 0 00-.059.024zm42.106-24.884l-.002.022.001-.009.001-.013zm.003-.035l.002-.071-.002.071zM20.773 13.917c-1.241.896-1.713 1.74-1.713 4.015 0 1.663.252 2.444.727 3.002.334.391.822.714 1.63 1.043.743.303 1.275.437 1.771.44.735.005 1.457-.254 2.72-1.109 1.495-1.02 2.072-1.825 2.19-2.615.111-.744-.188-1.715-1.214-3.254-.872-1.307-1.805-2.006-2.727-2.266-1.036-.292-2.15-.105-3.356.723l-.028.02zm4.263 4.285c-.128-.242-.375-.69-.648-1.099-.4-.598-.691-1.03-1.123-1.056-.24-.015-.473.123-.744.308-.461.337-.461.721-.461 1.577 0 .417.04.883.058 1.064.1.052.282.142.431.203.283.115.47.216.66.218.084 0 .152-.057.255-.113.215-.115.46-.275.757-.476.311-.213.632-.472.815-.626zM19.293 2.669l-.005.003.005-.003z",fill:"currentColor"})]}),{width:89,height:131,style:{transform:"translateX(4px)"}}),yu=e=>{let{elements:t,appState:n,files:i,onError:s}=e;return Object(kr.jsxs)(kd,{color:"indigo",children:[Object(kr.jsx)("div",{className:"Card-icon",children:vu}),Object(kr.jsx)("h2",{children:"Excalidraw+"}),Object(kr.jsx)("div",{className:"Card-details",children:w("exportDialog.excalidrawplus_description")}),Object(kr.jsx)(Mr,{className:"Card-button",type:"button",title:w("exportDialog.excalidrawplus_button"),"aria-label":w("exportDialog.excalidrawplus_button"),showAriaLabel:!0,onClick:async()=>{try{await(async(e,t,n)=>{const i=await Vh(),s="".concat(Object(ht.a)(12)),r=await Object(Lh.d)(),o=await Object(Lh.c)(r,bl(e,t,n,"database")),a=new Blob([o.iv,new Uint8Array(o.encryptedBuffer)],{type:d.D.binary});await i.storage().ref("/migrations/scenes/".concat(s)).put(a,{customMetadata:{data:JSON.stringify({version:2,name:t.name}),created:Date.now().toString()}});const l=new Map;for(const c of e)ut(c)&&n[c.fileId]&&l.set(c.fileId,n[c.fileId]);if(l.size){const e=await Ph({files:l,encryptionKey:r,maxBytes:Oh});await Kh({prefix:"/migrations/files/scenes/".concat(s),files:e})}window.open("https://plus.excalidraw.com/import?excalidraw=".concat(s,",").concat(r))})(t,n,i)}catch(e){console.error(e),"AbortError"!==e.name&&s(new Error(w("exportDialog.excalidrawplus_exportError")))}}})]})};var xu=n(22);const wu=Object(xu.a)("files-db","files-store"),ju=async e=>{const t=await Object(xu.d)(wu);for(const n of t)e.currentFileIds.includes(n)||Object(xu.b)(n,wu)},Su=new Dh({getFiles:e=>Object(xu.c)(e,wu).then((t=>{const n=[],i=new Map;return t.forEach(((t,s)=>{const r=e[s];t?n.push(t):i.set(r,!0)})),{loadedFiles:n,erroredFiles:i}})),async saveFiles(e){let{addedFiles:t}=e;const n=new Map,i=new Map;return await Promise.all([...t].map((async e=>{let[t,s]=e;try{await Object(xu.e)(t,s,wu),n.set(t,!0)}catch(r){console.error(r),i.set(t,!0)}}))),{savedFiles:n,erroredFiles:i}}}),Eu=new r.a;Eu.init({languageUtils:{formatLanguageCode:e=>e,isWhitelisted:()=>!0},checkWhitelist:!1});const Ou=Le((async(e,t,n,i)=>{((e,t)=>{try{localStorage.setItem($h,JSON.stringify(lr(e))),localStorage.setItem(eu,JSON.stringify(rt(t)))}catch(n){console.error(n)}})(e,t),await Su.saveFiles({elements:e,files:n}),i()}),300),Cu=()=>{Ou.flush()},ku=async e=>{const t=new URLSearchParams(window.location.search).get("id"),n=window.location.hash.match(/^#json=([a-zA-Z0-9_-]+),([a-zA-Z0-9_-]+)$/),i=window.location.hash.match(/^#url=(.*)$/),s=(()=>{let e=null,t=null;try{e=localStorage.getItem($h),t=localStorage.getItem(eu)}catch(s){console.error(s)}let n=[];if(e)try{n=lr(JSON.parse(e))}catch(s){console.error(s)}let i=null;if(t)try{i={...nt(),...rt(JSON.parse(t))}}catch(s){console.error(s)}return{elements:n,appState:i}})();let r=await Qh(null,null,s),o=(e=>{const t=new URL(e).hash.match(/^#room=([a-zA-Z0-9_-]+),([a-zA-Z0-9_-]+)$/);return t&&22!==t[2].length?(window.alert(w("alerts.invalidEncryptionKey")),null):t?{roomId:t[1],roomKey:t[2]}:null})(window.location.href);const a=!!(t||n||o);if(a)if(!r.elements.length||o||window.confirm(w("alerts.loadSceneOverridePrompt")))n&&(r=await Qh(n[1],n[2],s)),r.scrollToContent=!0,o||window.history.replaceState({},d.c,window.location.origin);else{if(document.hidden)return new Promise(((t,n)=>{window.addEventListener("focus",(()=>ku(e).then(t).catch(n)),{once:!0})}));o=null,window.history.replaceState({},d.c,window.location.origin)}else if(i){window.history.replaceState({},d.c,window.location.origin);const e=i[1];try{const t=await fetch(window.decodeURIComponent(e)),n=await dl(await t.blob(),null,null);if(!r.elements.length||window.confirm(w("alerts.loadSceneOverridePrompt")))return{scene:n,isExternalScene:a}}catch(l){return{scene:{appState:{errorMessage:w("alerts.invalidSceneUrl")}},isExternalScene:a}}}return o?{scene:await e.collabAPI.initializeSocketClient(o),isExternalScene:!0,id:o.roomId,key:o.roomKey}:r?a&&n?{scene:r,isExternalScene:a,id:n[1],key:n[2]}:{scene:r,isExternalScene:!1}:{scene:null,isExternalScene:!1}},Iu=Object(kr.jsxs)("p",{style:{direction:"ltr",unicodeBidi:"embed"},children:["Introducing Excalidraw+",Object(kr.jsx)("br",{}),Object(kr.jsx)("a",{href:"https://plus.excalidraw.com/?utm_source=excalidraw&utm_medium=banner&utm_campaign=launch",target:"_blank",rel:"noreferrer",children:"Try out now!"})]}),Mu=()=>{var e;const[t,n]=Object(o.useState)("");let i=Eu.detect()||m.code;Array.isArray(i)&&(i=i[0]);const[s,r]=Object(o.useState)(i),a=Object(o.useRef)({promise:null});a.current.promise||(a.current.promise=Ye()),Object(o.useEffect)((()=>{setTimeout((()=>{Object(l.a)("load","version",qe())}),d.X)}),[]);const[c,h]=ct(),u=null===(e=Object(o.useContext)(du))||void 0===e?void 0:e.api;Object(o.useEffect)((()=>{if(!u||!c)return;const e=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.scene){if(u.isCollaborating())e.scene.elements&&u.fetchImageFilesFromFirebase({elements:e.scene.elements}).then((e=>{let{loadedFiles:t,erroredFiles:n}=e;c.addFiles(t),zh({excalidrawAPI:c,erroredFiles:n,elements:c.getSceneElementsIncludingDeleted()})}));else{var n;const i=(null===(n=e.scene.elements)||void 0===n?void 0:n.reduce(((e,t)=>ut(t)?e.concat(t.fileId):e),[]))||[];e.isExternalScene?Xh("".concat(Mh,"/").concat(e.id),e.key,i).then((e=>{let{loadedFiles:t,erroredFiles:n}=e;c.addFiles(t),zh({excalidrawAPI:c,erroredFiles:n,elements:c.getSceneElementsIncludingDeleted()})})):t&&(i.length&&Su.getFiles(i).then((e=>{let{loadedFiles:t,erroredFiles:n}=e;t.length&&c.addFiles(t),zh({excalidrawAPI:c,erroredFiles:n,elements:c.getSceneElementsIncludingDeleted()})})),ju({currentFileIds:i}))}try{e.scene.libraryItems=JSON.parse(localStorage.getItem(d.L.LOCAL_STORAGE_LIBRARY))||[]}catch(i){console.error(i)}}};ku({collabAPI:u}).then((t=>{e(t,!0),a.current.promise.resolve(t.scene)}));const t=t=>{t.preventDefault();const n=new URLSearchParams(window.location.hash.slice(1)),i=n.get(d.U.addLibrary);i?(window.history.replaceState({},"",t.oldURL),c.importLibrary(i,n.get("token"))):ku({collabAPI:u}).then((t=>{e(t),t.scene&&c.updateScene({...t.scene,appState:il(t.scene.appState,null)})}))},n=setTimeout((()=>document.title=d.c),d.R);return window.addEventListener(d.s.HASHCHANGE,t,!1),window.addEventListener(d.s.UNLOAD,Cu,!1),window.addEventListener(d.s.BLUR,Cu,!1),()=>{window.removeEventListener(d.s.HASHCHANGE,t,!1),window.removeEventListener(d.s.UNLOAD,Cu,!1),window.removeEventListener(d.s.BLUR,Cu,!1),clearTimeout(n)}}),[u,c]),Object(o.useEffect)((()=>{const e=e=>{Ou.flush(),c&&Su.shouldPreventUnload(c.getSceneElements())&&Je(e)};return window.addEventListener(d.s.BEFORE_UNLOAD,e),()=>{window.removeEventListener(d.s.BEFORE_UNLOAD,e)}}),[c]),Object(o.useEffect)((()=>{Eu.cacheUserLanguage(s)}),[s]);const g=Object(o.useCallback)(((e,t)=>e?null:Object(kr.jsx)("div",{style:{width:"24ch",fontSize:"0.7em",textAlign:"center"},children:Iu})),[]),b=Object(o.useCallback)((e=>{const t=()=>Object(kr.jsx)(gu,{onChange:e=>r(e),languages:p,currentLangCode:s});if(e){const e=window.innerWidth<362;return Object(kr.jsxs)("div",{style:{display:"flex",flexDirection:e?"column":"row"},children:[Object(kr.jsxs)("fieldset",{children:[Object(kr.jsx)("legend",{children:w("labels.language")}),t()]}),Object(kr.jsx)("div",{style:{width:"24ch",fontSize:"0.7em",textAlign:"center",marginTop:e?16:void 0,marginLeft:"auto",marginRight:e?"auto":void 0,padding:"4px 2px",border:"1px dashed #aaa",borderRadius:12},children:Iu})]})}return Object(kr.jsxs)(kr.Fragment,{children:[Object(kr.jsx)("a",{className:"encrypted-icon tooltip",href:"https://blog.excalidraw.com/end-to-end-encryption/",target:"_blank",rel:"noopener noreferrer","aria-label":w("encrypted.link"),children:Object(kr.jsx)(La,{label:w("encrypted.tooltip"),long:!0,children:xo})}),t()]})}),[s]),f=Object(o.useCallback)((()=>{Su.reset()}),[]);return Object(kr.jsxs)(kr.Fragment,{children:[Object(kr.jsx)(Eh,{ref:h,onChange:(e,t,n)=>{(null===u||void 0===u?void 0:u.isCollaborating())?u.broadcastElements(e):Ou(e,t,n,(()=>{if(c){let e=!1,n=t.pendingImageElement;const i=c.getSceneElementsIncludingDeleted().map((t=>{if(Su.shouldUpdateImageElementStatus(t)){e=!0;const i=kn(t,{status:"saved"});return n===t&&(n=i),i}return t}));e&&c.updateScene({elements:i,appState:{pendingImageElement:n}})}}))},initialData:a.current.promise,onCollabButtonClick:null===u||void 0===u?void 0:u.onCollabButtonClick,isCollaborating:null===u||void 0===u?void 0:u.isCollaborating(),onPointerUpdate:null===u||void 0===u?void 0:u.onPointerUpdate,UIOptions:{canvasActions:{export:{onExportToBackend:async(e,t,i,s)=>{if(0===e.length)return window.alert(w("alerts.cannotExportEmptyCanvas"));if(s)try{await(async(e,t,n)=>{const i=await Object(Lh.d)("string"),s=await Object(Th.b)((new TextEncoder).encode(bl(e,t,n,"database")),{encryptionKey:i});try{const t=new Map;for(const i of e)ut(i)&&n[i.fileId]&&t.set(i.fileId,n[i.fileId]);const r=await Ph({files:t,encryptionKey:i,maxBytes:Oh}),o=await fetch("https://json.excalidraw.com/api/v2/post/",{method:"POST",body:s.buffer}),a=await o.json();if(a.id){const e=new URL(window.location.href);e.hash="json=".concat(a.id,",").concat(i);const t=e.toString();await Kh({prefix:"/files/shareLinks/".concat(a.id),files:r}),window.prompt("\ud83d\udd12".concat(w("alerts.uploadedSecurly")),t)}else"RequestTooLargeError"===a.error_class?window.alert(w("alerts.couldNotCreateShareableLinkTooBig")):window.alert(w("alerts.couldNotCreateShareableLink"))}catch(r){console.error(r),window.alert(w("alerts.couldNotCreateShareableLink"))}})(e,{...t,viewBackgroundColor:t.exportBackground?t.viewBackgroundColor:nt().viewBackgroundColor},i)}catch(r){if("AbortError"!==r.name){const{width:e,height:t}=s;console.error(r,{width:e,height:t}),n(r.message)}}},renderCustomUI:(e,t,n)=>Object(kr.jsx)(yu,{elements:e,appState:t,files:n,onError:e=>{null===c||void 0===c||c.updateScene({appState:{errorMessage:e.message}})}})}}},renderTopRightUI:g,renderFooter:b,langCode:s,renderCustomStats:()=>Object(kr.jsx)(fu,{setToastMessage:e=>c.setToastMessage(e)}),detectScroll:!1,handleKeyboardGlobally:!0,onLibraryChange:async e=>{if(!e.length)return void localStorage.removeItem(d.L.LOCAL_STORAGE_LIBRARY);const t=JSON.stringify(e);localStorage.setItem(d.L.LOCAL_STORAGE_LIBRARY,t)},autoFocus:!0}),c&&Object(kr.jsx)(pu,{excalidrawAPI:c,onRoomClose:f}),t&&Object(kr.jsx)(bh,{message:t,onClose:()=>n("")})]})};var Au=()=>Object(kr.jsx)(vh,{children:Object(kr.jsx)(hu,{children:Object(kr.jsx)(Mu,{})})});const Tu=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)),Lu=(e,t)=>{navigator.serviceWorker.register(e).then((e=>{e.onupdatefound=()=>{const n=e.installing;null!=n&&(n.onstatechange=()=>{"installed"===n.state&&(navigator.serviceWorker.controller?(console.info("New content is available and will be used when all tabs for this page are closed."),t&&t.onUpdate&&t.onUpdate(e)):(console.info("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((e=>{console.error("Error during service worker registration:",e)}))},Du=(e,t)=>{fetch(e,{headers:{"Service-Worker":"script"}}).then((n=>{const i=n.headers.get("content-type");404===n.status||null!=i&&-1===i.indexOf("javascript")?navigator.serviceWorker.ready.then((e=>{e.unregister().then((()=>{window.location.reload()}))})):Lu(e,t)})).catch((e=>{console.info("No internet connection found. App is running in offline mode.",e.message)}))},Pu=e=>{"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((e=>e.unregister())).then((()=>{null===e||void 0===e||e()})).catch((e=>{console.error(e.message)}))};/\b(iPad|iPhone|iPod|Safari)\b/.test(navigator.userAgent)&&!matchMedia("(display-mode: standalone)").matches&&n.e(48).then(n.t.bind(null,234,7)),(e=>{if("serviceWorker"in navigator){if(new URL(".",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(()=>{if(window.location.pathname.startsWith("/webex"))return Pu((()=>{window.location.reload()})),!1;const t="".concat(".","/service-worker.js");Tu?(Du(t,e),navigator.serviceWorker.ready.then((()=>{console.info("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):Lu(t,e)}))}})({onUpdate:e=>{const t=e.waiting;t&&(t.addEventListener(d.s.STATE_CHANGE,(e=>{"activated"===e.target.state&&window.location.reload()})),t.postMessage({type:"SKIP_WAITING"}))}});var zu=n(155),Nu=n(154);const Ru={"excalidraw.com":"production","vercel.app":"staging"},Bu=!("true"===Object({NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GIT_SHA:"",REACT_APP_BACKEND_V2_GET_URL:"https://json.excalidraw.com/api/v2/",REACT_APP_BACKEND_V2_POST_URL:"https://json.excalidraw.com/api/v2/post/",REACT_APP_LIBRARY_URL:"https://libraries.excalidraw.com",REACT_APP_LIBRARY_BACKEND:"https://us-central1-excalidraw-room-persistence.cloudfunctions.net/libraries",REACT_APP_SOCKET_SERVER_URL:"https://oss-collab-us1.excalidraw.com",REACT_APP_FIREBASE_CONFIG:'{"apiKey":"AIzaSyAd15pYlMci_xIp9ko6wkEsDzAAA0Dn0RU","authDomain":"excalidraw-room-persistence.firebaseapp.com","databaseURL":"https://excalidraw-room-persistence.firebaseio.com","projectId":"excalidraw-room-persistence","storageBucket":"excalidraw-room-persistence.appspot.com","messagingSenderId":"654800341332","appId":"1:654800341332:web:4a692de832b55bd57ce0c1"}',REACT_APP_GOOGLE_ANALYTICS_ID:"UA-387204-13"}).REACT_APP_DISABLE_SENTRY)&&Object.keys(Ru).find((e=>window.location.hostname.indexOf(e)>=0));zu.a({dsn:Bu?"https://7bfc596a5bf945eda6b660d3015a5460@sentry.io/5179260":void 0,environment:Bu?Ru[Bu]:void 0,release:"",ignoreErrors:["undefined is not an object (evaluating 'window.__pad.performLoop')"],integrations:[new Nu.a({levels:["error"]})],beforeSend(e){var t;return(null===(t=e.request)||void 0===t?void 0:t.url)&&(e.request.url=e.request.url.replace(/#.*$/,"")),e}}),window.__EXCALIDRAW_SHA__="",s.a.render(Object(kr.jsx)(Au,{}),document.getElementById("root"))}],[[105,49,51]]]);
//# sourceMappingURL=main.9640a3d2.chunk.js.map